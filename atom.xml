<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[liuchungui's Blog]]></title>
  <link href="http://www.liuchungui.com/atom.xml" rel="self"/>
  <link href="http://www.liuchungui.com/"/>
  <updated>2016-05-10T20:51:43+08:00</updated>
  <id>http://www.liuchungui.com/</id>
  <author>
    <name><![CDATA[åˆ˜æ˜¥æ¡‚]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Mac10.11å‡çº§å®‰è£…openssl]]></title>
    <link href="http://www.liuchungui.com/blog/2016/05/10/mac10-dot-11sheng-ji-an-zhuang-openssl/"/>
    <updated>2016-05-10T20:46:18+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/05/10/mac10-dot-11sheng-ji-an-zhuang-openssl</id>
    <content type="html"><![CDATA[<p>ä¸€ç›´æƒ³è¦å‡çº§Macä¸Šçš„opensslï¼Œä½†æ˜¯å‰é¢æ²¡å¼„æˆåŠŸï¼Œæ‰€ä»¥è€½æåˆ°ç°åœ¨ã€‚ä»Šå¤©ç”±äºå®‰è£…ä¸€ä¸ªè½¯ä»¶éœ€è¦å®‰è£…opensslåˆ°1.0.1ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ‰€ä»¥æŸ¥äº†ä¸‹èµ„æ–™ï¼Œç»ˆäºå‡çº§æˆåŠŸäº†ï¼Œä¹Ÿç®—æ˜¯è¿˜äº†å‰é¢ä¸€ç¯‡åšå®¢çš„å€ºã€‚</p>

<!-- more -->


<p>é¦–å…ˆï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬çš„opensslçš„ç‰ˆæœ¬å’Œç›®å½•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>openssl version
</span><span class='line'>OpenSSL 0.9.8zh <span class="m">14</span> Jan 2016
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>which openssl
</span><span class='line'>/usr/local/bin/openssl
</span></code></pre></td></tr></table></div></figure>


<p>é€šè¿‡ä¸Šé¢çš„æŸ¥çœ‹ï¼Œæ˜æ˜¾æˆ‘ä»¬çš„ç‰ˆæœ¬å·å¤ªä½äº†ï¼Œäºæ˜¯googleäº†ä¸‹ï¼Œæ‰¾åˆ°äº†<a href="http://apple.stackexchange.com/questions/126830/how-to-upgrade-openssl-in-os-x">http://apple.stackexchange.com/questions/126830/how-to-upgrade-openssl-in-os-x</a>ã€‚</p>

<p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬é¦–å…ˆæ›´æ–°<code>homebrew</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>brew update
</span><span class='line'>
</span><span class='line'>Error: Cowardly refusing to <span class="sb">`</span>sudo brew update<span class="sb">`</span>
</span><span class='line'>You can use brew with sudo, but only <span class="k">if</span> the brew executable is owned by root.
</span><span class='line'>However, this is both not recommended and completely unsupported so <span class="k">do</span> so at
</span><span class='line'>your own risk.
</span><span class='line'>bogon:Downloads user<span class="nv">$ </span>brew update
</span><span class='line'>Error: The /usr/local directory is not writable.
</span><span class='line'>Even <span class="k">if</span> this directory was writable when you installed Homebrew, other
</span><span class='line'>software may change permissions on this directory. Some versions of the
</span><span class='line'><span class="s2">&quot;InstantOn&quot;</span> component of Airfoil or running Cocktail cleanup/optimizations
</span><span class='line'>are known to <span class="k">do</span> this.
</span><span class='line'>
</span><span class='line'>You should probably change the ownership and permissions of /usr/local
</span><span class='line'>back to your user account.
</span><span class='line'>  sudo chown -R <span class="k">$(</span>whoami<span class="k">)</span>:admin /usr/local
</span></code></pre></td></tr></table></div></figure>


<p>å¾ˆä¸å¹¸ï¼Œæˆ‘ä»¬åœ¨æ›´æ–°çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼Œå¥½åœ¨homebrewæœ‰é”™è¯¯æé†’ï¼Œæˆ‘ä»¬æŒ‰ç…§æé†’æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œç»§ç»­å®‰è£…ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo chown -R <span class="k">$(</span>whoami<span class="k">)</span>:admin /usr/local
</span><span class='line'><span class="nv">$ </span>brew update
</span><span class='line'>Updated Homebrew from e3986e9 to 21ce7a5.
</span><span class='line'><span class="o">==</span>&gt; Migrating Homebrew to v0.9.9
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹åˆ°è¿™ä¸ªä¿¡æ¯ï¼Œå°±æ˜¯æˆåŠŸçš„åœ¨æ›´æ–°äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½æ¯”è¾ƒä¹…ç‚¹ã€‚æ›´æ–°å®Œä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹é€šè¿‡homebrewå®‰è£…opensslã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>brew install <span class="nv">openssl</span>
</span><span class='line'>
</span><span class='line'><span class="o">==</span>&gt; Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2h.el_capitan.b
</span><span class='line'><span class="c">######################################################################## 100.0%</span>
</span><span class='line'>...
</span><span class='line'><span class="o">==</span>&gt; Summary
</span><span class='line'>ğŸº  /usr/local/Cellar/openssl/1.0.2h: 1,691 files, 12M
</span></code></pre></td></tr></table></div></figure>


<p>å½“æœ€åæ˜¾ç¤ºğŸºé‚£ä¸ªæ ‡å¿—ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸçš„å°†opensslå®‰è£…åˆ°<code>/usr/local/Cellar/openssl/1.0.2h</code>ã€‚</p>

<p>ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æœ‰æœ€åä¸€æ­¥ï¼Œé‚£å°±æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨opensslæ—¶ï¼Œä½¿ç”¨çš„æ˜¯æˆ‘ä»¬ç”¨homebrewæ–°ä¸‹è½½çš„opensslã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p>

<p>ç¬¬ä¸€ç§ï¼š</p>

<p>å°†homebrewä¸‹è½½çš„opensslè½¯é“¾æ¥åˆ°/usr/bin/opensslç›®å½•ä¸‹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå°†å®ƒä¿å­˜ä¸€ä»½è€çš„ï¼Œç„¶åå†è½¯é“¾æ¥æ–°ä¸‹è½½çš„ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mv /usr/bin/openssl /usr/bin/openssl_old
</span><span class='line'>mv: rename /usr/bin/openssl to /usr/bin/openssl_old: Operation not permitted
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>ln -s /usr/local/Cellar/openssl/1.0.2h/bin/openssl /usr/bin/openssl
</span><span class='line'>ln: /usr/bin/openssl: Operation not permitted
</span></code></pre></td></tr></table></div></figure>


<p><code>Operation not permitted</code>æç¤ºæ²¡æœ‰æƒé™æ“ä½œï¼Œå¯¹<code>/usr/bin</code>ç›®å½•ä¸‹çš„ä¸œè¥¿ï¼Œæˆ‘å·²ç»é‡åˆ°è¿‡å‡ æ¬¡è¿™ä¸ªé—®é¢˜äº†ï¼Œäºæ˜¯ç»§ç»­googleï¼Œåœ¨stackoverflowä¸Šæ‰¾åˆ°äº†<a href="http://stackoverflow.com/questions/32659348/operation-not-permitted-when-on-root-el-capitan-rootless-disabled">Operation Not Permitted when on root El capitan (rootless disabled)</a>ã€‚</p>

<p>é‡å¯ç³»ç»Ÿï¼Œå½“å¯åŠ¨çš„æ—¶å€™æˆ‘ä»¬åŒæ—¶æŒ‰ä¸‹<code>cmd+r</code>è¿›å…¥Recoveryæ¨¡å¼ï¼Œä¹‹åé€‰æ‹©<code>å®ç”¨å·¥å…·</code> => <code>ç»ˆç«¯</code>ï¼Œåœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæ¥å£æ–‡ä»¶ç³»ç»Ÿçš„é”å®šï¼Œå¹¶ä¸”é‡å¯ç”µè„‘ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>csrutil disable
</span><span class='line'><span class="nv">$ </span>reboot
</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œæˆ‘ä»¬æ‰§è¡Œå‰é¢ä¸¤ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mv /usr/bin/openssl /usr/bin/openssl_old
</span><span class='line'><span class="nv">$ </span>ln -s /usr/local/Cellar/openssl/1.0.2h/bin/openssl /usr/bin/openssl
</span><span class='line'><span class="nv">$ </span>openssl version
</span><span class='line'>OpenSSL 1.0.2h  <span class="m">3</span> May 2016
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„opensslå‡çº§æˆåŠŸäº†ã€‚ä¸è¿‡ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘è¿˜æ˜¯é‡æ–°å¯åŠ¨ç”µè„‘ï¼Œç„¶åé‡æ–°å¼€å¯äº†<code>csrutil</code>ã€‚</p>

<p>ç¬¬äºŒç§ï¼š</p>

<p>åœ¨æ“ä½œå®Œå‰é¢ä¸€ç§æ–¹æ³•ä¹‹åï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯ç›´æ¥å°†opensslè½¯é“¾æ¥åˆ°<code>/usr/local/bin/openssl</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#å¦‚æœ/usr/local/bin/opensslä¸‹å­˜åœ¨ï¼Œåˆ™å…ˆåˆ é™¤ /usr/local/bin/openssl</span>
</span><span class='line'><span class="nv">$ </span>rm /usr/local/bin/openssl
</span><span class='line'>
</span><span class='line'><span class="c">#å°†ä»¥å‰é€šè¿‡homebrewä¸‹è½½çš„1.0.2eç‰ˆæœ¬çš„opensslé“¾æ¥åˆ°/usr/local/bin/openssl</span>
</span><span class='line'><span class="nv">$ </span>ln -s /usr/local/Cellar/openssl/1.0.2e/bin/openssl /usr/local/bin/openssl
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>openssl
</span><span class='line'>OpenSSL 1.0.2e <span class="m">3</span> Dec 2015
</span></code></pre></td></tr></table></div></figure>


<h2>æ€»ç»“</h2>

<p>ä¸»è¦è®°å½•äº†å®‰è£…opensslè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼ŒåŒæ—¶ä¹ŸçŸ¥é“å½“å¦‚æœå¯¹<code>/usr/bin</code>ç±»ä¼¼æ–‡ä»¶ç›®å½•æ— æ“ä½œæƒé™çš„æ—¶å€™æ€ä¹ˆè§£é”æ–‡ä»¶ç³»ç»Ÿã€‚å½“ç„¶ï¼Œæœ€å¥½æ˜¯å°†å‘½ä»¤é€šè¿‡lné“¾æ¥åˆ°<code>/usr/local/bin</code>ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„æƒé™è‹¹æœè¿˜æ˜¯å¼€æ”¾ç»™æˆ‘çš„ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ReactNativeä¹‹åŸç”Ÿæ¨¡å—å¼€å‘å¹¶å‘å¸ƒâ€”â€”androidç¯‡]]></title>
    <link href="http://www.liuchungui.com/blog/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/"/>
    <updated>2016-05-08T14:00:09+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian</id>
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´åšäº†ä¸ªReactNativeçš„Appï¼Œå‘ç°ReactNativeä¸­ä¸å°‘ç»„ä»¶å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è‡ªå·±å¯¹åŸç”Ÿæ¨¡å—è¿›è¡Œç¼–å†™è®©JSè°ƒç”¨ï¼Œæ­£æ˜¯å› ä¸ºåœ¨è¿™ä¸ªç¼–å†™è¿‡ç¨‹ä¸­é‡åˆ°ä¸å°‘é—®é¢˜ï¼Œå‘è§‰äº†å®˜ç½‘æ–‡æ¡£ä¸­è®¸å¤šçš„ä¸è¶³ã€‚æ‰€ä»¥äº§ç”Ÿäº†å†™ä¸€ä¸ªå®è·µæ•™ç¨‹çš„æƒ³æ³•ï¼Œæœ€ç»ˆæœ‰äº†è¿™ä¹ˆä¸€ç¯‡æ–‡ç« ã€‚</p>

<p>æ•´ç¯‡æ–‡ç« ä¸»è¦ä»¥ç¼–å†™ä¸€ä¸ªåŸç”Ÿæ¨¡å—ä¸ºä¾‹å­ï¼Œæ¥è®²è¿°äº†æˆ‘ä»¬åœ¨ç¼–å†™åŸç”Ÿæ¨¡å—æ‰€ç”¨åˆ°çš„ä¸€äº›çŸ¥è¯†ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªä¾‹å­ä¸­ï¼Œé…æœ‰äº†å®Œæ•´çš„å®è·µä»£ç ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£å¹¶è°ƒè¯•ã€‚é™¤äº†è¿™äº›å†…å®¹ï¼Œæ–‡ç« è¿˜è®²è¿°äº†æˆ‘ä»¬å¦‚ä½•å°†è‡ªå·±ç¼–å†™çš„åŸç”Ÿæ¨¡å—å‘å¸ƒåˆ°npmä¸Šåˆ†äº«ç»™åˆ«äººä½¿ç”¨ã€‚å¸Œæœ›èƒ½å¤Ÿç»™å¤§å®¶å¸¦æ¥å¸®åŠ©ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å°†è‡ªå·±ç¼–å†™çš„åŸç”Ÿæ¨¡å—åˆ†äº«å‡ºæ¥ã€‚</p>

<p>ç¤ºä¾‹ä»£ç githubåœ°å€ï¼š<a href="https://github.com/liuchungui/react-native-BGNativeModuleExample">https://github.com/liuchungui/react-native-BGNativeModuleExample</a></p>

<!-- more -->


<h2>å‡†å¤‡å·¥ä½œ</h2>

<p>æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªReactNativeå·¥ç¨‹ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>react native init TestProject
</span></code></pre></td></tr></table></div></figure>


<p>åˆ›å»ºå¥½å·¥ç¨‹ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨android studioæ‰“å¼€<code>TestProject/android/</code>ä¸‹çš„androidå·¥ç¨‹ã€‚</p>

<p>ä¹‹åï¼Œç‚¹å‡»android studioèœå•ä¸Šçš„File â€”â€”> New â€”â€”> New Moduleï¼Œä¹‹åé€‰æ‹©<code>Android Library</code>ï¼Œè®¾ç½®æ¨¡å—åå’ŒåŒ…åï¼Œæˆ‘çš„è®¾ç½®å¦‚ä¸‹ï¼š
<img src="http://ww2.sinaimg.cn/large/7746cd07jw1f3ilkyhcuzj21kw10w42q.jpg" alt="" /></p>

<p>ç‚¹å‡»å®Œæˆä¹‹åï¼Œæˆ‘ä»¬çš„å®‰å“é¡¹ç›®ä¸­å°±å¤šäº†ä¸ªåå­—ä¸º<code>nativemoduleexample</code>æ¨¡å—ã€‚
<img src="http://ww1.sinaimg.cn/large/7746cd07jw1f3iluj6owuj20qy11mgt8.jpg" alt="" />
ä¹‹åï¼Œæˆ‘ä»¬åœ¨<code>app</code>å·¥ç¨‹ä¸­çš„<code>build.gradle</code>æ–‡ä»¶ä¸­çš„<code>dependencies</code>æ·»åŠ ä¸€è¡Œ<code>compile project(':nativemoduleexample')</code>ï¼Œè®©ä¸»å·¥ç¨‹<code>app</code>ä¾èµ–æˆ‘ä»¬æ–°åˆ›å»ºçš„Libraryã€‚</p>

<p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®©æ–°åˆ›å»ºçš„Libraryä¾èµ–<code>react native</code>ï¼Œå’Œä¸Šé¢å·®ä¸å¤šï¼Œåªéœ€è¦åœ¨æˆ‘ä»¬æ–°åˆ›å»ºçš„<code>nativemoduleexample</code>ä¸‹çš„<code>build.gradle</code>ä¸­çš„<code>dependencies</code>æ·»åŠ ä¸€è¡Œ<code>compile "com.facebook.react:react-native:+"</code>å°±è¡Œäº†ã€‚</p>

<h2>ä¸€ã€ç¼–å†™åŸç”Ÿæ¨¡å—ä»£ç </h2>

<h4>1ã€åˆ›å»ºåŸç”Ÿæ¨¡å—ï¼Œå¹¶è¿›è¡Œæ³¨å†Œ</h4>

<p>æˆ‘ä»¬é¦–å…ˆç‚¹å‡»æ‰“å¼€å‰é¢åˆ›å»ºçš„<code>nativemoduleexample</code>åº“ï¼Œåœ¨<code>src/main/java/com/liuchungui/nativemoduleexample</code>ç›®å½•ä¸‹åˆ›å»ºæˆ‘ä»¬çš„åŸç”Ÿæ¨¡å—ç±»ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬å‰é¢åˆ›å»ºLibraryçš„åŒ…åä¸å¤ªä¸€æ ·ï¼Œé‚£<code>src/main/java/</code>åé¢è·Ÿä¸Šå°±æ˜¯å‰é¢è®¾ç½®çš„åŒ…åã€‚</p>

<p>åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸç”Ÿæ¨¡å—<code>BGNativeExampleModule</code>ï¼Œå®ƒç»§æ‰¿äº<code>ReactContextBaseJavaModule</code>ã€‚è¿™ä¸ªåŸç”Ÿæ¨¡å—å¿…é¡»å®ç°ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è¦†å†™<code>getName</code>æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åå­—ï¼Œåœ¨JSä¸­æˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ªåå­—è°ƒç”¨è¿™ä¸ªæ¨¡å—ï¼›å¦å¤–ä¸€ä¸ªæ˜¯æ„é€ æ–¹æ³•<code>BGNativeExampleModule</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">liuchungui</span><span class="o">.</span><span class="na">nativemoduleexample</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.NativeModule</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactApplicationContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactContextBaseJavaModule</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactMethod</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.lang.String</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BGNativeExampleModule</span> <span class="kd">extends</span> <span class="n">ReactContextBaseJavaModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">BGNativeExampleModule</span><span class="o">(</span><span class="n">ReactApplicationContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">reactContext</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;BGNativeModuleExample&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¨¡å—åå‰çš„RCTå‰ç¼€ä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚ä¾‹å¦‚"RCTBGNativeModuleExample"ï¼Œåœ¨JSä¸­çš„æ¨¡å—åå­—ä»ç„¶æ˜¯BGNativeModuleExampleã€‚</p>

<p>åˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥è®¿é—®è¿™ä¸ªæ¨¡å—äº†ï¼Ÿäº‹å®æ˜¯ç°åœ¨è¿˜ä¸èƒ½è®¿é—®ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦æ³¨å†Œè¿™ä¸ªæ¨¡å—ã€‚</p>

<p>ä¸ºäº†æ³¨å†ŒåŸç”Ÿæ¨¡å—ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>BGNativeExamplePackage</code>ç±»ï¼Œè¿™ä¸ªç±»è¦æ±‚å®ç°<code>ReactPackage</code>æ¥å£ï¼Œè¿™ä¸ªæ¥å£æœ‰ä¸‰ä¸ªæ–¹æ³•<code>createNativeModules</code>ã€<code>createJSModules</code>å’Œ<code>createViewManagers</code>ã€‚å…¶ä¸­ï¼Œ<code>createNativeModules</code>æ˜¯ç”¨æ¥æ·»åŠ åŸç”Ÿæ¨¡å—çš„ï¼›<code>createViewManagers</code>æ˜¯ç”¨æ¥æ·»åŠ åŸç”Ÿçš„UIç»„ä»¶ï¼›<code>createJSModules</code>æš‚æ—¶æ²¡ç”¨è¿‡ï¼Œä½†æ˜¯çœ‹å®˜æ–¹çš„æ³¨é‡Šï¼Œåº”è¯¥æ˜¯æ³¨å†Œæˆ‘ä»¬åŸç”Ÿæ¨¡å—ä¸­ç”¨åˆ°çš„JSæ¨¡å—ã€‚</p>

<p>æˆ‘ä»¬è¿™é‡Œåªéœ€è¦åœ¨<code>createNativeModules</code>æ–¹æ³•ä¸­æ·»åŠ åŸç”Ÿæ¨¡å—ï¼Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•è¿”å›ç©ºæ•°ç»„å°±è¡Œäº†ï¼Œæ•´ä¸ªpackageç±»çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">liuchungui</span><span class="o">.</span><span class="na">nativemoduleexample</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.ReactPackage</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.JavaScriptModule</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.NativeModule</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactApplicationContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.uimanager.ViewManager</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BGNativeExamplePackage</span> <span class="kd">implements</span> <span class="n">ReactPackage</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">NativeModule</span><span class="o">&gt;</span> <span class="nf">createNativeModules</span><span class="o">(</span><span class="n">ReactApplicationContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">NativeModule</span><span class="o">[]{</span>
</span><span class='line'>                <span class="k">new</span> <span class="nf">BGNativeExampleModule</span><span class="o">(</span><span class="n">reactContext</span><span class="o">),</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">JavaScriptModule</span><span class="o">&gt;&gt;</span> <span class="nf">createJSModules</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ViewManager</span><span class="o">&gt;</span> <span class="nf">createViewManagers</span><span class="o">(</span><span class="n">ReactApplicationContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œè¿™ä¸ªpackageéœ€è¦åœ¨<code>MainActivity.java</code>æ–‡ä»¶ä¸­çš„<code>getPackages</code>æ–¹æ³•ä¸­æä¾›ã€‚è¿™ä¸ªæ–‡ä»¶ä½äºæˆ‘ä»¬çš„reactNativeåº”ç”¨æ–‡ä»¶å¤¹çš„androidç›®å½•ä¸­ï¼Œè·¯å¾„æ˜¯:<code>android/app/src/main/java/com/testproject/MainActivity.java</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ReactPackage</span><span class="o">&gt;</span> <span class="nf">getPackages</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">Arrays</span><span class="o">.&lt;</span><span class="n">ReactPackage</span><span class="o">&gt;</span><span class="n">asList</span><span class="o">(</span>
</span><span class='line'>        <span class="k">new</span> <span class="nf">MainReactPackage</span><span class="o">(),</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">BGNativeExamplePackage</span><span class="o">()</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ°è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥åœ¨jsä¸­è®¿é—®æˆ‘ä»¬çš„åŸç”Ÿæ¨¡å—äº†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="err">{ </span><span class="nn">NativeModules</span> <span class="o">}</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">react</span><span class="o">-</span><span class="kd">native</span><span class="err">&#39;</span><span class="o">;</span>
</span><span class='line'><span class="n">var</span> <span class="n">BGNativeModuleExample</span> <span class="o">=</span> <span class="n">NativeModules</span><span class="o">.</span><span class="na">BGNativeModuleExample</span><span class="o">;</span>
</span><span class='line'><span class="n">console</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">BGNativeModuleExample</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2ã€ä¸ºåŸç”Ÿæ¨¡å—æ·»åŠ æ–¹æ³•</h4>

<p>è¦å¯¼å‡ºä¸€ä¸ªæ–¹æ³•ç»™JSä½¿ç”¨ï¼ŒJavaæ–¹æ³•éœ€è¦ä½¿ç”¨æ³¨è§£<code>@ReactMethod</code>ã€‚æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»ä¸ºvoidã€‚ReactNativeè·¨è¯­è¨€è®¿é—®æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œæ‰€ä»¥æƒ³è¦ç»™JSè¿”å›ä¸€ä¸ªå€¼ï¼Œå”¯ä¸€çš„åŠæ³•æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°æˆ–è€…å‘é€äº‹ä»¶ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.ReactMethod</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@ReactMethod</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPrint</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">ReadableMap</span> <span class="n">info</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
</span><span class='line'>  <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="n">info</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬å¦‚ä¸‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">BGNativeModuleExample</span><span class="o">.</span><span class="na">testPrint</span><span class="o">(</span><span class="s">&quot;Jack&quot;</span><span class="o">,</span> <span class="o">{</span>
</span><span class='line'>    <span class="nl">height:</span> <span class="err">&#39;</span><span class="mf">1.78</span><span class="n">m</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class='line'>    <span class="nl">weight:</span> <span class="err">&#39;</span><span class="mi">7</span><span class="n">kg</span><span class="err">&#39;</span>
</span><span class='line'><span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>3ã€å‚æ•°ç±»å‹</h4>

<p>åœ¨ç¼–å†™åŸç”Ÿæ¨¡å—çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“åŸç”ŸJavaæ•°æ®ç±»å‹å’ŒJSæ•°æ®ç±»å‹çš„æ˜ å°„å…³ç³»ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Boolean</span> <span class="o">-&gt;</span> <span class="n">Bool</span>
</span><span class='line'><span class="n">Integer</span> <span class="o">-&gt;</span> <span class="n">Number</span>
</span><span class='line'><span class="n">Double</span> <span class="o">-&gt;</span> <span class="n">Number</span>
</span><span class='line'><span class="n">Float</span> <span class="o">-&gt;</span> <span class="n">Number</span>
</span><span class='line'><span class="n">String</span> <span class="o">-&gt;</span> <span class="n">String</span>
</span><span class='line'><span class="n">Callback</span> <span class="o">-&gt;</span> <span class="n">function</span>
</span><span class='line'><span class="n">ReadableMap</span> <span class="o">-&gt;</span> <span class="n">Object</span>
</span><span class='line'><span class="n">ReadableArray</span> <span class="o">-&gt;</span> <span class="n">Array</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¯¦æƒ…å‚è€ƒï¼š<a href="https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableMap.java">ReadableMap</a>å’Œ<a href="https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableArray.java">ReadableArray</a></p>

<h4>4ã€å›è°ƒå‡½æ•°</h4>

<p>åŸç”Ÿæ¨¡å—è¿˜æ”¯æŒä¸€ç§ç‰¹æ®Šçš„å‚æ•°â€”â€”å›è°ƒå‡½æ•°ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥æŠŠè¿”å›å€¼ä¼ å›ç»™JSã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.Callback</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@ReactMethod</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">getNativeClass</span><span class="o">(</span><span class="n">Callback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">callback</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="s">&quot;BGNativeExampleModule&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–åˆ°åŸç”Ÿæ¨¡å—çš„ç±»åï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">getNativeClass</span><span class="p">(</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;nativeClass: &quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>5ã€Promises</h4>

<blockquote><p>åŸç”Ÿæ¨¡å—è¿˜å¯ä»¥ä½¿ç”¨promiseæ¥ç®€åŒ–ä»£ç ï¼Œæ­é…ES2016(ES7)æ ‡å‡†çš„async/awaitè¯­æ³•åˆ™æ•ˆæœæ›´ä½³ã€‚å¦‚æœæ¡¥æ¥åŸç”Ÿæ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªPromiseï¼Œåˆ™å¯¹åº”çš„JSæ–¹æ³•å°±ä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">com.facebook.react.bridge.Promise</span><span class="o">;</span>
</span><span class='line'><span class="nd">@ReactMethod</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPromises</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">isResolve</span><span class="o">,</span> <span class="n">Promise</span> <span class="n">promise</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="n">isResolve</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">promise</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">isResolve</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">promise</span><span class="o">.</span><span class="na">reject</span><span class="o">(</span><span class="n">isResolve</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>JSä¸­å¦‚ä¸‹è°ƒç”¨</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">testPromises</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span class='line'><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;result is &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;result = &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>6ã€å¯¼å‡ºå¸¸é‡</h4>

<p>  æˆ‘ä»¬åœ¨<code>getContants</code>æ–¹æ³•ä¸­å¯¼å‡ºjsæ‰€éœ€è¦ä½¿ç”¨çš„å¸¸é‡ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span>  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getConstants</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">constants</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="n">constants</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;BGModuleName&quot;</span><span class="o">,</span> <span class="s">&quot;BGNativeModuleExample&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">constants</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">TestEventName</span><span class="o">,</span> <span class="n">TestEventName</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">constants</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> æˆ‘ä»¬åœ¨JSä¸­æ‰“å°<code>BGModuleName</code>è¿™ä¸ªå¸¸é‡çš„å€¼ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;BGModuleName const value = &quot;</span><span class="p">,</span> <span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">BGModuleName</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>7ã€ç»™JSå‘é€äº‹ä»¶</h4>

<blockquote><p>åŸç”Ÿæ¨¡å—å¯ä»¥åœ¨æ²¡æœ‰è¢«è°ƒç”¨çš„æƒ…å†µä¸‹å¾€JSå‘é€äº‹ä»¶é€šçŸ¥ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯é€šè¿‡<code>RCTDeviceEventEmitter</code>ï¼Œè¿™å¯ä»¥é€šè¿‡<code>ReactContext</code>è·å¾—å¯¹åº”çš„å¼•ç”¨ã€‚</p></blockquote>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿæ¥æ”¶åˆ°äº‹ä»¶ï¼Œå¼€å¯äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯ä¸€ç§’å‘é€ä¸€æ¬¡äº‹ä»¶ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BGNativeExampleModule</span> <span class="kd">extends</span> <span class="n">ReactContextBaseJavaModule</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">BGNativeExampleModule</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span>  <span class="n">String</span> <span class="n">TestEventName</span> <span class="o">=</span> <span class="s">&quot;TestEventName&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Timer</span> <span class="n">timer</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">BGNativeExampleModule</span><span class="o">(</span><span class="kd">final</span> <span class="n">ReactApplicationContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">reactContext</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">//å¼€å¯å®šæ—¶å™¨</span>
</span><span class='line'>        <span class="n">TimerTask</span> <span class="n">task</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TimerTask</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="c1">//å‘é€äº‹ä»¶</span>
</span><span class='line'>                <span class="n">WritableMap</span> <span class="n">params</span> <span class="o">=</span> <span class="n">Arguments</span><span class="o">.</span><span class="na">createMap</span><span class="o">();</span>
</span><span class='line'>                <span class="n">params</span><span class="o">.</span><span class="na">putString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Jack&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="n">reactContext</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">getJSModule</span><span class="o">(</span><span class="n">DeviceEventManagerModule</span><span class="o">.</span><span class="na">RCTDeviceEventEmitter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">emit</span><span class="o">(</span><span class="n">TestEventName</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>        <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Timer</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">task</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨<code>DeviceEventEmitter</code>æ¨¡å—æ¥ç›‘å¬äº‹ä»¶ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//æ¥æ”¶äº‹ä»¶</span>
</span><span class='line'><span class="nx">DeviceEventEmitter</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">TestEventName</span><span class="p">,</span> <span class="nx">info</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè¯´ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Subscribable mixin</code>çš„addListenerOnæ–¹æ³•æ¥æ¥æ”¶äº‹ä»¶ï¼Œå…¶å®å®ƒå°±æ˜¯å¯¹<code>DeviceEventEmitter</code>ä¸€ç§å°è£…ã€‚è€Œä¸”ï¼Œåœ¨<code>es6</code>ä¹‹åï¼Œä¸å†æ”¯æŒ<code>mixins</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨DeviceEventEmitteræ¥æ”¶äº‹ä»¶æ¯”è¾ƒå¥½ã€‚</p>

<h4>8ã€ç”Ÿå‘½å‘¨æœŸ</h4>

<p>æœ‰æ—¶å€™ï¼Œä¸ºäº†æŸäº›ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬ReactNativeåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚æˆ‘ä»¬å¯ä»¥è®©åŸç”Ÿæ¨¡å—å®ç°<code>LifecycleEventListener</code>æ¥å£ï¼Œç„¶åä½¿ç”¨<code>addLifecycleEventListener</code>æ³¨å†Œä¸€ä¸‹ç›‘å¬ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="nf">BGNativeExampleModule</span><span class="o">(</span><span class="kd">final</span> <span class="n">ReactApplicationContext</span> <span class="n">reactContext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">(</span><span class="n">reactContext</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//æ·»åŠ ç›‘å¬</span>
</span><span class='line'>    <span class="n">reactContext</span><span class="o">.</span><span class="na">addLifecycleEventListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®ç°<code>LifecycleEventListener</code>æ¥å£</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">@</span><span class="nx">Override</span>
</span><span class='line'><span class="kr">public</span> <span class="k">void</span> <span class="nx">onHostResume</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Log</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">TAG</span><span class="p">,</span> <span class="s2">&quot;onHostResume&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nx">Override</span>
</span><span class='line'><span class="kr">public</span> <span class="k">void</span> <span class="nx">onHostPause</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Log</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">TAG</span><span class="p">,</span> <span class="s2">&quot;onHostPause&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">timer</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="nx">Override</span>
</span><span class='line'><span class="kr">public</span> <span class="k">void</span> <span class="nx">onHostDestroy</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Log</span><span class="p">.</span><span class="nx">i</span><span class="p">(</span><span class="nx">TAG</span><span class="p">,</span> <span class="s2">&quot;onHostDestroy&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">timer</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›‘å¬ReactNativeåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸäº†ã€‚</p>

<p>ä¸Šé¢åŸç”Ÿä»£ç å°±ç¼–å†™å¥½äº†ï¼Œä¸»è¦ä»¥ä»£ç å®è·µä¸ºä¸»ï¼Œå¼¥è¡¥å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€äº›ä¸è¶³ï¼Œå¦‚æœè¦éœ€è¦äº†è§£æ›´å¤šçš„åŸç”Ÿæ¨¡å—å°è£…çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒ<a href="http://reactnative.cn/docs/0.22/native-modules-ios.html#content">åŸç”Ÿæ¨¡å—</a>ï¼Œä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹çš„æºä»£ç ã€‚</p>

<h2>äºŒã€å‘å¸ƒä¸Šçº¿</h2>

<h4>å»ºç«‹ä¸€ä¸ªgithubä»“åº“</h4>

<p>åœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“<code>react-native-BGNativeModuleExample</code>ï¼Œå…‹éš†åˆ°æœ¬åœ°ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ª<code>android</code>æ–‡ä»¶å¤¹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git clone https://github.com/liuchungui/react-native-BGNativeModuleExample.git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>react-native-BGNativeModuleExample
</span><span class='line'><span class="nv">$ </span>mkdir android
</span></code></pre></td></tr></table></div></figure>


<h4>å°†Libraryå¤åˆ¶åˆ°androidæ–‡ä»¶å¤¹ä¸‹</h4>

<p>æˆ‘ä»¬é¦–å…ˆè¿›å…¥å‰é¢åˆ›å»ºçš„<code>nativemoduleexample</code>è¿™ä¸ªLibraryä¸‹ï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶copyåˆ°<code>react-native-BGNativeModuleExample/android</code>ç›®å½•ä¸‹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>cp -R android/nativemoduleexample/* ~/github/react-native-BGNativeModuleExample/android
</span></code></pre></td></tr></table></div></figure>


<h4>å‘å¸ƒåˆ°npm</h4>

<p>è¿™é‡Œè¯·å‚è€ƒæˆ‘å‰é¢å†™çš„<a href="http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/">ReactNativeä¹‹åŸç”Ÿæ¨¡å—å¼€å‘å¹¶å‘å¸ƒâ€”â€”iOSç¯‡</a>ä¸­çš„<code>å‘å¸ƒåˆ°npm</code>é‚£ä¸€èŠ‚çš„å†…å®¹ï¼Œå½“ç„¶å¦‚æœä½ å’Œæˆ‘ä¸€æ ·å‰é¢å·²ç»å‘å¸ƒäº†<code>1.0.0</code>ï¼Œåªéœ€è¦å°†<code>package.json</code>ä¿®æ”¹ä¸€ä¸ªç‰ˆæœ¬å°±å¥½äº†ï¼Œæˆ‘è¿™é‡Œä¿®æ”¹ä¸º<code>2.0.0</code>ï¼Œç„¶åä½¿ç”¨ä¸‹é¢å‘½ä»¤å‘å¸ƒã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>npm publish
</span><span class='line'>+ react-native-nativemodule-example@2.0.0
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æˆåŠŸå‘å¸ƒåˆ°äº†<a href="npmjs.org">npmjs.org</a>ã€‚</p>

<h2>ä¸‰ã€æ·»åŠ Exampleï¼Œæµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œæ·»åŠ README</h2>

<p>è¯·ç‚¹å‡»æŸ¥çœ‹<a href="http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/">ReactNativeä¹‹åŸç”Ÿæ¨¡å—å¼€å‘å¹¶å‘å¸ƒâ€”â€”iOSç¯‡</a>ä¸­çš„<code>æ·»åŠ Exampleï¼Œæµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œæ·»åŠ README</code>è¿™ä¸€éƒ¨åˆ†å†…å®¹ï¼ŒåŸºæœ¬ä¸Šä¸€æ ·çš„ã€‚</p>

<h2>å‚è€ƒï¼š</h2>

<p><a href="http://blog.csdn.net/dxpqxb/article/details/8659292">http://blog.csdn.net/dxpqxb/article/details/8659292</a>      <br/>
<a href="http://reactnative.cn/docs/0.25/native-modules-android.html#content">åŸç”Ÿæ¨¡å—</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ReactNativeä¹‹åŸç”Ÿæ¨¡å—å¼€å‘å¹¶å‘å¸ƒâ€”â€”iOSç¯‡]]></title>
    <link href="http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/"/>
    <updated>2016-05-02T19:48:27+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian</id>
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´åšäº†ä¸ªReactNativeçš„Appï¼Œå‘ç°ReactNativeä¸­ä¸å°‘ç»„ä»¶å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è‡ªå·±å¯¹åŸç”Ÿæ¨¡å—è¿›è¡Œç¼–å†™è®©JSè°ƒç”¨ï¼Œæ­£æ˜¯å› ä¸ºåœ¨è¿™ä¸ªç¼–å†™è¿‡ç¨‹ä¸­é‡åˆ°ä¸å°‘é—®é¢˜ï¼Œå‘è§‰äº†å®˜ç½‘æ–‡æ¡£ä¸­è®¸å¤šçš„ä¸è¶³ã€‚æ‰€ä»¥äº§ç”Ÿäº†å†™ä¸€ä¸ªå®è·µæ•™ç¨‹çš„æƒ³æ³•ï¼Œæœ€ç»ˆæœ‰äº†è¿™ä¹ˆä¸€ç¯‡æ–‡ç« ã€‚</p>

<p>æ•´ç¯‡æ–‡ç« ä¸»è¦ä»¥ç¼–å†™ä¸€ä¸ªåŸç”Ÿæ¨¡å—ä¸ºä¾‹å­ï¼Œæ¥è®²è¿°äº†æˆ‘ä»¬åœ¨ç¼–å†™åŸç”Ÿæ¨¡å—æ‰€ç”¨åˆ°çš„ä¸€äº›çŸ¥è¯†ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªä¾‹å­ä¸­ï¼Œé…æœ‰äº†å®Œæ•´çš„å®è·µä»£ç ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£å¹¶è°ƒè¯•ã€‚é™¤äº†è¿™äº›å†…å®¹ï¼Œæ–‡ç« è¿˜è®²è¿°äº†æˆ‘ä»¬å¦‚ä½•å°†è‡ªå·±ç¼–å†™çš„åŸç”Ÿæ¨¡å—å‘å¸ƒåˆ°npmä¸Šåˆ†äº«ç»™åˆ«äººä½¿ç”¨ã€‚å¸Œæœ›èƒ½å¤Ÿç»™å¤§å®¶å¸¦æ¥å¸®åŠ©ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å°†è‡ªå·±ç¼–å†™çš„åŸç”Ÿæ¨¡å—åˆ†äº«å‡ºæ¥ã€‚</p>

<p>ç¤ºä¾‹ä»£ç githubåœ°å€ï¼š<a href="https://github.com/liuchungui/react-native-BGNativeModuleExample">https://github.com/liuchungui/react-native-BGNativeModuleExample</a></p>

<p>ç¼–å†™androidåŸç”Ÿæ¨¡å—ï¼Œè¯·çœ‹<a href="http://www.liuchungui.com/blog/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/">ReactNativeä¹‹åŸç”Ÿæ¨¡å—å¼€å‘å¹¶å‘å¸ƒâ€”â€”androidç¯‡</a></p>

<!-- more -->


<h2>å‡†å¤‡å·¥ä½œï¼š</h2>

<h4>åˆ›å»ºReactNativeå·¥ç¨‹</h4>

<p>æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªReactNativeå·¥ç¨‹ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>react native init TestProject</span></code></pre></td></tr></table></div></figure>


<p>åˆ›å»ºå¥½å·¥ç¨‹ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨xcodeæ‰“å¼€<code>TestProject/ios/</code>ä¸‹çš„iOSå·¥ç¨‹ã€‚</p>

<h4>åˆ›å»ºé™æ€åº“ï¼Œå¹¶å°†è¿™ä¸ªé™æ€åº“æ‰‹åŠ¨é“¾æ¥åˆ°å·¥ç¨‹ä¸­</h4>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å‰é¢åˆ›å»ºçš„ReactNativeå·¥ç¨‹ä¸‹çš„<code>node_modules</code>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹<code>react-native-BGNativeModuleExample</code>ï¼Œç„¶åæˆ‘ä»¬åœ¨æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹å†åˆ›å»ºä¸€ä¸ªiosæ–‡ä»¶å¤¹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd TestProject/node_modules
</span><span class='line'>$ mkdir react-native-BGNativeModuleExample
</span><span class='line'>$ cd react-native-BGNativeModuleExample
</span><span class='line'>$ mkdir ios</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åï¼Œç”±äºReactNativeçš„ç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªä¸ªé™æ€åº“ï¼Œæˆ‘ä»¬å‘å¸ƒåˆ°npmç»™åˆ«äººä½¿ç”¨çš„è¯ï¼Œä¹Ÿéœ€è¦å»ºç«‹é™æ€åº“ã€‚æˆ‘ä»¬ä½¿ç”¨xcodeå»ºç«‹é™æ€åº“ï¼Œå–åä¸º<code>BGNativeModuleExample</code>ã€‚å»ºç«‹ä¹‹åï¼Œæˆ‘ä»¬å°†åˆ›å»ºçš„é™æ€åº“ä¸­çš„æ–‡ä»¶å…¨éƒ¨copyåˆ°<code>node_modules/react-native-BGNativeModuleExample/ios</code>ç›®å½•ä¸‹ã€‚  <br/>
iosæ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|____BGNativeModuleExample
</span><span class='line'>| |____BGNativeModuleExample.h
</span><span class='line'>| |____BGNativeModuleExample.m
</span><span class='line'>|____BGNativeModuleExample.xcodeproj</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†è¿™ä¸ªé™æ€åº“é“¾æ¥åˆ°å·¥ç¨‹ä¸­ã€‚</p>

<p>1ã€ä½¿ç”¨xcodeæ‰“å¼€åˆ›å»ºçš„é™æ€åº“ï¼Œæ·»åŠ ä¸€è¡Œ<code>Header Search Paths</code>ï¼Œå€¼ä¸º<code>$(SRCROOT)/../../react-native/React</code>ï¼Œå¹¶è®¾ç½®ä¸º<code>recursive</code>ã€‚</p>

<p><img src="http://ww2.sinaimg.cn/large/7746cd07jw1f3h69rwj3oj212s0r7dm6.jpg" alt="" /></p>

<p>2ã€å°†<code>BGNativeModuleExample</code>é™æ€åº“å·¥ç¨‹æ‹–åŠ¨åˆ°å·¥ç¨‹ä¸­çš„Libraryä¸­ã€‚
<img src="http://ww1.sinaimg.cn/large/7746cd07jw1f3o30vl8wjj20xq0fawi3.jpg" alt="" /></p>

<p>3ã€é€‰ä¸­ TARGETS => TestProject => Build Settings => Link Binary With Librariesï¼Œæ·»åŠ <code>libBGNativeModuleExample.a</code>è¿™ä¸ªé™æ€åº“
<img src="http://ww3.sinaimg.cn/large/7746cd07jw1f3o2v5wrgyj212r0hgq72.jpg" alt="" /></p>

<p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å‡†å¤‡å·¥ä½œå®Œæˆäº†ã€‚æˆ‘ä»¬è¿™é‡Œè¿™ä¹ˆå‡†å¤‡æ˜¯æœ‰ç”¨æ„çš„ï¼Œé‚£å°±æ˜¯æ¨¡æ‹Ÿnpmé“¾æ¥çš„è¿‡ç¨‹ï¼Œå»ºç«‹å¥½äº†ç¯å¢ƒï¼Œé¿å…äº†å‘å¸ƒåˆ°npmä¸Šååˆ«äººä½¿ç”¨æ‰¾ä¸åˆ°é™æ€åº“çš„é—®é¢˜ã€‚</p>

<h2>ä¸€ã€ç¼–å†™åŸç”Ÿæ¨¡å—ä»£ç </h2>

<h4>1ã€åˆ›å»ºåŸç”Ÿæ¨¡å—</h4>

<p>é€‰ä¸­æˆ‘ä»¬åˆ›å»ºçš„<code>BGNativeModuleExample</code>é™æ€åº“ï¼Œç„¶ååœ¨<code>BGNativeModuleExample.h</code>æ–‡ä»¶ä¸­å¯¼å…¥<code>RCTBridgeModule.h</code>ï¼Œè®©<code>BGNativeModuleExample</code>ç±»éµå¾ª<code>RCTBridgeModule</code>åè®®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//BGNativeModuleExample.hæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹</span>
</span><span class='line'><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
</span><span class='line'><span class="cp">#import &quot;RCTBridgeModule.h&quot;</span>
</span><span class='line'><span class="k">@interface</span> <span class="nc">BGNativeModuleExample</span> : <span class="bp">NSObject</span> <span class="o">&lt;</span><span class="n">RCTBridgeModule</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨<code>BGNativeModuleExample.m</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç°<code>RCTBridgeModule</code>åè®®ã€‚ä¸ºäº†å®ç°<code>RCTBridgeModule</code>åè®®ï¼Œæˆ‘ä»¬çš„ç±»éœ€è¦åŒ…å«RCT_EXPORT_MODULE()å®ã€‚è¿™ä¸ªå®ä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šåœ¨Javascriptä¸­è®¿é—®è¿™ä¸ªæ¨¡å—çš„åå­—ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šä½¿ç”¨è¿™ä¸ªç±»çš„åå­—ã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†æ¨¡å—çš„åå­—ä¸º<code>BGNativeModuleExample</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">RCT_EXPORT_MODULE</span><span class="p">(</span><span class="nx">BGNativeModuleExample</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®ç°äº†RCTBridgeModuleåè®®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨jsä¸­å¦‚ä¸‹è·å–åˆ°æˆ‘ä»¬åˆ›å»ºçš„åŸç”Ÿæ¨¡å—ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">NativeModules</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-native&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">BGNativeModuleExample</span> <span class="o">=</span> <span class="nx">NativeModules</span><span class="p">.</span><span class="nx">BGNativeModuleExample</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRCT_EXPORT_MODULEå®ä¼ é€’çš„å‚æ•°ä¸èƒ½æ˜¯OCä¸­çš„å­—ç¬¦ä¸²ã€‚å¦‚æœä¼ é€’@&ldquo;BGNativeModuleExample"ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¼å‡ºç»™JSçš„æ¨¡å—åå­—å…¶å®æ˜¯@"BGNativeModuleExample"ï¼Œä½¿ç”¨BGNativeModuleExampleå°±æ‰¾ä¸åˆ°äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥é€šè¿‡æ‰“å°<code>NativeModules</code>æ¥æŸ¥æ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„åŸç”Ÿæ¨¡å—ã€‚</p>

<h4>2ã€ä¸ºåŸç”Ÿæ¨¡å—æ·»åŠ æ–¹æ³•</h4>

<p>æˆ‘ä»¬éœ€è¦æ˜ç¡®çš„å£°æ˜è¦ç»™JSå¯¼å‡ºçš„æ–¹æ³•ï¼Œå¦åˆ™ReactNativeä¸ä¼šå¯¼å‡ºä»»ä½•æ–¹æ³•ã€‚å£°æ˜é€šè¿‡RCT_EXPORT_METHOD()å®æ¥å®ç°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">RCT_EXPORT_METHOD</span><span class="p">(</span><span class="nl">testPrint</span><span class="p">:(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span> <span class="nl">info</span><span class="p">:(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="n">info</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">RCTLogInfo</span><span class="p">(</span><span class="s">@&quot;%@: %@&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">testPrint</span><span class="p">(</span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;1.78m&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">weight</span><span class="o">:</span> <span class="s1">&#39;7kg&#39;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>3ã€å‚æ•°ç±»å‹</h4>

<p>RCT_EXPORT_METHOD()æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„JSONç±»å‹ï¼ŒåŒ…æ‹¬ï¼š</p>

<ul>
<li>string (NSString)</li>
<li>number (NSInteger, float, double, CGFloat, NSNumber)</li>
<li>boolean (BOOL, NSNumber)</li>
<li>array (NSArray) åŒ…å«æœ¬åˆ—è¡¨ä¸­ä»»æ„ç±»å‹</li>
<li>map (NSDictionary) åŒ…å«stringç±»å‹çš„é”®å’Œæœ¬åˆ—è¡¨ä¸­ä»»æ„ç±»å‹çš„å€¼</li>
<li>function (RCTResponseSenderBlock)</li>
</ul>


<p>é™¤æ­¤ä»¥å¤–ï¼Œä»»ä½•RCTConvertç±»æ”¯æŒçš„çš„ç±»å‹ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨(å‚è§<a href="https://github.com/facebook/react-native/blob/master/React/Base/RCTConvert.h">RCTConvert</a>äº†è§£æ›´å¤šä¿¡æ¯)ã€‚RCTConvertè¿˜æä¾›äº†ä¸€ç³»åˆ—è¾…åŠ©å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶ä¸€ä¸ªJSONå€¼å¹¶è½¬æ¢åˆ°åŸç”ŸObjective-Cç±»å‹æˆ–ç±»ã€‚</p>

<p>äº†è§£æ›´å¤šè¯·ç‚¹å‡»<a href="http://reactnative.cn/docs/0.25/native-modules-ios.html#content">åŸç”Ÿæ¨¡å—</a></p>

<h4>4ã€å›è°ƒå‡½æ•°</h4>

<blockquote><p>è­¦å‘Š  <br/>
æœ¬ç« èŠ‚å†…å®¹ç›®å‰è¿˜å¤„åœ¨å®éªŒé˜¶æ®µï¼Œå› ä¸ºæˆ‘ä»¬è¿˜å¹¶æ²¡æœ‰å¤ªå¤šçš„å®è·µç»éªŒæ¥å¤„ç†å›è°ƒå‡½æ•°ã€‚</p></blockquote>

<p>å›è°ƒå‡½æ•°ï¼Œåœ¨å®˜æ–¹çš„æ–‡æ¡£ä¸­æ˜¯æœ‰ä¸Šé¢çš„ä¸€ä¸ªè­¦å‘Šï¼Œä¸è¿‡åœ¨ä½¿ç”¨è¿‡ç¨‹æš‚æ—¶æœªå‘ç°é—®é¢˜ã€‚åœ¨OCä¸­ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª<code>getNativeClass</code>æ–¹æ³•ï¼Œå°†å½“å‰æ¨¡å—çš„ç±»åå›è°ƒç»™JSã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">RCT_EXPORT_METHOD</span><span class="p">(</span><span class="nl">getNativeClass</span><span class="p">:(</span><span class="n">RCTResponseSenderBlock</span><span class="p">)</span><span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">callback</span><span class="p">(</span><span class="l">@[</span><span class="n">NSStringFromClass</span><span class="p">([</span><span class="nb">self</span> <span class="k">class</span><span class="p">])</span><span class="l">]</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–åˆ°åŸç”Ÿæ¨¡å—çš„ç±»å</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">getNativeClass</span><span class="p">(</span><span class="nx">name</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;nativeClass: &quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>åŸç”Ÿæ¨¡å—é€šå¸¸åªåº”è°ƒç”¨å›è°ƒå‡½æ•°ä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬å¯ä»¥ä¿å­˜callbackå¹¶åœ¨å°†æ¥è°ƒç”¨ã€‚</strong>è¿™åœ¨å°è£…é‚£äº›é€šè¿‡â€œå§”æ‰˜å‡½æ•°â€æ¥è·å¾—è¿”å›å€¼çš„iOS APIæ—¶æœ€å¸¸è§ã€‚</p>

<h4>5ã€Promises</h4>

<blockquote><p>åŸç”Ÿæ¨¡å—è¿˜å¯ä»¥ä½¿ç”¨promiseæ¥ç®€åŒ–ä»£ç ï¼Œæ­é…ES2016(ES7)æ ‡å‡†çš„async/awaitè¯­æ³•åˆ™æ•ˆæœæ›´ä½³ã€‚å¦‚æœæ¡¥æ¥åŸç”Ÿæ–¹æ³•çš„æœ€åä¸¤ä¸ªå‚æ•°æ˜¯RCTPromiseResolveBlockå’ŒRCTPromiseRejectBlockï¼Œåˆ™å¯¹åº”çš„JSæ–¹æ³•å°±ä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚</p></blockquote>

<p>æˆ‘ä»¬é€šè¿‡Promisesæ¥å®ç°åŸç”Ÿæ¨¡å—æ˜¯å¦ä¼šå“åº”æ–¹æ³•ï¼Œå“åº”åˆ™è¿”å›YESï¼Œä¸å“åº”åˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">RCT_REMAP_METHOD</span><span class="p">(</span><span class="n">testRespondMethod</span><span class="p">,</span>
</span><span class='line'>                 <span class="nl">name</span><span class="p">:(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">name</span>
</span><span class='line'>                 <span class="nl">resolver</span><span class="p">:(</span><span class="n">RCTPromiseResolveBlock</span><span class="p">)</span><span class="n">resolve</span>
</span><span class='line'>                 <span class="nl">rejecter</span><span class="p">:(</span><span class="n">RCTPromiseRejectBlock</span><span class="p">)</span><span class="n">reject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">([</span><span class="nb">self</span> <span class="nl">respondsToSelector</span><span class="p">:</span><span class="n">NSSelectorFromString</span><span class="p">(</span><span class="n">name</span><span class="p">)])</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">resolve</span><span class="p">(</span><span class="m">@YES</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">reject</span><span class="p">(</span><span class="s">@&quot;-1001&quot;</span><span class="p">,</span> <span class="s">@&quot;not respond this method&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼è°ƒç”¨ï¼Œç¬¬ä¸€ç§æ˜¯é€šè¿‡<code>then....catch</code>çš„æ–¹å¼ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">testRespondMethod</span><span class="p">(</span><span class="s2">&quot;dealloc&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;result is &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¬¬äºŒç§æ˜¯é€šè¿‡<code>try...catch</code>æ¥è°ƒç”¨ï¼Œä¸ç¬¬ä¸€ç§ç›¸æ¯”ï¼Œç¬¬äºŒç§ä¼šæŠ¥è­¦å‘Šâ€Possible Unhandled Promiss Rejection (id:0)â€œã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">async</span> <span class="nx">testRespond</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">testRespondMethod</span><span class="p">(</span><span class="s2">&quot;hell&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;respond this method&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>æ³¨æ„: å¦‚æœä½¿ç”¨Promissæˆ‘ä»¬ä¸éœ€è¦å‚æ•°ï¼Œåˆ™åœ¨OCå»æ‰nameé‚£ä¸€è¡Œå°±è¡Œäº†ï¼›å¦‚æœéœ€è¦å¤šä¸ªå‚æ•°ï¼Œåœ¨nameä¸‹é¢å¤šåŠ ä¸€è¡Œå°±è¡Œäº†ï¼Œæ³¨æ„å®ƒä»¬ä¹‹é—´ä¸éœ€è¦æ·»åŠ é€—å·ã€‚</strong></p>

<h4>6ã€å¤šçº¿ç¨‹</h4>

<p>æˆ‘ä»¬è¿™é‡Œæ“ä½œçš„æ¨¡å—æ²¡æœ‰æ¶‰åŠåˆ°UIï¼Œæ‰€ä»¥ä¸“é—¨å»ºç«‹ä¸€ä¸ªä¸²è¡Œçš„é˜Ÿåˆ—ç»™å®ƒä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">return</span> <span class="nx">dispatch_queue_create</span><span class="p">(</span><span class="s2">&quot;com.liuchungui.demo&quot;</span><span class="p">,</span> <span class="nx">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>æ³¨æ„: åœ¨æ¨¡å—ä¹‹é—´å…±äº«åˆ†å‘é˜Ÿåˆ—   <br/>
methodQueueæ–¹æ³•ä¼šåœ¨æ¨¡å—è¢«åˆå§‹åŒ–çš„æ—¶å€™è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åä¼šè¢«React Nativeçš„æ¡¥æ¥æœºåˆ¶ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦è‡ªå·±ä¿å­˜é˜Ÿåˆ—çš„å¼•ç”¨ï¼Œé™¤éä½ å¸Œæœ›åœ¨æ¨¡å—çš„å…¶å®ƒåœ°æ–¹ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨è‹¥å¹²ä¸ªæ¨¡å—ä¸­å…±äº«åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™éœ€è¦è‡ªå·±ä¿å­˜å¹¶è¿”å›ç›¸åŒçš„é˜Ÿåˆ—å®ä¾‹ï¼›ä»…ä»…æ˜¯è¿”å›ç›¸åŒåå­—çš„é˜Ÿåˆ—æ˜¯ä¸è¡Œçš„ã€‚</p></blockquote>

<p>æ›´å¤šçº¿ç¨‹çš„æ“ä½œç»†èŠ‚å¯ä»¥å‚è€ƒ<a href="http://reactnative.cn/docs/0.24/native-modules-ios.html#content">http://reactnative.cn/docs/0.24/native-modules-ios.html#content</a></p>

<h4>7ã€å¯¼å‡ºå¸¸é‡</h4>

<p>åŸç”Ÿæ¨¡å—å¯ä»¥å¯¼å‡ºä¸€äº›å¸¸é‡ï¼Œè¿™äº›å¸¸é‡åœ¨JavaScriptç«¯éšæ—¶éƒ½å¯ä»¥è®¿é—®ã€‚ç”¨è¿™ç§æ–¹æ³•æ¥ä¼ é€’ä¸€äº›é™æ€æ•°æ®ï¼Œå¯ä»¥é¿å…é€šè¿‡bridgeè¿›è¡Œä¸€æ¬¡æ¥å›äº¤äº’ã€‚</p>

<p>OCä¸­ï¼Œæˆ‘ä»¬å®ç°<code>constantsToExport</code>æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">constantsToExport</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="l">@{</span> <span class="s">@&quot;BGModuleName&quot;</span> <span class="o">:</span> <span class="s">@&quot;BGNativeModuleExample&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nl">TestEventName</span><span class="p">:</span> <span class="n">TestEventName</span>
</span><span class='line'>            <span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>JSä¸­ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹è¿™ä¸ªå¸¸é‡</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;BGModuleName value is &quot;</span><span class="p">,</span> <span class="nx">BGNativeModuleExample</span><span class="p">.</span><span class="nx">BGModuleName</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯æ³¨æ„è¿™ä¸ªå¸¸é‡ä»…ä»…åœ¨åˆå§‹åŒ–çš„æ—¶å€™å¯¼å‡ºäº†ä¸€æ¬¡ï¼Œæ‰€ä»¥å³ä½¿ä½ åœ¨è¿è¡ŒæœŸé—´æ”¹å˜constantToExportè¿”å›çš„å€¼ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°JavaScriptç¯å¢ƒä¸‹æ‰€å¾—åˆ°çš„ç»“æœã€‚</p>

<h4>8ã€ç»™JSå‘é€äº‹ä»¶</h4>

<p>å³ä½¿æ²¡æœ‰è¢«JSè°ƒç”¨ï¼Œæœ¬åœ°æ¨¡å—ä¹Ÿå¯ä»¥ç»™JSå‘é€äº‹ä»¶é€šçŸ¥ã€‚æœ€ç›´æ¥çš„æ–¹å¼æ˜¯ä½¿ç”¨<code>eventDispatcher</code>ã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿæ¥æ”¶åˆ°äº‹ä»¶ï¼Œæˆ‘ä»¬å¼€ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯ä¸€ç§’å‘é€ä¸€æ¬¡äº‹ä»¶ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;BGNativeModuleExample.h&quot;</span>
</span><span class='line'><span class="cp">#import &quot;RCTEventDispatcher.h&quot;</span>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">BGNativeModuleExample</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">bridge</span> <span class="o">=</span> <span class="n">_bridge</span><span class="p">;</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">init</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="bp">NSTimer</span> <span class="nl">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="mf">1.0</span> <span class="nl">target</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">sendEventToJS</span><span class="p">)</span> <span class="nl">userInfo</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">repeats</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">receiveNotification:</span><span class="p">(</span><span class="bp">NSNotification</span> <span class="o">*</span><span class="p">)</span><span class="nv">notification</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">bridge</span><span class="p">.</span><span class="n">eventDispatcher</span> <span class="nl">sendAppEventWithName</span><span class="p">:</span><span class="n">TestEventName</span> <span class="nl">body</span><span class="p">:</span><span class="l">@{</span><span class="s">@&quot;name&quot;</span><span class="o">:</span> <span class="s">@&quot;Jack&quot;</span><span class="l">}</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨JSä¸­ï¼Œæˆ‘ä»¬è¿™æ ·æ¥æ”¶äº‹ä»¶</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NativeAppEventEmitter</span><span class="p">.</span><span class="n">addListener</span><span class="p">(</span><span class="n">BGNativeModuleExample</span><span class="p">.</span><span class="n">TestEventName</span><span class="p">,</span> <span class="n">info</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>æ³¨æ„ï¼š ç¼–å†™OCä»£ç æ—¶ï¼Œéœ€è¦æ·»åŠ <code>@synthesize bridge = _bridge;</code>ï¼Œå¦åˆ™æ¥æ”¶äº‹ä»¶çš„æ—¶å€™å°±ä¼šæŠ¥<code>Exception -[BGNativeModuleExample brige]; unrecognized selector sent to instance</code>çš„é”™è¯¯ã€‚</strong></p>

<p>ä¸Šé¢åŸç”Ÿä»£ç å°±ç¼–å†™å¥½äº†ï¼Œä¸»è¦ä»¥ä»£ç å®è·µä¸ºä¸»ï¼Œå¼¥è¡¥å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€äº›ä¸è¶³ï¼Œå¦‚æœè¦éœ€è¦äº†è§£æ›´å¤šçš„åŸç”Ÿæ¨¡å—å°è£…çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒ<a href="http://reactnative.cn/docs/0.22/native-modules-ios.html#content">åŸç”Ÿæ¨¡å—</a>ï¼Œä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹çš„æºä»£ç ã€‚</p>

<h2>äºŒã€å‘å¸ƒä¸Šçº¿</h2>

<p>æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢æ­¥éª¤ç¼–å†™å¥½åŸç”Ÿæ¨¡å—ä¹‹åï¼Œæ¥ä¸‹æ¥å°†æˆ‘ä»¬å†™çš„åŸç”Ÿæ¨¡å—å‘å¸ƒåˆ°npmã€‚</p>

<h4>1ã€æˆ‘ä»¬éœ€è¦åˆ›å»ºgithubä»“åº“</h4>

<p>åœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“<code>react-native-BGNativeModuleExample</code>ï¼Œç„¶åå…³è”åˆ°æˆ‘ä»¬å‰é¢åˆ›å»ºçš„<code>react-native-BGNativeModuleExample</code>ç›®å½•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">cd</span> <span class="n">TestProject</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">BGNativeModuleExample</span>
</span><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">init</span> <span class="p">.</span>
</span><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">origin</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/liuchungui/react-native-BGNativeModuleExample.git</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2ã€æˆ‘ä»¬éœ€è¦åˆ›å»ºåŸç”Ÿæ¨¡å—çš„å…¥å£æ–‡ä»¶</h4>

<p>æˆ‘ä»¬éœ€è¦åœ¨react-native-BGNativeModuleExampleç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.jsï¼Œå®ƒæ˜¯æ•´ä¸ªåŸç”Ÿæ¨¡å—çš„å…¥å£ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ˜¯å°†åŸç”Ÿè¿›è¡Œå¯¼å‡ºã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//index.js</span>
</span><span class='line'><span class="n">import</span> <span class="n">React</span><span class="p">,</span> <span class="p">{</span> <span class="n">NativeModules</span> <span class="p">}</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="err">&#39;</span><span class="p">;</span>
</span><span class='line'><span class="n">module</span><span class="p">.</span><span class="n">exports</span> <span class="o">=</span> <span class="n">NativeModules</span><span class="p">.</span><span class="n">BGNativeModuleExample</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>3ã€å‘å¸ƒåˆ°npm</h4>

<p>åœ¨å‘å¸ƒåˆ°npmä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>package.json</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†moduleçš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ¯”å¦‚åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä¾èµ–ã€ä½œè€…ã€licenseç­‰ã€‚
æˆ‘ä»¬åœ¨react-native-BGNativeModuleExampleæ ¹ç›®å½•ä¸‹ä½¿ç”¨<code>npm init</code>å‘½ä»¤æ¥åˆ›å»º<code>package.json</code>ï¼Œç³»ç»Ÿä¼šæç¤ºæˆ‘ä»¬è¾“å…¥æ‰€éœ€çš„ä¿¡æ¯ï¼Œä¸æƒ³è¾“å…¥çš„ç›´æ¥æŒ‰ä¸‹<code>Enter</code>è·³è¿‡ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">npm</span> <span class="n">init</span>
</span><span class='line'><span class="n">This</span> <span class="n">utility</span> <span class="n">will</span> <span class="n">walk</span> <span class="n">you</span> <span class="n">through</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">package</span><span class="p">.</span><span class="n">json</span> <span class="n">file</span><span class="p">.</span>
</span><span class='line'><span class="n">It</span> <span class="n">only</span> <span class="n">covers</span> <span class="n">the</span> <span class="n">most</span> <span class="n">common</span> <span class="n">items</span><span class="p">,</span> <span class="n">and</span> <span class="n">tries</span> <span class="n">to</span> <span class="n">guess</span> <span class="n">sensible</span> <span class="n">defaults</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">See</span> <span class="err">`</span><span class="n">npm</span> <span class="n">help</span> <span class="n">json</span><span class="err">`</span> <span class="k">for</span> <span class="n">definitive</span> <span class="n">documentation</span> <span class="n">on</span> <span class="n">these</span> <span class="n">fields</span>
</span><span class='line'><span class="n">and</span> <span class="n">exactly</span> <span class="n">what</span> <span class="n">they</span> <span class="k">do</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Use</span> <span class="err">`</span><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">pkg</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">save</span><span class="err">`</span> <span class="n">afterwards</span> <span class="n">to</span> <span class="n">install</span> <span class="n">a</span> <span class="n">package</span> <span class="n">and</span>
</span><span class='line'><span class="n">save</span> <span class="n">it</span> <span class="n">as</span> <span class="n">a</span> <span class="n">dependency</span> <span class="k">in</span> <span class="n">the</span> <span class="n">package</span><span class="p">.</span><span class="n">json</span> <span class="n">file</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Press</span> <span class="o">^</span><span class="n">C</span> <span class="n">at</span> <span class="n">any</span> <span class="n">time</span> <span class="n">to</span> <span class="n">quit</span><span class="p">.</span>
</span><span class='line'><span class="nl">name</span><span class="p">:</span> <span class="p">(</span><span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">BGNativeModuleExample</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¾“å…¥å®Œæˆä¹‹åï¼Œç³»ç»Ÿä¼šè¦æˆ‘ä»¬ç¡®è®¤æ–‡ä»¶çš„å†…å®¹æ˜¯å¦æœ‰è¯¯ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ç›´æ¥è¾“å…¥<code>yes</code>ï¼Œé‚£ä¹ˆ<code>package.json</code>å°±åˆ›å»ºå¥½äº†ã€‚
æˆ‘è¿™é‡Œåˆ›å»ºçš„package.jsonæ–‡ä»¶å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;react-native-nativemodule-example&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;version&quot;</span><span class="o">:</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;description&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;main&quot;</span><span class="o">:</span> <span class="s">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;test&quot;</span><span class="o">:</span> <span class="s">&quot;echo </span><span class="se">\&quot;</span><span class="s">Error: no test specified</span><span class="se">\&quot;</span><span class="s"> &amp;&amp; exit 1&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s">&quot;repository&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;type&quot;</span><span class="o">:</span> <span class="s">&quot;git&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;url&quot;</span><span class="o">:</span> <span class="s">&quot;git+https://github.com/liuchungui/react-native-BGNativeModuleExample.git&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s">&quot;author&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;license&quot;</span><span class="o">:</span> <span class="s">&quot;ISC&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s">&quot;bugs&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;url&quot;</span><span class="o">:</span> <span class="s">&quot;https://github.com/liuchungui/react-native-BGNativeModuleExample/issues&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s">&quot;homepage&quot;</span><span class="o">:</span> <span class="s">&quot;https://github.com/liuchungui/react-native-BGNativeModuleExample#readme&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæˆ‘ä»¬ç¼–å†™çš„åŸç”Ÿæ¨¡å—ä¾èµ–äºå…¶ä»–çš„åŸç”Ÿæ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>package.json</code>æ·»åŠ ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬è¿™é‡Œç”±äºæ²¡æœ‰ç›¸å…³ä¾èµ–ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="s">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>åˆå§‹åŒ–å®Œpackage.jsonï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘å¸ƒåˆ°npmä¸Šé¢äº†ã€‚</strong></p>

<p>å¦‚æœæ²¡æœ‰npmçš„è´¦å·ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œè¿™ä¸ªè´¦å·ä¼šè¢«æ·»åŠ åˆ°npmæœ¬åœ°çš„é…ç½®ä¸­ï¼Œç”¨æ¥å‘å¸ƒmoduleç”¨ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">npm</span> <span class="n">adduser</span>
</span><span class='line'><span class="nl">Username</span><span class="p">:</span> <span class="n">your</span> <span class="n">name</span>
</span><span class='line'><span class="nl">Password</span><span class="p">:</span> <span class="n">your</span> <span class="n">password</span>
</span><span class='line'><span class="nl">Email</span><span class="p">:</span> <span class="n">yourmail</span><span class="p">@</span><span class="n">gmail</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆåŠŸä¹‹åï¼Œnpmä¼šæŠŠè®¤è¯ä¿¡æ¯å­˜å‚¨åœ¨~/.npmrcä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹npmå½“å‰ä½¿ç”¨çš„ç”¨æˆ·ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">npm</span> <span class="n">whoami</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»¥ä¸Šå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå‘å¸ƒäº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span><span class="n">npm</span> <span class="n">publish</span>
</span><span class='line'><span class="o">+</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span><span class="mf">@1.0.0</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæŠŠmoduleå‘å¸ƒåˆ°äº†<a href="npmjs.org">npmjs.org</a>ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿåˆ«å¿˜è®°å°†æˆ‘ä»¬çš„ä»£ç å‘å¸ƒåˆ°githubã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">pull</span> <span class="n">origin</span> <span class="n">master</span>
</span><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">add</span> <span class="p">.</span>
</span><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="err">&#39;</span><span class="n">add</span> <span class="n">Project</span><span class="err">&#39;</span>
</span><span class='line'><span class="err">$</span> <span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ‰æ—¶å€™ï¼Œæœ‰äº›æ–‡ä»¶æ²¡å¿…è¦å‘å¸ƒï¼Œä¾‹å¦‚Exampleæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>.npmignore</code>å¿½ç•¥å®ƒã€‚ä¾‹å¦‚æˆ‘è¿™é‡Œ<code>.npmignore</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Example</span><span class="o">/</span>
</span><span class='line'><span class="p">.</span><span class="n">git</span>
</span><span class='line'><span class="p">.</span><span class="n">gitignore</span>
</span><span class='line'><span class="p">.</span><span class="n">idea</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬npmè¿›è¡Œå‘å¸ƒçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå°†Exampleå‘å¸ƒåˆ°npmä¸Šäº†ã€‚</p>

<h4>4ã€æ·»åŠ Exampleï¼Œæµ‹è¯•æ˜¯å¦å¯ç”¨ï¼Œæ·»åŠ README</h4>

<p>æˆ‘ä»¬åœ¨<code>react-native-BGNativeModuleExample</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªExampleçš„ReactNativeå·¥ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡<code>rnpm install react-native-nativemodule-example</code>å‘½ä»¤å®‰è£…æˆ‘ä»¬å‘å¸ƒçš„<code>react-native-nativemodule-example</code>æ¨¡å—ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">$</span> <span class="n">rnpm</span> <span class="n">install</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span>
</span><span class='line'><span class="n">TestProject</span><span class="mf">@0.0.1</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">TestProject</span>
</span><span class='line'><span class="err">â””â”€â”€</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span><span class="mf">@1.0.0</span>
</span><span class='line'>
</span><span class='line'><span class="n">rnpm</span><span class="o">-</span><span class="n">link</span> <span class="n">info</span> <span class="n">Linking</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span> <span class="n">ios</span> <span class="n">dependency</span>
</span><span class='line'><span class="n">rnpm</span><span class="o">-</span><span class="n">link</span> <span class="n">info</span> <span class="n">iOS</span> <span class="n">module</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span> <span class="n">has</span> <span class="n">been</span> <span class="n">successfully</span> <span class="n">linked</span>
</span><span class='line'><span class="n">rnpm</span><span class="o">-</span><span class="n">link</span> <span class="n">info</span> <span class="n">Module</span> <span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span> <span class="n">has</span> <span class="n">been</span> <span class="n">successfully</span> <span class="n">installed</span> <span class="o">&amp;</span> <span class="n">linked</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢æç¤ºå®‰è£…å¹¶ä¸”linkæˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨jsä¸­è¿›è¡Œä½¿ç”¨äº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">import</span> <span class="n">BGNativeModuleExample</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">react</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">nativemodule</span><span class="o">-</span><span class="n">example</span><span class="err">&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">BGNativeModuleExample</span><span class="p">.</span><span class="n">testPrint</span><span class="p">(</span><span class="s">&quot;Jack&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nl">height</span><span class="p">:</span> <span class="err">&#39;</span><span class="mf">1.78</span><span class="n">m</span><span class="err">&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nl">weight</span><span class="p">:</span> <span class="err">&#39;</span><span class="mi">7</span><span class="n">kg</span><span class="err">&#39;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>5ã€æˆ‘ä»¬åœ¨å‘å¸ƒä¸Šçº¿ä¹‹åè¿˜éœ€è¦ç¼–å†™READMEæ–‡ä»¶ã€‚</h4>

<p>READMEæ–‡ä»¶æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœæ²¡æœ‰READMEæ–‡ä»¶ï¼Œåˆ«äººçœ‹åˆ°æˆ‘ä»¬çš„åŸç”Ÿç»„ä»¶ï¼Œæ ¹æœ¬å°±ä¸çŸ¥é“æˆ‘ä»¬è¿™ä¸ªç»„ä»¶æ˜¯ç”¨æ¥å¹²å•¥çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦æ·»åŠ ä¸€ä¸ªREADMEæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éœ€è¦å‘Šè¯‰åˆ«äººæˆ‘ä»¬è¿™ä¸ªåŸç”Ÿç»„ä»¶æ˜¯å¹²ä»€ä¹ˆçš„ã€å¦‚ä½•å®‰è£…ã€APIã€ä½¿ç”¨æ‰‹å†Œç­‰ç­‰ã€‚</p>

<h4>6ã€åŸç”Ÿæ¨¡å—å‡çº§ï¼Œå‘å¸ƒæ–°ç‰ˆæœ¬</h4>

<p>å½“æˆ‘ä»¬æ·»åŠ æ–°ä»£ç æˆ–è€…ä¿®å¤bugåï¼Œéœ€è¦å‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹package.jsonæ–‡ä»¶ä¸­çš„<code>version</code>çš„å€¼å°±è¡Œäº†ï¼Œç„¶åä½¿ç”¨<code>npm publish</code>è¿›è¡Œå‘å¸ƒã€‚</p>

<h2>æ€»ç»“</h2>

<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€æ˜¯è®²è¿°äº†ç¼–å†™åŸç”Ÿæ¨¡å—çš„çŸ¥è¯†ï¼ŒäºŒæ˜¯å°†æˆ‘ä»¬ç¼–å†™çš„å†…å®¹å‘å¸ƒåˆ°npmä¸Šã€‚</p>

<h2>å‚è€ƒ</h2>

<p><a href="http://weizhifeng.net/how-to-publish-a-node-module.html">å¦‚ä½•å‘å¸ƒNodeæ¨¡å—åˆ°NPMç¤¾åŒº</a></p>

<p><a href="http://reactnative.cn/docs/0.22/native-modules-ios.html#content">åŸç”Ÿæ¨¡å—</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntuä¸‹æ­å»ºvpnå†ç¨‹]]></title>
    <link href="http://www.liuchungui.com/blog/2016/04/23/ubuntuxia-da-jian-vpn/"/>
    <updated>2016-04-23T16:27:39+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/04/23/ubuntuxia-da-jian-vpn</id>
    <content type="html"><![CDATA[<p>å»å¹´å››æœˆä»½çš„æ—¶å€™ï¼Œå’ŒåŒå­¦ä¸€èµ·ä¹°äº†ä¸€ä¸ªé¦™æ¸¯çš„æœåŠ¡å™¨ï¼Œå‡†å¤‡æ­å»ºä¸€ä¸ªvpnç»™è‡ªå·±ç¿»å¢™ç”¨ã€‚å½“æ—¶ï¼Œvpnæ­å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯è¿ä¸Šå»ä¹‹åï¼Œæ ¹æœ¬è¿ä¸äº†googleã€‚åæ¥ï¼Œå»å’¨è¯¢äº†ä¸€ä¸‹ç›¼å“¥ï¼Œç›¼å“¥ç»™æˆ‘ä»‹ç»äº†ä¸€æ¬¾å¾ˆå‡ºåçš„ç¿»å¢™å·¥å…·Shadowsocksã€‚äºæ˜¯ï¼Œåˆ°ç½‘ä¸Šæœäº†ä¸€ä¸ªæ•™ç¨‹ï¼Œapt-get installå®‰è£…ï¼Œç¨å¾®é…ç½®ä¸€ä¸‹ï¼Œåœ¨æœ¬åœ°ç”µè„‘ä¸‹è½½ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¡«å†™æœåŠ¡å™¨å’Œå¯†ç ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥google.comç«‹é©¬å°±å‡ºç°äº†å¿ƒåŠ¨çš„é¡µé¢ï¼Œé¡¿æ—¶æ•´ä¸ªäººæ„Ÿè§‰ç¥æ¸…æ°”çˆ½ï¼Œè§‰å¾—ShadowsocksçœŸæ˜¯ä¸ªå¥½ä¸œè¥¿ã€‚äºæ˜¯ï¼Œä½¿ç”¨Shadowsocksç¿»å¢™ï¼Œç”¨åˆ°äº†ç°åœ¨ï¼Œä¸€ç›´æ„Ÿè§‰ä¸é”™ã€‚ä¸è¿‡ï¼Œåœ¨ä½¿ç”¨é€”ä¸­ï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„ä¸è¶³ï¼Œé‚£å°±æ˜¯å‘½ä»¤è¡Œä¸‹æ— æ³•ç¿»å¢™ï¼Œæ‰‹æœºä¸Šä½“éªŒä¸å¤ªå¥½ï¼ˆæˆ‘ä½¿ç”¨ä¸€æ¬¡å°±ä¸å†ä½¿ç”¨äº†ï¼‰ã€‚å‰å‡ å¤©ï¼Œç”±äºä½¿ç”¨ReactNativeå¼€å‘å®‰å“ï¼Œåœ¨å‘½ä»¤è¡Œä¸‹ä¸€å®šéœ€è¦ç¿»å¢™ä¸‹è½½googleçš„ä¸œè¥¿ã€‚äºæ˜¯ä¹ï¼Œé‡æ•´äº†ä¸€ä¸‹vpnï¼Œæœ€ç»ˆè¿˜æ˜¯ä»¥å¤±è´¥å‘Šç»ˆã€‚åæ¥ï¼Œå‡†å¤‡æ›²çº¿æ•‘å›½ï¼Œä½¿ç”¨Shadowsockså’Œä¸€äº›è¾…åŠ©å·¥å…·è¿›è¡Œå…¨å±€ç¿»å¢™ï¼ŒæŸ¥æ‰¾äº†ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œæ­å»ºåéƒ½å¤±è´¥äº†ã€‚æœ€ç»ˆï¼Œåœ¨ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ªvpnç¿»å¢™å·¥å…·<code>VPN Unlimited</code>ï¼Œæå®šäº†è‡ªå·±çš„é—®é¢˜ï¼Œä½†æ˜¯æœ‰æ—¶é—´é™åˆ¶ã€‚</p>

<p>ä»Šå¤©ï¼ŒæŒ‰ç…§åŒå­¦å‘çš„ä¸€ä¸ªé“¾æ¥æ•™ç¨‹é‡æ–°æ•´ä¸€ä¸‹vpnï¼Œåˆä»¥å¤±è´¥å‘Šç»ˆï¼Œè€Œä¸”VPNå¯åŠ¨éƒ½å¯åŠ¨ä¸èµ·æ¥äº†ï¼Œäºæ˜¯ä¹googleåˆ°ä¸Šé¢ç»§ç»­æ‰¾æ•™ç¨‹ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡<a href="http://my.oschina.net/mn1127/blog/380941">vps ubuntuä¸Šæ­å»ºpptpæœåŠ¡</a>ï¼ŒæŒ‰ç…§ä¸Šé¢æ­å»ºï¼Œæ²¡æƒ³åˆ°æˆåŠŸäº†ã€‚
é‰´äºä»¥ä¸Šæ­å»ºçš„ä¸å®¹æ˜“ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹æ­å»ºæ­¥éª¤ã€‚</p>

<!-- more -->


<h2>1ã€å¸è½½pptpdå’Œiptablesï¼Œé‡æ–°å®‰è£…pptpd</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#å¸è½½pptpd
</span><span class='line'>$ apt-get autoremove pptpd
</span><span class='line'>$ apt-get purge pptpd
</span><span class='line'>
</span><span class='line'>#å¸è½½iptables
</span><span class='line'>$ apt-get autoremove iptables*
</span><span class='line'>$ apt-get purge iptables*
</span><span class='line'>
</span><span class='line'>#å®‰è£…pptpd
</span><span class='line'>$ apt-get install pptpd</span></code></pre></td></tr></table></div></figure>


<h2>2ã€é…ç½®pptpd</h2>

<h4>ï¼ˆ1ï¼‰é¦–å…ˆï¼Œç¼–è¾‘pptpd.confæ–‡ä»¶ï¼Œè®¾ç½®localipå’Œremoteip</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/pptpd.conf</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥æ‰¾åˆ°localipå’Œremoteipï¼Œæ‰“å¼€æ³¨é‡Šè¿›è¡Œè®¾ç½®ã€‚å°†localipè®¾ç½®ä¸ºä½ çš„vpsçš„æœåŠ¡å™¨å…¬ç½‘ipï¼Œä¸çŸ¥é“å¯ä»¥é€šè¿‡ifconfigæŸ¥çœ‹ã€‚remoteipæ˜¯è®¾ç½®ç»™VPNç”¨æˆ·åˆ†é…çš„IPæ®µï¼Œæˆ‘è¿™é‡Œè®¾ç½®ä¸º10.100.0.2-100ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>localip VPS_IP
</span><span class='line'>remoteip 10.100.0.2-100</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ2ï¼‰ä¿®æ”¹dnsè®¾ç½®ï¼Œè®¾ç½®ä¸ºgoogleçš„DNS</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/ppp/pptpd-options</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥æ‰¾åˆ°ms-dnsï¼Œé…ç½®dnså¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ms-dns 8.8.8.8
</span><span class='line'>ms-dns 8.8.4.4</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ3ï¼‰è®¾ç½®VPNçš„è´¦å·å¯†ç </h4>

<p>ç¼–è¾‘chap-secretsæ–‡ä»¶</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/ppp/chap-secrets</span></code></pre></td></tr></table></div></figure>


<p>åœ¨chap-secretsæ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œé…ç½®</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#client           server       secret      IP address
</span><span class='line'> liuchungui       pptpd        123456          *</span></code></pre></td></tr></table></div></figure>


<p>å…¶ä¸­ï¼Œliuchunguiæ˜¯VPNçš„ç”¨æˆ·åï¼Œä½¿ç”¨çš„VPNæœåŠ¡ç±»å‹æ˜¯pptpdï¼Œå¯†ç æ˜¯123456ï¼Œ*ä»£è¡¨ä¸é™åˆ¶IP</p>

<h2>3ã€å¯åŠ¨pptpdæœåŠ¡</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /etc/init.d/pptpd restart</span></code></pre></td></tr></table></div></figure>


<p> è¾“å…¥ä¸Šé¢å‘½ä»¤ï¼Œå¦‚æœæç¤º<code>
  * Restarting PoPToP Point to Point Tunneling Server pptpd               [ OK ]</code>
  å°±è¯´æ˜å¯åŠ¨æˆåŠŸäº†</p>

<h2>4ã€è®¾ç½®ç³»ç»Ÿçš„ipv4çš„è½¬å‘å¼€å…³</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/sysctl.conf</span></code></pre></td></tr></table></div></figure>


<p>ç¼–è¾‘<code>/etc/sysctl.conf</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°<code>net.ipv4.ip_forward=1</code>ï¼ŒæŠŠè¿™è¡Œçš„æ³¨é‡Šæ‰“å¼€å¹¶ä¿å­˜ã€‚  <br/>
è¿è¡Œï¼š<code>sysctl -p</code> è®©ä¸Šé¢çš„ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆã€‚</p>

<h2>5ã€é…ç½®iptables</h2>

<h4>ï¼ˆ1ï¼‰å®‰è£…iptables</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install iptables</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ2ï¼‰æ·»åŠ ä¸€ä¸ªNATï¼Œè¿™é‡Œç‰¹åˆ«æ³¨æ„ï¼š<code>eth1</code>æ˜¯vpsçš„ipç½‘å¡æ¥å£ï¼Œå¯ä»¥é€šè¿‡ifconfigæŸ¥çœ‹</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ iptables -t nat -A POSTROUTING -s 10.100.0.0/24 -o eth1 -j MASQUERADE</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ3ï¼‰è®¾ç½®MTUï¼Œé˜²æ­¢åŒ…è¿‡å¤§</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ iptables -A FORWARD -s 10.100.0.0/24 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --set-mss 1200</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ4ï¼‰å†æ·»åŠ ä¸€ä¸ªNATï¼Œ<code>45.62.119.172</code>å°±æ˜¯ä½ çš„vpsçš„å…¬ç½‘ip</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ iptables -t nat -A POSTROUTING -s 10.100.0.0/24 -j SNAT --to-source 45.62.119.172</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ5ï¼‰å°†iptablesè§„åˆ™ä¿å­˜ï¼Œä»¤é‡å¯åè§„åˆ™ä¸ä¸¢å¤±ï¼š</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ iptables-save &gt; /etc/iptables-rules</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ6ï¼‰ç¼–è¾‘ç½‘å¡æ–‡ä»¶ï¼ŒåŠ è½½ç½‘å¡æ—¶è‡ªåŠ¨åŠ è½½è§„åˆ™</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/network/interfaces</span></code></pre></td></tr></table></div></figure>


<p>åœ¨<code>interfaces</code>æ–‡ä»¶æœ«å°¾åŠ ä¸Šï¼š<code>pre-up iptables-restore &lt; /etc/iptables-rules</code></p>

<h4>ï¼ˆ7ï¼‰å®‰è£…iptablesé…ç½®æŒä¹…åŒ–</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install iptables-persistent</span></code></pre></td></tr></table></div></figure>


<h4>ï¼ˆ8ï¼‰è¿è¡Œä¿å­˜é…ç½®å‘½ä»¤</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ service iptables-persistent start</span></code></pre></td></tr></table></div></figure>


<h2>å‚è€ƒ</h2>

<p><a href="http://my.oschina.net/mn1127/blog/380941">vps ubuntuä¸Šæ­å»ºpptpæœåŠ¡</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GCDæ€»ç»“]]></title>
    <link href="http://www.liuchungui.com/blog/2016/04/04/gcdzong-jie/"/>
    <updated>2016-04-04T19:13:33+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/04/04/gcdzong-jie</id>
    <content type="html"><![CDATA[<h3>GCDçš„çŸ¥è¯†ç‚¹ï¼š</h3>

<ol>
<li>queueåˆ†æˆä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ä¸²è¡Œé˜Ÿåˆ—(Serial Dispatch Queue)å’Œå¹¶è¡Œé˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queue)ã€‚</li>
<li>ä¸²è¡Œé˜Ÿåˆ—åªä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œå„ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¹‹é—´æ˜¯å¹¶è¡Œçš„ã€‚</li>
<li>ä¸²è¡Œé˜Ÿåˆ—ä¸ªæ•°åˆ›å»ºä¸å—é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸²è¡Œé˜Ÿåˆ—åˆ›å»ºçš„çº¿ç¨‹å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä½†æ˜¯è¿™æ ·ä¼šå­˜åœ¨æ¶ˆè€—å¤§é‡å†…å­˜çš„é—®é¢˜ï¼›è€Œå¹¶è¡Œé˜Ÿåˆ—ä¸ä¼šï¼Œä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªå¹¶è¡Œé˜Ÿåˆ—ï¼ŒXNUå†…æ ¸åªä½¿ç”¨æœ‰æ•ˆç®¡ç†çš„çº¿ç¨‹ã€‚</li>
<li>åœ¨iOS6ä»¥åï¼ŒARCå·²ç»å®ç°äº†GCDçš„å†…å­˜ç®¡ç†ï¼Œæ‰€ä»¥ä¸ç”¨æˆ‘ä»¬å»ç®¡ç†å®ƒçš„å†…å­˜äº†ã€‚</li>
<li>ç³»ç»Ÿå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªqueueï¼Œåˆ†åˆ«æ˜¯main queueå’Œglobal queueï¼Œå…¶ä¸­main queueæ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œglobal queueæ˜¯å¹¶è¡Œé˜Ÿåˆ—ã€‚</li>
</ol>


<!-- more -->


<h2>GCDçš„APIï¼š</h2>

<h3>1ã€dispatch_set_target_queue</h3>

<p>è¿™ä¸ªapiæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€æ˜¯è®¾ç½®dispatch_queue_createåˆ›å»ºé˜Ÿåˆ—çš„ä¼˜å…ˆçº§ï¼ŒäºŒæ˜¯å»ºç«‹é˜Ÿåˆ—çš„æ‰§è¡Œé˜¶å±‚ã€‚</p>

<p>ï¼ˆ1ï¼‰å½“ä½¿ç”¨dispatch_queue_createåˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œï¼Œå®ƒä»¬çš„ä¼˜å…ˆçº§éƒ½æ˜¯<code>DISPATCH_QUEUE_PRIORITY_DEFAULT</code>çº§åˆ«ï¼Œè€Œè¿™ä¸ªAPIå°±æ˜¯å¯ä»¥è®¾ç½®é˜Ÿåˆ—çš„ä¼˜å…ˆçº§ã€‚</p>

<p>å¦‚ä¸‹ï¼Œå°†serailQueueè®¾ç½®æˆ<code>DISPATCH_QUEUE_PRIORITY_HIGH</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">dispatch_queue_t</span> <span class="n">serialQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="n">kBGGCDTestIdentifier</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">globalQueue</span> <span class="o">=</span>
</span><span class='line'><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_HIGH</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="c1">//æ³¨æ„ï¼šè¢«è®¾ç½®ä¼˜å…ˆçº§çš„é˜Ÿåˆ—æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</span>
</span><span class='line'><span class="n">dispatch_set_target_queue</span><span class="p">(</span><span class="n">serialQueue</span><span class="p">,</span> <span class="n">globalQueue</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ï¼ˆ2ï¼‰ä½¿ç”¨è¿™ä¸ªAPIå¯ä»¥è®¾ç½®é˜Ÿåˆ—æ‰§è¡Œé˜¶å±‚ï¼Œä¾‹å¦‚<code>dispatch_set_target_queue(queue1, targetQueue);</code>è¿™æ ·è®¾ç½®æ—¶ï¼Œç›¸å½“äºå°†queue1æŒ‡æ´¾ç»™targetQueueï¼Œå¦‚æœtargetQueueæ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œåˆ™queue1æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼›å¦‚æœtargetQueueæ˜¯å¹¶è¡Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆqueue1æ˜¯å¹¶è¡Œçš„ã€‚</p>

<p>å½“targetQueueä¸ºä¸²è¡Œé˜Ÿåˆ—æ—¶ï¼Œä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">kBGGCDTestIdentifier</span> <span class="o">=</span> <span class="s">&quot;kBGGCDTestIdentifier&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">testTargetQueue</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">targetQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="n">kBGGCDTestIdentifier</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">queue1</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="n">kBGGCDTestIdentifier</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">queue2</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="n">kBGGCDTestIdentifier</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_set_target_queue</span><span class="p">(</span><span class="n">queue1</span><span class="p">,</span> <span class="n">targetQueue</span><span class="p">);</span>
</span><span class='line'>    <span class="n">dispatch_set_target_queue</span><span class="p">(</span><span class="n">queue2</span><span class="p">,</span> <span class="n">targetQueue</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue1</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;queue1 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue1</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;queue1 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue2</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;queue2 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue2</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;queue2 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">targetQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;target queue&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¾“å‡ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mf">31.015</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23237</span><span class="o">:</span><span class="mi">6187006</span><span class="p">]</span> <span class="n">queue1</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mf">31.015</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23237</span><span class="o">:</span><span class="mi">6187006</span><span class="p">]</span> <span class="n">queue1</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mf">31.016</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23237</span><span class="o">:</span><span class="mi">6187006</span><span class="p">]</span> <span class="n">queue2</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mf">31.017</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23237</span><span class="o">:</span><span class="mi">6187006</span><span class="p">]</span> <span class="n">queue2</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mf">31.018</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23237</span><span class="o">:</span><span class="mi">6187006</span><span class="p">]</span> <span class="n">target</span> <span class="n">queue</span>
</span></code></pre></td></tr></table></div></figure>


<p>å½“ä¸Šé¢ä»£ç ä¸­targetQueueæ˜¯å¹¶è¡Œé˜Ÿåˆ—æ—¶</p>

<p>è¾“å‡ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">48.234</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23331</span><span class="o">:</span><span class="mi">6188776</span><span class="p">]</span> <span class="n">queue2</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">48.234</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23331</span><span class="o">:</span><span class="mi">6188777</span><span class="p">]</span> <span class="n">queue1</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">48.234</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23331</span><span class="o">:</span><span class="mi">6188780</span><span class="p">]</span> <span class="n">queue2</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">48.234</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23331</span><span class="o">:</span><span class="mi">6188786</span><span class="p">]</span> <span class="n">target</span> <span class="n">queue</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mo">00</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mf">48.235</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">23331</span><span class="o">:</span><span class="mi">6188777</span><span class="p">]</span> <span class="n">queue1</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>å‚è€ƒï¼š<a href="http://justsee.iteye.com/blog/2233252">http://justsee.iteye.com/blog/2233252</a></p>

<h3>2ã€dispatch_after</h3>

<p>æŒ‡å®šæ—¶é—´æ‰§è¡ŒæŸäº›å†…å®¹ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢ä¸€ç§’åæ‰§è¡Œæ‰“å°ä¿¡æ¯.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>  <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;test&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3ã€dispatch_group</h3>

<p>ç»å¸¸ä¼šæœ‰è¿™ä¹ˆä¸ªéœ€æ±‚ï¼Œå°±æ˜¯å¤šä¸ªqueueä¸­æ‰€æœ‰æ“ä½œæ‰§è¡Œå®Œä¹‹åï¼Œæƒ³å†æ‰§è¡Œç»“æŸå¤„ç†ï¼Œè€Œdispatch_groupæ­£æ˜¯å¹²è¿™ä¸ªçš„ã€‚å®ƒæœ‰ä¸¤ç§æ“ä½œå¯ä»¥åšåˆ°ï¼Œä¸€ç§æ˜¯ä½¿ç”¨dispatch_group_notifyï¼Œå¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨dispatch_group_waitã€‚</p>

<p>å®ƒä»¬åŒºåˆ«æ˜¯dispatch_group_notifyæ˜¯å¯ä»¥å°†ç»“æŸè¿½åŠ åˆ°æŸä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œä¸ä¼šé˜»å¡å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ï¼›è€Œdispatch_group_waitä¼šé˜»å¡å½“å‰æ‰§è¡Œçº¿ç¨‹ï¼Œç›´åˆ°groupä¸­æ‰€æœ‰å¤„ç†å…¨éƒ¨æ‰§è¡Œç»“æŸæˆ–è¶…è¿‡ç­‰å¾…çš„æŒ‡å®šæ—¶é—´ã€‚å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨<code>DISPATCH_TIME_NOW</code>å°±ä¸ç”¨ç­‰å¾…ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹çš„Runloopæ¯æ¬¡å¾ªç¯ä¸­ï¼Œæ£€æŸ¥æ‰§è¡Œæ˜¯å¦ç»“æŸï¼Œè¿™æ ·å°±ä¸ä¼šå µå¡å½“å‰æ‰§è¡Œçš„çº¿ç¨‹äº†ï¼Œä¸è¿‡è¿™æ ·å®ç°èµ·æ¥å°±ä¼šéº»çƒ¦å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œæ¨èä½¿ç”¨dispatch_group_notifyã€‚</p>

<p>ä½¿ç”¨dispatch_group_notifyæ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testGroupNotification</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">serialQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.serailQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrentQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_group_t</span> <span class="n">group</span> <span class="o">=</span> <span class="n">dispatch_group_create</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">serialQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;serailQueue 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">serialQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;serailQueue 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;concurrentQueue 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;concurrentQueue 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_notify</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;finish!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;testGroupNotification&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨dispatch_group_waitæ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testGroupWait</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">serialQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.serailQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrentQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_group_t</span> <span class="n">group</span> <span class="o">=</span> <span class="n">dispatch_group_create</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">serialQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;serailQueue 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">serialQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;serailQueue 2&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;concurrentQueue 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;concurrentQueue 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_group_wait</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">DISPATCH_TIME_FOREVER</span><span class="p">);</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;testGroupNotification&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4ã€dispatch_barrier_async</h3>

<p>dispatch_barrier_asyncåŠ å…¥çš„å¤„ç†ï¼Œä¼šç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„å¤„ç†ç»“æŸåæ‰æ‰§è¡Œbarrierå½“ä¸­çš„å¤„ç†ï¼Œè€Œä¸”åªæœ‰ç­‰å¾…barrieræ‰§è¡Œå®Œä¹‹åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œåç»­å¤„ç†ã€‚<strong>ä½¿ç”¨å¹¶è¡Œé˜Ÿåˆ—å’Œdispatch_barrier_asyncå¯ä»¥åšåˆ°å¾ˆé«˜æ•ˆçš„æ•°æ®åº“æˆ–æ–‡ä»¶è®¿é—®</strong>ã€‚</p>

<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testBarrier</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrent.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;reading 1&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;reading 2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;reading 3&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_barrier_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;writing&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;reading 4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;reading 5&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¾“å‡ºç»“æœï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.980</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276100</span><span class="p">]</span> <span class="n">reading</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.980</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276099</span><span class="p">]</span> <span class="n">reading</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.981</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276102</span><span class="p">]</span> <span class="n">reading</span> <span class="mi">3</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.981</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276102</span><span class="p">]</span> <span class="n">writing</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.982</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276102</span><span class="p">]</span> <span class="n">reading</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mf">47.982</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28694</span><span class="o">:</span><span class="mi">6276099</span><span class="p">]</span> <span class="n">reading</span> <span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>


<h3>5ã€dispatch_sync</h3>

<p>ä¸dispatch_asyncå¼‚æ­¥ä¸åŒçš„æ˜¯dispatch_syncä¼šç­‰å¾…å½“å‰å¤„ç†ç»“æŸä¹‹åæœ‰è¿”å›ç»“æœæ—¶æ‰ä¼šç»§ç»­å¾€ä¸‹èµ°ã€‚ä¸dispatch_group_waitæœ‰ç‚¹ç±»ä¼¼ï¼Œå½“ä½¿ç”¨dispatch_syncæ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å®ƒæœ‰è¿”å›ç»“æœä¸ºæ­¢ã€‚</p>

<p>ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testSync</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">serialQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.serailQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrent.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">serialQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;test&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;test2&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;finish&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¾“å‡ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mf">43.166</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28912</span><span class="o">:</span><span class="mi">6278490</span><span class="p">]</span> <span class="n">test</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mf">43.167</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28912</span><span class="o">:</span><span class="mi">6278490</span><span class="p">]</span> <span class="n">test2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mf">43.167</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">28912</span><span class="o">:</span><span class="mi">6278490</span><span class="p">]</span> <span class="n">finish</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨dispatch_syncå¾ˆå®¹æ˜“é€ æˆæ­»é”ï¼Œå¦‚ä¸‹ä»£ç åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œå°±ä¼šé€ æˆæ­»é”ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;test&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ†æï¼šä¸»çº¿ç¨‹ä¼šç­‰å¾…dispatch_syncå‡½æ•°è¿”å›ï¼Œè€Œdispatch_syncè¦ç­‰blockæ‰§è¡Œå®Œæ‰ä¼šè¿”å›ã€‚è€Œä¸»çº¿ç¨‹æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œé‡‡ç”¨FIFOé˜Ÿåˆ—æ‰§è¡Œä»»åŠ¡ï¼Œdispatch_syncåŠ å…¥çš„blockæ˜¯ååŠ å…¥çš„ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªblockæ˜¯å¾—ä¸åˆ°æ‰§è¡Œçš„ï¼Œä»è€Œäº§ç”Ÿäº†æ­»é”ã€‚</p>

<p><strong>å®˜æ–¹æ–‡æ¡£æŒ‡å‡ºï¼šdispatch_syncçš„å½“å‰æ‰§è¡Œé˜Ÿåˆ—ä¸æäº¤blockæ‰§è¡Œçš„ç›®æ ‡é˜Ÿåˆ—ç›¸åŒæ—¶å¹¶ä¸”æ˜¯ä¸²è¡Œé˜Ÿåˆ—æ—¶å°†é€ æˆæ­»é”ã€‚</strong></p>

<p>å‚è€ƒï¼š
<a href="http://www.jianshu.com/p/44369c02b62a">dispatch_syncæ­»é”é—®é¢˜ç ”ç©¶</a>
<a href="http://www.cnblogs.com/tangbinblog/p/4133481.html">GCD ä¹‹çº¿ç¨‹æ­»é”</a></p>

<h3>6ã€dispatch_apply</h3>

<p>dispatch_applyå‡½æ•°æ˜¯dispatch_syncå’ŒDISPATCH Groupçš„å…³è”APIã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Blockè¿½åŠ åˆ°æŒ‡å®šçš„é˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</p>

<p>ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testApply</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrent.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">dispatch_apply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%zd&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;done!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¾“å‡ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.524</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6331022</span><span class="p">]</span> <span class="mi">0</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.524</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6331025</span><span class="p">]</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.524</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6330953</span><span class="p">]</span> <span class="mi">1</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.524</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6331023</span><span class="p">]</span> <span class="mi">3</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.525</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6331022</span><span class="p">]</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">12</span><span class="o">:</span><span class="mi">08</span><span class="o">:</span><span class="mf">35.525</span> <span class="n">BGGCDDemo</span><span class="p">[</span><span class="mi">32542</span><span class="o">:</span><span class="mi">6330953</span><span class="p">]</span> <span class="n">done</span><span class="o">!</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>æ³¨æ„ï¼šå› ä¸ºdispatch_applyä¼šè®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ç­‰å¾…ï¼Œé˜»å¡çº¿ç¨‹ï¼Œå› æ­¤æœ€å¥½å°†å®ƒæ”¾åœ¨dispatch_asyncä¸­æ‰§è¡Œã€‚</strong></p>

<h3>7ã€dispatch_suspend/dispatch_resume</h3>

<p>dispatch_suspendå¯ä»¥æš‚åœå½“å‰é˜Ÿåˆ—çš„æ‰§è¡Œï¼Œdispatch_resumeæ¢å¤å½“å‰é˜Ÿåˆ—çš„æ‰§è¡Œã€‚
è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å·²ç»æ‰§è¡Œçš„å¤„ç†æ²¡æœ‰å½±å“ã€‚æŒ‚èµ·åï¼Œè¿½åŠ åˆ°queueä¸­ä½†å°šæœªæ‰§è¡Œçš„å¤„ç†åœ¨æ­¤ä¹‹ååœæ­¢æ‰§è¡Œã€‚è€Œæ¢å¤åˆ™ä½¿å¾—è¿™äº›å¤„ç†èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p>

<h3>8ã€Dispatch Semaphore</h3>

<p>ä¿¡å·é‡ï¼Œæ›´ç»†ç²’åº¦çš„å¤„ç†èµ„æºç«äº‰çš„æ–¹æ¡ˆã€‚  <br/>
ä¸»è¦ç”¨åˆ°ä¸‰ä¸ªæ–¹æ³•dispatch_semaphore_createã€dispatch_semaphore_waitã€dispatch_semaphore_signalã€‚</p>

<ul>
<li>dispatch_semaphore_createï¼šåˆ›å»ºä¸€ä¸ªdispatch_semaphore_tï¼Œå¹¶ä¸”åˆå§‹åŒ–Dispatch Semaphoreçš„è®¡æ•°å€¼ï¼›</li>
<li>dispatch_semaphore_waitï¼šç­‰å¾…Dispatch Semaphoreçš„è®¡æ•°å€¼å¤§äºç­‰äº1ï¼Œå¦‚æœå¤§äºç­‰äº1ï¼Œåˆ™è®¡æ•°å€¼å‡1å¹¶ä¸”å¾€ä¸‹ç»§ç»­æ‰§è¡Œï¼›å¦‚æœç­‰äº0ï¼Œåˆ™ä¸€ç›´ç­‰å¾…è®¡æ•°å€¼å¢åŠ ã€‚</li>
<li>dispatch_semaphore_sigalï¼šå°†Dispatch Semaphoreçš„è®¡æ•°å€¼åŠ 1</li>
</ul>


<p>è¿™ä¸‰ä¸ªæ–¹æ³•é…åˆä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">void</span> <span class="nf">testSemaphore</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">concurrentQueue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;BG.concurrentQueue.com&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_semaphore_t</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="n">dispatch_semaphore_create</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="bp">NSInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">concurrentQueue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>            <span class="n">dispatch_semaphore_wait</span><span class="p">(</span><span class="n">semaphore</span><span class="p">,</span> <span class="n">DISPATCH_TIME_FOREVER</span><span class="p">);</span>
</span><span class='line'>            <span class="p">[</span><span class="n">array</span> <span class="nl">addObject</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="n">i</span><span class="p">]];</span>
</span><span class='line'>            <span class="n">dispatch_semaphore_signal</span><span class="p">(</span><span class="n">semaphore</span><span class="p">);</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%zd&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>9ã€dispatch_once</h3>

<p>ä¿è¯åœ¨åº”ç”¨ç¨‹åºä¸­åªæ‰§è¡Œä¸€æ¬¡æŒ‡å®šçš„å¤„ç†ï¼Œä¸€èˆ¬åº”ç”¨åœºæ™¯å°±æ˜¯å•ä¾‹äº†ã€‚</p>

<h3>10ã€dispatch_source</h3>

<p>ä¸Dispatch Queueä¸åŒçš„æ˜¯ï¼Œdispatch_sourceæ˜¯å¯ä»¥è¿›è¡Œå–æ¶ˆçš„ï¼Œè€Œä¸”å¯ä»¥æ·»åŠ å–æ¶ˆçš„blockå›è°ƒï¼›dispatch_sourceå¯ä»¥åšå¼‚æ­¥è¯»å–æ–‡ä»¶æ˜ åƒã€å®šæ—¶å™¨ã€ç›‘å¬æ–‡ä»¶ç›®å½•å˜åŒ–ç­‰ç­‰ï¼Œå…·ä½“è¯·è§ä¸‹è¡¨ï¼š</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> æ–¹æ³• </th>
<th style="text-align:left;"> è¯´æ˜ </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_DATA_ADD </td>
<td style="text-align:left;"> æ•°æ®å¢åŠ  </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_DATA_OR </td>
<td style="text-align:left;"> æ•°æ®OR </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_MACH_SEND </td>
<td style="text-align:left;"> Machç«¯å£å‘é€ </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_MACH_RECV </td>
<td style="text-align:left;"> Machç«¯å£æ¥æ”¶ </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_MEMORYPRESSURE </td>
<td style="text-align:left;"> å†…å­˜æƒ…å†µ </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_PROC </td>
<td style="text-align:left;"> è¿›ç¨‹äº‹ä»¶ </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_READ </td>
<td style="text-align:left;"> è¯»æ•°æ® </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_SIGNAL </td>
<td style="text-align:left;"> ä¿¡å· </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_TIMER </td>
<td style="text-align:left;"> å®šæ—¶å™¨ </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_VNODE </td>
<td style="text-align:left;"> æ–‡ä»¶ç³»ç»Ÿå˜åŒ– </td>
</tr>
<tr>
<td style="text-align:left;"> DISPATCH_SOURCE_TYPE_WRITE </td>
<td style="text-align:left;"> æ–‡ä»¶å†™å…¥ </td>
</tr>
</tbody>
</table>


<p>å®šæ—¶å™¨ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSourceTimer</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//å®šæ—¶å™¨åœ¨ä¸»çº¿ç¨‹è¿è¡Œ</span>
</span><span class='line'>    <span class="kt">dispatch_source_t</span> <span class="n">timer</span> <span class="o">=</span> <span class="n">dispatch_source_create</span><span class="p">(</span><span class="n">DISPATCH_SOURCE_TYPE_TIMER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dispatch_get_main_queue</span><span class="p">());</span>
</span><span class='line'>    <span class="c1">//è®¾ç½®å®šæ—¶å™¨æ¯éš”2ç§’è°ƒç”¨ä¸€æ¬¡ï¼Œå…è®¸å»¶è¿Ÿ1ç§’</span>
</span><span class='line'>    <span class="n">dispatch_source_set_timer</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//å®šæ—¶å™¨æ‰§è¡Œçš„å¤„ç†</span>
</span><span class='line'>    <span class="n">dispatch_source_set_event_handler</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;timer work&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//        dispatch_source_cancel(timer);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="c1">//å®šæ—¶å™¨å–æ¶ˆæ‰€åšçš„å¤„ç†</span>
</span><span class='line'>    <span class="n">dispatch_source_set_cancel_handler</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;timer cancel!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="c1">//éœ€è¦å°†å®šæ—¶å™¨è®¾ç½®ä¸ºå…¨å±€å˜é‡ï¼Œå¦åˆ™å°±ä¼šè¢«æå‰é‡Šæ”¾</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">timer</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//å¯åŠ¨å®šæ—¶å™¨</span>
</span><span class='line'>    <span class="n">dispatch_resume</span><span class="p">(</span><span class="n">timer</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç›‘å¬æ–‡ä»¶å¤¹å˜åŒ–ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testSourceForObservFile</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå†™å…¥æ–‡ä»¶ï¼Œç”¨æ¥è¿›è¡Œæµ‹è¯•</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">cacheDirectory</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSCachesDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">)</span> <span class="n">firstObject</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">directory</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%@/test&quot;</span><span class="p">,</span> <span class="n">cacheDirectory</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">fileExistsAtPath</span><span class="p">:</span><span class="n">directory</span> <span class="nl">isDirectory</span><span class="p">:</span><span class="nb">nil</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">createDirectoryAtPath</span><span class="p">:</span><span class="n">directory</span> <span class="nl">withIntermediateDirectories</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">attributes</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;%@/test.txt&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">fileExistsAtPath</span><span class="p">:</span><span class="n">filePath</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="s">@&quot;hello&quot;</span> <span class="nl">writeToFile</span><span class="p">:</span><span class="n">filePath</span> <span class="nl">atomically</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSURL</span> <span class="o">*</span><span class="n">directoryURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">directory</span><span class="p">];</span> <span class="c1">// assume this is set to a directory</span>
</span><span class='line'>    <span class="kt">int</span> <span class="k">const</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">([[</span><span class="n">directoryURL</span> <span class="n">path</span><span class="p">]</span> <span class="n">fileSystemRepresentation</span><span class="p">],</span> <span class="n">O_EVTONLY</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
</span><span class='line'>        <span class="n">strerror_r</span><span class="p">(</span><span class="n">errno</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Unable to open </span><span class="se">\&quot;</span><span class="s">%@</span><span class="se">\&quot;</span><span class="s">: %s (%d)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">directoryURL</span> <span class="n">path</span><span class="p">],</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//è®¾ç½®æºç›‘å¬æ–‡ä»¶å¤¹çš„å˜åŒ–ï¼Œå…¶ä¸­ç›‘å¬çš„æ˜¯å†™å…¥ã€åˆ é™¤ã€æ›´æ”¹åå­—</span>
</span><span class='line'>    <span class="kt">dispatch_source_t</span> <span class="n">source</span> <span class="o">=</span> <span class="n">dispatch_source_create</span><span class="p">(</span><span class="n">DISPATCH_SOURCE_TYPE_VNODE</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span>
</span><span class='line'>                                                      <span class="n">DISPATCH_VNODE_WRITE</span> <span class="o">|</span> <span class="n">DISPATCH_VNODE_DELETE</span> <span class="o">|</span> <span class="n">DISPATCH_VNODE_RENAME</span><span class="p">,</span> <span class="n">DISPATCH_TARGET_QUEUE_DEFAULT</span><span class="p">);</span>
</span><span class='line'>    <span class="n">dispatch_source_set_event_handler</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">^</span><span class="p">(){</span>
</span><span class='line'>        <span class="c1">//è·å–æºå˜åŒ–çš„å…·ä½“æ ‡å¿—</span>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="k">const</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dispatch_source_get_data</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">DISPATCH_VNODE_WRITE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;The directory changed.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">DISPATCH_VNODE_DELETE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;The directory has been deleted.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_source_set_cancel_handler</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">^</span><span class="p">(){</span>
</span><span class='line'>        <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>
</span><span class='line'>    <span class="n">dispatch_resume</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">source</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å‚è€ƒï¼š<a href="https://github.com/ming1016/study/wiki/%E7%BB%86%E8%AF%B4GCD%EF%BC%88Grand-Central-Dispatch%EF%BC%89%E5%A6%82%E4%BD%95%E7%94%A8">ç»†è¯´GCDå¦‚ä½•ä½¿ç”¨</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ReactNativeä¹‹Flexå¸ƒå±€æ€»ç»“]]></title>
    <link href="http://www.liuchungui.com/blog/2016/04/04/reactnativezhi-flexbu-ju-zong-jie/"/>
    <updated>2016-04-04T18:35:53+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/04/04/reactnativezhi-flexbu-ju-zong-jie</id>
    <content type="html"><![CDATA[<p>ä»äºŒæœˆä»½å¼€å§‹å­¦ä¹ ReactNativeåˆ°ç°åœ¨å·²ç»æœ‰ä¸¤ä¸ªæœˆäº†ï¼Œé›¶ç¢çš„è®°å½•äº†å¾ˆå¤šç¬”è®°ï¼Œä¸€ç›´æƒ³å†™ä¸€äº›ReactNativeç›¸å…³çš„ä¸œè¥¿ï¼Œå¥ˆä½•æ„Ÿè§‰è‡ªå·±å­¦ä¹ çš„è¿˜æ¯”è¾ƒæµ…é™‹ï¼Œè€Œä¸”ç¬”è®°æ¯”è¾ƒæ‚ä¹±ï¼Œä¸çŸ¥ä»ä½•è€Œèµ·ï¼Œæ‰€ä»¥è¿Ÿè¿Ÿæ²¡æœ‰åŠ¨ç¬”ã€‚æ¸…æ˜ä¸‰å¤©å‡ï¼Œå†³å®šæ— è®ºå¦‚ä½•éƒ½å¾—æ•´ä¸€ç¯‡å‡ºæ¥ã€‚æœ¬æ¥æ˜¯æƒ³æ•´ä¸€ç¯‡ReactNativeå¸ƒå±€ç¯‡çš„ï¼Œä½†æ˜¯çœ‹çœ‹é‚£ä¹ˆå¤šå¸ƒå±€å±æ€§ï¼Œè‡ªå·±å¯¹CSSåˆä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œå¸ƒå±€ç¯‡ä»ä½•è°ˆèµ·ï¼Ÿæ‰€ä»¥ï¼Œä¸“é—¨æ‹¿å‡ºReactNativeä¸­å¸ƒå±€æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªç‚¹Flexå¸ƒå±€æ¥åšä¸‹æ€»ç»“ï¼Œç®—æ˜¯å¼€å¯ReactNativeç¯‡ç« ã€‚</p>

<p>Flexæ˜¯Flexible Boxçš„ç¼©å†™ï¼Œæ„ä¸ºâ€œå¼¹æ€§å¸ƒå±€â€ï¼Œ2009å¹´å®ƒç”±W3Cæå‡ºäº†ä¸€ç§æ–°çš„ç½‘é¡µå¸ƒå±€æ–¹æ¡ˆã€‚è€ŒFaceBookå°†è¿™ä¸ªå¸ƒå±€ä¹Ÿåº”ç”¨åˆ°Reactå’ŒReactNativeä¸¤ä¸ªé¡¹ç›®å½“ä¸­ã€‚è€Œåœ¨ReactNativeå½“ä¸­ï¼Œç½‘é¡µçš„æœ‰äº›å±æ€§å’Œå±æ€§çš„å€¼å¹¶ä¸æ”¯æŒï¼Œä¸‹é¢æ¥çœ‹çœ‹ReactNativeå½“ä¸­æ”¯æŒçš„å±æ€§ã€‚ï¼ˆå¦‚æœå¯¹äºFlexå¸ƒå±€ä¸å¤ªäº†è§£çš„åŒå­¦ï¼Œå¯ä»¥çœ‹çœ‹<a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡</a>ï¼‰</p>

<!-- more -->


<h2>ä¸€ã€å®¹å™¨å±æ€§ï¼š</h2>

<p>ReactNativeæ”¯æŒçš„å®¹å™¨å±æ€§æœ‰flexDirectionã€flexWrapã€justifyContentå’ŒalignItemsã€‚</p>

<h4>1ã€ flexDirectionå±æ€§</h4>

<p>flexDirectionå±æ€§å†³å®šäº†ä¸»è½´çš„æ–¹å‘ï¼Œå®ƒæœ‰ä¸¤ä¸ªå€¼ï¼š</p>

<ul>
<li>row: ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯</li>
<li>column:  ä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨é¡¶éƒ¨</li>
</ul>


<h4>2ã€flexWrapå±æ€§</h4>

<p>flexWrapå±æ€§å®šä¹‰ä¸€æ¡è½´çº¿æ’ä¸ä¸‹æ—¶æ˜¯å¦æŠ˜è¡Œã€‚å®ƒæœ‰ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯'wrap'å’Œ'nowrap'ï¼Œåˆ†åˆ«ä»£è¡¨æ”¯æŒæ¢è¡Œå’Œä¸æ”¯æŒæ¢è¡Œï¼Œé»˜è®¤æ˜¯'nowrap'ã€‚</p>

<h4>3ã€justifyContentå±æ€§</h4>

<p>ä¸»è½´çš„å¯¹é½æ–¹å¼ï¼Œé»˜è®¤ä¸º'flex-start'ï¼Œå®ƒçš„å€¼æœ‰äº”ä¸ªï¼š</p>

<ul>
<li>flex-startï¼šä¸»è½´èµ·ç‚¹å¯¹é½</li>
<li>flex-endï¼šä¸»è½´ç»ˆç‚¹</li>
<li>centerï¼šå±…ä¸­</li>
<li>space-betweenï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰</li>
<li>space-around: æ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚é¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</li>
</ul>


<h4>4ã€alignItemså±æ€§</h4>

<p>äº¤å‰è½´çš„å¯¹é½æ–¹å¼ï¼Œé»˜è®¤ä¸º'stretch'ï¼Œå®ƒæœ‰å››ä¸ªå€¼ï¼š</p>

<ul>
<li>flex-start: äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½</li>
<li>flex-end: äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½</li>
<li>center: äº¤å‰è½´çš„ä¸­å¿ƒå¯¹é½</li>
<li>stretch: å®¹å™¨ä¸­çš„æ‰€æœ‰é¡¹ç›®æ‹‰ä¼¸å¡«æ»¡æ•´ä¸ªå®¹å™¨</li>
</ul>


<h2>äºŒã€é¡¹ç›®å±æ€§</h2>

<h4>1ã€flexå±æ€§</h4>

<p>æ˜¯å¦è®©å½“å‰çš„è§†å›¾å°½é‡å ç”¨æ›´å¤§çš„ç©ºé—´ï¼Œè¿™ä¸ªå±æ€§å¯èƒ½ä½¿é¡¹ç›®å±æ€§justifyContentå¤±æ•ˆã€‚æœ‰ä¸¤ä¸ªå€¼0å’Œ1ï¼Œ0ä»£è¡¨å¦ï¼Œ1ä»£è¡¨æ˜¯ï¼Œé»˜è®¤ä¸º0ã€‚</p>

<h3>2ã€alignSelfå±æ€§</h3>

<p>å…è®¸å•ä¸ªé¡¹ç›®åœ¨äº¤å‰è½´æ–¹å‘ä¸Šä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–alignItemså±æ€§ï¼Œå®ƒçš„å€¼æœ‰äº”ä¸ªï¼Œé™¤äº†'auto'ï¼Œå…¶ä»–éƒ½ä¸alignItemå±æ€§å®Œå…¨ä¸€è‡´ï¼Œé»˜è®¤ä¸º'auto'ã€‚</p>

<h2>åè¯</h2>

<p>åœ¨åˆšå¼€å§‹æ¥è§¦ReactNativeçš„æ—¶å€™ï¼Œå¯¹äºæˆ‘è¿™ä¹ˆä¸€ä¸ªä»æœªæœ‰è¿‡å‰ç«¯å¼€å‘çš„iOSå¼€å‘ç¨‹åºå‘˜ï¼Œä¸¤ä¸ªåœ°æ–¹ç›´æ¥è®©æˆ‘æ‡µäº†ï¼Œä¸€æ˜¯é‡Œé¢çš„è¯­æ³•ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯Flexå¸ƒå±€ã€‚å¸ƒå±€å½“ä¸­å…¶å®ƒä¾‹å¦‚bottomã€leftã€marginç­‰ç­‰å±æ€§éƒ½èƒ½ä»å­—é¢æ„æ€ç†è§£ï¼Œè€ŒFlexå¸ƒå±€ï¼Œç¡®å®æ˜¯ä»æ²¡è§è¿‡çš„ä¸œè¥¿ï¼Œä¸ç†è§£é‡Œé¢çš„æ¦‚å¿µæ ¹æœ¬æ²¡æ³•ç”¨ã€‚å¥½åœ¨æ‰¾åˆ°äº†é˜®ä¸€å³°è€å¸ˆçš„<a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡</a>çš„è¿™ç¯‡æ–‡ç« ï¼Œå¿«é€Ÿçš„æŒæ¡äº†Flexå¸ƒå±€ã€‚
åœ¨è¿™å‡ å¤©ReactNativeçš„å¼€å‘å½“ä¸­ï¼Œè¶Šå‘è§‰å¾—Flexå¸ƒå±€çš„é‡è¦æ€§ï¼Œèƒ½å°†ä¸Šé¢çš„å±æ€§å…¨éƒ¨ç†è§£æ¸…æ¥šçš„è¯ï¼Œå¹¶ä¸”çµæ´»ä½¿ç”¨ï¼Œå¿…ç„¶ä¼šè®©ReactNativeå¼€å‘ä¹‹æ—…æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚</p>

<h2>å‚è€ƒï¼š</h2>

<p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡</a>  <br/>
<a href="http://reactnative.cn/docs/flexbox.html#content">å¼¹æ€§ç›’(Flexbox)</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Runtimeä¹‹ç±»ä¸å¯¹è±¡æ€»ç»“]]></title>
    <link href="http://www.liuchungui.com/blog/2016/03/14/runtimezhi-lei-yu-dui-xiang-zong-jie/"/>
    <updated>2016-03-14T23:30:27+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/03/14/runtimezhi-lei-yu-dui-xiang-zong-jie</id>
    <content type="html"><![CDATA[<p>ä»¥å‰åœ¨ä½¿ç”¨<a href="https://github.com/elado/jastor">jastor</a>è§£æJsonæˆmodelçš„æ—¶å€™é‡Œé¢æ¶‰åŠåˆ°äº†Runtimeé‡Œé¢çš„çŸ¥è¯†ï¼Œæ‰€ä»¥ä¸“é—¨çœ‹äº†<a href="http://blog.jobbole.com/79566/">Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸€åˆ°å…­</a>è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œæ•´ä¸ªJastorä¹Ÿå°±æ‡‚äº†ï¼Œç°åœ¨éå¸¸å‡ºåçš„æ¡†æ¶<a href="https://github.com/Mantle/Mantle">Mantle</a>ï¼Œ<a href="https://github.com/icanzilb/JSONModel">JSONModel</a>ä¹Ÿéƒ½æ˜¯å·®ä¸å¤šçš„åŸç†ã€‚ä½†æ˜¯ï¼Œä¸€å¹´ä¹‹åçš„ä»Šå¤©é‡æ–°å†çœ‹çš„æ—¶å€™ï¼Œå‘ç°å¤§æ¦‚æ€è·¯çŸ¥é“ï¼Œä½†æ˜¯å…·ä½“çš„ä¸€äº›ç»†èŠ‚å®ç°éœ€è¦å†™çš„æ—¶å€™ï¼Œå´ä¸€æ—¶ä¸Šä¸äº†æ‰‹ï¼Œæ‰€ä»¥é‡æ–°çœ‹äº†<a href="http://blog.jobbole.com/79566/">Objective-C Runtime è¿è¡Œæ—¶</a>ä¸€ç³»åˆ—ï¼Œç„¶åæ•´ç†äº†ä¸€ä¸‹ï¼Œç»†èŠ‚éƒ¨åˆ†é™„ä¸Šä¸€äº›ä»£ç ï¼Œæ–¹ä¾¿ä»¥åæŸ¥æ‰¾ã€‚</p>

<!-- more -->


<h2>ä¸€ã€å¯¹è±¡ã€ç±»ã€å…ƒç±»ä¹‹é—´çš„å…³ç³»</h2>

<ul>
<li>æ¯ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªobjc_objectç»“æ„ä½“ï¼Œæ­¤ç»“æ„ä½“åªæœ‰ä¸€ä¸ªå…ƒç´ å³æŒ‡å‘å…¶ç±»çš„isaæŒ‡é’ˆï¼ŒisaæŒ‡é’ˆçš„ç±»å‹ä¸ºClassã€‚(Classçš„ç»“æ„ä½“åé¢æœ‰ï¼‰</li>
<li>æ¯ä¸ªç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„isaæŒ‡é’ˆæŒ‡å‘å®ƒçš„å…ƒç±»(meta class)ï¼Œä¸€èˆ¬å…ƒç±»éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li>
<li>æ¯ä¸ªå…ƒç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„isaæŒ‡é’ˆæŒ‡å‘NSObjectçš„å…ƒç±»ï¼Œè€ŒNSObjectçš„å…ƒç±»æŒ‡å‘å®ƒæœ¬èº«ï¼ˆå³NSObjectå…ƒç±»ï¼‰</li>
<li>è€Œæ¯ä¸ªç±»çš„super classéƒ½æŒ‡å‘å®ƒçš„çˆ¶ç±»ï¼Œç›´è‡³NSObjectï¼ŒNSObjectçš„super classä¸ºnullã€‚</li>
<li>æ¯ä¸ªå…ƒç±»çš„super classéƒ½æŒ‡å‘å®ƒçš„çˆ¶å…ƒç±»ï¼Œç›´è‡³NSObjectå…ƒç±»ã€‚NSObjectå…ƒç±»çš„çˆ¶å…ƒç±»æ˜¯NSObjectï¼ŒNSObjectçš„çˆ¶ç±»æ˜¯nilã€‚</li>
</ul>


<p>æ³¨ï¼šä¸Šé¢ä½¿ç”¨ä»£ç æµ‹è¯•è¿‡ï¼Œä¸»è¦ä½¿ç”¨object_getClassã€class_getSuperClasså’Œobjc_getMetaClassæ¥è·å–ç±»ã€çˆ¶ç±»ã€å…ƒç±»ï¼Œç„¶åæ‰“å°æŒ‡é’ˆè¿›è¡ŒæŸ¥çœ‹ã€‚</p>

<h2>äºŒã€ç±»ä¸å¯¹è±¡åŸºç¡€æ•°æ®ç»“æ„</h2>

<p>Objective-Cç±»æ˜¯ç”±Classç±»å‹æ¥è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">typedef</span> <span class="k">struct</span> <span class="n">objc_class</span> <span class="o">*</span><span class="kt">Class</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥çœ‹objc/runtime.hä¸­objc_classç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">struct</span> <span class="n">objc_class</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">Class</span> <span class="n">isa</span>  <span class="n">OBJC_ISA_AVAILABILITY</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#if !__OBJC2__</span>
</span><span class='line'>    <span class="kt">Class</span> <span class="n">super_class</span>                       <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// çˆ¶ç±»</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span>                        <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// ç±»å</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">version</span>                            <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">info</span>                               <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">instance_size</span>                      <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">objc_ivar_list</span> <span class="o">*</span><span class="n">ivars</span>            <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">objc_method_list</span> <span class="o">**</span><span class="n">methodLists</span>   <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// æ–¹æ³•å®šä¹‰çš„é“¾è¡¨</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">objc_cache</span> <span class="o">*</span><span class="n">cache</span>                <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// æ–¹æ³•ç¼“å­˜</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">objc_protocol_list</span> <span class="o">*</span><span class="n">protocols</span>    <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>  <span class="c1">// åè®®é“¾è¡¨</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span> <span class="n">OBJC2_UNAVAILABLE</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ä¸‰ã€è°ƒç”¨æ–¹æ³•æ—¶çš„æµç¨‹</h2>

<p>é¦–å…ˆåˆ°å½“å‰å¯¹è±¡æ‰€å±çš„ç±»ä¸­çš„æ–¹æ³•ç¼“å­˜åˆ—è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ°è¯¥ç±»çš„æ–¹æ³•å®šä¹‰é“¾è¡¨ä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œå¦‚æœæŸ¥æ‰¾åˆ°ï¼Œåˆ™æ‰§è¡Œè¿™ä¸ªæ–¹æ³•å°†è¿”å›å€¼è¿”å›ç»™åŸè°ƒç”¨å¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ–¹æ³•åŠ å…¥ç¼“å­˜cacheå½“ä¸­ï¼›å¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°åˆ™é€šè¿‡super_classæ‰¾åˆ°å®ƒçš„çˆ¶ç±»ï¼Œåˆ°å®ƒçš„çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚</p>

<p>æƒ³äº†è§£æ›´å¤šRuntimeæ–¹æ³•è°ƒç”¨çŸ¥è¯†ï¼Œè¯·çœ‹<a href="http://blog.jobbole.com/79574/">Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸‰ï¼šæ–¹æ³•ä¸æ¶ˆæ¯</a></p>

<h2>å››ã€ç±»ä¸å¯¹è±¡çš„æ“ä½œå‡½æ•°</h2>

<p>runtimeæä¾›äº†å¤§é‡çš„å‡½æ•°æ¥æ“ä½œç±»ä¸å¯¹è±¡ï¼Œæ“ä½œç±»çš„å‡½æ•°ä¸€èˆ¬å‰ç¼€æ˜¯classï¼Œè€Œæ“ä½œå¯¹è±¡çš„å‡½æ•°ä¸€èˆ¬å‰ç¼€æ˜¯objcã€‚</p>

<h4>1ã€ç±»ç›¸å…³æ“ä½œå‡½æ•°</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è·å–ç±»çš„ç±»å</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">class_getName</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span><span class='line'><span class="c1">// è·å–ç±»çš„çˆ¶ç±»</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">class_getSuperclass</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// åˆ¤æ–­ç»™å®šçš„Classæ˜¯å¦æ˜¯ä¸€ä¸ªå…ƒç±»</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="nf">class_isMetaClass</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span><span class='line'><span class="c1">// è·å–å®ä¾‹å¤§å°</span>
</span><span class='line'><span class="kt">size_t</span> <span class="nf">class_getInstanceSize</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2ã€æˆå‘˜å˜é‡ç›¸å…³æ“ä½œå‡½æ•°</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è·å–ç±»ä¸­æŒ‡å®šåç§°å®ä¾‹æˆå‘˜å˜é‡çš„ä¿¡æ¯</span>
</span><span class='line'><span class="n">Ivar</span> <span class="nf">class_getInstanceVariable</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è·å–ç±»æˆå‘˜å˜é‡çš„ä¿¡æ¯</span>
</span><span class='line'><span class="n">Ivar</span> <span class="nf">class_getClassVariable</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// æ·»åŠ æˆå‘˜å˜é‡</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="nf">class_addIvar</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">alignment</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">types</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è·å–æ•´ä¸ªæˆå‘˜å˜é‡åˆ—è¡¨</span>
</span><span class='line'><span class="n">Ivar</span> <span class="o">*</span> <span class="nf">class_copyIvarList</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">outCount</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>éœ€è¦æ³¨æ„ï¼š</p>

<ul>
<li>class_copyIvarListï¼šè·å–çš„æ˜¯æ‰€æœ‰æˆå‘˜å®ä¾‹å±æ€§ï¼Œä¸propertyè·å–ä¸ä¸€æ ·ã€‚</li>
<li>class_addIvar: <strong>OCä¸æ”¯æŒå¾€å·²å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡</strong>ï¼Œå› æ­¤ä¸ç®¡æ˜¯ç³»ç»Ÿåº“æä¾›çš„ç±»ï¼Œè¿˜æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œéƒ½æ— æ³•åŠ¨æ€ç»™å®ƒæ·»åŠ æˆå‘˜å˜é‡ã€‚<strong>ä½†ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬é€šè¿‡è¿è¡Œæ—¶æ¥åˆ›å»ºçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨class_addIvaræ¥æ·»åŠ ã€‚ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨objc_allocateClassPairå‡½æ•°ä¸objc_registerClassPairä¹‹é—´è°ƒç”¨ã€‚</strong>å¦å¤–ï¼Œ<strong>è¿™ä¸ªç±»ä¹Ÿä¸èƒ½æ˜¯å…ƒç±»</strong>ã€‚</li>
</ul>


<p>ä»£ç æµ‹è¯•ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *  æµ‹è¯•æˆå‘˜å˜é‡</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testIvar</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">outCount</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">class_addIvar</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="s">&quot;_hell&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">id</span><span class="p">),</span> <span class="n">log2</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">id</span><span class="p">)),</span> <span class="s">&quot;@&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Add Ivar Success!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Add Ivar failed!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">Ivar</span> <span class="o">*</span><span class="n">ivarList</span> <span class="o">=</span> <span class="n">class_copyIvarList</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">outCount</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">outCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Ivar</span> <span class="n">ivar</span> <span class="o">=</span> <span class="n">ivarList</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ivarName</span> <span class="o">=</span> <span class="n">ivar_getName</span><span class="p">(</span><span class="n">ivar</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">ptrdiff_t</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">ivar_getOffset</span><span class="p">(</span><span class="n">ivar</span><span class="p">);</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">types</span> <span class="o">=</span> <span class="n">ivar_getTypeEncoding</span><span class="p">(</span><span class="n">ivar</span><span class="p">);</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;ivar:%s, offset:%zd, type:%s&quot;</span><span class="p">,</span> <span class="n">ivarName</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">types</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">free</span><span class="p">(</span><span class="n">ivarList</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼šclass_addIvarä¸­ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ç±»å‹çš„å¤§å°ï¼Œç¬¬å››ä¸ªå‚æ•°è®¾ç½®å¯¹é½ï¼Œå¯¹é½ä¼ é€’log2(size)ï¼Œå…·ä½“åŸå› å‚è€ƒï¼š<a href="http://stackoverflow.com/questions/33184826/what-does-class-addivars-alignment-do-in-objective-c">http://stackoverflow.com/questions/33184826/what-does-class-addivars-alignment-do-in-objective-c</a></p>

<h4>3ã€å±æ€§æ“ä½œå‡½æ•°</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è·å–æŒ‡å®šçš„å±æ€§</span>
</span><span class='line'><span class="kt">objc_property_t</span> <span class="nf">class_getProperty</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è·å–å±æ€§åˆ—è¡¨</span>
</span><span class='line'><span class="kt">objc_property_t</span> <span class="o">*</span> <span class="nf">class_copyPropertyList</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">outCount</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ä¸ºç±»æ·»åŠ å±æ€§</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="nf">class_addProperty</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">objc_property_attribute_t</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attributeCount</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// æ›¿æ¢ç±»çš„å±æ€§</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">class_replaceProperty</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">objc_property_attribute_t</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attributeCount</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸€ç§æ–¹æ³•ä¹Ÿæ˜¯é’ˆå¯¹ivaræ¥æ“ä½œçš„ï¼Œä¸è¿‡å®ƒåªæ“ä½œé‚£äº›propertyçš„å€¼ï¼ŒåŒ…æ‹¬æ‰©å±•ä¸­çš„propertyã€‚</p>

<p>ä»£ç å®è·µï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testProperty</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  æ·»åŠ property</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">objc_property_attribute_t</span> <span class="n">attribute1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;@</span><span class="se">\&quot;</span><span class="s">NSString</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">};</span>
</span><span class='line'>    <span class="kt">objc_property_attribute_t</span> <span class="n">attribute2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">};</span>
</span><span class='line'>    <span class="kt">objc_property_attribute_t</span> <span class="n">attribute3</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">};</span>
</span><span class='line'>    <span class="kt">objc_property_attribute_t</span> <span class="n">attribute4</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="s">&quot;_lcg&quot;</span><span class="p">};</span>
</span><span class='line'>    <span class="kt">objc_property_attribute_t</span> <span class="n">attributesList</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">attribute1</span><span class="p">,</span> <span class="n">attribute2</span><span class="p">,</span> <span class="n">attribute3</span><span class="p">,</span> <span class="n">attribute4</span><span class="p">};</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">class_addProperty</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="s">&quot;lcg&quot;</span><span class="p">,</span> <span class="n">attributesList</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;add property success!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;add property failure!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  æ‰“å°propertyçš„nameå’Œproperty_attribute_t</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">outCount</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">objc_property_t</span> <span class="o">*</span><span class="n">propertyList</span> <span class="o">=</span> <span class="n">class_copyPropertyList</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">outCount</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">outCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kt">objc_property_t</span> <span class="n">property</span> <span class="o">=</span> <span class="n">propertyList</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">propertyName</span> <span class="o">=</span> <span class="n">property_getName</span><span class="p">(</span><span class="n">property</span><span class="p">);</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">property_getAttributes</span><span class="p">(</span><span class="n">property</span><span class="p">);</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;propertyName: %s, attribute: %s&quot;</span><span class="p">,</span> <span class="n">propertyName</span><span class="p">,</span> <span class="n">attribute</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attributeCount</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">objc_property_attribute_t</span> <span class="o">*</span><span class="n">attributeList</span> <span class="o">=</span> <span class="n">property_copyAttributeList</span><span class="p">(</span><span class="n">property</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attributeCount</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">attributeCount</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kt">objc_property_attribute_t</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">attributeList</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;attribute name: %s, value: %s&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢ä»£ç æœ‰å‡ ä¸ªçŸ¥è¯†ç‚¹éœ€è¦è¯´ä¸€ä¸‹ï¼š</p>

<p>(1) å…¶ä¸­property_attributeçš„ç›¸å…³å†…å®¹éœ€è¦è¯´æ˜ä¸‹ã€‚</p>

<p>   property_attributeä¸º<strong>T@&ldquo;NSString&rdquo;,&amp;,N,V_exprice</strong>æ—¶ï¼š</p>

<ul>
<li><strong>T</strong> æ˜¯å›ºå®šçš„ï¼Œæ”¾åœ¨ç¬¬ä¸€ä¸ª</li>
<li><strong>@&ldquo;NSString&rdquo;</strong> ä»£è¡¨è¿™ä¸ªpropertyæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</li>
<li><strong>&amp;</strong> ä»£è¡¨å¼ºå¼•ç”¨ï¼Œå…¶ä¸­ä¸ä¹‹å¹¶åˆ—çš„æ˜¯ï¼š'C'ä»£è¡¨Copyï¼Œ'&amp;&lsquo;ä»£è¡¨å¼ºå¼•ç”¨ï¼Œ'W'è¡¨ç¤ºweakï¼Œassignä¸ºç©ºï¼Œé»˜è®¤ä¸ºassignã€‚</li>
<li><strong>N</strong> åŒºåˆ†çš„nonatomicå’Œatomicï¼Œé»˜è®¤ä¸ºatomicï¼Œatomicä¸ºç©ºï¼Œ'N'ä»£è¡¨æ˜¯nonatomic</li>
<li><strong>V_exprice</strong> Vä»£è¡¨å˜é‡ï¼Œåé¢ç´§è·Ÿç€çš„æ˜¯æˆå‘˜å˜é‡åï¼Œä»£è¡¨è¿™ä¸ªpropertyçš„æˆå‘˜å˜é‡åä¸º_expriceã€‚</li>
</ul>


<p> property_attributeä¸º<strong>T@&ldquo;NSNumber&rdquo;,R,N,V_yearsOld</strong>æ—¶ï¼š</p>

<ul>
<li><strong>T</strong> æ˜¯å›ºå®šçš„ï¼Œæ”¾åœ¨ç¬¬ä¸€ä¸ª</li>
<li><strong>@&ldquo;NSNumber&rdquo;</strong> ä»£è¡¨è¿™ä¸ªpropertyæ˜¯ä¸€ä¸ªNSNumberå¯¹è±¡</li>
<li><strong>R</strong> ä»£è¡¨readOnlyå±æ€§ï¼Œreadwriteæ—¶ä¸ºç©º</li>
<li><strong>N</strong> åŒºåˆ†çš„nonatomicå’Œatomicï¼Œé»˜è®¤ä¸ºatomicï¼Œatomicä¸ºç©ºï¼Œ'N'ä»£è¡¨æ˜¯nonatomic</li>
<li><strong>V_yearsOld</strong> Vä»£è¡¨å˜é‡ï¼Œåé¢ç´§è·Ÿç€çš„æ˜¯æˆå‘˜å˜é‡åï¼Œä»£è¡¨è¿™ä¸ªpropertyçš„æˆå‘˜å˜é‡åä¸º_yearsOldã€‚</li>
</ul>


<p>ä½¿ç”¨ä¾‹å­å‚è€ƒï¼š<a href="http://www.tuicool.com/articles/aY3Ujii">http://www.tuicool.com/articles/aY3Ujii</a>  <br/>
å®˜æ–¹å‚è€ƒï¼š<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html#//apple_ref/doc/uid/TP40008048-CH101-SW6">Property Type</a></p>

<p>ï¼ˆ2ï¼‰ æ·»åŠ propertyï¼Œproperty_attribute_tæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ²¡æœ‰å…·ä½“åˆ›å»ºçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±åªèƒ½ä½¿ç”¨{}è¿™æ ·ç»“æ„ä½“ç›´æ¥èµ‹å€¼è¿‡å»ã€‚è€Œä¸”ï¼Œæ·»åŠ propertyæˆåŠŸä¹‹åï¼Œå®ƒå¹¶ä¸ä¼šç”Ÿæˆ<strong>å®ä¾‹å±æ€§ã€setteræ–¹æ³•å’Œgetteræ–¹æ³•</strong>ã€‚å¦‚æœè¦çœŸæ­£è°ƒç”¨çš„è¯ï¼Œè¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±æ·»åŠ å¯¹åº”çš„setterå’Œgetteræ–¹æ³•ã€‚  <br/>
è¯¦æƒ…ä½¿ç”¨è¯·è§ï¼š<a href="http://blog.csdn.net/meegomeego/article/details/18356169">http://blog.csdn.net/meegomeego/article/details/18356169</a></p>

<h4>4ã€åè®®ç›¸å…³å‡½æ•°</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// æ·»åŠ åè®®</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="nf">class_addProtocol</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="n">Protocol</span> <span class="o">*</span><span class="n">protocol</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›ç±»æ˜¯å¦å®ç°æŒ‡å®šçš„åè®®</span>
</span><span class='line'><span class="kt">BOOL</span> <span class="nf">class_conformsToProtocol</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="n">Protocol</span> <span class="o">*</span><span class="n">protocol</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›ç±»å®ç°çš„åè®®åˆ—è¡¨</span>
</span><span class='line'><span class="n">Protocol</span> <span class="o">*</span> <span class="nf">class_copyProtocolList</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">outCount</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»£ç å®è·µï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testProtocolList</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//æ·»åŠ åè®®</span>
</span><span class='line'>    <span class="n">Protocol</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">@</span><span class="n">protocol</span><span class="p">(</span><span class="n">StudentDataSource</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">class_addProtocol</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="n">p</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;æ·»åŠ åè®®æˆåŠŸ!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;æ·»åŠ åè®®å¤±è´¥!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//åˆ¤æ–­æ˜¯å¦å®ç°äº†æŒ‡å®šçš„åè®®</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">class_conformsToProtocol</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="n">p</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;éµå¾ª %såè®®&quot;</span><span class="p">,</span> <span class="n">protocol_getName</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;ä¸éµå¾ª %såè®®&quot;</span><span class="p">,</span> <span class="n">protocol_getName</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//è·å–ç±»çš„åè®®åˆ—è¡¨</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">outCount</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Protocol</span> <span class="o">*</span> <span class="n">__unsafe_unretained</span> <span class="o">*</span><span class="n">protocolList</span> <span class="o">=</span> <span class="n">class_copyProtocolList</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">outCount</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">outCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Protocol</span> <span class="o">*</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">protocolList</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">protocol_getName</span><span class="p">(</span><span class="n">protocol</span><span class="p">);</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%s&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">free</span><span class="p">(</span><span class="n">protocolList</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>æ³¨æ„ï¼šå¯ä»¥ä½¿ç”¨runtimeæ·»åŠ åè®®</strong></p>

<h4>6ã€ç‰ˆæœ¬å·ï¼ˆVersion)</h4>

<p>ç‰ˆæœ¬çš„ä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œè·å–ç‰ˆæœ¬å’Œè®¾ç½®ç‰ˆæœ¬ï¼Œè¯·çœ‹ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testVersion</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">version</span> <span class="o">=</span> <span class="n">class_getVersion</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">]);</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">);</span>
</span><span class='line'>    <span class="n">class_setVersion</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">],</span> <span class="mi">100</span><span class="p">);</span>
</span><span class='line'>    <span class="n">version</span> <span class="o">=</span> <span class="n">class_getVersion</span><span class="p">([</span><span class="n">Student</span> <span class="k">class</span><span class="p">]);</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>äº”ã€åŠ¨æ€åˆ›å»ºç±»å’Œå¯¹è±¡</h2>

<h4>1ã€åŠ¨æ€åˆ›å»ºç±»</h4>

<p>æ¶‰åŠä»¥ä¸‹å‡½æ•°</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// åˆ›å»ºä¸€ä¸ªæ–°ç±»å’Œå…ƒç±»</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">objc_allocateClassPair</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">superclass</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">extraBytes</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é”€æ¯ä¸€ä¸ªç±»åŠå…¶ç›¸å…³è”çš„ç±»</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">objc_disposeClassPair</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// åœ¨åº”ç”¨ä¸­æ³¨å†Œç”±objc_allocateClassPairåˆ›å»ºçš„ç±»</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">objc_registerClassPair</span> <span class="p">(</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼šobjc_disposeClassPairåªèƒ½é”€æ¯ç”±objc_allocateClassPairåˆ›å»ºçš„ç±»ï¼Œå½“æœ‰å®ä¾‹å­˜åœ¨æˆ–è€…å®ƒçš„å­ç±»å­˜åœ¨æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>

<p>ä»£ç å®è·µï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testCreateClass</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">objc_allocateClassPair</span><span class="p">([</span><span class="n">Person</span> <span class="k">class</span><span class="p">],</span> <span class="s">&quot;Teacher&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//æ·»åŠ æˆå‘˜å˜é‡ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»æ·»åŠ ï¼Œå¹¶ä¸”æ˜¯åœ¨objc_allocateClassPairä¸objc_registerClassPairä¹‹é—´</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">class_addIvar</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&quot;_level&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">id</span><span class="p">),</span> <span class="n">log2</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">id</span><span class="p">)),</span> <span class="s">&quot;@</span><span class="se">\&quot;</span><span class="s">NSString</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;æ·»åŠ _levelæˆå‘˜å˜é‡æˆåŠŸ&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;æ·»åŠ _levelæˆå‘˜å˜é‡å¤±è´¥&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">objc_registerClassPair</span><span class="p">(</span><span class="n">cls</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  å½“æœ‰å®ä¾‹å­˜åœ¨ä¸èƒ½é”€æ¯ç±»ï¼Œæ‰€ä»¥è®²ä»£ç æ”¾åˆ°é‡Œé¢</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">//åˆ›å»ºå¯¹è±¡</span>
</span><span class='line'>        <span class="n">Person</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cls</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">class</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">p</span> <span class="n">printInfo</span><span class="p">];</span>
</span><span class='line'>        <span class="c1">//è®¾ç½®å€¼</span>
</span><span class='line'>        <span class="p">[</span><span class="n">p</span> <span class="nl">setValue</span><span class="p">:</span><span class="s">@&quot;é«˜çº§è®²å¸ˆ&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;level&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSString</span> <span class="o">*</span><span class="n">level</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;level&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;level: %@&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//é”€æ¯ç±»ï¼Œå½“æœ‰å®ä¾‹å­˜åœ¨çš„æ—¶å€™æ˜¯ä¸èƒ½é”€æ¯ç±»</span>
</span><span class='line'>    <span class="n">objc_disposeClassPair</span><span class="p">(</span><span class="n">cls</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å…­ã€å®ä¾‹æ“ä½œå‡½æ•°</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è¿”å›æŒ‡å®šå¯¹è±¡çš„ä¸€ä»½æ‹·è´</span>
</span><span class='line'><span class="kt">id</span> <span class="nf">object_copy</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é‡Šæ”¾æŒ‡å®šå¯¹è±¡å ç”¨çš„å†…å­˜</span>
</span><span class='line'><span class="kt">id</span> <span class="nf">object_dispose</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span> <span class="p">);</span>
</span><span class='line'><span class="c1">// ä¿®æ”¹ç±»å®ä¾‹çš„å®ä¾‹å˜é‡çš„å€¼</span>
</span><span class='line'><span class="n">Ivar</span> <span class="nf">object_setInstanceVariable</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è·å–å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼</span>
</span><span class='line'><span class="n">Ivar</span> <span class="nf">object_getInstanceVariable</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">outValue</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›æŒ‡å‘ç»™å®šå¯¹è±¡åˆ†é…çš„ä»»ä½•é¢å¤–å­—èŠ‚çš„æŒ‡é’ˆ</span>
</span><span class='line'><span class="kt">void</span> <span class="o">*</span> <span class="nf">object_getIndexedIvars</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›å¯¹è±¡ä¸­å®ä¾‹å˜é‡çš„å€¼</span>
</span><span class='line'><span class="kt">id</span> <span class="nf">object_getIvar</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="n">Ivar</span> <span class="n">ivar</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è®¾ç½®å¯¹è±¡ä¸­å®ä¾‹å˜é‡çš„å€¼</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">object_setIvar</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="n">Ivar</span> <span class="n">ivar</span><span class="p">,</span> <span class="kt">id</span> <span class="n">value</span> <span class="p">);</span>
</span><span class='line'><span class="c1">// è¿”å›ç»™å®šå¯¹è±¡çš„ç±»å</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">object_getClassName</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›å¯¹è±¡çš„ç±»</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">object_getClass</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è®¾ç½®å¯¹è±¡çš„ç±»</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">object_setClass</span> <span class="p">(</span> <span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">Class</span> <span class="n">cls</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®è·µä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testInstance</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Person</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span> <span class="n">new</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//object_copyåœ¨ARCä¸‹ä¸èƒ½ä½¿ç”¨</span>
</span><span class='line'><span class="c1">//    p = object_copy(p, class_getInstanceSize([Student class]));</span>
</span><span class='line'>    <span class="c1">//å°†pçš„isaæŒ‡å‘Student</span>
</span><span class='line'>    <span class="n">object_setClass</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[</span><span class="n">Student</span> <span class="k">class</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">[(</span><span class="n">Student</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="nl">setName</span><span class="p">:</span><span class="s">@&quot;Jack&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œåªæ˜¯ç®€å•çš„å°†pè¿™ä¸ªå¯¹è±¡çš„classè®¾ç½®ä¸ºStudentç±»ï¼Œå…¶å®å°±æ˜¯å°†på¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘Studentç±»ï¼ŒKVOä¸­çš„isa-swizzlingå…¶å®å°±æ˜¯è¿™æ ·å¹²çš„ã€‚å½“è°ƒç”¨setName:çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå°±è°ƒç”¨åˆ°äº†Studentç±»ä¸­çš„setNameã€‚ä¸è¿‡ï¼Œè¿™é‡Œè°ƒç”¨Personç±»æ²¡æœ‰ï¼Œè€ŒStudentç±»æœ‰çš„æ–¹æ³•ä¼šå´©æºƒï¼ŒæŠ¥é”™Heap buffer overflowï¼Œå°±ç®—æ˜¯åœ¨éARCä¸‹ä½¿ç”¨object_copyä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>

<h2>ä¸ƒã€è·å–ç±»çš„å®šä¹‰</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è·å–å·²æ³¨å†Œçš„ç±»å®šä¹‰çš„åˆ—è¡¨</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">objc_getClassList</span> <span class="p">(</span> <span class="kt">Class</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bufferCount</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰€æœ‰å·²æ³¨å†Œç±»çš„æŒ‡é’ˆåˆ—è¡¨</span>
</span><span class='line'><span class="kt">Class</span> <span class="o">*</span> <span class="nf">objc_copyClassList</span> <span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">outCount</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›æŒ‡å®šç±»çš„ç±»å®šä¹‰</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">objc_lookUpClass</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">objc_getClass</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">objc_getRequiredClass</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿”å›æŒ‡å®šç±»çš„å…ƒç±»</span>
</span><span class='line'><span class="kt">Class</span> <span class="nf">objc_getMetaClass</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>objc_getClassListå’Œobjc_copyClassListéƒ½æ˜¯è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç±»ï¼›è€Œobjc_lookUpClassè·å–æŒ‡å®šçš„ç±»ï¼Œå¦‚æœæ²¡æœ‰æ³¨å†Œåˆ™è¿”å›nilï¼›objc_getRequiredClassä¹Ÿæ˜¯è·å–æŒ‡å®šçš„ç±»ï¼Œä¸è¿‡å¦‚æœè¿™ä¸ªç±»ä¸å­˜åˆ™ï¼Œåˆ™ä¼šå´©æºƒï¼›objc_getMetaClassä¸“é—¨ç”¨æ¥è·å–ç±»çš„å…ƒç±»ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆå¹¶ä¸”å”¯ä¸€çš„å…ƒç±»ï¼Œå¦‚æœè¿™ä¸ªç±»æ²¡æœ‰æ³¨å†Œåˆ™è¿”å›nilã€‚</p>

<p>ä»£ç å®è·µï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testGetClass</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  ç¬¬ä¸€ç§è·å–æ‰€æœ‰æ³¨å†Œçš„ç±»</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">Class</span> <span class="o">*</span><span class="n">bufferClass</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">numClasses</span><span class="p">;</span>
</span><span class='line'>    <span class="n">numClasses</span> <span class="o">=</span> <span class="n">objc_getClassList</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">numClasses</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">bufferClass</span> <span class="o">=</span> <span class="p">(</span><span class="kt">Class</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">Class</span><span class="p">)</span><span class="o">*</span><span class="n">numClasses</span><span class="p">);</span>
</span><span class='line'>        <span class="n">numClasses</span> <span class="o">=</span> <span class="n">objc_getClassList</span><span class="p">(</span><span class="n">bufferClass</span><span class="p">,</span> <span class="n">numClasses</span><span class="p">);</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;numer of classes: %d&quot;</span><span class="p">,</span> <span class="n">numClasses</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numClasses</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kt">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">bufferClass</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;class name: %s&quot;</span><span class="p">,</span> <span class="n">class_getName</span><span class="p">(</span><span class="n">cls</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">bufferClass</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  ç¬¬äºŒç§è·å–æ‰€æœ‰æ³¨å†Œçš„ç±»</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">outCount</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">Class</span> <span class="o">*</span><span class="n">classLiset</span> <span class="o">=</span> <span class="n">objc_copyClassList</span><span class="p">(</span><span class="o">&amp;</span><span class="n">outCount</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">outCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kt">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">classLiset</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;class name: %s&quot;</span><span class="p">,</span> <span class="n">class_getName</span><span class="p">(</span><span class="n">cls</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">free</span><span class="p">(</span><span class="n">classLiset</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¬¬äºŒç§è·å–æ‰€æœ‰æ³¨å†Œçš„ç±»æ¯”ç¬¬ä¸€ç§ç®€å•å¤šäº†ï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§ã€‚</p>

<h2>å‚è€ƒ</h2>

<p><a href="http://blog.jobbole.com/79566/">Objective-C Runtime è¿è¡Œæ—¶ä¹‹ä¸€ï¼šç±»ä¸å¯¹è±¡</a></p>

<p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100">Type Encodings</a></p>

<p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html#//apple_ref/doc/uid/TP40008048-CH101-SW6">Property Type</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BGSessionä¸€ä¸ªåŸºäºNSUserDefaultså®ç°çš„è½»é‡çº§æœ¬åœ°æ•°æ®å­˜å‚¨]]></title>
    <link href="http://www.liuchungui.com/blog/2016/03/04/bgsession/"/>
    <updated>2016-03-04T16:35:38+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/03/04/bgsession</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/liuchungui/BGSession">BGSession</a>æ˜¯ä¸€ä¸ªåŸºäºNSUserDefaultså®ç°çš„è½»é‡çº§æ•°æ®å­˜å‚¨ï¼Œä½ åªéœ€è¦ç®€å•çš„ç»§æ‰¿å®ƒï¼Œç»™å®ƒæ·»åŠ å±æ€§ï¼Œè®¾ç½®å±æ€§çš„å€¼ï¼Œå°±èƒ½é€šè¿‡NSUserDefaultsåŒæ­¥åˆ°æœ¬åœ°ã€‚</p>

<!-- more -->


<h2>BGSessionçš„ç”±æ¥</h2>

<p>åœ¨æ˜¨å¤©ä»¥å‰ï¼Œå¯¹äºä¸€äº›è½»é‡çº§æ•°æ®ï¼Œæˆ‘ä¸€å…±ä½¿ç”¨è¿‡ä¸‰ç§æ–¹æ¡ˆã€‚</p>

<p>ç¬¬ä¸€ç§ï¼Œç›´æ¥ä½¿ç”¨NSUserDefaultsè¿›è¡Œè¯»å–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//å†™å…¥</span>
</span><span class='line'><span class="p">[[</span><span class="bp">NSUserDefaults</span> <span class="n">standardUserDefaults</span><span class="p">]</span> <span class="nl">setValue</span><span class="p">:</span><span class="s">@&quot;Jack&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;UserDefaults_userName&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[[</span><span class="bp">NSUserDefaults</span> <span class="n">standardUserDefaults</span><span class="p">]</span> <span class="n">synchronize</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è¯»å–</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">userName</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSUserDefaults</span> <span class="n">standardUserDefaults</span><span class="p">]</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;UserDefaults_userName&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¬¬äºŒç§ï¼Œæ•°æ®å½’æ¡£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//ä½¿ç”¨å½’æ¡£å†™å…¥</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">userName</span> <span class="o">=</span> <span class="s">@&quot;Jack&quot;</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">)</span> <span class="n">lastObject</span><span class="p">]</span> <span class="nl">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@&quot;UserNameFile&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="bp">NSKeyedArchiver</span> <span class="nl">archiveRootObject</span><span class="p">:</span><span class="n">userName</span> <span class="nl">toFile</span><span class="p">:</span><span class="n">filePath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//ä½¿ç”¨è§£å½’æ¡£è¯»å–</span>
</span><span class='line'><span class="n">userName</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSKeyedUnarchiver</span> <span class="nl">unarchiveObjectWithFile</span><span class="p">:</span><span class="n">filePath</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¬¬ä¸‰ç§ï¼Œå»ºç«‹ä¸€ä¸ªå…¨å±€çš„å•ä¾‹ï¼Œç„¶åç»™å®šç›¸åº”çš„å±æ€§å€¼ï¼Œå­˜å‚¨æ—¶çš„ä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//å†™å…¥</span>
</span><span class='line'><span class="p">[</span><span class="n">BGGlobal</span> <span class="n">sharedGlobal</span><span class="p">].</span><span class="n">userName</span> <span class="o">=</span> <span class="s">@&quot;Jack&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">//å†™å…¥æ–‡ä»¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯å°†æ•´ä¸ªå¯¹è±¡å½’æ¡£åˆ°ä¸€ä¸ªæ–‡ä»¶å½“ä¸­</span>
</span><span class='line'><span class="p">[</span><span class="n">BGGlobal</span> <span class="n">writeToFile</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è¯»å–</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">userName</span> <span class="o">=</span> <span class="p">[</span><span class="n">BGGlobal</span> <span class="n">sharedGlobal</span><span class="p">].</span><span class="n">userName</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p> æ¯”è¾ƒä¸Šé¢ä¸‰ç§æ–¹æ¡ˆï¼š  <br/>
 ç¬¬ä¸€ç§æˆ‘ä½¿ç”¨è¿‡ä¹‹åå°±å†ä¹Ÿä¸æ€ä¹ˆç”¨äº†ï¼Œæœ‰æ®µæ—¶é—´å‡ ä¹é—å¿˜äº†å®ƒï¼Œå› ä¸ºä½¿ç”¨å®ƒçœŸçš„å¾ˆéº»çƒ¦ï¼Œæ‰“å‡º<code>[NSUserDefaults standardUserDefaults]</code>å·²ç»æ„Ÿè§‰å¾ˆé•¿äº†ï¼Œåé¢è¿˜éœ€è¦è¾“å…¥ä¸€ä¸ªè‡ªå·±å®šä¹‰çš„keyå€¼ï¼Œè™½ç„¶å¯ä»¥å…¨å±€å®šä¹‰å¸¸é‡ï¼Œä½†æ˜¯å½“å¸¸é‡å¤Ÿå¤šçš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½ä¸€æ—¶æ‰¾åˆ°ï¼Œè€Œä¸”è®¾ç½®å€¼ä¹‹åï¼Œå¦‚æœè¦å†™å…¥ç£ç›˜ï¼Œè¿˜éœ€è¦ä½¿ç”¨<code>[[NSUserDefaults standardUserDefaults] synchronize]</code>åŒæ­¥åˆ°æœ¬åœ°ï¼›è¯»å–æ—¶å’Œå†™å…¥ç±»ä¼¼ï¼Œéœ€è¦ä¸€ä¸ªkeyå€¼ã€‚</p>

<p> ç¬¬äºŒç§ï¼Œæ•°æ®å½’æ¡£å’Œç¬¬ä¸€ç§ä¸€æ ·ï¼Œå­˜å–æ—¶æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”å› ä¸ºå½’æ¡£çš„æ—¶å€™éœ€è¦ä¸åœçš„è¯»å–æ–‡ä»¶ï¼Œæ€§èƒ½ä¹Ÿä¸å¥½ã€‚</p>

<p> ç¬¬ä¸‰ç§ï¼Œåœ¨å…¨å±€å•ä¾‹å®ç°<code>NSCoding</code>åè®®ï¼Œåªéœ€è¦æ·»åŠ å±æ€§å€¼ï¼Œå°±å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•ç›´æ¥å­˜å–ï¼Œå­˜å–éå¸¸çš„æ–¹ä¾¿ã€‚å­˜å‚¨æœ¬åœ°æ—¶ï¼Œå’Œ<code>[[NSUserDefaults standardUserDefaults] synchronize]</code>ç±»ä¼¼ï¼Œä½¿ç”¨<code>[BGGlobal writeToFile]</code>å…¨å±€å½’æ¡£å†™å…¥æ–‡ä»¶ã€‚</p>

<p> æ¯”è¾ƒè¿™ä¸‰ç§æ–¹æ¡ˆï¼Œæˆ‘é€‰æ‹©äº†ç¬¬ä¸‰ç§ã€‚ç¬¬äºŒç§ï¼Œç›´æ¥èˆå¼ƒï¼›ç¬¬ä¸€ç§è™½ç„¶åœ¨æ€§èƒ½æ¯”ç¬¬äºŒç§æ›´ä¼˜ï¼Œä½†æ˜¯ä½¿ç”¨ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå†µä¸”æˆ‘ä»¬è¿™æ˜¯å­˜å‚¨è½»é‡çº§æ•°æ®ï¼Œæ€§èƒ½å·®å¼‚æ ¹æœ¬çœ‹ä¸å‡ºæ¥ä»€ä¹ˆã€‚</p>

<p> ä½†ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯<code>[BGGlobal writeToFile]</code>ä¼šå¿˜è®°å†™ï¼Œä»è€Œé€ æˆäº†bugã€‚è€Œä¸”ï¼Œåœ¨æ•´ä¸ªå·¥ç¨‹é¡¹ç›®ä¸­<code>[BGGlobal writeToFile]</code>å‡ºç°çš„æ¬¡æ•°ç‰¹åˆ«çš„å¤šï¼Œè¿™ä¸€æ­¥æ˜¯å¦å¯ä»¥ä¼˜åŒ–æ‰ï¼Ÿ</p>

<p> åæ¥ï¼Œä¸€è‡´å•†è®®ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­å°†å…¨å±€å•ä¾‹çš„globalä¸­å½’æ¡£å†™å…¥æ–‡ä»¶çš„æ–¹å¼æ›¿æ¢æˆNSUserDefaultsçš„å­˜å‚¨æ–¹å¼ï¼Œç„¶ååœ¨å†…éƒ¨å®ç°äº†åŒæ­¥æœ¬åœ°çš„æ“ä½œã€‚è¿™æ ·åªè¦æˆ‘ä»¬åœ¨å¤–é¢ä½¿ç”¨è®¾ç½®æ–°çš„å€¼æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°ï¼Œè€Œä¸”æ€§èƒ½æ–¹é¢æ›´ä½³ã€‚</p>

<p> ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘å‘ç°å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œ##æ¯æ·»åŠ ä¸€ä¸ªå­—æ®µéƒ½éœ€è¦åšå¦‚ä¸‹ä¸¤æ­¥##ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="c1">//1ã€å®šä¹‰ä¸€ä¸ªå¸¸é‡æ¥ä½œä¸ºNSUserDefaultsçš„key</span>
</span><span class='line'> <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">kSessionUserName</span> <span class="o">=</span> <span class="s">@&quot;kSessionUserName&quot;</span><span class="p">;</span>
</span><span class='line'> <span class="c1">//2ã€åœ¨å…¨å±€å•ä¾‹å†…éƒ¨å®ç°getterå’Œsetteræ–¹æ³•</span>
</span><span class='line'> <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setUserName</span><span class="p">:(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">userName</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="nl">setValue</span><span class="p">:</span><span class="n">userName</span> <span class="nl">forKey</span><span class="p">:</span><span class="n">kSessionUserName</span><span class="p">];</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="o">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">userName</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">getValueForKey</span><span class="p">:</span><span class="n">kSessionUserName</span><span class="p">];</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> è¿™äº›æ­¥éª¤æˆ‘ä»¬æ˜¯å¦å¯ä»¥å®Œå…¨çœç•¥å‘¢ï¼Ÿ</p>

<p> åœ¨ä¸€æ¬¡æˆ‘è‡ªå·±åšé¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä½¿ç”¨å…¨å±€å•ä¾‹èˆå¼ƒNSUserDefaultsè¿›è¡Œå­˜å‚¨ï¼Œä»ç„¶ä½¿ç”¨çš„æ˜¯å½’æ¡£çš„å½¢å¼ï¼Œè€Œä¸”é‚£ä¸ªå…¨å±€å•ä¾‹ç»§æ‰¿çš„æ˜¯<a href="https://github.com/elado/jastor">jastor</a>ï¼Œå®ƒå†…éƒ¨è‡ªå·±å®ç°äº†å½’æ¡£åè®®ï¼Œæˆ‘åªéœ€è¦æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œå¤šæ·»åŠ <code>[BGGlobal writeToFile]</code>åŒæ­¥åˆ°æœ¬åœ°å°±è¡Œäº†ï¼Œæ¯”å‰é¢ä½¿ç”¨NSUserDefaultsæ–¹ä¾¿å¾ˆå¤šã€‚</p>

<p> ä½†æ˜¯ï¼Œæˆ‘ä¸€ç›´éƒ½è®¤ä¸ºæœ‰æ›´å¥½çš„å®ç°æ–¹æ¡ˆï¼Œç»ˆäºåœ¨çœ‹runtimeå’ŒKVOä¸œè¥¿çš„æ—¶å€™æƒ³åˆ°äº†ä¸€ç§æ–¹æ¡ˆã€‚äºæ˜¯ï¼Œç«‹é©¬å›å®¶å†™äº†ä¸€ä¸ªå®ç°äº†<a href="https://github.com/liuchungui/BGSession">BGSession</a>ã€‚</p>

<h2>BGSessionå®ç°åŸç†</h2>

<p> BGSessionæ˜¯ä¸€ä¸ªå…¨å±€å•ä¾‹ï¼Œä¸»è¦é‡‡ç”¨çš„æ˜¯KVC/KVOå’ŒRuntimeè¿›è¡Œå®ç°çš„ã€‚ä½¿ç”¨BGSessionä½œä¸ºè½»é‡çº§æ•°æ®å­˜å‚¨æ—¶ï¼Œåªéœ€è¦ç»§æ‰¿BGSessionï¼Œç„¶ååœ¨BGSessionçš„æ´¾ç”Ÿç±»æ·»åŠ ç›¸å…³çš„å±æ€§ã€‚å½“ç»™è¿™äº›å±æ€§è®¾ç½®æ–°çš„å€¼åï¼ŒBGSessionä¼šç›‘å¬åˆ°å±æ€§å€¼çš„å˜åŒ–ï¼Œç„¶åä½¿ç”¨KVCè‡ªåŠ¨å°†å®ƒåŒæ­¥åˆ°NSUserDefaultsã€‚è¿™æ ·ï¼Œå­˜å–æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å½“åšä½¿ç”¨å•ä¾‹ä¸€æ ·ä½¿ç”¨ï¼Œç®€å•æ–¹ä¾¿ã€‚</p>

<h2>Githubåœ°å€</h2>

<p><a href="https://github.com/liuchungui/BGSession">https://github.com/liuchungui/BGSession</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015å¹´æ€»ç»“]]></title>
    <link href="http://www.liuchungui.com/blog/2016/01/01/2015nian-zong-jie/"/>
    <updated>2016-01-01T01:22:29+08:00</updated>
    <id>http://www.liuchungui.com/blog/2016/01/01/2015nian-zong-jie</id>
    <content type="html"><![CDATA[<p>ç°åœ¨å·²ç»2016å¹´1ç‚¹äº†ï¼Œå»å¹´è¿™ä¸ªæ—¶å€™çœ‹åˆ°åˆ«äººéƒ½çº·çº·å†™ç€ä¸€å¹´çš„æ€»ç»“ï¼Œé‚£ä¸ªæ—¶å€™é¡¿ç”Ÿå´‡æ‹œã€‚ä»Šå¹´ï¼Œæˆ‘ä¹Ÿæ¥ä¸ªç®€çŸ­çš„æ€»ç»“å§ï¼</p>

<!-- more -->


<p>2015è¿™ä¸€å¹´ï¼Œæ¢äº†ä¸€å®¶å…¬å¸ï¼Œè€Œå°±æ˜¯ä»è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘æ„Ÿè§‰æˆ‘æ•´ä¸ªå†™ä»£ç çš„æ€æƒ³å‘ç”Ÿäº†ä¸å°çš„å˜åŒ–ï¼Œäº‹æƒ…å°±ä»è¿™é‡Œå¼€å§‹å§ã€‚</p>

<p>äº”æœˆä»½çš„æ—¶å€™ï¼Œè·Ÿç€é¢†å¯¼ä¸€èµ·æ¥åˆ°äº†ä¸€å®¶æ–°çš„å…¬å¸ã€‚æ–°çš„å…¬å¸å›¢é˜Ÿæ­£åœ¨å»ºç«‹ï¼Œç”±äºé¢†å¯¼çš„å™¨é‡ï¼Œæˆ‘å‚ä¸äº†é¡¹ç›®é‡æ„å‰çš„æ¡†æ¶è®¾è®¡ã€‚</p>

<p>åœ¨è¿™å…¶ä¸­ï¼Œæˆ‘æœ€ä¸»è¦çš„æ˜¯é‡æ„ç½‘ç»œæ¡†æ¶è¿™ä¸€å—ã€‚ç½‘ç»œæ¡†æ¶æ˜¯åŸºäºAFç¬¬äºŒæ¬¡å¼€å‘çš„ï¼Œå¹¶ä¸”æœ€åˆç‰ˆæœ¬æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªå…¬å¸ä¸€èµ·è®¨è®ºï¼Œç„¶åç”±æˆ‘ä»¬ä¸€ä¸ªåŒäº‹æé¹æ€»ç†è®¾è®¡å®ç°çš„ã€‚è€Œé‡æ„ç½‘ç»œæ¡†æ¶è¿™ä¸€å—ï¼Œç»è¿‡å¤šæ¬¡è®¨è®ºä¹‹åï¼Œæˆ‘ä»¬çš„æƒ³æ³•å…¶å®å¯ä»¥å½’çº³æˆä¸¤ç‚¹ï¼šç¬¬ä¸€ä¸ªæ˜¯ç§»æ¤æ€§ï¼Œä¸éœ€åƒä»¥å‰ä¸€æ ·ï¼Œæ¯åšä¸ªé¡¹ç›®éƒ½éœ€è¦ä¿®æ”¹ç½‘ç»œæ¡†æ¶å†…éƒ¨çš„åº•å±‚ï¼Œè€Œæˆ‘ä»¬æ€»ä½“æ¡†æ¶ä¹Ÿæ˜¯éå¸¸å¼ºè°ƒç§»æ¤æ€§ï¼›ç¬¬äºŒä¸ªå°±æ˜¯ä¸šåŠ¡å±‚ä½¿ç”¨ä¸Šä½“éªŒæ›´å¥½ï¼Œæœ€åˆç‰ˆæœ¬æ˜¯å‘é€ä¸€ä¸ªè¯·æ±‚è°ƒå›ä¸€ä¸ªæˆåŠŸå’Œä¸€ä¸ªå¤±è´¥çš„blockï¼ŒæˆåŠŸçš„blocké‡Œé¢åªè¿”å›äº†ä¸€ä¸ªrequestï¼Œå–æ•°æ®çš„æ—¶å€™éœ€è¦ä»å½“å‰è¿™ä¸ªrequestå½“ä¸­è·å–ï¼Œè¿™æ ·å…·æœ‰è¿·æƒ‘æ€§ï¼›è€Œä¸”æˆ‘ä»¬ä¸ä½†è¦åœ¨processResultWithDic:è¿™ä¸ªå¤„ç†æ•°æ®çš„æ–¹æ³•å½“ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯ä¸šåŠ¡å±‚æˆåŠŸï¼Œè¿˜éœ€è¦åœ¨æˆåŠŸè°ƒå›çš„blockå½“ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œè¿™æ ·ç›¸å½“äºè¿›è¡Œäº†ä¸¤æ¬¡åˆ¤æ–­ã€‚</p>

<h5>é’ˆå¯¹è¿™ä¸¤ç‚¹ï¼Œæˆ‘é‡æ–°è®¾è®¡äº†ä¸€ä¸‹ã€‚</h5>

<ul>
<li>è§£å†³ç§»æ¤æ€§ï¼Œæˆ‘åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªNetworkHelperç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå®ƒçš„ä½œç”¨ä¸»è¦æ˜¯æä¾›BaseURLã€æˆåŠŸçš„è¿”å›ç ã€å–è¿”å›ç çš„keyå€¼ã€è¯·æ±‚çš„ç¼“å­˜ç ã€å¤„ç†è¯·æ±‚å‚æ•°ã€å¤„ç†è¯·æ±‚å¤´ã€å¤„ç†è¿”å›çš„æ•°æ®ï¼Œè€Œä¸”ä¸Šé¢å¦‚æœè¿˜æ»¡è¶³ä¸äº†ï¼Œè¿™ä¸ªHelperè¿˜å¯ä»¥è¿”å›AFçš„requestSerializerå’ŒresponseSerializerã€‚è€Œåœ¨é¡¹ç›®å½“ä¸­ï¼Œåªéœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå®ç°é‡Œé¢çš„æ–¹æ³•å°±å¯ä»¥é…ç½®æ•´ä¸ªç½‘ç»œæ¡†æ¶ï¼Œè¿™å°±è§£å†³äº†ç§»æ¤æ€§çš„é—®é¢˜ã€‚</li>
<li>ä½¿ä¸šåŠ¡å±‚ä½¿ç”¨ä½“éªŒæ›´å¥½ï¼Œä¸ºäº†åšåˆ°è¿™ä¸ªï¼Œæˆ‘åšäº†ä¸¤ç‚¹ã€‚ä¸€æ˜¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªblockï¼Œé‚£å°±æ˜¯ä¸€å…±ä¸‰ä¸ªåˆ†åˆ«æ˜¯ä¸šåŠ¡æˆåŠŸã€ä¸šåŠ¡å¤±è´¥ã€ç½‘ç»œå¤±è´¥ï¼›äºŒæ˜¯æ¯ä¸ªblockè°ƒå›ï¼Œä¸ä½†è°ƒå›requestï¼Œè€Œä¸”è¿”å›responseæˆ–è€…NSErrorã€‚</li>
</ul>


<p>ç½‘ç»œè¿™æ ·é‡æ„ä¹‹åï¼Œæˆ‘ä»¬æ”¾åˆ°äº†ä¸€ä¸ªæ•´ä½“çš„å·¥ç¨‹ä¸­PublicProjectï¼Œé¡¹ç›®å¼•å…¥çš„æ—¶å€™å¯¼å…¥æ•´ä¸ªå·¥ç¨‹ï¼Œå¼•ç”¨å…¶ä¸­é™æ€åŒ…æ–‡ä»¶å°±è¡Œäº†ã€‚è¿™ä¸ªæ¡†æ¶ï¼Œåœ¨å…¬å¸å½“ä¸­æˆ‘ä»¬å¤šä¸ªé¡¹ç›®éƒ½åœ¨ä½¿ç”¨ï¼Œå»ºç«‹é¡¹ç›®æ—¶ï¼Œç»™æˆ‘ä»¬ä½¿ç”¨èµ·æ¥å¸¦æ¥ä¸å°çš„ä¾¿åˆ©ã€‚åæ¥ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä¸€ä¸‹ç§æœ‰çš„CocoaPodsï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼ŒåæœŸæ–°é¡¹ç›®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥è¿›è¡Œç®¡ç†ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚ç…§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšå®¢<a href="http://www.liuchungui.com/blog/2015/10/19/cocoapodschuang-jian-si-you-pods/">CocoaPodsåˆ›å»ºç§æœ‰Pods</a>ã€‚ä¹‹åï¼Œå‚ç…§äº†<a href="http://casatwy.com/iosying-yong-jia-gou-tan-wang-luo-ceng-she-ji-fang-an.html">iOSåº”ç”¨æ¶æ„è°ˆ ç½‘ç»œå±‚è®¾è®¡æ–¹æ¡ˆ</a>çš„æ€æƒ³ï¼Œé‡æ–°æ¶æ„äº†ä¸‹ï¼Œè‡ªå·±é‡å†™äº†ä¸€éç½‘ç»œæ¡†æ¶<a href="https://github.com/liuchungui/BGNetwork">BGNetwork</a>ï¼Œæ”¾åœ¨äº†githubä¸Šé¢ã€‚ç›¸æ¯”ä»¥å‰çš„ç½‘ç»œæ¡†æ¶ï¼Œä¸»è¦å¢åŠ äº†ç¼“å­˜æœºåˆ¶ï¼Œæ‰©å±•äº†å¯é…ç½®æ€§çš„åŠŸèƒ½ã€‚ä¹‹åï¼Œä¹Ÿè®¸æ˜¯ç”¨æƒ¯äº†blockå›è°ƒçš„æ–¹å¼ï¼Œåè€Œè§‰å¾—blockå›è°ƒæ›´å¥½ï¼Œåˆåœ¨æ­¤åŸºç¡€ä¸Šé‡æ–°å¼€äº†ä¸€ä¸ª<a href="https://github.com/liuchungui/BGNetwork/tree/dev">devåˆ†æ”¯</a>ã€‚å‚ç…§<a href="https://github.com/yuantiku/YTKNetwork">YTKNetwork</a>ï¼Œåœ¨devåˆ†æ”¯ä¸Šæ›´æ˜¯æ·»åŠ äº†æ‰¹é‡å¤„ç†è¯·æ±‚ã€ä¸Šä¼ è¯·æ±‚å’Œä¸‹è½½è¯·æ±‚ã€‚åæ¥é™†é™†ç»­ç»­æ•´äº†ä¸‹<a href="https://travis-ci.org/liuchungui/BGNetwork">travis-ci</a>å’Œ<a href="https://codecov.io/github/liuchungui/BGNetwork">codecov</a>ã€‚</p>

<p>æ•´ä¸ªç½‘ç»œå°è£…ä¹‹åï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤šçš„ã€‚ä¸è¿‡ï¼Œç‰¹åˆ«é—æ†¾çš„æ˜¯æ²¡æœ‰å¥½å¥½çš„å†™ä½¿ç”¨æ•™ç¨‹å’Œå®£ä¼ ä¸‹ï¼Œå¸¦åŠ¨æ›´å¤šçš„äººå‚ä¸è¿›æ¥ï¼Œstarå°‘çš„å¯æ€œã€‚</p>

<p>2015å¹´è¿˜æœ‰ä¸ªé‡è¦çš„äº‹æƒ…å°±æ˜¯ä½¿ç”¨äº†gitï¼ŒçœŸæ­£å‚ä¸è¿›äº†githubï¼ŒçœŸæ­£çš„ä¸ºgithubçš„ä¸–ç•Œå‘å¾€å’Œæ¿€åŠ¨ã€‚åœ¨ä¹‹å‰ï¼Œgitå¯¹æˆ‘æ¥è¯´ä¹Ÿå°±æ˜¯å’Œsvnä¸€æ ·çš„å·¥å…·ï¼Œgithubå°±æ˜¯ä¸€ä¸ªä¸‹è½½å¼€æºä»£ç çš„ç½‘ç«™ã€‚è€Œåœ¨åŒå­¦è¯´gitæ€ä¹ˆæ€ä¹ˆå¥½çš„æ—¶å€™ï¼Œæˆ‘ç»ˆäºä½¿ç”¨äº†gitï¼Œç«‹é©¬å°±æ„Ÿè§‰ä½¿ç”¨gitåŸæ¥è¿™ä¹ˆçˆ½ã€‚åæ¥ï¼Œè¿›å…¥githubåœ¨æŸä¸ªé¡¹ç›®é‡Œé¢é—®äº†ä¸ªé—®é¢˜ï¼Œå‘ç°æœ‰å¾ˆå¤šå¾ˆå¤šäººæ¥å›ç­”ï¼Œå¤§å®¶å°±åƒä¸€ä¸ªå¤§å®¶åº­ä¸€æ ·ï¼Œä¸ºæ•´ä¸ªå¼€æºé¡¹ç›®å‘å±•çš„æ›´å¥½è€ŒåŠªåŠ›ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ‰ä»€ä¹ˆæƒ³æ³•çš„æ—¶å€™ï¼Œä¹Ÿä¼šè‡ªå·±åˆ›å»ºé¡¹ç›®æ”¾åœ¨ä¸Šé¢ã€‚</p>

<p>2015å¹´ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹æƒ…ä¸å¾—ä¸æï¼Œå°±æ˜¯å’Œæˆ‘ä¸€ä¸ªå®¤å‹åœ¨ä¸€èµ·åšäº†ä¸€ä¸ªé¡¹ç›®ï¼Œåšå¾—é¡¹ç›®æ˜¯ä¸€ä¸ªä¸ºç¾¤ä¼—æä¾›æ³•å¾‹æœåŠ¡çš„å¹³å°ï¼Œåšäº†å®¢æˆ·ç«¯å’Œå¾‹å¸ˆç«¯ã€‚å½“æ—¶ï¼Œæˆ‘è¿˜ä¸“é—¨é’ˆå¯¹ä¸€ä¸ªç½‘ç«™ç”¨phpå†™äº†ä¸€ä¸ªæŠ“å–æ•°æ®çš„ä»£ç ï¼Œæœ€åèŠ±äº†å°†è¿‘ä¸€ä¸ªæœˆçš„æ—¶é—´æŠ“å–äº†ä¸ƒç™¾å¤šä¸‡æ¡æ•°æ®ã€‚ä»–æ›´æ˜¯å†™äº†ä¸€æ®µä»£ç åˆ†æå‡ºå…¶ä¸­çš„æ¡ˆä»¶ç±»å‹ã€å¾‹å¸ˆåã€å¾‹å¸ˆä¸‹æ‰€æ‰“çš„å®˜å¸ç­‰æœ‰ä»·å€¼çš„æ•°æ®ï¼Œè¿˜åšäº†ä¸€ä¸ªå°ç½‘ç«™ã€‚åæ¥ï¼Œæˆ‘ä»¬åšAPPï¼Œæˆ‘å†™æœåŠ¡å™¨æ¥å£ï¼Œå†™äº†å‡ ä¸ªä¹‹åï¼Œä»–å‚ç…§ç€å†™äº†è®¸å¤šã€‚iOSå®¢æˆ·ç«¯æœ‰ä¸¤ä¸ªï¼Œæ˜¯æˆ‘å’Œå¦å¤–ä¸€ä¸ªåŒå­¦ä¸€å—å†™çš„ã€‚å½“æ—¶æˆ‘è¿™ä¸ªå®¤å‹ç‰¹åˆ«æœ‰æ¿€æƒ…ï¼Œä¸“é—¨èŠ±äº†ä¸‰å¤©çš„åŠŸå¤«åšäº†ä¸€ä¸ªç‰¹åˆ«æ£’çš„PPTï¼Œåœ¨ä»–å¯¼å¸ˆçš„ç‰µå¤´ä¸‹ï¼Œé‚€è¯·äº†æ³•å¾‹ç•Œçš„å¾‹å¸ˆã€æ³•é™¢çš„äººå’ŒåŒ—å¤§çš„æ•™æˆåœ¨å›½å®¶ä¼šè®®ä¸­å¿ƒåšäº†ä¸€æ¬¡æ¼”è®²ã€‚æœ¬æ¥æ˜¯æ‰“ç®—æ¿€æƒ…å››å°„çš„å‡†å¤‡æèµ·ï¼Œèèµ„åˆ›å»ºå…¬å¸ï¼Œæœ€åä¸“ä¸šäººå£«æå‡ºäº†å„ç§å„æ ·çš„é—®é¢˜ï¼Œæœ€åæ²¡æœ‰æèµ·æ¥ã€‚</p>

<p>ä¸è¿‡ï¼Œè¿™ä¹Ÿæˆä¸ºäº†æˆ‘ä»¬ä¸€ä¸ªé‡è¦çš„ç»éªŒã€‚å¯¹æˆ‘æ¥è¯´ï¼Œæˆ‘ç»å†äº†æŠ“å–æ•°æ®ï¼Œä¸“é—¨å®è·µäº†ä¸€ç•ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè€Œä¸”æˆ‘å½“æ—¶æ˜¯è‡ªå·±æ•´äº†ä¸€ä¸ªç®€å•çš„phpæ¡†æ¶ï¼Œç„¶åå°±å†™èµ·äº†æœåŠ¡å™¨ç«¯çš„æ¥å£ã€‚</p>

<p>åæ¥ï¼Œä»–ä»¬å…¬å¸è¦åšä¸€ä¸ªé¡¹ç›®ï¼ŒæœåŠ¡å™¨æ¥å£æ˜¯ç”±æˆ‘ä¸€ä¸ªäººå†™çš„ï¼ŒiOSå®¢æˆ·ç«¯æ˜¯ç”±æˆ‘å’Œå¦å¤–ä¸€ä¸ªåŒå­¦å†™çš„ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä½¿ç”¨äº†åœ¨<a href="https://github.com/bcit-ci/CodeIgniter">CI</a>åŸºç¡€å°è£…çš„Resetful APIæ¡†æ¶<a href="https://github.com/chriskacerguis/codeigniter-restserver">codeigniter-restserver</a>ï¼Œæ¥å£æ–‡æ¡£ä¸“é—¨ç”±<a href="https://tower.im/">Tower</a>ç®¡ç†ã€‚</p>

<p>æ€»ç»“å†™çš„æœ‰ç‚¹å•°å—¦ï¼Œå¤§æ¦‚å°±ä¸€äº›è¿™æ ·çš„äº‹æƒ…ï¼Œä¹Ÿç®—æ˜¯å¯¹2015å¹´çš„è®°å½•å§ï¼</p>

<p>2016å¹´è®¡åˆ’ï¼š
å…¶å®æƒ³è¿‡å„ç§å„æ ·çš„è®¡åˆ’ï¼Œæƒ³åšçš„äº‹æƒ…ä¹Ÿç‰¹åˆ«ç‰¹åˆ«å¤šï¼Œä½†æ˜¯è¯´å¤šäº†ï¼Œè‚¯å®šåˆå®ç°ä¸äº†ï¼Œè¿˜æ˜¯æ¥ç‚¹å®é™…çš„å§ï¼</p>

<ol>
<li>2016å¹´è¦å­¦ä¹ ä¸€é—¨æ–°çš„æŠ€æœ¯ï¼Œæš‚æ—¶é€‰å®šçš„æ˜¯H5ã€‚</li>
<li>githubä¸Šå¥½å¥½ç»´æŠ¤è‡ªå·±çš„é¡¹ç›®ï¼Œåšå‡ºä¸€ä¸ªæœ‰ç‚¹åæ°”çš„é¡¹ç›®æ¥ã€‚</li>
<li>åšä¸€ä¸ªè‡ªå·±çš„ç½‘ç«™å’ŒAppï¼Œè¶Šç‚«é…·è¶Šå¥½ã€‚</li>
<li>å¥½å¥½ç»´æŠ¤è‡ªå·±çš„åšå®¢ï¼Œæ¯ä¸ªæœˆè‡³å°‘ä¸€ç¯‡åšå®¢ã€‚</li>
<li>å¸¦ç€å¥³æœ‹å‹å¥½å¥½å»æ—…æ¸¸ä¸€æ¬¡</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gitbookå®‰è£…ä½¿ç”¨]]></title>
    <link href="http://www.liuchungui.com/blog/2015/12/26/gitbookan-zhuang-shi-yong/"/>
    <updated>2015-12-26T17:15:07+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/12/26/gitbookan-zhuang-shi-yong</id>
    <content type="html"><![CDATA[<blockquote><p>GitBook æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä½¿ç”¨ Github/Git å’Œ Markdown æ¥åˆ¶ä½œç²¾ç¾çš„ç”µå­ä¹¦ã€‚</p></blockquote>

<p>åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œè®°å½•äº†ä¸€ä¸‹gitbookçš„å®‰è£…ä½¿ç”¨ï¼Œæ›´è¯¦ç»†çš„ä½¿ç”¨è¯·æŸ¥çœ‹ä¸‹é¢å†…å®¹ï¼š
gitbookè¯¦ç»†ä½¿ç”¨æ–‡æ¡£ï¼š<a href="help.gitbook.com">help.gitbook.com</a>      <br/>
gitbookå®˜ç½‘:<a href="https://www.gitbook.com">https://www.gitbook.com</a>  <br/>
githubåœ°å€:<a href="https://github.com/GitbookIO/gitbook">https://github.com/GitbookIO/gitbook</a></p>

<h3>1ã€å®‰è£…</h3>

<p>é¦–å…ˆåˆ°<a href="http://nodejs.cn/">nodejs</a>ä¸‹è½½ï¼Œå®‰è£…Node.jsçš„åŒ…ç®¡ç†å™¨npmã€‚
ç„¶åï¼Œé€šè¿‡<code>sudo npm install -g gitbook-cli</code>å‘½ä»¤å®‰è£…gitbook</p>

<!-- more -->


<h3>2ã€åˆå§‹åŒ–gitbook</h3>

<p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååˆå§‹åŒ–</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir test
</span><span class='line'>gitbook init</span></code></pre></td></tr></table></div></figure>


<p>åˆå§‹åŒ–ä¹‹åä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶README.mdå’ŒSUMMARY.md,README.md æ˜¯ä½œå“çš„ä»‹ç»ï¼ŒSUMMARY.md æ˜¯ä½œå“çš„ç›®å½•ç»“æ„ï¼Œé‡Œé¢è¦åŒ…å«ä¸€ä¸ªç« èŠ‚æ ‡é¢˜å’Œæ–‡ä»¶ç´¢å¼•çš„åˆ—è¡¨ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªSUMMARY.mdæ–‡ä»¶çš„å†…å®¹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Summary
</span><span class='line'>
</span><span class='line'>This is the summary of my book.
</span><span class='line'>
</span><span class='line'>* [section 1](section1/README.md)
</span><span class='line'>    * [example 1](section1/example1.md)
</span><span class='line'>    * [example 2](section1/example2.md)
</span><span class='line'>* [section 2](section2/README.md)
</span><span class='line'>    * [example 1](section2/example1.md)</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢ç¼–è¾‘å¯¹åº”çš„å†…å®¹ï¼Œä¹‹åæ›´æ–°SUMMARY.mdè¿™ä¸ªç›®å½•æ–‡ä»¶ï¼›å¦‚æœåœ¨ç¼–è¾‘ä¹‹å‰æˆ‘ä»¬å·²ç»ç¡®å®šå¥½äº†å†…å®¹æ ‡é¢˜å’Œç›®å½•ï¼Œä¹Ÿå¯ä»¥å…ˆç¼–è¾‘SUMMARY.mdæ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>gitbook init</code>æ¥åˆå§‹åŒ–ä¸€éï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ç›®å½•å’Œå¯¹åº”çš„mdæ–‡ä»¶ã€‚</p>

<h3>3ã€ç¼–è¾‘å†…å®¹ï¼Œå¹¶æŸ¥çœ‹</h3>

<p>åˆå§‹åŒ–ä¹¦ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æˆ‘ä»¬çš„å†…å®¹è¿›è¡Œç¼–è¾‘äº†ã€‚
ä¾‹å¦‚ï¼š
æˆ‘è¦å°†æœ¬ç¯‡åšå®¢æ”¾å…¥ç›®å½•ä¸ºgitbookä¸‹ï¼Œé¦–å…ˆåœ¨testç›®å½•å»ºç«‹ä¸€ä¸ªgitbookæ–‡ä»¶å¤¹ï¼Œç„¶åå»ºç«‹ä¸€ä¸ª<code>gitbookå®‰è£…ä½¿ç”¨.md</code>æ–‡ä»¶ï¼Œç›®å½•å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|____gitbook
</span><span class='line'>| |____gitbookå®‰è£…ä½¿ç”¨.md
</span><span class='line'>|____README.md
</span><span class='line'>|____section1
</span><span class='line'>| |____example1.md
</span><span class='line'>| |____example2.md
</span><span class='line'>| |____README.md
</span><span class='line'>| |____test.md
</span><span class='line'>|____section2
</span><span class='line'>| |____example1.md
</span><span class='line'>| |____README.md
</span><span class='line'>|____SUMMARY.md</span></code></pre></td></tr></table></div></figure>


<p>ä¹‹åï¼Œæˆ‘ä»¬åƒå†™åšå®¢ä¸€æ ·ï¼Œä½¿ç”¨markdownè¯­è¨€ç¼–è¾‘<code>gitbookå®‰è£…ä½¿ç”¨.md</code>ä¸­çš„å†…å®¹ã€‚
ç¼–è¾‘å®Œä¹‹åï¼Œéœ€è¦å°†<code>gitbookå®‰è£…ä½¿ç”¨.md</code>è¿™ç¯‡æ–‡ç« æ”¾å…¥SUMMARY.mdç›®å½•ä¸­ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Summary
</span><span class='line'>* [gitbook]
</span><span class='line'>    * [gitbookå®‰è£…ä½¿ç”¨](gitbook/gitbookå®‰è£…ä½¿ç”¨.md)
</span><span class='line'>* [section 1](section1/README.md)
</span><span class='line'>    * [example 1](section1/example1.md)
</span><span class='line'>    * [example 2](section1/example2.md)
</span><span class='line'>* [section 2](section2/README.md)</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼Œå°±åŠ å…¥äº†<code>gitbookå®‰è£…ä½¿ç”¨.md</code>è¿™ç¯‡æ–‡ç« ã€‚ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨ä¸€ä¸ªæœ¬åœ°webæœåŠ¡ï¼Œæ¥é¢„è§ˆæœ¬åœ°çš„å†…å®¹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gitbook serve</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªæ—¶å€™ï¼Œç®€æ´ã€ä¼˜é›…çš„ç•Œé¢å°±å‡ºæ¥äº†ã€‚
<img src="http://ww1.sinaimg.cn/large/7746cd07gw1eynt17tm6yj20zh0ey0ua.jpg" alt="" /></p>

<p>æ³¨æ„ï¼š</p>

<ul>
<li>åœ¨æŸ¥çœ‹çš„æ—¶å€™æ²¡æœ‰çœ‹åˆ°åˆšåˆšåŠ å…¥çš„æ–‡ç« ï¼ŒæŸ¥çœ‹ä¸€ä¸‹<code>SUMMARY.md</code>æ˜¯å¦æ·»åŠ </li>
<li>åœ¨é¢„è§ˆçš„æ—¶å€™èƒ½çœ‹åˆ°æ–‡ç« ï¼Œä½†æ˜¯ç‚¹å‡»ä¸èµ·ä½œç”¨ï¼ŒæŸ¥çœ‹æ˜¯å¦ç›®å½•æ­£ç¡®</li>
</ul>


<p><strong>å¦‚æœæƒ³å°†gitbookæ”¾åˆ°webæœåŠ¡å™¨ä½œä¸ºç½‘ç«™æµè§ˆï¼Œå…ˆä½¿ç”¨gitbook buildå‘½ä»¤ï¼Œä¹‹åä¼šç”Ÿæˆé™æ€ç½‘é¡µåˆ°<em>bookç›®å½•ä¸‹ï¼Œåªè¦å°†</em>bookç›®å½•copyåˆ°webæœåŠ¡å™¨ä¸Šå°±è¡Œäº†ã€‚</strong></p>

<h3>4ã€å‘å¸ƒç”µå­ä¹¦gitbookå®˜ç½‘</h3>

<p>åˆ°<a href="https://www.gitbook.com/">gitbookå®˜ç½‘</a>åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œåˆ›å»ºä¸€æœ¬<code>test</code>ç”µå­ä¹¦ï¼Œåˆ›å»ºç”µå­ä¹¦çš„æ—¶å€™ï¼Œgitbookä¼šåˆ›å»ºgitä»“åº“<a href="https://git.gitbook.liuchungui/test.git%E3%80%82">https://git.gitbook.liuchungui/test.git%E3%80%82</a></p>

<p>ç„¶åä¸‹è½½<a href="https://www.gitbook.com/editor">gitbook editor</a>ï¼Œç™»é™†è´¦å·ï¼Œå°†ç”µå­ä¹¦cloneä¸€ä»½ä¸‹æ¥ï¼Œå°†å‰é¢æ–°å»ºç”µå­ä¹¦å°†å‰é¢ç¼–è¾‘çš„å†…å®¹æ‹–åˆ°è¿™ä¸ªç”µå­ä¹¦ä¸‹ï¼Œç„¶ååŒæ­¥åˆ°å®˜ç½‘å°±å¯ä»¥çœ‹åˆ°å†…å®¹äº†ï¼Œä¾‹å¦‚æˆ‘çš„<a href="https://liuchungui.gitbooks.io/test/content/">test</a>ã€‚</p>

<p>ä¸Šé¢çš„æ“ä½œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œã€‚å…ˆåœ¨å®˜ç½‘å»ºç«‹ä¸€ä¸ªç”µå­ä¹¦ï¼Œç„¶åcloneä¸‹æ¥ï¼Œä¹‹åç¼–å†™æˆ‘ä»¬çš„ç”µå­ä¹¦å†…å®¹å’Œç›®å½•ï¼Œç„¶åä½¿ç”¨<a href="http://www.liuchungui.com/blog/2015/10/23/gitzong-jie/">gitå‘½ä»¤</a>å°†å†…å®¹Pushåˆ°gitä»“åº“å°±è¡Œäº†ã€‚</p>

<h3>5ã€å¯¼å‡ºç”µå­ä¹¦</h3>

<p>å…¶å®ï¼Œä¸Šé¢å»ºç«‹çš„<code>test</code>å·²ç»åœ¨å®˜ç½‘ä¸Šå¯ä»¥è¿›è¡Œç”µå­ä¹¦ä¸‹è½½äº†ï¼Œæœ‰ä¸‰ç§æ ¼å¼<code>PDF</code>ã€<code>EPUB</code>ã€<code>MOBI</code>ã€‚
è€Œåœ¨æœ¬åœ°ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯¼å‡º</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pdf [options] [source_dir] æ„å»º pdf æ ¼å¼çš„ç”µå­ä¹¦
</span><span class='line'>epub [options] [source_dir] æ„å»º ePub æ ¼å¼çš„ç”µå­ä¹¦
</span><span class='line'>mobi [options] [source_dir] æ„å»º mobi æ ¼å¼çš„ç”µå­ä¹¦</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœå¯¼å‡ºå¤±è´¥ï¼Œéœ€è¦æˆ‘ä»¬ä¸‹è½½<a href="http://calibre-ebook.com/">Calibre</a>è¿›è¡Œç”µå­ä¹¦è½¬æ¢ã€‚</p>

<h3>gitbookçš„ç›¸å…³å‘½ä»¤</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>build [options] [source_dir] æ ¹æ®æ–‡æ¡£ç›®å½•æ„å»ºä¹¦ç±
</span><span class='line'>serve [options] [source_dir] æ„å»ºå¹¶ä¸”æä¾›ä¹¦ç±çš„ web æ‰˜ç®¡
</span><span class='line'>install [options] [source_dir] å®‰è£… GitBook æ’ä»¶
</span><span class='line'>pdf [options] [source_dir] æ„å»º pdf æ ¼å¼çš„ç”µå­ä¹¦
</span><span class='line'>epub [options] [source_dir] æ„å»º ePub æ ¼å¼çš„ç”µå­ä¹¦
</span><span class='line'>mobi [options] [source_dir] æ„å»º mobi æ ¼å¼çš„ç”µå­ä¹¦
</span><span class='line'>init [source_dir]      æ ¹æ® SUMARRY.md æ–‡ä»¶çš„å†…å®¹ç”Ÿæˆç›¸åº”çš„ç›®å½•å’Œæ–‡ä»¶
</span><span class='line'>publish [source_dir]   å¦‚æœå·²ç»‘å®š GitBook.ioï¼Œè¯¥å‘½ä»¤å¯ä»¥ç›´æ¥å‘å¸ƒä¹¦ç±
</span><span class='line'>
</span><span class='line'>-h, --help     è¾“å‡ºå‘½ä»¤çš„ä½¿ç”¨è¯´æ˜
</span><span class='line'>-V, --version  è¾“å‡ºç¨‹åºçš„ç‰ˆæœ¬å·</span></code></pre></td></tr></table></div></figure>


<h3>æ€»ç»“</h3>

<p>gitbookæ“ä½œå…¶å®å°±åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢å†…å®¹ï¼Œä¸€ä¸ªæ˜¯å»ºç«‹gitä»“åº“å¯¹å†…å®¹è¿›è¡Œç®¡ç†ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ä½¿ç”¨markdownå¯¹å†…å®¹è¿›è¡Œç¼–è¾‘ï¼Œç„¶åä½¿ç”¨SUMARRY.mdç”Ÿæˆä¹¦çš„ç›®å½•ã€‚  <br/>
è€Œgitbookè¿™ä¹ˆä¼˜é›…å¤§æ–¹çš„é¡µé¢ï¼Œæˆ‘ä»¬å–œæ¬¢çš„è¯ï¼Œå®Œå…¨å¯ä»¥å°†å®ƒåšæˆæˆ‘ä»¬çš„æŠ€æœ¯åšå®¢ã€‚è€Œå®ƒè¿˜å…·æœ‰ç®€å•æ ‡é¢˜æ£€ç´¢åŠŸèƒ½ï¼Œæˆ‘ç”šè‡³æƒ³è¿‡å°†å®ƒåšæˆä¸€ä¸ªapiæ¥å£ç®¡ç†é¡µé¢ã€‚</p>

<h3>å‚è€ƒï¼š</h3>

<p><a href="http://zhaoda.net/2015/11/09/gitbook-plugins/">Gitbook çš„ä½¿ç”¨å’Œå¸¸ç”¨æ’ä»¶</a> <br/>
<a href="http://liaoer.net/2015/04/30/Mac%E4%B8%8BGitBook%E5%88%B6%E4%BD%9C%E7%94%B5%E5%AD%90%E4%B9%A6/">Macä¸‹GitBookåˆ¶ä½œç”µå­ä¹¦</a><br/>
<a href="http://blog.windrunner.info/app/gitbook-tutorial.html">ä½¿ç”¨GitBook</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UICollectionViewåŠ¨ç”»]]></title>
    <link href="http://www.liuchungui.com/blog/2015/11/24/uicollectionviewdong-hua/"/>
    <updated>2015-11-24T00:00:26+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/11/24/uicollectionviewdong-hua</id>
    <content type="html"><![CDATA[<h2>ä¸€ã€ç®€å•ä½¿ç”¨</h2>

<p>UICollectionViewæ›´æ–°äº‹ä»¶æœ‰å››ç§åˆ†åˆ«æ˜¯<code>æ’å…¥</code>ã€<code>åˆ é™¤</code>ã€<code>åˆ·æ–°</code>ã€<code>ç§»åŠ¨</code>ï¼Œ
apiä½¿ç”¨èµ·æ¥å’ŒUITableViewç±»ä¼¼ï¼Œå…·ä½“å¯ä»¥è‡ªå·±åœ¨ä»£ç ä¸­æ‰¾ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œå¤šä¸ªæ›´æ–°äº‹ä»¶ï¼Œå¯ä»¥æ”¾åˆ°performBatchUpdatesä¸­çš„updatesé—­åŒ…ä¸­ä½œä¸ºä¸€ç»„åŠ¨ç”»ï¼Œç„¶åå…¨éƒ¨æ‰§è¡Œå®Œä¹‹åé€šè¿‡completionè°ƒå›ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">collectionView</span><span class="p">.</span><span class="n">performBatchUpdates</span><span class="p">({</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>            <span class="n">collectionView</span><span class="p">.</span><span class="n">insertItemsAtIndexPaths</span><span class="p">(</span><span class="n">insertIndexPaths</span><span class="p">)</span>
</span><span class='line'>            <span class="n">collectionView</span><span class="p">.</span><span class="n">moveItemAtIndexPath</span><span class="p">(</span><span class="n">currentIndexPath</span><span class="p">,</span> <span class="nl">toIndexPath</span><span class="p">:</span> <span class="n">toIndexPath</span><span class="p">)</span>
</span><span class='line'>            <span class="p">},</span> <span class="nl">completion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">isFinish</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>        <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>äºŒã€UICollectionViewåŠ¨ç”»</h2>

<p>å››ç§ä¸åŒçš„æ›´æ–°äº‹ä»¶ï¼Œç³»ç»Ÿé»˜è®¤ä¼šå¸¦æœ‰åŠ¨ç”»ï¼Œä¸è¿‡æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰layoutæˆ–è€…ç»§æ‰¿flowLayoutï¼Œåœ¨å†…éƒ¨å®ç°æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„åŠ¨ç”»ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¯´è¯´åŠ¨ç”»çš„æµç¨‹ï¼Œä»¥åŠç³»ç»Ÿé»˜è®¤çš„å››ç§åŠ¨ç”»å†…éƒ¨æ˜¯å¦‚ä½•çš„ï¼Œå¹¶ä¸”é€šè¿‡ä»£ç æ¥ä¿®æ”¹è¾¾åˆ°è‡ªå·±æƒ³è¦çš„åŠ¨ç”»ã€‚</p>

<!-- more -->


<h4>CollectionViewåŠ¨ç”»æµç¨‹</h4>

<p>å½“æˆ‘ä»¬åœ¨å¤–éƒ¨è°ƒç”¨CollectionViewç›¸å…³çš„apiå»<code>æ’å…¥</code>ã€<code>åˆ é™¤</code>ã€<code>åˆ·æ–°</code>ã€<code>ç§»åŠ¨</code>cellæ—¶ï¼Œé¦–å…ˆä¼šé€šè¿‡layoutä¸­çš„<code>layoutAttributesForElementsInRect</code>æ–¹æ³•è·å–æ›´æ–°ä»¥åçš„å¸ƒå±€ä¿¡æ¯ï¼Œç„¶åé€šè¿‡<code>prepareForCollectionViewUpdates</code>æ–¹æ³•æ¥é€šçŸ¥layoutå“ªäº›å†…å®¹å°†ä¼šå‘ç”Ÿæ”¹å˜ã€‚ä¹‹åï¼Œé€šè¿‡è°ƒç”¨layoutä¸­çš„<code>initialLayoutAttributesForAppearingItemAtIndexPath</code>ã€<code>finalLayoutAttributesForDisappearingItemAtIndexPath</code>æ–¹æ³•è·å–å¯¹åº”indexPathçš„<code>åˆšå‡ºç°æ—¶æœ€åˆå¸ƒå±€å±æ€§</code>å’Œ<code>æ¶ˆå¤±æ—¶æœ€ç»ˆå¸ƒå±€å±æ€§</code>ã€‚è€Œåå½¢æˆä¸¤ä¸ªåŠ¨ç”»è¿‡ç¨‹åˆ†åˆ«æ˜¯<code>åˆšå‡ºç°æ—¶æœ€åˆå¸ƒå±€-&gt;æ›´æ–°åå¸ƒå±€çš„å‡ºç°åŠ¨ç”»</code>å’Œ<code>æ›´æ–°å‰å¸ƒå±€-&gt;æ¶ˆå¤±æ—¶æœ€ç»ˆå¸ƒå±€çš„æ¶ˆå¤±åŠ¨ç”»</code>ï¼Œè€ŒcollectionViewä¸­'æ’å…¥'ã€'åˆ é™¤'ã€'åˆ·æ–°'å’Œ'ç§»åŠ¨'åŠ¨ç”»éƒ½æ˜¯åŸºäºè¿™ä¸¤ä¸ªåŠ¨ç”»ç»„åˆå½¢æˆçš„ã€‚æœ€åï¼Œç­‰è¿™ä¸€ç³»åˆ—åŠ¨ç”»æ‰§è¡Œå®Œä¹‹åï¼Œæœ€åä¼šè°ƒç”¨layoutä¸­<code>finalizeCollectionViewUpdates</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä»ç„¶æ”¾åœ¨åŠ¨ç”»å—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•å½“ä¸­æ·»åŠ é¢å¤–çš„åŠ¨ç”»ã€‚</p>

<p>ä»ä¸Šé¢æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ›´æ–°çš„æ—¶å€™ï¼Œç”±äº<code>æ›´æ–°å‰å¸ƒå±€</code>å’Œ<code>æ›´æ–°åå¸ƒå±€</code>éƒ½æ˜¯åœ¨æ›´æ–°åŠ¨ç”»å‰å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬ä¸èƒ½å»èƒ¡ä¹±æ›´æ”¹å¸ƒå±€ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡<code>initialLayoutAttributesForAppearingItemAtIndexPath</code>å’Œ<code>finalLayoutAttributesForDisappearingItemAtIndexPath</code>ä¸¤ä¸ªæ–¹æ³•æ¥æ›´æ”¹<code>åˆšå‡ºç°æ—¶æœ€åˆå¸ƒå±€å±æ€§</code>å’Œ<code>æ¶ˆå¤±æ—¶æœ€ç»ˆå¸ƒå±€å±æ€§</code>ï¼Œå³æˆ‘ä»¬åªèƒ½æ›´æ”¹<code>å‡ºç°åŠ¨ç”»çš„èµ·ç‚¹</code>å’Œ<code>æ¶ˆå¤±åŠ¨ç”»çš„ç»ˆç‚¹</code>ã€‚</p>

<p>ä¸ºäº†æ›´æ–¹é¢çš„ä¸‹é¢è¯´æ˜ï¼Œå¼•ç”³å‡ºä¸¤ä¸ªåè¯ï¼š</p>

<ul>
<li>å‡ºç°åŠ¨ç”»ï¼šinitialLayoutAttributesForAppearingItemAtIndexPathè·å–å¯¹åº”indexPathçš„<code>åˆšå‡ºç°æ—¶æœ€åˆå¸ƒå±€</code>->æ›´æ–°åå¸ƒå±€å˜åŒ–è¿‡ç¨‹</li>
<li>æ¶ˆå¤±åŠ¨ç”»ï¼šæ›´æ–°ä¹‹å‰çš„å¸ƒå±€->finalLayoutAttributesForDisappearingItemAtIndexPathæ–¹æ³•è·å–å¯¹åº”indexPathçš„<code>æ¶ˆå¤±æ—¶æœ€ç»ˆå¸ƒå±€</code>çš„å˜åŒ–è¿‡ç¨‹</li>
</ul>


<p>æ³¨æ„ï¼Œå‡ºç°åŠ¨ç”»å’Œæ¶ˆå¤±åŠ¨ç”»é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªcellå•å…ƒã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç ç¤ºä¾‹æ¥å®ç°æ’å…¥ã€åˆ é™¤ã€åˆ·æ–°ã€ç§»åŠ¨åŠ¨ç”»ã€‚
ä»£ç ç¤ºä¾‹å·¥ç¨‹ï¼š<a href="https://github.com/liuchungui/UICollectionViewAnimationDemo">UICollectionViewAnimationDemo</a></p>

<p>åœ¨è¿™ä¸ªDemoå·¥ç¨‹ä¸­æœ‰ä¸€ä¸ª<code>BGSelectImageLayout</code>ï¼Œå®ƒæ˜¯CollectionViewçš„layoutï¼Œå®ƒçš„å¸ƒå±€æ–¹å¼æ˜¯æ°´å¹³æ¨ªå‘æ»‘åŠ¨ï¼Œå¹¶ä¸”åªæœ‰ä¸€ç»„ï¼Œæ¯ä¸€ä¸ªæ™®é€šçš„cellå¤§å°éƒ½æ˜¯<code>itemSize</code>ï¼Œè€Œé€‰ä¸­çš„cellåˆ™å®½åº¦æ˜¯<code>itemSize*2</code>ã€‚</p>

<h4>æ’å…¥åŠ¨ç”»ï¼š</h4>

<p>åœ¨å½“å‰çš„å¸ƒå±€ä¸‹ï¼Œæ¯æ’å…¥ä¸€ä¸ªcellæ—¶ï¼Œéƒ½ä¼šå½±å“å®ƒåé¢æ‰€æœ‰cellå¸ƒå±€å˜åŒ–ã€‚      <br/>
ä¾‹å¦‚CollectionViewæœ‰ä¸€è¡Œä¸‰ä¸ªcellï¼Œä¸ºäº†æ›´å¥½çš„è¯´æ˜å°†indexPathæ˜¯(0,0),(0,1),(0,2)æ ‡è®°ä¸º0ï¼Œ1ï¼Œ2ã€‚å½“åœ¨ç¬¬1ä¸ªä½ç½®æ’å…¥ä¸€ä¸ªcellæ—¶ï¼Œå¦‚ä¸‹å›¾</p>

<p><img src="http://ww2.sinaimg.cn/large/7746cd07jw1eyba1ih4nvj20re0fs75l.jpg" alt="" /></p>

<p>è€Œåœ¨è¿™ä¸ªæ’å…¥è¿‡ç¨‹ä¸­ï¼Œè§†è§‰ä¸Šä¼šæœ‰ä¸‰ä¸ªåŠ¨ç”»è¿‡ç¨‹ã€‚newæ’å…¥åˆ°ä½ç½®1ä¸º<code>è¿‡ç¨‹1</code>ï¼Œ1ç§»åŠ¨ä¸€ä¸ªå•ä½åˆ°2ä¸º<code>è¿‡ç¨‹2</code>ï¼Œ2ç§»åŠ¨ä¸€ä¸ªå•ä½åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®3ä¸º<code>è¿‡ç¨‹3</code>ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/large/7746cd07jw1eyba58t45gj20yc0g6760.jpg" alt="" /></p>

<p>è™½ç„¶è§†è§‰ä¸Šåªæœ‰ä¸‰ä¸ªåŠ¨ç”»è¿‡ç¨‹ï¼Œä½†å…¶å®æœ‰äº”ä¸ªåŠ¨ç”»ã€‚å…¶ä¸­ï¼Œè¿‡ç¨‹1æ˜¯1ä½ç½®çš„<code>å‡ºç°åŠ¨ç”»</code>ï¼›è¿‡ç¨‹2æ˜¯1ä½ç½®çš„<code>æ¶ˆå¤±åŠ¨ç”»</code>å’Œ2ä½ç½®çš„<code>å‡ºç°åŠ¨ç”»</code>é‡åˆè€Œæˆï¼›è¿‡ç¨‹3æ˜¯2ä½ç½®çš„<code>æ¶ˆå¤±åŠ¨ç”»</code>å’Œ3ä½ç½®çš„<code>å‡ºç°åŠ¨ç”»</code>ã€‚</p>

<p>å…¶ä¸­å€¼å¾—æ³¨æ„çš„ä¸‰ç‚¹ï¼Œä¸€æ˜¯é™¤äº†æœ€åä¸€ä¸ªï¼Œå‰é¢çš„cellæ¶ˆå¤±åŠ¨ç”»ä¸å®ƒåé¢cellå‡ºç°åŠ¨ç”»é‡åˆï¼Œè¿™æ ·çœ‹èµ·æ¥å°±æ˜¯å½“å‰ä½ç½®çš„cellå‘åå¹³ç§»äº†ä¸€ä¸ªä½ç½®ï¼›äºŒæ˜¯æœ€åä¸€ä¸ªcellåªæœ‰å‡ºç°åŠ¨ç”»ï¼Œæ²¡æœ‰æ¶ˆå¤±åŠ¨ç”»ï¼Œæ•´ä¸ªè¿‡ç¨‹<code>å‡ºç°åŠ¨ç”»ä¼šå¤šä¸€ä¸ª</code>ï¼›ä¸‰æ˜¯æ’å…¥çš„cellçš„å‡ºç°åŠ¨ç”»æ˜¯é»˜è®¤æ˜¯alphaä»0åˆ°1çš„æ·¡å…¥æ•ˆæœã€‚</p>

<p>åœ¨ä»£ç ä¸­ï¼Œæƒ³è·å¾—ä¸€ä¸ªæ’å…¥çš„cellä»å°å˜å¤§çš„å‡ºç°æ•ˆæœå’Œå…¶å®ƒcellæ•´ä½“å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®çš„åŠ¨ç”»æ•ˆæœï¼Œå¯ä»¥å¦‚ä¸‹å®ç°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="n">insertIndexPathArr</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformMakeScale</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//è®¾ç½®ä¸ºå‰ä¸€ä¸ªitemçš„frame</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">currentFrameWithIndexPath</span><span class="p">(</span><span class="bp">NSIndexPath</span><span class="p">(</span><span class="nl">forRow</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nl">inSection</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">section</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>     <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">currentFrameWithIndexPath</span><span class="p">(</span><span class="bp">NSIndexPath</span><span class="p">(</span><span class="nl">forRow</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nl">inSection</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">section</span><span class="p">))</span>
</span><span class='line'>     <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œä¸ºäº†çœ‹åˆ°æ•ˆæœï¼Œæˆ‘åœ¨æ¨¡æ‹Ÿå™¨çš„Debugæ¨¡å¼ä¸‹å‹¾é€‰äº†Slow Animationsè°ƒæ…¢äº†åŠ¨ç”»:
<img src="http://ww3.sinaimg.cn/large/7746cd07jw1eyaa2ommv4g208j0frab5.gif" alt="" /></p>

<h4>åˆ é™¤åŠ¨ç”»ï¼š</h4>

<p>åœ¨ä¸Šé¢çš„ä½ç½®1æ’å…¥ä¸€ä¸ªcellåï¼Œcellçš„æ•°é‡å˜æˆäº†4ä¸ªï¼Œåˆ†åˆ«æ˜¯0ã€1ã€2ã€3ï¼Œå®ƒä»¬å¯¹åº”çš„indexPathä¸º(0,0)ã€(0,1)ã€(0,2)ã€(0,3)ã€‚å½“è¦åˆ é™¤ä½ç½®1çš„cellæ—¶ï¼Œä¸æ’å…¥ç±»ä¼¼ï¼Œç³»ç»Ÿé»˜è®¤ä¹Ÿä¼šæœ‰ä¸‰ä¸ªåŠ¨ç”»è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/large/7746cd07jw1eybbqnkm4cj20xo0dita5.jpg" alt="" /></p>

<p>å…¶ä¸­ï¼ŒåŠ¨ç”»è¿‡ç¨‹1æ˜¯åœ¨ä½ç½®1æ‰§è¡Œä¸€ä¸ªæ¶ˆå¤±åŠ¨ç”»ï¼›è¿‡ç¨‹2æ˜¯ä½ç½®1çš„å‡ºç°åŠ¨ç”»å’Œä½ç½®2çš„æ¶ˆå¤±åŠ¨ç”»é‡åˆè€Œæˆï¼›è¿‡ç¨‹3æ˜¯ä½ç½®2çš„å‡ºç°åŠ¨ç”»å’Œä½ç½®3çš„æ¶ˆå¤±åŠ¨ç”»é‡åˆè€Œæˆã€‚</p>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œä¸€æ˜¯ä¸æ’å…¥ä¸åŒï¼Œé‡åˆåçš„æ•ˆæœæ˜¯cellå‘å‰å¹³ç§»äº†ä¸€ä¸ªä½ç½®ï¼›äºŒæ˜¯æœ€åä¸€ä¸ªä½ç½®åªæœ‰æ¶ˆå¤±åŠ¨ç”»æ²¡æœ‰å‡ºç°åŠ¨ç”»ï¼Œæ•´ä¸ªè¿‡ç¨‹æ¶ˆå¤±åŠ¨ç”»æ•°ä¼šå¤šä¸€ä¸ªï¼›ä¸‰æ˜¯åˆ é™¤çš„cellçš„å‡ºç°åŠ¨ç”»é»˜è®¤æ˜¯ä»1åˆ°0çš„æ·¡å‡ºæ•ˆæœã€‚</p>

<p>åœ¨ä»£ç ä¸­ï¼Œå®ç°ä¸€ä¸ªä¸æ’å…¥ç›¸å¯¹åº”çš„åŠ¨ç”»ï¼Œå³åˆ é™¤çš„cellä»å¤§åˆ°å°çš„æ·¡å‡ºæ•ˆæœå’Œå…¶å®ƒcellæ•´ä½“å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®çš„æ•ˆæœï¼Œå¯ä»¥å¦‚ä¸‹å®ç°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">currentFrameWithIndexPath</span><span class="p">(</span><span class="bp">NSIndexPath</span><span class="p">(</span><span class="nl">forRow</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nl">inSection</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">section</span><span class="p">))</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="n">deleteIndexPathArr</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//è¿™é‡Œå†™æˆç¼©æ”¾æˆ(0ï¼Œ0)ç›´æ¥å°±ä¸è§äº†</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformMakeScale</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">currentFrameWithIndexPath</span><span class="p">(</span><span class="bp">NSIndexPath</span><span class="p">(</span><span class="nl">forRow</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">row</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nl">inSection</span><span class="p">:</span> <span class="n">itemIndexPath</span><span class="p">.</span><span class="n">section</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww2.sinaimg.cn/large/7746cd07jw1eyaqorep4rg208j0g9wgw.gif" alt="" /></p>

<h4>åˆ·æ–°åŠ¨ç”»ï¼š</h4>

<p>åœ¨å®˜æ–¹çš„è§£é‡Šä¸­ï¼Œåˆ·æ–°æ˜¯å…ˆåˆ é™¤ç„¶åæ’å…¥ã€‚å…¶å®å®ƒå°±æ˜¯å…ˆæ‰§è¡Œæ‰€æœ‰cellçš„æ¶ˆå¤±åŠ¨ç”»ï¼›åœ¨æ­¤ä¹‹åï¼Œå®ƒåˆä¼šæ‰§è¡Œæ‰€æœ‰cellçš„å‡ºç°åŠ¨ç”»ã€‚
åœ¨ç³»ç»Ÿå½“ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤å‡ºç°åŠ¨ç”»æ˜¯ä¸€ä¸ªalphaä»0åˆ°1çš„æ·¡å…¥æ•ˆæœï¼Œè€Œæ¶ˆå¤±åŠ¨ç”»åˆ™æ˜¯alphaä»1åˆ°0çš„æ·¡å…¥æ•ˆæœï¼›ä¸æ’å…¥åŠ¨ç”»å’Œåˆ é™¤åŠ¨ç”»ä¸åŒçš„æ˜¯ï¼Œåˆ·æ–°åŠ¨ç”»ä¼šæˆå¯¹å­˜åœ¨ï¼Œå³æ¶ˆå¤±åŠ¨ç”»ä¸å‡ºç°åŠ¨ç”»æ•°é‡ç›¸ç­‰ã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œå®ç°ä¸€ä¸ªç‚¹å‡»æŸä¸ªcellæ—¶ï¼Œå½“å‰é€‰ä¸­çš„cellå˜å¤§çš„æ•ˆæœï¼Œè€Œå®ƒæ—è¾¹çš„cellè¢«æ¨å¼€çš„åŠ¨ç”»æ•ˆæœã€‚åœ¨è¿™é‡Œæˆ‘ä¸éœ€è¦æ·¡å…¥å’Œæ·¡å‡ºæ•ˆæœï¼Œæ‰€ä»¥ä¿®æ”¹äº†æ¶ˆå¤±æ—¶alphaä¸º1.0ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">lastFrameWithIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="c1">//æ³¨æ„ï¼Œè¿™é‡Œalphaè®¾ç½®ä¸ºä¸é€æ˜ï¼Œç³»ç»Ÿé»˜è®¤è¿”å›æ˜¯0ï¼Œå³ä¸€ä¸ªæ·¡å‡ºçš„æ•ˆæœ</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span class='line'>    <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">currentFrameWithIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww2.sinaimg.cn/large/7746cd07jw1eyb04xye32g208j0g9755.gif" alt="" /></p>

<h4>ç§»åŠ¨åŠ¨ç”»ï¼š</h4>

<p>ç§»åŠ¨ä¸€ä¸ªcellåˆ°å¦ä¸€ä¸ªä½ç½®æ—¶ï¼Œä¼šå¼•èµ·å½“å‰cellåˆ°ç›®æ ‡ä½ç½®ä¹‹é—´æ‰€æœ‰cellå¸ƒå±€å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—çš„åŠ¨ç”»ã€‚åœ¨è¿™ä¸ªåŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªindexPathéƒ½ä¼šæœ‰ä¸€ä¸ªå‡ºç°åŠ¨ç”»å’Œä¸€ä¸ªæ¶ˆå¤±åŠ¨ç”»ã€‚</p>

<p>ä¾‹å¦‚ï¼Œåœ¨ç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œ0ä½ç½®cellç§»åŠ¨åˆ°2ä½ç½®cellçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸‰ä¸ªåŠ¨ç”»è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/large/7746cd07jw1eyazemzgkzj20qa0bqt9u.jpg" alt="" /></p>

<p>ä½†æ˜¯ï¼Œå…¶å®å®ƒå†…éƒ¨æ‰§è¡Œäº†å…­ä¸ªåŠ¨ç”»ï¼Œåªæ˜¯å…¶ä¸­ä¸¤ä¸¤ä¹‹é—´åŠ¨ç”»é‡åˆäº†è€Œå·²ã€‚å…¶ä¸­åŠ¨ç”»è¿‡ç¨‹1æ˜¯1ä½ç½®çš„æ¶ˆå¤±åŠ¨ç”»å’Œ0ä½ç½®å‡ºç°åŠ¨ç”»é‡åˆï¼›åŠ¨ç”»è¿‡ç¨‹2æ˜¯0ä½ç½®çš„æ¶ˆå¤±åŠ¨ç”»å’Œ2ä½ç½®çš„å‡ºç°åŠ¨ç”»é‡åˆï¼›åŠ¨ç”»è¿‡ç¨‹3æ˜¯2ä½ç½®çš„æ¶ˆå¤±åŠ¨ç”»å’Œ1ä½ç½®çš„å‡ºç°åŠ¨ç”»é‡åˆã€‚</p>

<p><strong>å…¶ä¸­å€¼å¾—æ³¨æ„çš„æœ‰ä¸¤ç‚¹ï¼š</strong>   <br/>
1ã€æ¶ˆå¤±åŠ¨ç”»å’Œå‡ºç°åŠ¨ç”»æ•°é‡ç›¸ç­‰    <br/>
2ã€åŠ¨ç”»çš„é‡åˆä¸åˆ·æ–°åŠ¨ç”»ä¸åŒï¼Œä¸æ’å…¥å’Œåˆ é™¤åŠ¨ç”»ç±»ä¼¼ï¼Œå®ƒä»¬ä¸åŒä½ç½®ä¹‹é—´çš„æ¶ˆå¤±åŠ¨ç”»ä¸å‡ºç°åŠ¨ç”»é‡åˆã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œå®ç°ä¸€ä¸ªç§»åŠ¨cellæ—¶æ—‹è½¬180Â°åˆ°ç›®æ ‡ä½ç½®æ•ˆæœï¼Œå®ç°å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'> <span class="kr">override</span> <span class="k">func</span> <span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">initialLayoutAttributesForAppearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">itemIndexPath</span> <span class="o">==</span> <span class="nb">self</span><span class="p">.</span><span class="n">afterMoveIndexPath</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//afterMoveIndexPathçš„æ¶ˆå¤±åŠ¨ç”»å’ŒbeforeMoveIndexPathçš„å‡ºç°åŠ¨ç”»é‡åˆ</span>
</span><span class='line'>        <span class="c1">//initæ˜¯è®¾ç½®èµ·ç‚¹ï¼Œè€Œfinalè®¾ç½®ç»ˆç‚¹ï¼Œç†è®ºæ˜¯ä¸é‡åˆçš„</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">transform3D</span> <span class="o">=</span> <span class="n">CATransform3DMakeRotation</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">CGFloat</span><span class="p">(</span><span class="n">M_PI</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="nl">itemIndexPath</span><span class="p">:</span> <span class="bp">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UICollectionViewLayoutAttributes</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">attributes</span> <span class="o">=</span> <span class="nb">super</span><span class="p">.</span><span class="n">finalLayoutAttributesForDisappearingItemAtIndexPath</span><span class="p">(</span><span class="n">itemIndexPath</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="k">copy</span><span class="p">()</span> <span class="kt">as</span><span class="o">?</span> <span class="bp">UICollectionViewLayoutAttributes</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">self</span><span class="p">.</span><span class="n">beforeMoveIndexPath</span> <span class="o">==</span> <span class="n">itemIndexPath</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//afterMoveIndexPathçš„æ¶ˆå¤±åŠ¨ç”»å’ŒbeforeMoveIndexPathçš„å‡ºç°åŠ¨ç”»é‡åˆï¼Œè®¾ç½®ä»–ä»¬æ—‹è½¬çš„è§’åº¦ä¸€æ ·ï¼Œæ–¹å‘ç›¸å</span>
</span><span class='line'>        <span class="n">attributes</span><span class="o">?</span><span class="p">.</span><span class="n">transform3D</span> <span class="o">=</span> <span class="n">CATransform3DMakeRotation</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">CGFloat</span><span class="p">(</span><span class="n">M_PI</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww1.sinaimg.cn/large/7746cd07jw1eyb0375fz7g208j0g9go4.gif" alt="" /></p>

<p>ä¸Šé¢éƒ½æ˜¯çº¯é¢œè‰²ï¼Œåœ¨ç¤ºä¾‹å·¥ç¨‹<a href="https://github.com/liuchungui/UICollectionViewAnimationDemo">UICollectionViewAnimationDemo</a>ä¸­ï¼Œæˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªå›¾ç‰‡çš„<code>BGSimpleImageSelectCollectionViewDemo2</code>ã€‚å¸ƒå±€åŸºæœ¬ä¸Šç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å›¾ç‰‡å› ä¸ºä¸Šä¸‹ä¸å¯ä»¥å€’è½¬ï¼Œæ²¡åŠæ³•åšåˆ°ç»Ÿä¸€çš„æ—‹è½¬180Â°ã€‚</p>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/large/7746cd07jw1eybewu3qyxg208j0g9k2r.gif" alt="" /></p>

<h2>æ€»ç»“ï¼š</h2>

<p>1ã€CollectionViewæ›´æ–°æ—¶ï¼Œæ‰§è¡ŒåŠ¨ç”»çš„æ—¶å€™ä¼šè®¿é—®layoutä¸­å“ªäº›apiï¼Œæ•´ä¸ªæµç¨‹æ˜¯å¦‚ä½•å½¢æˆçš„        <br/>
2ã€ä¿®æ”¹CollectionViewåŠ¨ç”»å°±æ˜¯ä¿®æ”¹å‡ºç°åŠ¨ç”»çš„èµ·ç‚¹å’Œæ¶ˆå¤±åŠ¨ç”»çš„ç»ˆç‚¹ï¼Œå³layoutå½“ä¸­çš„initialLayoutAttributesForAppearingItemAtIndexPathå’ŒfinalLayoutAttributesForDisappearingItemAtIndexPathæ–¹æ³•è¿›è¡Œä¿®æ”¹ã€‚     <br/>
3ã€æ’å…¥ã€åˆ é™¤ã€åˆ·æ–°ã€ç§»åŠ¨å†…éƒ¨æ‰§è¡Œå“ªäº›åŠ¨ç”»ï¼Œæˆ‘ä»¬å¦‚ä½•å»ä¿®æ”¹ã€‚</p>

<h2>å‚è€ƒï¼š</h2>

<p><a href="http://objccn.io/issue-12-5/">Collection View åŠ¨ç”»</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UICollectionViewä¹‹è‡ªå®šä¹‰Layout]]></title>
    <link href="http://www.liuchungui.com/blog/2015/11/06/uicollectionviewzhi-zi-ding-yi-layout/"/>
    <updated>2015-11-06T00:00:26+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/11/06/uicollectionviewzhi-zi-ding-yi-layout</id>
    <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„UICollectionViewFlowLayoutæ— æ³•å®ç°æˆ‘ä»¬çš„å¸ƒå±€æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘è‡ªå®šä¹‰layoutã€‚     <br/>
æ‰€ä»¥ï¼Œäº†è§£å¹¶å­¦ä¹ ä¸€ä¸‹è‡ªå®šä¹‰Layoutæ˜¯å¾ˆæœ‰å¿…è¦ã€‚    <br/>
å…¶å®å¯ä»¥åˆ†ä¸‰ä¸ªæ­¥éª¤ï¼š</p>

<ol>
<li>è¦†å†™prepareLayoutæ–¹æ³•ï¼Œå¹¶åœ¨é‡Œé¢äº‹å…ˆå°±è®¡ç®—å¥½å¿…è¦çš„å¸ƒå±€ä¿¡æ¯å¹¶å­˜å‚¨èµ·æ¥ã€‚</li>
<li>åŸºäºprepareLayoutæ–¹æ³•ä¸­çš„å¸ƒå±€ä¿¡æ¯ï¼Œä½¿ç”¨collectionViewContentSizeæ–¹æ³•è¿”å›UICollectionViewçš„å†…å®¹å°ºå¯¸ã€‚</li>
<li>ä½¿ç”¨layoutAttributesForElementsInRect:æ–¹æ³•è¿”å›æŒ‡å®šåŒºåŸŸcellã€Supplementary Viewå’ŒDecoration Viewçš„å¸ƒå±€å±æ€§ã€‚</li>
</ol>


<!-- more -->


<p>äº†è§£äº†è‡ªå®šä¹‰å¸ƒå±€çš„ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼Œæˆ‘ä»¬æ¥é€šè¿‡è‡ªå®šä¹‰å¸ƒå±€çš„æ–¹å¼ç”¨UICollectionViewå®ç°grideViewã€‚å½“ç„¶ï¼ŒgrideViewä½¿ç”¨<code>UICollectionViewFlowLayout</code>å°±å¯ä»¥è½»æ˜“å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯å­¦ä¹ äº†è§£ä¸€ä¸‹è‡ªå®šä¹‰å¸ƒå±€çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æ‹¿grideViewè¿™ä¸ªç»å¸¸ç”¨çš„æ¥ä½œä¸ºä¾‹å­ã€‚</p>

<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹<a href="https://github.com/liuchungui/BGCustomLayoutCollectionViewDemo">BGCustomLayoutCollectionViewDemo</a>ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªUICollectionViewLayoutçš„å­ç±»å¯¹è±¡<code>BGGrideLayout</code>ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰layoutå¯¹è±¡ã€‚</p>

<h3>åœ¨BGGrideLayouté‡Œé¢ï¼Œæˆ‘ä»¬é¦–å…ˆè¦†å†™prepareLayoutæ–¹æ³•ã€‚</h3>

<p>prepareLayoutæ˜¯ä¸“é—¨ç”¨æ¥å‡†å¤‡å¸ƒå±€çš„ï¼Œåœ¨<code>prepareLayout</code>æ–¹æ³•é‡Œé¢æˆ‘ä»¬å¯ä»¥äº‹å…ˆå°±è®¡ç®—åé¢è¦ç”¨åˆ°çš„å¸ƒå±€ä¿¡æ¯å¹¶å­˜å‚¨èµ·æ¥ï¼Œé˜²æ­¢åé¢æ–¹æ³•å¤šæ¬¡è®¡ç®—ï¼Œæé«˜æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤æ–¹æ³•å°±è®¡ç®—å¥½æ¯ä¸ªcellçš„å±æ€§ã€æ•´ä¸ªCollectionViewçš„å†…å®¹å°ºå¯¸ç­‰ç­‰ã€‚æ­¤æ–¹æ³•åœ¨å¸ƒå±€ä¹‹å‰ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹ååªæœ‰åœ¨è°ƒç”¨<code>invalidateLayout</code>ã€<code>shouldInvalidateLayoutForBoundsChange:</code>è¿”å›<code>YES</code>å’Œ<code>UICollectionViewåˆ·æ–°</code>çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ã€‚</p>

<p>è€Œåœ¨BGGrideLayoutçš„prepareLayoutæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç›®çš„ï¼š    <br/>
ä¸€æ˜¯è·å–å¯¹åº”indexPathçš„<code>UICollectionViewLayoutAttributes</code>å¯¹è±¡ï¼Œå¹¶å­˜å‚¨åˆ°äºŒç»´æ•°ç»„<code>layoutInfoArr</code>å½“ä¸­ï¼›   <br/>
äºŒæ˜¯è®¡ç®—å‡ºå†…å®¹å°ºå¯¸å¹¶ä¿å­˜åˆ°å…¨å±€å˜é‡<code>contentSize</code>å½“ä¸­ã€‚     <br/>
ä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">prepareLayout</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">super</span> <span class="n">prepareLayout</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">layoutInfoArr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSInteger</span> <span class="n">maxNumberOfItems</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//è·å–å¸ƒå±€ä¿¡æ¯</span>
</span><span class='line'>    <span class="bp">NSInteger</span> <span class="n">numberOfSections</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="n">numberOfSections</span><span class="p">];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="bp">NSInteger</span> <span class="n">section</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">section</span> <span class="o">&lt;</span> <span class="n">numberOfSections</span><span class="p">;</span> <span class="n">section</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="bp">NSInteger</span> <span class="n">numberOfItems</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">numberOfItemsInSection</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">subArr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithCapacity</span><span class="p">:</span><span class="n">numberOfItems</span><span class="p">];</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="bp">NSInteger</span> <span class="n">item</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">item</span> <span class="o">&lt;</span> <span class="n">numberOfItems</span><span class="p">;</span> <span class="n">item</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>            <span class="bp">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSIndexPath</span> <span class="nl">indexPathForItem</span><span class="p">:</span><span class="n">item</span> <span class="nl">inSection</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>            <span class="bp">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">layoutAttributesForItemAtIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">subArr</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">attributes</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">maxNumberOfItems</span> <span class="o">&lt;</span> <span class="n">numberOfItems</span><span class="p">){</span>
</span><span class='line'>            <span class="n">maxNumberOfItems</span> <span class="o">=</span> <span class="n">numberOfItems</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">//æ·»åŠ åˆ°äºŒç»´æ•°ç»„</span>
</span><span class='line'>        <span class="p">[</span><span class="n">layoutInfoArr</span> <span class="nl">addObject</span><span class="p">:[</span><span class="n">subArr</span> <span class="k">copy</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//å­˜å‚¨å¸ƒå±€ä¿¡æ¯</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">layoutInfoArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">layoutInfoArr</span> <span class="k">copy</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//ä¿å­˜å†…å®¹å°ºå¯¸</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">maxNumberOfItems</span><span class="o">*</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">width</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">)</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">,</span> <span class="n">numberOfSections</span><span class="o">*</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">height</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">)</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†<code>UICollectionViewLayoutAttributes</code>è¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»å…¶å®ä¸“é—¨ç”¨æ¥å­˜å‚¨è§†å›¾çš„å†…å®¹ï¼Œä¾‹å¦‚frameã€sizeã€aphaã€hidenç­‰ç­‰ï¼Œlayoutæœ€åä¼šæ‹¿ç€è¿™äº›frameè®¾ç½®ç»™å¯¹åº”çš„è§†å›¾ã€‚
è€Œä¸Šé¢ä»£ç ä¸­ï¼Œè·å–<code>UICollectionViewLayoutAttributes</code>æ˜¯é€šè¿‡<code>layoutAttributesForItemAtIndexPath:</code>æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForItemAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>    <span class="bp">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UICollectionViewLayoutAttributes</span> <span class="nl">layoutAttributesForCellWithIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//æ¯ä¸€ç»„cellä¸ºä¸€è¡Œ</span>
</span><span class='line'>    <span class="n">attributes</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">((</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">width</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">)</span><span class="o">*</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">,</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">height</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">)</span><span class="o">*</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">attributes</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œ<code>itemSize</code>æ˜¯cellçš„å¤§å°ï¼Œ<code>interitemSpacing</code>æ˜¯cellä¸cellä¹‹é—´çš„é—´è·ï¼Œ<code>lineSpacing</code>æ˜¯è¡Œè·ã€‚</p>

<h3>éšåï¼Œè¦†å†™collectionViewContentSize</h3>

<p>collectionViewContentSizeè¿”å›å†…å®¹å°ºå¯¸ç»™UICollectionViewã€‚æ³¨æ„è¿™ä¸ªæ–¹æ³•è¿”å›çš„å°ºå¯¸æ˜¯ç»™UICollectionViewè¿™ä¸ªç»§æ‰¿äº<code>UIScrollView</code>çš„è§†å›¾ä½œä¸º<code>contentSize</code>ï¼Œä¸æ˜¯UICollectionViewçš„è§†å›¾å°ºå¯¸ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰layoutå¦‚æœæƒ³è®©å®ƒåªèƒ½æ¨ªå‘æ»‘åŠ¨ï¼Œåªéœ€è¦å°†è¿™ä¸ª<code>size.height</code>è®¾ç½®æˆ<code>collectionView.height</code>å°±è¡Œäº†ã€‚
è¿™ä¸ªæ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯åœ¨prepareLayouté‡Œå°±è®¡ç®—å¥½ã€‚
åœ¨BGGrideLayoutç±»ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è¿”å›å‰é¢è®¡ç®—å¥½çš„å†…å®¹å°ºå¯¸å°±è¡Œäº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span><span class="nf">collectionViewContentSize</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">contentSize</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æœ€åï¼Œè¦†å†™layoutAttributesForElementsInRect:æ–¹æ³•</h3>

<p>æ­¤æ–¹æ³•éœ€è¦è¿”å›ä¸€ç»„UICollectionViewLayoutAttributesç±»å‹å¯¹è±¡ã€‚å®ƒä»£è¡¨ç€åœ¨è¿™ä¸ªæŒ‡å®šçš„åŒºåŸŸä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤º<code>cell</code>ã€<code>Supplementary View</code>å’Œ<code>Decoration View</code>ä¸­å“ªäº›è§†å›¾ï¼Œè€Œè¿™äº›è§†å›¾çš„å±æ€§åˆ™ä¿å­˜UICollectionViewLayoutAttributesä¸­ã€‚
æ­¤æ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨ï¼Œä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„UICollectionViewLayoutAttributesæœ€å¥½æ˜¯åœ¨prepareLayoutå·²ç»å¸ƒå±€å¥½çš„ä¿¡æ¯ã€‚</p>

<p>åœ¨BGGrideLayoutä¸­ï¼Œæˆ‘ä»¬éå†äºŒç»´æ•°ç»„ï¼Œæ‰¾å‡ºäº†ä¸æŒ‡å®šåŒºåŸŸæœ‰äº¤æ¥çš„UICollectionViewLayoutAttributeså¯¹è±¡æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç„¶åè¿”å›ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForElementsInRect:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">rect</span><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">layoutAttributesArr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">layoutInfoArr</span> <span class="nl">enumerateObjectsUsingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="bp">NSUInteger</span> <span class="n">i</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">array</span> <span class="nl">enumerateObjectsUsingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="bp">NSUInteger</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="n">CGRectIntersectsRect</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="p">[</span><span class="n">layoutAttributesArr</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">obj</span><span class="p">];</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">layoutAttributesArr</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„BGGrideLayoutå·²ç»å†™å¥½äº†ï¼Œä½¿ç”¨éƒ¨åˆ†çš„ä»£ç ï¼Œè¯·ç›´æ¥æŸ¥çœ‹<a href="https://github.com/liuchungui/BGCustomLayoutCollectionViewDemo">BGCustomLayoutCollectionViewDemo</a>ä¸­ViewControlleré‡Œé¢çš„ä»£ç å°±è¡Œäº†ã€‚</p>

<p>æ•ˆæœï¼š</p>

<p><img src="http://ww4.sinaimg.cn/large/7746cd07jw1exqk0a7ofyg208j0fr7wh.gif" alt="Demo" /></p>

<h2>å‚è€ƒ</h2>

<p><a href="https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/CollectionViewPGforIOS/Introduction/Introduction.html">Collection View Programming Guide for iOS</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UICollectionViewä¹‹ä»‹ç»ä½¿ç”¨ç¯‡]]></title>
    <link href="http://www.liuchungui.com/blog/2015/11/02/uicollectionviewzhi-jie-shao-shi-yong-pian/"/>
    <updated>2015-11-02T00:29:12+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/11/02/uicollectionviewzhi-jie-shao-shi-yong-pian</id>
    <content type="html"><![CDATA[<p>å®ç°å‚ç›´æ–¹å‘çš„å•åˆ—è¡¨æ¥è¯´ï¼Œä½¿ç”¨UITableViewè¶³ä»¥ï¼›è‹¥æ˜¯éœ€è¦æ„å»ºæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨ã€gridViewç­‰ç›´çº¿å‹å¸ƒå±€ï¼Œåˆ™ä½¿ç”¨UICollectionView+UICollectionViewFlowLayoutæ­å»ºæœ€åˆé€‚ï¼›æ›´å¤æ‚çš„å¸ƒå±€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨UICollectionView+è‡ªå®šä¹‰Layoutæ¥å®ç°ã€‚</p>

<p>è€Œè¿™ç¯‡åšå®¢å°±æ¥ä»‹ç»ä¸€ä¸‹UICollectionViewã€‚</p>

<p>é¦–å…ˆï¼Œæ¥äº†è§£ä¸€ä¸‹UICollectionViewå·¥ä½œæµç¨‹ï¼š</p>

<p><img src="http://ww3.sinaimg.cn/large/7746cd07jw1exjnjqrju5j20x00qk76h.jpg" alt="" /></p>

<p>å½“UICollectionViewæ˜¾ç¤ºå†…å®¹æ—¶ï¼Œå…ˆä»æ•°æ®æºè·å–cellï¼Œç„¶åäº¤ç»™UICollectionViewã€‚å†ä»UICollectionViewLayoutè·å–å¯¹åº”çš„layout attributes(å¸ƒå±€å±æ€§)ã€‚æœ€åï¼Œæ ¹æ®æ¯ä¸ªcellå¯¹åº”çš„layout attributes(å¸ƒå±€å±æ€§)æ¥å¯¹cellè¿›è¡Œå¸ƒå±€ï¼Œç”Ÿæˆäº†æœ€ç»ˆçš„ç•Œé¢ã€‚è€Œç”¨æˆ·äº¤äº’çš„æ—¶å€™ï¼Œéƒ½æ˜¯é€šè¿‡Delegateæ¥è¿›è¡Œäº¤äº’ã€‚å½“ç„¶ï¼Œä¸Šé¢åªæ˜¯å¸ƒå±€cellï¼Œä½†æ˜¯UICollectionViewå†…éƒ¨è¿˜æœ‰Supplementary Viewå’ŒDecoration Viewï¼Œä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œå¸ƒå±€ã€‚</p>

<p>ä¸Šé¢ï¼Œæˆ‘ä»¬äº†è§£äº†UICollectionViewçš„å·¥ä½œæµç¨‹ï¼Œæˆ‘ä»¬å°†UICollectionViewåˆ†æˆè§†å›¾ã€æ•°æ®æºå’Œä»£ç†æ–¹æ³•ã€UICollectionViewLayoutä¸‰å—æ¥ä»‹ç»ã€‚</p>

<!-- more -->


<h2>ä¸€ã€è§†å›¾</h2>

<p>UICollectionViewä¸Šé¢æ˜¾ç¤ºå†…å®¹çš„è§†å›¾æœ‰ä¸‰ç§Cellè§†å›¾ã€Supplementary Viewå’ŒDecoration Viewã€‚</p>

<h4>Cellè§†å›¾</h4>

<p>CollectionViewä¸­ä¸»è¦çš„å†…å®¹éƒ½æ˜¯ç”±å®ƒå±•ç¤ºçš„ï¼Œå®ƒæ˜¯ä»æ•°æ®æºå¯¹è±¡è·å–çš„ã€‚</p>

<h4>Supplementary View</h4>

<p>å®ƒå±•ç¤ºäº†æ¯ä¸€ç»„å½“ä¸­çš„ä¿¡æ¯ï¼Œä¸cellç±»ä¼¼ï¼Œå®ƒæ˜¯ä»æ•°æ®æºæ–¹æ³•å½“ä¸­è·å–çš„ï¼Œä½†æ˜¯ä¸cellä¸åŒçš„æ˜¯ï¼Œå®ƒå¹¶ä¸æ˜¯å¼ºåˆ¶éœ€è¦çš„ã€‚ä¾‹å¦‚flow layoutå½“ä¸­çš„headerså’Œfooterså°±æ˜¯å¯é€‰çš„Supplementary Viewã€‚</p>

<h4>Decoration View</h4>

<p>è¿™ä¸ªè§†å›¾æ˜¯ä¸€ä¸ªè£…é¥°è§†å›¾ï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆåŠŸèƒ½æ€§ï¼Œå®ƒä¸è·Ÿæ•°æ®æºæœ‰ä»»ä½•å…³ç³»ï¼Œå®ƒå®Œå…¨å±äºlayoutå¯¹è±¡ã€‚</p>

<h2>äºŒã€æ•°æ®æºå’Œä»£ç†æ–¹æ³•</h2>

<h4>1ã€æ³¨å†Œcellæˆ–è€…Supplementary Viewä½¿å…¶é‡ç”¨</h4>

<p>åœ¨ä½¿ç”¨æ•°æ®æºè¿”å›cellæˆ–è€…Supplementary Viewç»™collectionViewä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆè¦æ³¨å†Œï¼Œç”¨æ¥è¿›è¡Œé‡ç”¨ã€‚</p>

<ul>
<li>registerClass: forCellWithReuseIdentifier:</li>
<li>registerNib: forCellWithReuseIdentifier:</li>
<li>registerClass: forSupplementaryViewOfKind: withReuseIdentifier:</li>
<li>registerNib: forSupplementaryViewOfKind: withReuseIdentifier:</li>
</ul>


<p> æ˜¾è€Œæ˜“è§ï¼Œå‰é¢ä¸¤ä¸ªæ–¹æ³•æ˜¯æ³¨å†Œcellï¼Œåä¸¤ä¸ªæ–¹æ³•æ³¨å†ŒSupplementary Viewã€‚å…¶ä¸­ï¼Œæ³¨å†Œçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥æ³¨å†Œclassï¼Œå®ƒé‡ç”¨çš„æ—¶å€™ä¼šè°ƒç”¨[[UICollectionView alloc] init]è¿™æ ·çš„åˆå§‹åŒ–æ–¹æ³•åˆ›å»ºcellï¼›å¦å¤–ä¸€ç§æ˜¯æ³¨å†Œnibï¼Œå®ƒä¼šè‡ªåŠ¨åŠ è½½nibæ–‡ä»¶ã€‚</p>

<p> æ³¨å†Œçš„ä¹‹åï¼Œæˆ‘ä»¬å¦‚ä½•é‡ç”¨ï¼Ÿ       <br/>
 åœ¨æ•°æ®æºæ–¹æ³•å½“ä¸­è¿”å›<code>cell</code>æˆ–è€…<code>Supplementary view</code>çš„æ–¹æ³•å½“ä¸­é€šè¿‡<code>dequeueReusableCellWithReuseIdentifier:forIndexPath:</code> æˆ–è€… <code>dequeueReusableSupplementaryViewOfKind:withReuseIdentifier:forIndexPath:</code>æ–¹æ³•è·å–cellæˆ–è€…Supplementary Viewã€‚</p>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">UICollectionViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">collectionView:</span><span class="p">(</span><span class="bp">UICollectionView</span> <span class="o">*</span><span class="p">)</span><span class="nv">collectionView</span> <span class="nf">cellForItemAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>    <span class="n">CollectionViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">(</span><span class="n">CollectionViewCell</span> <span class="o">*</span><span class="p">)[</span><span class="n">collectionView</span> <span class="nl">dequeueReusableCellWithReuseIdentifier</span><span class="p">:</span><span class="n">CellReuseIdentify</span> <span class="nl">forIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">lightGrayColor</span><span class="p">];</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;(%zd,%zd)&quot;</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">,</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>2ã€æ•°æ®æºæ–¹æ³•</h4>

<p> æ•°æ®æºæ–¹æ³•ä¸UITableViewç±»ä¼¼ï¼Œä¸»è¦æœ‰ï¼š</p>

<ul>
<li>numberOfSectionsInCollectionView:</li>
<li>collectionView: numberOfItemsInSection:</li>
<li>collectionView: cellForItemAtIndexPath:</li>
<li>collectionView: viewForSupplementaryElementOfKind: atIndexPath:</li>
</ul>


<p>ä¸UITableViewä¸åŒçš„æ˜¯å¤šåŠ äº†è¿”å›Supplementary viewæ•°æ®æºæ–¹æ³•ã€‚</p>

<h4>3ã€ä»£ç†æ–¹æ³•</h4>

<p>æ•°æ®æºä¸ºUICollectionViewæä¾›æ•°æ®ç›¸å…³çš„å†…å®¹ï¼Œè€Œä»£ç†åˆ™ä¸»è¦è´Ÿè´£ç”¨æˆ·äº¤äº’ã€ä¸æ•°æ®æ— å…³çš„è§†å›¾å¤–å½¢ã€‚ä¸»è¦åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p>

<p>1ã€é€šè¿‡è°ƒç”¨ä»£ç†æ–¹æ³•ï¼Œç®¡ç†è§†å›¾çš„é€‰ä¸­ã€é«˜äº®</p>

<ul>
<li>collectionView:shouldDeselectItemAtIndexPath:</li>
<li>collectionView:didSelectItemAtIndexPath:</li>
<li>collectionView:didDeselectItemAtIndexPath:</li>
<li>collectionView:shouldHighlightItemAtIndexPath:</li>
<li>collectionView:didHighlightItemAtIndexPath:</li>
<li>collectionView:didUnhighlightItemAtIndexPath:</li>
</ul>


<p> 2ã€é•¿æŒ‰cellï¼Œæ˜¾ç¤ºç¼–è¾‘èœå•
 ä¸UITableViewä¸åŒï¼Œç”¨æˆ·é•¿æŒ‰cellæ—¶ï¼ŒUICollectionViewå¯ä»¥æ˜¾ç¤ºç¼–è¾‘èœå•ã€‚è¿™ä¸ªç¼–è¾‘èœå•å¯ä»¥ç”¨æ¥å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´cellã€‚ä¸è¿‡ï¼Œè¦æ˜¾ç¤ºè¿™ä¸ªç¼–è¾‘èœå•éœ€è¦æ»¡è¶³ä¸‹é¢å‡ ä¸ªæ¡ä»¶ï¼š</p>

<ul>
<li>ä»£ç†å¯¹è±¡å¿…é¡»å®ç°ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼š     <br/>
<code>collectionView:shouldShowMenuForItemAtIndexPath:</code>   <code>collectionView:canPerformAction:forItemAtIndexPath:withSender:</code>   <code>collectionView:performAction:forItemAtIndexPath:withSender:</code></li>
<li>å¯¹äºæŒ‡å®šè¦ç¼–è¾‘çš„cellï¼Œ<code>collectionView:shouldShowMenuForItemAtIndexPath:</code>æ–¹æ³•éœ€è¦è¿”å›<code>YES</code></li>
<li><p><code>collectionView:canPerformAction:forItemAtIndexPath:withSender:</code> æ–¹æ³•ä¸­ï¼Œå¯¹äºå‰ªåˆ‡ã€å¤åˆ¶ã€ç²˜è´´ä¸‰ç§actionè‡³å°‘æœ‰ä¸€ä¸ªè¿”å›YESã€‚å…¶å®ï¼Œç¼–è¾‘èœå•æ˜¯æœ‰å¾ˆå¤šç§actionçš„ï¼Œä½†æ˜¯å¯¹äºUICollectionViewæ¥è¯´ï¼Œå®ƒä»…ä»…æ”¯æŒçš„å‰ªåˆ‡ã€å¤åˆ¶ã€ç²˜è´´ä¸‰ä¸ªï¼Œæ‰€ä»¥è¯´è¿™ä¸ªä»£ç†æ–¹æ³•è‡³å°‘æ”¯æŒè¿™ä¸‰ç§çš„ä¸€ç§ã€‚  <br/>
å‰ªåˆ‡ã€å¤åˆ¶ã€ç²˜è´´çš„æ–¹æ³•åæ˜¯ï¼š   <br/>
<code>cut:</code>   <br/>
<code>copy:</code>   <br/>
<code>paste:</code></p>

<p>å½“ä¸Šé¢çš„æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œç”¨æˆ·å°±å¯ä»¥é•¿æŒ‰cellæ˜¾ç¤ºå‡ºç¼–è¾‘èœå•ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„actionï¼Œä»è€Œå°±ä¼šå›è°ƒdelegateçš„collectionView:performAction:forItemAtIndexPath:withSender: æ–¹æ³•å»åšå¯¹åº”çš„äº‹æƒ…ã€‚</p></li>
</ul>


<p>å½“æˆ‘ä»¬æƒ³æ§åˆ¶ç¼–è¾‘èœå•ä»…ä»…æ˜¾ç¤ºå¤åˆ¶å’Œç²˜è´´æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>collectionView:canPerformAction:forItemAtIndexPath:withSender:</code>æ–¹æ³•ä¸­è¿›è¡Œæ“ä½œï¼Œå…·ä½“è¯·è§ä¸‹é¢ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">collectionView:</span><span class="p">(</span><span class="bp">UICollectionView</span> <span class="o">*</span><span class="p">)</span><span class="nv">collectionView</span> <span class="nf">canPerformAction:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">action</span> <span class="nf">forItemAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="nf">withSender:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([</span><span class="n">NSStringFromSelector</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;copy:&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="o">||</span> <span class="p">[</span><span class="n">NSStringFromSelector</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@&quot;paste:&quot;</span><span class="p">])</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ä¸‰ã€UICollectionViewLayout</h2>

<p><code>UICollectionViewLayout</code>æ˜¯é€šè¿‡<code>UICollectionViewLayoutAttributes</code>ç±»æ¥ç®¡ç†<code>cell</code>ã€<code>Supplementary View</code>å’Œ<code>Decoration View</code>çš„<code>ä½ç½®</code>ã€<code>transform</code>ã€<code>alpha</code>ã€<code>hidden</code>ç­‰ç­‰ã€‚   <br/>
UICollectionViewLayoutè¿™ä¸ªç±»åªæ˜¯ä¸€ä¸ªåŸºç±»ï¼Œæˆ‘ä»¬ç»™UICollectionViewä½¿ç”¨çš„éƒ½æ˜¯å®ƒçš„<code>å­ç±»</code>ã€‚ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæœ€å¸¸ç”¨çš„layoutä¸º<code>UICollectionViewFlowLayout</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒåˆ¶ä½œ<code>grid view</code>ã€‚å½“UICollectionViewLayoutæ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥<code>å­ç±»åŒ–UICollectionViewLayout</code>æˆ–è€…<code>è‡ªå®šä¹‰layout</code>ï¼Œè¿™ä¸ªå†…å®¹æ”¾åˆ°æˆ‘ä¸‹ä¸€ç¯‡å½“ä¸­ã€‚</p>

<h4>UICollectionViewFlowLayout</h4>

<p>ä½¿ç”¨UICollectionViewFlowLayoutä¹‹å‰ï¼Œæˆ‘ä»¬æ¥äº†è§£å®ƒå†…éƒ¨å¸¸ç”¨çš„å±æ€§ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//åŒä¸€ç»„å½“ä¸­ï¼Œå‚ç›´æ–¹å‘ï¼šè¡Œä¸è¡Œä¹‹é—´çš„é—´è·ï¼›æ°´å¹³æ–¹å‘ï¼šåˆ—ä¸åˆ—ä¹‹é—´çš„é—´è·</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">minimumLineSpacing</span><span class="p">;</span>
</span><span class='line'><span class="c1">//å‚ç›´æ–¹å‘ï¼šåŒä¸€è¡Œä¸­çš„cellä¹‹é—´çš„é—´è·ï¼›æ°´å¹³æ–¹å‘ï¼šåŒä¸€åˆ—ä¸­ï¼Œcellä¸cellä¹‹é—´çš„é—´è·</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">minimumInteritemSpacing</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ¯ä¸ªcellç»Ÿä¸€å°ºå¯¸</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">CGSize</span> <span class="n">itemSize</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ»‘åŠ¨åå‘ï¼Œé»˜è®¤æ»‘åŠ¨æ–¹å‘æ˜¯å‚ç›´æ–¹å‘æ»‘åŠ¨</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="n">UICollectionViewScrollDirection</span> <span class="n">scrollDirection</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ¯ä¸€ç»„å¤´è§†å›¾çš„å°ºå¯¸ã€‚å¦‚æœæ˜¯å‚ç›´æ–¹å‘æ»‘åŠ¨ï¼Œåˆ™åªæœ‰é«˜èµ·ä½œç”¨ï¼›å¦‚æœæ˜¯æ°´å¹³æ–¹å‘æ»‘åŠ¨ï¼Œåˆ™åªæœ‰å®½èµ·ä½œç”¨ã€‚</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">CGSize</span> <span class="n">headerReferenceSize</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ¯ä¸€ç»„å°¾éƒ¨è§†å›¾çš„å°ºå¯¸ã€‚å¦‚æœæ˜¯å‚ç›´æ–¹å‘æ»‘åŠ¨ï¼Œåˆ™åªæœ‰é«˜èµ·ä½œç”¨ï¼›å¦‚æœæ˜¯æ°´å¹³æ–¹å‘æ»‘åŠ¨ï¼Œåˆ™åªæœ‰å®½èµ·ä½œç”¨ã€‚</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">CGSize</span> <span class="n">footerReferenceSize</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ¯ä¸€ç»„çš„å†…å®¹ç¼©è¿›</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">UIEdgeInsets</span> <span class="n">sectionInset</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼šUICollectionViewFlowLayoutå†…éƒ¨çš„å±æ€§éƒ½æ˜¯ç”¨æ¥ç»Ÿä¸€è®¾ç½®ï¼Œè‹¥æ˜¯ç»Ÿä¸€è®¾ç½®æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥å®ç°<code>UICollectionViewDelegateFlowLayout</code>ä»£ç†æ–¹æ³•ï¼Œè¿›è¡Œå¯¹åº”çš„è®¾ç½®ã€‚è€Œåé¢å†…å®¹æˆ‘éƒ½ä»¥UICollectionViewFlowLayoutçš„å±æ€§æ¥å™è¿°ï¼Œè¯·è‡ªè¡Œå‚ç…§ä¿®æ”¹ã€‚</p>

<p>UICollectionViewFlowLayoutåœ¨çºµå‘æ»‘åŠ¨ä¸æ¨ªå‘æ»‘åŠ¨æ—¶ï¼Œå¸ƒå±€æ˜¯ä¸å¤ªä¸€æ ·çš„ã€‚</p>

<p align="center" >
  <img src="http://ww1.sinaimg.cn/large/7746cd07jw1exmpk8hs66j20ea0fcabe.jpg" width=257 height = 274>
  <img src="http://ww3.sinaimg.cn/large/7746cd07jw1exmq7ebjo2j20es0cujsp.jpg" width=266 height = 231>
</p>


<p>ç”±ä¸Šå›¾å°±å¯ä»¥çœ‹å‡ºæ¥ï¼ŒUICollectionViewFlowLayoutåœ¨å¸ƒå±€æ—¶ï¼Œä¼šæ ¹æ®scrollDirectionçš„å€¼ä¸åŒè€Œäº§ç”Ÿä¸åŒçš„å¸ƒå±€ã€‚</p>

<ul>
<li><p>å‚ç›´æ–¹å‘æ»‘åŠ¨ï¼š</p>

<ul>
<li>Cellå¸ƒå±€ï¼šUICollectionViewçš„å†…å®¹å®½åº¦ä¸æœ¬èº«è§†å›¾çš„å®½åº¦ç›¸ç­‰ï¼Œå¹¶ä¸”æ˜¯å›ºå®šçš„ã€‚ä¼šæ ¹æ®<code>sectionInsetå·¦å³ç¼©è¿›</code>ã€<code>itemSizeçš„å®½åº¦</code>ã€<code>minimumInteritemSpacing</code>ä¸‰ä¸ªå€¼æ¥è®¡ç®—æ¯ä¸€è¡Œcellæ•°é‡ã€‚   <br/>
å…·ä½“è®¡ç®—å…¬å¼æ˜¯:   <br/>
<code>  
cellCount = (CollectionViewContentWidth-sectionInset.left-sectionInset.right+minimumInteritemSpacing)/(itemSize.width+minimumInteritemSpacing)      
</code>
<code>CollectionViewContentWidth</code>æ˜¯UICollectionViewçš„å†…å®¹å®½åº¦ï¼Œè®¡ç®—å‡ºæ¥çš„<code>cellCount</code>è¿›è¡Œå››èˆäº”å…¥æˆä¸€ä¸ªæ•´æ•°å°±æ˜¯<code>æ¯ä¸€è¡Œcellçš„æ•°é‡</code>ã€‚  <br/>
è€Œæ¯ä¸ªcellä¹‹é—´å®é™…çš„é—´éš”å€¼åˆ™æ˜¯:  <br/>
<code>realInteritemSpacing = (CollectionViewContentWidth-sectionInset.left-sectionInset.right-cellCount*itemSize.width)/(cellCount-1)</code>  <br/>
å½“æ¯ä¸ªcellå¤§å°ç¡®å®šã€æ¯ä¸€è¡Œcellçš„ä¸ªæ•°ç¡®å®šã€æ¯ä¸ªcellä¹‹é—´çš„é—´è·ç¡®å®šä¹‹åï¼ŒUICollectionViewFlowLayoutå°±å¯ä»¥è®¡ç®—å‡ºæ¯ä¸€è¡Œcellçš„frameäº†ã€‚  <br/>
è€Œå¦‚æœåŒä¸€ç»„cellçš„ä¸ªæ•°ï¼Œåœ¨æ°´å¹³æ–¹å‘çš„ä¸€è¡Œæ”¾ä¸ä¸‹å»ï¼Œåˆ™å°±ä¼šæ”¾å…¥ç¬¬äºŒè¡Œï¼Œè€Œè¿™ç¬¬äºŒè¡Œçš„cellåœ¨å‚ç›´æ–¹å‘ä¸ç¬¬ä¸€è¡Œçš„cellç›¸éš”<code>minimumLineSpacing</code>ã€‚è¿™æ ·åˆç¡®å®šäº†è¡Œä¸è¡Œä¹‹é—´çš„é—´è·ï¼Œé‚£ä¹ˆè¿™ä¸€ç»„cellçš„å¸ƒå±€å°±å¯ä»¥ç¡®å®šäº†ã€‚</li>
<li>å¤´è§†å›¾ä¸å°¾éƒ¨è§†å›¾ï¼šæ ¹æ®headerReferenceSizeå’ŒfooterReferenceSizeä¸­çš„é«˜æ¥ç¡®å®šå¤´éƒ¨å’Œå°¾éƒ¨è§†å›¾çš„é«˜ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸¤ä¸ªä¸åŒç±»å‹çš„Supplementary Viewã€‚</li>
</ul>
</li>
<li><p>æ°´å¹³æ–¹å‘æ»‘åŠ¨ï¼š</p>

<ul>
<li>Cellå¸ƒå±€ï¼šæ°´å¹³æ–¹å‘çš„æ»‘åŠ¨å†…å®¹çš„é«˜ä¸æœ¬èº«è§†å›¾çš„é«˜æ˜¯ç›¸ç­‰çš„ï¼Œå¹¶ä¸”æ˜¯å›ºå®šçš„ã€‚å®ƒçš„cellæ˜¯ä»<code>ä¸Šåˆ°ä¸‹è¿›è¡Œå¸ƒå±€</code>çš„ã€‚ä¼šæ ¹æ®<code>sectionInsetä¸Šä¸‹ç¼©è¿›</code>ã€<code>itemSizeçš„é«˜åº¦</code>ã€<code>minimumInteritemSpacing</code>ä¸‰ä¸ªå€¼æ¥è®¡ç®—æ¯ä¸€åˆ—æ”¾å¤šå°‘ä¸ªcellï¼Œå…·ä½“è®¡ç®—å…¬å¼å¯ä»¥å‚ç…§å‚ç›´æ–¹å‘æ»‘åŠ¨çš„å…¬å¼ã€‚ä¹‹åçš„é€»è¾‘å’Œå‚ç›´æ–¹å‘æ»‘åŠ¨æ—¶ä¸€æ ·ï¼Œåªæ˜¯minimumLineSpacingç°åœ¨æ˜¯ä»£è¡¨åˆ—ä¸åˆ—ä¹‹é—´çš„é—´è·ã€‚</li>
<li>å¤´è§†å›¾ä¸å°¾éƒ¨è§†å›¾ï¼šæ ¹æ®headerReferenceSizeå’ŒfooterReferenceSizeä¸­çš„å®½æ¥ç¡®å®šå¤´éƒ¨å’Œå°¾éƒ¨è§†å›¾çš„å®½ã€‚</li>
</ul>
</li>
</ul>


<p>ç›¸å…³ä½¿ç”¨UICollectionViewFlowLayoutä»£ç :<a href="https://github.com/liuchungui/UICollectionViewDemo">UICollectionViewDemo</a></p>

<h2>å‚è€ƒ</h2>

<p><a href="https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/CollectionViewPGforIOS/Introduction/Introduction.html">Collection View Programming Guide for iOS</a>   <br/>
<a href="http://www.onevcat.com/2012/06/introducing-collection-views/">WWDC 2012 Sessionç¬”è®°â€”â€”205 Introducing Collection Views</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gitç®€å•æ€»ç»“]]></title>
    <link href="http://www.liuchungui.com/blog/2015/10/23/gitzong-jie/"/>
    <updated>2015-10-23T14:45:46+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/10/23/gitzong-jie</id>
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€æ˜¯æ­å»ºgitæœåŠ¡å™¨ï¼ŒäºŒæ˜¯gitå‘½ä»¤ï¼Œä¸»è¦æ˜¯è®°å½•äº†ä¸€ä¸‹æˆ‘æ­å»ºgitæœåŠ¡å™¨æµç¨‹å’Œç”¨åˆ°çš„ç›¸å…³å‘½ä»¤ã€‚</p>

<h2>ä¸€ã€Macç¯å¢ƒä¸‹æ­å»ºGitæœåŠ¡å™¨</h2>

<p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹Macç¯å¢ƒä¸‹é€šè¿‡git+sshæ­å»ºæœåŠ¡å™¨çš„æµç¨‹ã€‚</p>

<h4>1ã€æ‰“å¼€è¿œç¨‹ç™»é™†</h4>

<p>ç³»ç»Ÿåå¥½è®¾ç½® -> å…±äº« -> è¿œç¨‹ç™»é™†</p>

<h4>2ã€æ·»åŠ gitç”¨æˆ·</h4>

<p>è¿™ä¸€æ­¥ä¸åŠ ä¸Šä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½çš„ç®¡ç†å’Œå®‰å…¨ç€æƒ³ï¼Œæœ€å¥½åŠ ä¸Šä¸€ä¸ªgitç”¨æˆ·   <br/>
ç³»ç»Ÿåå¥½è®¾ç½® -> ç”¨æˆ·ä¸ç¾¤ç»„ -> æ·»åŠ åä¸ºgitçš„ç”¨æˆ·</p>

<h4>3ã€åˆå§‹åŒ–ä¸€ä¸ªç©ºä»“åº“</h4>

<p>åœ¨gitç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªreposæ–‡ä»¶å¤¹ä¸“é—¨ç”¨æ¥ç®¡ç†ä»“åº“</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir repos
</span><span class='line'>$ cd repos
</span><span class='line'># åˆå§‹åŒ–ä¸€ä¸ªç©ºä»“åº“
</span><span class='line'>$ git init --bare test.git</span></code></pre></td></tr></table></div></figure>


<h4>4ã€æ·»åŠ å¯†é’¥</h4>

<p>åœ¨gitæœåŠ¡ç«¯æ·»åŠ å®¢æˆ·ç«¯çš„å…¬é’¥åï¼Œä»¥ågitè®¿é—®ä¸éœ€è¦å¯†ç äº†ï¼Œä¸‹é¢æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„æ“ä½œã€‚    <br/>
å®¢æˆ·ç«¯ï¼š   <br/>
ä½¿ç”¨<code>ssh-keygen</code>å‘½ä»¤ç”Ÿæˆå¯†é’¥ï¼Œæ‰§è¡Œå®Œåä¼šç”Ÿæˆ<code>id_rsa</code>å’Œ<code>id_rsa.pub</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­<code>id_rsa</code>æ˜¯ç§é’¥ï¼Œ<code>id_rsa.pub</code>æ˜¯å…¬é’¥ã€‚å®¢æˆ·ç«¯å°†<code>id_rsa.pub</code>æ–‡ä»¶äº¤ç»™gitæœåŠ¡ç«¯å°±è¡Œäº†ã€‚       <br/>
æœåŠ¡ç«¯ï¼š       <br/>
å°†å®¢æˆ·ç«¯çš„<code>id_rsa.pub</code>ä¸­çš„å†…å®¹æ”¾åˆ°<code>/Users/git/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ã€‚ä¸»è¦ï¼Œå®¢æˆ·ç«¯æ¯ä¸ªå…¬é’¥å ç”¨ç‹¬ç«‹çš„ä¸€è¡Œï¼Œæœ‰æ—¶å¤åˆ¶ä¼šå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨<code>cat id_rsa.pub &gt;&gt; /Users/git/.ssh/authorized_keys</code>å‘½ä»¤ã€‚</p>

<!-- more -->


<h4>5ã€å®¢æˆ·ç«¯ä½¿ç”¨</h4>

<p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„gitæœåŠ¡ç¯å¢ƒå…¶å®å·²ç»æ­å»ºå¥½äº†ï¼Œä¸‹é¢æ¥ä½¿ç”¨ã€‚     <br/>
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æœåŠ¡ç«¯çš„ç”¨æˆ·å’Œgité¡¹ç›®çš„è·¯å¾„</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ whoami
</span><span class='line'>git
</span><span class='line'>$ pwd
</span><span class='line'>/Users/git/repos</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œç”¨æˆ·æ˜¯gitï¼Œè·¯å¾„æ˜¯<code>/Users/git/repos/test.git</code>     <br/>
ä¸‹é¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯cloneé¡¹ç›®äº†ã€‚è¿™é‡Œå› ä¸ºæˆ‘æ˜¯åœ¨æœ¬æœºæµ‹è¯•ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯localhostï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨<code>æœåŠ¡å™¨çš„ipæˆ–è€…åŸŸå</code>ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone user@localhost:/Users/user/repos/test.git
</span><span class='line'>Cloning into 'test'...
</span><span class='line'>warning: You appear to have cloned an empty repository.
</span><span class='line'>Checking connectivity... done.</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œå°±è¯´æ˜æœåŠ¡å™¨å·²ç»æ­å»ºå¥½äº†ã€‚</p>

<p>é‡åˆ°é—®é¢˜(è¿™é‡Œæ˜¯æˆ‘åœ¨linuxç³»ç»Ÿæ­å»ºæ—¶é‡åˆ°çš„é—®é¢˜)ï¼š  <br/>
<code>remote: error: insufficient permission for adding an object to repository database ./objects</code>   <br/>
æƒé™çš„é—®é¢˜ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨å¯¹åº”çš„ä»“åº“çš„çˆ¶æ–‡ä»¶å¤¹æ˜¯å¦å±äºgitç”¨æˆ·ï¼Œgitæ˜¯å¦æ‹¥æœ‰å¯å†™æƒé™</p>

<p><strong>linuxç³»ç»Ÿæ­å»ºgitæœåŠ¡å™¨ï¼Œè¯·å‚è€ƒ</strong><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000">æ­å»ºGitæœåŠ¡å™¨</a></p>

<h2>äºŒã€Gitå‘½ä»¤</h2>

<p>1ã€ä¸‹é¢æ˜¯gitæ“ä½œçš„ç®€å•æµç¨‹ï¼Œé‡Œé¢çš„å‘½ä»¤éƒ½æ˜¯ç»å¸¸ç”¨åˆ°çš„</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#å…‹éš†æŸä¸ªä»“åº“çš„ä»£ç 
</span><span class='line'>git clone https://github.com/chunguiLiu/TestLCGCocoapods.git
</span><span class='line'>#è¿›å…¥TestLCGCocoapodsï¼Œæ·»åŠ æ–‡ä»¶
</span><span class='line'>cd TestLCGCocoapods
</span><span class='line'>echo "test" &gt; test.txt
</span><span class='line'>git add test.txt
</span><span class='line'>#æäº¤æ–‡ä»¶ï¼Œå¹¶æ·»åŠ æ—¥å¿—ä¸º'add test.txt file'
</span><span class='line'>git commit -m 'add test.txt file'
</span><span class='line'>#æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨
</span><span class='line'>git push origin master
</span><span class='line'>#ä¿®æ”¹æ–‡ä»¶ï¼Œå¹¶æ¨é€åˆ°æœåŠ¡å™¨
</span><span class='line'>echo 'add test' &gt;&gt; test.txt
</span><span class='line'>git add -update
</span><span class='line'>git commit -m 'update file'
</span><span class='line'>git push origin master
</span><span class='line'>#æ‰“ä¸Šç‰ˆæœ¬å·ï¼Œå…¶ä¸­-må‚æ•°åé¢æ˜¯æ—¥å¿—ï¼Œ'0.1.0'æ˜¯ç‰ˆæœ¬å·
</span><span class='line'>git tag -m 'first tag' '0.1.0'
</span><span class='line'>#å°†ç‰ˆæœ¬å·æ¨é€åˆ°æœåŠ¡å™¨
</span><span class='line'>git push --tags</span></code></pre></td></tr></table></div></figure>


<p>2ã€åˆ†æ”¯æ˜¯gitä¸­ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™é‡Œåˆ—å‡ºæˆ‘æ›¾ç»ä½¿ç”¨è¿‡çš„ç›¸å…³åˆ†æ”¯å‘½ä»¤ï¼Œä¹Ÿè®¸ä½ ä¼šç”¨åˆ°ï¼Œæƒ³äº†è§£æ›´å¤šåˆ†æ”¯çš„çŸ¥è¯†è¯·è¿›å…¥<a href="http://www.open-open.com/lib/view/open1328069889514.html">Gitè¯¦è§£ä¹‹ä¸‰ Gitåˆ†æ”¯</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#åˆ›å»ºteståˆ†æ”¯
</span><span class='line'>git branch test
</span><span class='line'>#åˆ‡æ¢åˆ°teståˆ†æ”¯
</span><span class='line'>git checkout test
</span><span class='line'>#æ¯”è¾ƒmasterå’Œtestä¸¤ä¸ªåˆ†æ”¯
</span><span class='line'>git diff master test
</span><span class='line'>#æŸ¥çœ‹å½“å‰åˆ†æ”¯
</span><span class='line'>git branch
</span><span class='line'>#åˆ é™¤åˆ†æ”¯
</span><span class='line'>git branch -d test
</span><span class='line'>#åˆ é™¤è¿œç¨‹æœåŠ¡å™¨çš„åˆ†æ”¯
</span><span class='line'>git push --delete origin testBranch</span></code></pre></td></tr></table></div></figure>


<p>3ã€æŸ¥çœ‹gitæŸä¸ªç‰ˆæœ¬çš„å†…å®¹
å½“æˆ‘æ·»åŠ Cocoapodsç§æœ‰åº“çš„æ—¶å€™ï¼Œæƒ³æŸ¥çœ‹ä»podæŸä¸ªç‰ˆæœ¬ä¸‹æ¥çš„å†…å®¹ä¸æˆ‘å¯¹åº”ç‰ˆæœ¬å†…å®¹æ˜¯å¦ç›¸åŒï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘æ€ä¹ˆæ“ä½œgitï¼Ÿ   <br/>
å…¶å®ï¼Œgitå…‹éš†ä¸‹æ¥çš„å†…å®¹æ‹¥æœ‰æ‰€æœ‰ç‰ˆæœ¬å†…å®¹ï¼Œæˆ‘ä»¬å¦‚æœæƒ³æŸ¥çœ‹æŸä¸ªtagç‰ˆæœ¬çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨<code>git checkout tag-version</code>å‘½ä»¤ï¼Œå°†è¿™ä¸ªç‰ˆæœ¬å½“åšä¸€ä¸ªåˆ†æ”¯æ¥æŸ¥çœ‹ï¼Œåªæ˜¯è¿™ä¸ªæ—¶å€™å®ƒåªæ˜¯ä¸€ä¸ªå¿«ç…§ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹ä»£ç ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#è·³è½¬åˆ°0.0.1ç‰ˆæœ¬
</span><span class='line'>git checkout 0.0.1</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹è¿™ä¸ªç‰ˆæœ¬çš„å†…å®¹æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè¿™ä¸ªæ–°çš„åˆ†æ”¯æ˜¯ä»¥æŸä¸ªtagç‰ˆæœ¬ä¸ºå‡†ï¼Œå¯ä»¥åœ¨æ–°çš„åˆ†æ”¯ä¸‹ä¿®æ”¹ä»£ç </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ä»¥0.0.1ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªåˆ†æ”¯newBranch
</span><span class='line'>git checkout -b newBranch 0.0.1</span></code></pre></td></tr></table></div></figure>


<h2>å‚è€ƒï¼š</h2>

<p><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000">æ­å»ºGitæœåŠ¡å™¨</a>   <br/>
<a href="http://blog.jobbole.com/54184/">å¼€å‘è€…æ—¥å¸¸ä½¿ç”¨çš„ Git å‘½ä»¤</a>   <br/>
<a href="http://www.cnblogs.com/lee0oo0/archive/2013/06/28/3161829.html">GitåŸºæœ¬å‘½ä»¤è¡Œæ“ä½œ</a>   <br/>
<a href="http://www.cnblogs.com/winterIce/archive/2012/07/22/2603488.html">githubå¸¸ç”¨å‘½ä»¤</a>   <br/>
<a href="http://www.open-open.com/lib/view/open1328069889514.html">Gitè¯¦è§£ä¹‹ä¸‰ Gitåˆ†æ”¯</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Macç¯å¢ƒä¸‹Nginxå®ç°åå‘ä»£ç†]]></title>
    <link href="http://www.liuchungui.com/blog/2015/10/21/mhuan-jing-xia-nginxshi-xian-fan-xiang-dai-li/"/>
    <updated>2015-10-21T10:16:01+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/10/21/mhuan-jing-xia-nginxshi-xian-fan-xiang-dai-li</id>
    <content type="html"><![CDATA[<h2>1ã€å®‰è£…</h2>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºNginxç¯å¢ƒï¼Œæˆ‘è¿™é‡Œæ˜¯é€šè¿‡homebrewä¸€é”®å¼æ­å»ºï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š  <br/>
1ã€å®‰è£…homebrew</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></code></pre></td></tr></table></div></figure>


<p>ä»¥<a href="brew.sh">å®˜ç½‘homebrew</a>ä¸ºå‡†</p>

<p>2ã€å®‰è£…nginx</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install nginx</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥çœ‹Nginxå®‰è£…çš„ç‰ˆæœ¬</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nginx -v</span></code></pre></td></tr></table></div></figure>


<p>Nginxå¸¸ç”¨çš„å‘½ä»¤æœ‰</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#æŸ¥çœ‹ç‰ˆæœ¬ï¼Œä»¥åŠé…ç½®æ–‡ä»¶åœ°å€
</span><span class='line'>nginx -V
</span><span class='line'>#æŸ¥çœ‹ç‰ˆæœ¬ 
</span><span class='line'>nginx -v
</span><span class='line'>#æŒ‡å®šé…ç½®æ–‡ä»¶
</span><span class='line'>nginx -c filename
</span><span class='line'>#å¸®åŠ©
</span><span class='line'>nginx -h
</span><span class='line'>#é‡æ–°åŠ è½½é…ç½®|é‡å¯|åœæ­¢|é€€å‡º nginx
</span><span class='line'>nginx -s reload|reopen|stop|quit
</span><span class='line'>#æ‰“å¼€ nginx
</span><span class='line'>sudo nginx
</span><span class='line'>#æµ‹è¯•é…ç½®æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
</span><span class='line'>sudo nginx -t</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<h2>2ã€Nginxé…ç½®WEBæœåŠ¡å™¨</h2>

<p>ä½¿ç”¨Nginxåšåå‘ä»£ç†ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹Nginxä¸­httpæ¨¡å—çš„é…ç½®ã€‚</p>

<h4>ç¼–è¾‘Nginxé…ç½®æ–‡ä»¶</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /usr/local/etc/nginx/nginx.conf</span></code></pre></td></tr></table></div></figure>


<p>æ‰¾åˆ°httpæ¨¡å—ï¼Œä¿®æ”¹httpæ¨¡å—ä¸­çš„listenä¸º80ï¼Œå¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http {
</span><span class='line'>    #å¯¼å…¥ç±»å‹é…ç½®æ–‡ä»¶
</span><span class='line'>    include       mime.types;
</span><span class='line'>    #è®¾å®šé»˜è®¤ç±»å‹ä¸ºäºŒè¿›åˆ¶æµ
</span><span class='line'>    default_type  application/octet-stream;
</span><span class='line'>    #å¯ç”¨sendfile()å‡½æ•°
</span><span class='line'>    sendfile        on;
</span><span class='line'>    #å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´ä¸º65ç§’ï¼Œè¶…è¿‡65ç§’ï¼ŒæœåŠ¡å™¨å…³é—­è¿æ¥
</span><span class='line'>    keepalive_timeout  65;
</span><span class='line'>    #æ˜¯å¦å¼€å¯gzipï¼Œé»˜è®¤å…³é—­
</span><span class='line'>    #gzip  on;
</span><span class='line'>    #ä¸€ä¸ªserverå—
</span><span class='line'>    server {
</span><span class='line'>        #æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ä¸º80
</span><span class='line'>        listen       80;
</span><span class='line'>        #æœåŠ¡å™¨åç§°ä¸ºlocalhostï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡localhostæ¥è®¿é—®è¿™ä¸ªserverå—çš„æœåŠ¡
</span><span class='line'>        server_name  localhost;
</span><span class='line'>        #locationå—ï¼Œå®ƒå­˜æ”¾åœ¨serverå—å½“ä¸­ï¼Œlocationä¼šå°è¯•æ ¹æ®ç”¨æˆ·è¯·æ±‚ä¸­çš„URIæ¥åŒ¹é…ä¸Šé¢çš„/uriè¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥åŒ¹é…ï¼Œå°±é€‰æ‹©location {}å—ä¸­çš„é…ç½®æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚
</span><span class='line'>        location / {
</span><span class='line'>            #ä»¥rootæ–¹å¼è®¾ç½®èµ„æºè·¯å¾„ï¼Œå®ƒä¸aliasçš„ä¸åŒè¯·è§ä¸‹é¢çš„ httpæ¨¡å—ä¸­æ–‡ä»¶è·¯å¾„å®šä¹‰
</span><span class='line'>            root   html;
</span><span class='line'>            #é»˜è®¤è®¿é—®çš„é¡µé¢ï¼Œä»å·¦ä¾æ¬¡æ‰¾åˆ°å³ï¼Œç›´åˆ°æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿”å›ç»“æŸè¯·æ±‚
</span><span class='line'>            index  index.html index.htm;
</span><span class='line'>            #è®¾ç½®é”™è¯¯é¡µé¢ï¼Œå¯¹åº”çš„é”™è¯¯ç æ˜¯404ï¼Œé”™è¯¯é¡µé¢æ˜¯/Users/user/Sites/404.html
</span><span class='line'>            error_page 404  /404.html;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    include servers/*;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>httpæ¨¡å—ä¸­æ–‡ä»¶è·¯å¾„å®šä¹‰ï¼š</h4>

<p>1ã€ä»¥<strong>root</strong>æ–¹å¼è®¾ç½®èµ„æºè·¯å¾„  <br/>
è¯­æ³•: root path;  <br/>
é»˜è®¤: root html;  <br/>
é…ç½®å—: http, server, location, if   <br/>
ä¾‹å¦‚ï¼Œå®šä¹‰èµ„æºæ–‡ä»¶ç›¸å¯¹äºHTTPè¯·æ±‚çš„æ ¹ç›®å½•ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location /download/ {
</span><span class='line'>  root /opt/web/html;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¯·æ±‚çš„URIæ˜¯/download/index/test.htmlï¼Œé‚£ä¹ˆWebæœåŠ¡å™¨å°†ä¼šè¿”å›æœåŠ¡å™¨ä¸Š/opt/web/html/download/index/test.htmlæ–‡ä»¶çš„å†…å®¹ã€‚</p>

<p>2ã€ä»¥<strong>alias</strong>æ–¹å¼è®¾ç½®èµ„æºè·¯å¾„   <br/>
è¯­æ³•ï¼šalias path;   <br/>
é…ç½®å—ï¼šlocation     <br/>
aliasä¹Ÿæ˜¯ç”¨æ¥è®¾ç½®æ–‡ä»¶èµ„æºè·¯å¾„çš„ï¼Œå®ƒä¸rootçš„ä¸åŒç‚¹ä¸»è¦åœ¨äºå¦‚ä½•è§£è¯»ç´§è·Ÿlocationåé¢çš„uriå‚æ•°ï¼Œè¿™å°†ä¼šè‡´ä½¿aliasä¸rootä»¥ä¸åŒçš„æ–¹å¼å°†ç”¨æˆ·è¯·æ±‚æ˜ å°„åˆ°çœŸæ­£çš„ç£ç›˜æ–‡ä»¶ä¸Šã€‚  <br/>
ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¯·æ±‚çš„URIæ˜¯/conf/nginx.confï¼Œè€Œç”¨æˆ·å®é™…æƒ³è®¿é—®çš„æ–‡ä»¶åœ¨/usr/local/nginx/conf/nginx.confï¼Œé‚£ä¹ˆæƒ³è¦ä½¿ç”¨aliasæ¥è¿›è¡Œè®¾ç½®çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location /conf {
</span><span class='line'>  alias /usr/local/nginx/conf/;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœç”¨rootè®¾ç½®ï¼Œé‚£ä¹ˆè¯­å¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location /conf {
</span><span class='line'>  alias /usr/local/nginx/;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨aliasæ—¶ï¼Œåœ¨URIå‘å®é™…æ–‡ä»¶è·¯å¾„çš„æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œå·²ç»æŠŠlocationåé…ç½®çš„/confè¿™éƒ¨åˆ†å­—ç¬¦ä¸²ä¸¢å¼ƒæ‰ï¼Œå› æ­¤ï¼Œ/conf/nginx.confè¯·æ±‚å°†æ ¹æ®alias pathæ˜ å°„ä¸ºpath/nginx.confã€‚rootåˆ™ä¸ç„¶ï¼Œå®ƒä¼šæ ¹æ®å®Œæ•´çš„URIè¯·æ±‚æ¥æ˜ å°„ï¼Œå› æ­¤/conf/nginx.confè¯·æ±‚ä¼šæ ¹æ®root pathæ˜ å°„ä¸ºpath/conf/nginx.confã€‚è¿™ä¹Ÿæ˜¯rootå¯ä»¥æ”¾ç½®åˆ°httpã€serverã€locationæˆ–ifå—ä¸­ï¼Œè€Œaliasåªèƒ½æ”¾ç½®åˆ°locationå—ä¸­çš„åŸå› ã€‚  <br/>
aliasåé¢è¿˜å¯ä»¥æ·»åŠ æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>location ~ ^/test/(\w+)\.(\w+)$ {
</span><span class='line'>  alias /usr/local/nginx/$2/$1.$2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼Œè¯·æ±‚åœ¨è®¿é—®/test/nginx.confæ—¶ï¼ŒNginxä¼šè¿”å›/usr/local/nginx/conf/nginx.confæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p>

<h4>å¼€å¯Nginxçš„WebæœåŠ¡</h4>

<p>å¼€å¯NginxæœåŠ¡ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†ApacheæœåŠ¡ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦å…ˆå…³é—­ApacheæœåŠ¡</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#å¼€å¯Nginx
</span><span class='line'>$ sudo nginx</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨localhostæ¥è®¿é—®ï¼Œè‹¥æ˜¯å‡ºç°nginxæ¬¢è¿é¡µï¼Œè¯´æ˜æˆåŠŸã€‚</p>

<h2>3ã€ä½¿ç”¨Nginxåšåå‘ä»£ç†</h2>

<p>åå‘ä»£ç†ï¼ˆreverse proxyï¼‰æ–¹å¼æ˜¯æŒ‡ç”¨ä»£ç†æœåŠ¡å™¨æ¥æ¥å—Internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸­çš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¹¶å°†ä»ä¸Šæ¸¸æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™Internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–çš„è¡¨ç°å°±æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ã€‚   <br/>
è¿™é‡Œï¼Œæˆ‘æ˜¯åœ¨æœ¬æœºæ­å»ºï¼Œé€šè¿‡ä¿®æ”¹hostæ¥æ¨¡æ‹Ÿå¤šä¸ªåŸŸåè®¿é—®æœ¬æœºçš„nginxã€‚</p>

<h4>1ã€ä¿®æ”¹hostsæ–‡ä»¶</h4>

<p>$ vim /etc/hosts    <br/>
åœ¨å†…éƒ¨æ·»åŠ åŸŸåè§£æ</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>127.0.0.1 pinger.com www.pinger.com
</span><span class='line'>127.0.0.1 test.com www.test.com
</span><span class='line'>127.0.0.1 chungui.com www.chungui.com</span></code></pre></td></tr></table></div></figure>


<h4>2ã€ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</h4>

<p>$ sudo vim /usr/local/etc/nginx/nginx.conf    <br/>
åœ¨åé¢æ·»åŠ serveræ¨¡å—ï¼Œå†…éƒ¨é€šè¿‡<code>proxy_pass</code>è®¾ç½®åå‘ä»£ç†</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server {
</span><span class='line'>    listen  80;
</span><span class='line'>    server_name  *.pinger.com pinger.com;
</span><span class='line'>    location / {
</span><span class='line'>        proxy_pass http://www.baidu.com;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>server {
</span><span class='line'>    listen 80;
</span><span class='line'>    server_name *.chungui.com chungui.com;
</span><span class='line'>    location / {
</span><span class='line'>        proxy_pass http://www.renren.com;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>server {
</span><span class='line'>    listen 80;
</span><span class='line'>    server_name test.com;
</span><span class='line'>    location / {
</span><span class='line'>        proxy_pass http://www.zhihu.com;
</span><span class='line'>    }
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<p>å…¶ä¸­ï¼Œserver_nameå¯ä»¥æŒ‡å‘å¤šä¸ªåŸŸåå€¼</p>

<h4>3ã€é‡å¯nginxæœåŠ¡</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#é‡å¯æœåŠ¡
</span><span class='line'>$ sudo nginx -s reload</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ—¶ï¼Œåå‘ä»£ç†å·²ç»æ­å»ºæˆåŠŸã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡<code>chungui.com</code>è®¿é—®åˆ°äººäººç½‘ï¼Œ<code>test.com</code>è®¿é—®åˆ°çŸ¥ä¹ã€‚ä¸è¿‡ï¼Œè®¾ç½®<code>pinger.com</code>è®¿é—®çš„<code>http://www.baidu.com</code>ç«™ç‚¹ï¼Œè€Œç™¾åº¦æœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°<code>https://www.baidu.com</code>ç«™ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡<code>pinger.com</code>ä¼šè·³è½¬åˆ°<code>https://www.baidu.com</code>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å°†ç™¾åº¦çš„æ›¿æ¢æˆhttpså°±è¡Œäº†ï¼Œä¿®æ”¹é…ç½®å¦‚ä¸‹ï¼š</p>

<pre><code>server {
    listen       80;
    server_name  *.pinger.com pinger.com;
    location / {
        proxy_pass https://www.baidu.com;
    }
}
</code></pre>

<p>è¿™ä¸ªæ—¶å€™ï¼Œå†ä½¿ç”¨<code>pinger.com</code>åœ¨æµè§ˆå™¨é‡Œè®¿é—®æ—¶å°±ä¸ä¼šå‡ºç°è·³è½¬çš„é—®é¢˜äº†ã€‚</p>

<h2>å‚è€ƒ</h2>

<p><a href="http://manual.51yip.com/nginx/">Nginxä¸­æ–‡å‚è€ƒæ‰‹å†Œ,æ•™ç¨‹</a>    <br/>
<a href="http://blog.csdn.net/dracotianlong/article/details/21817097">mac å®‰è£… nginx ç¯å¢ƒ</a>   <br/>
<a href="http://segmentfault.com/a/1190000002963355">Mac OSä½¿ç”¨brewå®‰è£…Nginxã€MySQLã€PHP-FPMçš„LAMPå¼€å‘ç¯å¢ƒ</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CocoaPodsåˆ›å»ºç§æœ‰Pods]]></title>
    <link href="http://www.liuchungui.com/blog/2015/10/19/cocoapodschuang-jian-si-you-pods/"/>
    <updated>2015-10-19T21:54:54+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/10/19/cocoapodschuang-jian-si-you-pods</id>
    <content type="html"><![CDATA[<p>åˆ›å»ºPodç§æœ‰æºæ­¥éª¤ï¼š  <br/>
1ã€åˆ›å»ºä¸¤ä¸ªgitä»“åº“ï¼Œä¸€ä¸ªç”¨æ¥åšç§æœ‰çš„Spec Repoï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±çš„å…¬å…±ç»„ä»¶  <br/>
2ã€æ·»åŠ ç§æœ‰çš„repoåˆ°CocoaPods  <br/>
3ã€åˆ¶ä½œPodspecï¼Œå¹¶ä¸”æ¨é€åˆ°ä½ åˆ›å»ºçš„ç§æœ‰repo   <br/>
4ã€ä½¿ç”¨Podï¼Œåœ¨Podfileæ·»åŠ ç§æœ‰æºæ¥æ­å»ºé¡¹ç›®</p>

<!-- more -->


<p></p>

<h2>ä¸€ã€åˆ›å»ºä¸¤ä¸ªgitä»“åº“ï¼Œä¸€ä¸ªç”¨æ¥åšç§æœ‰çš„Spec Repoï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±çš„å…¬å…±ç»„ä»¶</h2>

<p>åœ¨è¿™ä¸€æ­¥å½“ä¸­éœ€è¦gitæœåŠ¡å™¨ç”¨æ¥åˆ›å»ºä»“åº“ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨githubæ¥å½“åšæˆ‘çš„æœåŠ¡å™¨ï¼Œæˆ‘åˆ›å»ºçš„è¿™äº›é¡¹ç›®éƒ½æ˜¯publicçš„ã€‚ä½ å¦‚æœæ˜¯ç»ƒæ‰‹çš„è¯ï¼Œä¹Ÿå¯ä»¥ä»¿ç…§æˆ‘ä¸€æ ·åœ¨githubä¸Šé¢åˆ›å»ºä»“åº“ã€‚å¦‚æœæ˜¯ä¸ºå…¬å¸å»ºç«‹ç§æœ‰çš„å…¬å…±ç»„ä»¶åº“ï¼Œä½ å¯ä»¥åœ¨githubç­‰å¹³å°ä¸Šé¢åˆ›å»ºç§æœ‰ä»“åº“ï¼Œæˆ–è€…ç›´æ¥æ­å»ºä¸€ä¸ªgitæœåŠ¡å™¨æ¥åˆ›å»ºä»“åº“ã€‚æ­å»ºæœåŠ¡å™¨å¯ä»¥å‚è€ƒ<a href="http://www.liuchungui.com/blog/2015/10/23/gitzong-jie/">Gitç®€å•æ€»ç»“</a>çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æœ‰Macæ­å»ºä¹Ÿæœ‰Linuxæ­å»ºçš„é“¾æ¥ã€‚    <br/>
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºä¸¤ä¸ªgitä»“åº“ã€‚     <br/>
ç¬¬ä¸€ä¸ªä»“åº“åç§°æ˜¯<a href="https://github.com/liuchungui/first.git">first</a>ï¼Œä¸“é—¨ç”¨æ¥åšç§æœ‰Spec Repoã€‚      <br/>
ç¬¬äºŒä¸ªä»“åº“åç§°æ˜¯<a href="https://github.com/liuchungui/BGNetwork">BGNetwork</a>ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å…¬å…±ç»„ä»¶åº“ã€‚     <br/>
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯Spec Repo?</p>

<blockquote><p>ä»–æ˜¯æ‰€æœ‰çš„Podsçš„ä¸€ä¸ªç´¢å¼•ï¼Œå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ‰€æœ‰å…¬å¼€çš„Podséƒ½åœ¨è¿™ä¸ªé‡Œé¢ï¼Œä»–å®é™…æ˜¯ä¸€ä¸ªGitä»“åº“remoteç«¯ã€‚  <br/>
åœ¨GitHubä¸Šï¼Œå½“ä½ ä½¿ç”¨äº†Cocoapodsåä»–ä¼šè¢«cloneåˆ°æœ¬åœ°çš„~/.cocoapods/reposç›®å½•ä¸‹ï¼Œå¯ä»¥è¿›å…¥åˆ°è¿™ä¸ªç›®å½•çœ‹åˆ°masteræ–‡ä»¶å¤¹å°±æ˜¯è¿™ä¸ªå®˜æ–¹çš„Spec Repoäº†ã€‚</p></blockquote>

<p>è¿™é‡Œå¼•ç”¨äº†<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/">ä½¿ç”¨Cocoapodsåˆ›å»ºç§æœ‰podspec</a>çš„å†…å®¹ã€‚</p>

<h2>äºŒã€æ·»åŠ ç§æœ‰çš„repoåˆ°CocoaPods</h2>

<p>ä¸»è¦å‘½ä»¤æ˜¯<code>pod repo add REPO_NAME SOURCE_URL</code>ã€‚å…¶ä¸­ï¼ŒREPO_NAMEæ˜¯ç§æœ‰repoçš„åå­—ï¼Œå–ä¸€ä¸ªå®¹æ˜“è®°ä½çš„åå­—ï¼Œåé¢è¿˜ä¼šç”¨åˆ°ï¼Œä»¥åå…¬å¸å†…éƒ¨çš„ç»„ä»¶å¯¹åº”çš„podspecéƒ½å¯ä»¥æ¨é€åˆ°è¿™ä¸ªrepoä¸­ï¼›SOURCE_URLå°±æ˜¯åˆšåˆšæˆ‘ä»¬åˆ›å»ºçš„<code>first</code>ä»“åº“é“¾æ¥ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod repo add liuchungui https://github.com/liuchungui/first.git
</span><span class='line'>$ ls ~/.cocoapods/repos  
</span><span class='line'>liuchungui    master</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ—¶ï¼Œä½ ä¼šå‘ç°æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹<code>liuchungui</code>å’Œ<code>master</code>ï¼Œmasteræ˜¯Cocoapodså®˜æ–¹çš„repoï¼Œè€Œliuchunguiå°±æ˜¯æˆ‘åˆšåˆšåˆ›å»ºçš„ã€‚è¿›å…¥liuchunguiæ–‡ä»¶å¤¹æŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°å®ƒæ˜¯cloneäº†ä¸€ä»½<code>https://github.com/liuchungui/first.git</code>ã€‚   <br/>
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯ä¸€ä¸ªç©ºçš„ä»“åº“ï¼Œå¯ä»¥ä¸æ£€æŸ¥ï¼Œä½†æ˜¯ä½ çš„ä»“åº“å¦‚æœæœ‰ä»€ä¹ˆå…¶ä»–ä¸œè¥¿çš„è¯ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/.cocoapods/repos/liuchungui
</span><span class='line'>$ pod repo lint .</span></code></pre></td></tr></table></div></figure>


<h2>ä¸‰ã€åˆ¶ä½œPodspecï¼Œå¹¶ä¸”æ¨é€åˆ°ä½ åˆ›å»ºçš„ç§æœ‰repo</h2>

<p>1ã€å°†æˆ‘ä»¬å‰é¢åˆ›å»ºçš„BGNetworké¡¹ç›®å…‹éš†åˆ°æœ¬åœ°   <br/>
<code>git clone https://github.com/liuchungui/BGNetwork.git</code>   <br/>
2ã€åœ¨æœ¬åœ°æˆ‘ä»¬ä½¿ç”¨äº†xcodeåˆ›å»ºäº†é¡¹ç›®ï¼Œå¹¶ä¸”å†™äº†ä¸€ä¸ªç½‘ç»œæ¡†æ¶ï¼Œè¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å‡†å¤‡æäº¤åˆ°githubï¼Œå¹¶æ‰“ä¸Šç‰ˆæœ¬å·ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m 'add file'
</span><span class='line'>git push origin master
</span><span class='line'>git tag -m 'add tag' '0.1.1'
</span><span class='line'>git push --tags</span></code></pre></td></tr></table></div></figure>


<p>3ã€æˆ‘ä»¬å¼€å§‹åˆ¶ä½œPodspecæ–‡ä»¶ã€‚  <br/>
<code>BGNetwork</code>æ˜¯ä¸€ä¸ªåŸºäº<code>AFNetworking</code>è€Œå°è£…çš„ç½‘ç»œæ¡†æ¶ï¼Œå®ƒä¸»è¦çš„æºæ–‡ä»¶éƒ½åœ¨<code>BGNetwork/BGNetwork</code>è·¯å¾„ä¸‹ã€‚æˆ‘ä»¬å°†å®ƒæ”¾åœ¨CocoaPodsç»™ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼Œä¸»è¦æ˜¯å°†è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æºæ–‡ä»¶åŠ è½½åˆ°ç¬¬ä¸‰æ–¹çš„é¡¹ç›®ä¸­ä»¥ä¾›ä½¿ç”¨ã€‚
ä¸‹é¢æ˜¯ä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨çš„æºæ–‡ä»¶ç»“æ„ï¼Œå…·ä½“å¯ä»¥ä¸‹è½½<a href="https://github.com/liuchungui/BGNetwork">BGNetwork</a>ä»£ç æŸ¥çœ‹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>____BGNetwork
</span><span class='line'>| |____BGAFHTTPClient.h
</span><span class='line'>| |____BGAFHTTPClient.m
</span><span class='line'>| |____BGAFRequestSerializer.h
</span><span class='line'>| |____BGAFRequestSerializer.m
</span><span class='line'>| |____BGAFResponseSerializer.h
</span><span class='line'>| |____BGAFResponseSerializer.m
</span><span class='line'>| |____BGNetworkCache.h
</span><span class='line'>| |____BGNetworkCache.m
</span><span class='line'>| |____BGNetworkConfiguration.h
</span><span class='line'>| |____BGNetworkConfiguration.m
</span><span class='line'>| |____BGNetworkConnector.h
</span><span class='line'>| |____BGNetworkConnector.m
</span><span class='line'>| |____BGNetworkManager.h
</span><span class='line'>| |____BGNetworkManager.m
</span><span class='line'>| |____BGNetworkRequest.h
</span><span class='line'>| |____BGNetworkRequest.m
</span><span class='line'>| |____BGNetworkUtil.h
</span><span class='line'>| |____BGNetworkUtil.m</span></code></pre></td></tr></table></div></figure>


<p>åœ¨BGNetworké¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªBGNetwork.podspecæ–‡ä»¶ï¼Œå¯¹åº”ä¸Šé¢çš„éœ€æ±‚ï¼Œæˆ‘ä»¬çš„podspecå¯ä»¥è¿™ä¹ˆå†™</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Pod::Spec.new do |spec|
</span><span class='line'>  #é¡¹ç›®åç§°
</span><span class='line'>  spec.name         = 'BGNetwork'
</span><span class='line'>  #ç‰ˆæœ¬å·
</span><span class='line'>  spec.version      = '0.1.1'
</span><span class='line'>  #å¼€æºåè®®
</span><span class='line'>  spec.license      = 'MIT'
</span><span class='line'>  #å¯¹å¼€æºé¡¹ç›®çš„æè¿°
</span><span class='line'>  spec.summary      = 'BGNetwork is a request util based on AFNetworking'
</span><span class='line'>  #å¼€æºé¡¹ç›®çš„é¦–é¡µ
</span><span class='line'>  spec.homepage     = 'https://github.com/chunguiLiu/BGNetwork'
</span><span class='line'>  #ä½œè€…ä¿¡æ¯
</span><span class='line'>  spec.author       = {'chunguiLiu' =&gt; 'chunguiLiu@126.com'}
</span><span class='line'>  #é¡¹ç›®çš„æºå’Œç‰ˆæœ¬å·
</span><span class='line'>  spec.source       = { :git =&gt; 'https://github.com/chunguiLiu/BGNetwork.git', :tag =&gt; '0.1.1' }
</span><span class='line'>  #æºæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯ä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨çš„æºæ–‡ä»¶
</span><span class='line'>  spec.source_files = "BGNetwork/*"
</span><span class='line'>  #é€‚ç”¨äºios7åŠä»¥ä¸Šç‰ˆæœ¬
</span><span class='line'>  spec.platform     = :ios, '7.0'
</span><span class='line'>  #ä½¿ç”¨çš„æ˜¯ARC
</span><span class='line'>  spec.requires_arc = true
</span><span class='line'>  #ä¾èµ–AFNetworking2.0
</span><span class='line'>  spec.dependency 'AFNetworking', '~&gt; 2.0'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p><strong>æ³¨æ„ï¼š</strong>spec.sourceæºæ˜¯<code>BGNetwork</code>çš„gitä»“åº“ï¼Œç‰ˆæœ¬å·æ˜¯æˆ‘ä»¬ä¸Šä¸€æ­¥æ‰“ä¸Šçš„ç‰ˆæœ¬å·0.1.1ã€‚</p>

<p>4ã€éªŒè¯å¹¶æ¨é€åˆ°æœåŠ¡å™¨    <br/>
åœ¨æ¨é€å‰ï¼Œæˆ‘ä»¬å…ˆéªŒè¯Podspecï¼ŒéªŒè¯çš„æ—¶å€™æ˜¯éªŒè¯BGNetwork.podspecæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯è¿›å…¥çš„ç›®å½•å’ŒBGNetwork.podspecåŒçº§çš„ï¼ŒéªŒè¯å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod lib lint</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼šéªŒè¯çš„æ—¶å€™ï¼Œä¼šè·å–<code>BGNetwork.podspec</code>æ–‡ä»¶ä¸­çš„<code>spec.source</code>æ¥è·å–gitæœåŠ¡å™¨ä¸Šé¢å¯¹åº”ç‰ˆæœ¬çš„ä»£ç ï¼Œç„¶åå†æ‰¾åˆ°<code>spec.source_files</code>ä¸­çš„æºä»£ç ï¼Œé€šè¿‡xcodeå‘½ä»¤è¡Œå·¥å…·å»ºç«‹å·¥ç¨‹å¹¶ä¸”è¿›è¡Œç¼–è¯‘ã€‚æ‰€ä»¥è¿™ä¸€æ­¥çš„è¿‡ç¨‹ä¼šæ¯”è¾ƒä¹…ï¼Œå¦‚æœç¼–è¯‘æ²¡æœ‰é”™è¯¯ï¼Œå°±éªŒè¯é€šè¿‡ã€‚</p>

<p>å¦‚æœæ²¡æœ‰é”™è¯¯å’Œè­¦å‘Šæˆ‘ä»¬å°±å¯ä»¥æ¨é€åˆ°æœåŠ¡å™¨äº†ï¼Œæ¨é€ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod repo push REPO_NAME SPEC_NAME.podspec</span></code></pre></td></tr></table></div></figure>


<p>å®ƒä¹Ÿä¼šå…ˆéªŒè¯ï¼Œç„¶åå†æ¨é€ã€‚æˆ‘è¿™é‡Œæ¨é€BGNetworkå‘½ä»¤æ˜¯ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod repo push liuchungui BGNetwork.podspec</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œä½†æ˜¯æœ‰è­¦å‘Šï¼Œæˆ‘ä»¬å°±å°†è­¦å‘Šè§£å†³ï¼Œä¹Ÿå¯ä»¥åŠ <code>--allow-warnings</code>æ¥æäº¤</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod repo push liuchungui BGNetwork.podspec --allow-warnings</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥å»æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¯¹åº”ä¸‹çš„Noteä¿¡æ¯å¹¶è§£å†³ã€‚åœ¨è¿™é”™è¯¯å½“ä¸­ï¼Œå¸¸å¸¸ä¼šé‡åˆ°æ‰¾ä¸åˆ°å¯¹åº”æ–‡ä»¶çš„é”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦æŸ¥çœ‹<code>BGNetwork.podspec</code>æ–‡ä»¶ä¸­<code>spec.source</code>ä¸‹gitä»“åº“é“¾æ¥æ˜¯å¦æ²¡é—®é¢˜ï¼Œgitä»“åº“ä¸‹å¯¹åº”çš„tagç‰ˆæœ¬ä¸­<code>spec.source_files</code>è·¯å¾„ä¸‹æ˜¯å¦æ­£ç¡®ã€‚</p>

<p>å¦‚æœæŸ¥çœ‹Noteä¿¡æ¯çœ‹ä¸å‡ºä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥åŠ ä¸Š<code>verbose</code>å‚æ•°è¿›è¡Œæ›´è¯¦ç»†çš„æŸ¥çœ‹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod repo push liuchungui BGNetwork.podspec --allow-warnings --verbose</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><strong>æ³¨æ„äº‹é¡¹ï¼šç¢°åˆ°æœ¬åœ°ä½¿ç”¨<code>pod lib lint</code>éªŒè¯é€šè¿‡ï¼Œä½†æ˜¯pushåˆ°æœåŠ¡å™¨å´å¤±è´¥äº†ï¼Œè¿™ä¸ªæ—¶å€™å¾ˆå¯èƒ½å°±æ˜¯æœåŠ¡å™¨tagç‰ˆæœ¬ä¸å¯¹ï¼Œä½¿ç”¨<code>--verbose</code>èƒ½æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚</strong></p>

<p>5ã€æœç´¢æˆ‘ä»¬çš„æ¡†æ¶
åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>pod search BGNetwork</code>æ¥æœç´¢äº†ï¼Œæœç´¢åˆ°äº†è¯´æ˜æˆ‘ä»¬ç§æœ‰æºå»ºç«‹æˆåŠŸã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod search BGNetwork
</span><span class='line'>-&gt; BGNetwork (0.1.2)
</span><span class='line'>   BGNetwork is a request util based on AFNetworking
</span><span class='line'>   pod 'BGNetwork', '~&gt; 0.1.2'
</span><span class='line'>   Homepage: https://github.com/chunguiLiu/BGNetwork
</span><span class='line'>   Source:   https://github.com/chunguiLiu/BGNetwork.git
</span><span class='line'>   Versions: 0.1.1, 0.1.0 [liuchungui repo] - 0.1.2, 0.1.1 [master repo]</span></code></pre></td></tr></table></div></figure>


<p>ç”±ä¸Šé¢çš„æœç´¢çŸ¥é“ï¼ŒBGNetworkåœ¨liuchunguiè¿™ä¸ªç§æœ‰repoä¸­å­˜åœ¨0.1.1å’Œ0.1.0ç‰ˆæœ¬ï¼Œåœ¨masterä¸­å­˜åœ¨0.1.2å’Œ0.1.1ç‰ˆæœ¬ã€‚  <br/>
æœç´¢æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å°†BGNetwork.podspecä¹Ÿæ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚</p>

<h2>å››ã€ä½¿ç”¨Podï¼Œåœ¨Podfileæ·»åŠ ç§æœ‰æºæ¥æ­å»ºé¡¹ç›®</h2>

<p>ä½¿ç”¨æ—¶ï¼Œåœ¨Podfileæ–‡ä»¶ä¸­æ·»åŠ <strong>æœ¬åœ°ç§æœ‰æºå’Œå®˜æ–¹æº</strong>ã€‚å¦‚æœæ²¡æœ‰æ·»åŠ æœ¬åœ°ç§æœ‰æºï¼Œå®ƒé»˜è®¤æ˜¯ç”¨å®˜æ–¹çš„repoï¼Œè¿™æ ·æ‰¾ä¸åˆ°æœ¬åœ°çš„Podï¼›å¦‚æœåªæ˜¯è®¾ç½®äº†æœ¬åœ°ç§æœ‰æºï¼Œå°±ä¸ä¼šå†å»å®˜æ–¹æºä¸­æŸ¥æ‰¾ã€‚
 ä¸‹é¢æ˜¯Podfileå†…å®¹</p>

<pre><code class="```">   #å®˜æ–¹Cocoapodsçš„æº
   source 'https://github.com/CocoaPods/Specs.git'
   #æœ¬åœ°ç§æœ‰æº
   source 'https://github.com/liuchungui/first.git'
   platform :ios, '7.0'
   pod 'BGNetwork', '~&gt; 0.1.1'
</code></pre>

<h2>æ³¨æ„</h2>

<p>1ã€é€”ä¸­é‡åˆ°äº†å‡ æ¬¡é—®é¢˜ï¼Œå°±æ˜¯<code>pod repo push</code>ä¸ä¸Šå»ï¼Œæ˜¾ç¤ºæ²¡æœ‰æ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼Œåæ¥å‘ç°æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ²¡æœ‰æ‰“ä¸Šç‰ˆæœ¬å·æˆ–è€…<code>Podspec</code>ä¸­ç‰ˆæœ¬é”™äº†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ç»´æŠ¤ä¸€ä¸ªæ¡†æ¶æ—¶ï¼Œä¿®æ”¹æ¡†æ¶ä¹‹åï¼Œpushåˆ°gitæœåŠ¡å™¨ä¹‹åå…ˆæ‰“ä¸Štagï¼Œç„¶åå†ä¿®æ”¹podspecæ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ï¼Œæœ€åpushåˆ°å¯¹åº”çš„pod repoä¸­ã€‚å¦‚æœä½ é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¯¦ç»†æŸ¥çœ‹<strong>ç¬¬ä¸‰æ­¥ä¸­çš„éªŒè¯å¹¶æ¨é€åˆ°æœåŠ¡å™¨</strong>è¿™ä¸€èŠ‚ã€‚</p>

<p>2ã€è‹¥æ˜¯åœ¨æ¡†æ¶å½“ä¸­ï¼Œå­˜åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œè¯·ä½¿ç”¨<code>subspec</code>ã€‚å¦‚æœä¸åŒæ–‡ä»¶å¤¹ä¹‹é—´çš„æ–‡ä»¶æœ‰ç›¸äº’å¯¼å…¥çš„æƒ…å†µï¼Œè¯·å°†è¢«å¯¼å…¥çš„å¤´æ–‡ä»¶è®¾ç½®ä¸º<code>public_header_files</code>ï¼Œå¹¶ä¸”é€šè¿‡<code>dependency</code>è®¾ç½®ä¾èµ–ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking.podspec">AFNetworkingçš„podspec</a>æ–‡ä»¶ã€‚</p>

<p>3ã€è‹¥æ˜¯éœ€è¦æäº¤ç»™å®˜æ–¹ï¼Œè¯·ä½¿ç”¨</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pod trunk register youremail
</span><span class='line'>æŸ¥çœ‹ä¿¡æ¯
</span><span class='line'>pod trunk me
</span><span class='line'>å°†å¯¹åº”çš„podæ¨é€åˆ°æœåŠ¡å™¨
</span><span class='line'>pod trunk push</span></code></pre></td></tr></table></div></figure>


<p>4ã€ä½¿ç”¨<code>pod install</code>æ—¶ï¼Œå®ƒé¦–å…ˆä¼šæ›´æ–°æ•´ä¸ªå®˜æ–¹çš„æºï¼Œè€ŒCocoapodsæ¯å¤©éƒ½æœ‰å¾ˆå¤šäººæäº¤ï¼Œæ‰€ä»¥æ›´æ–°æ¯”è¾ƒæ…¢ã€‚æ‰€ä»¥ï¼Œå»ºè®®æ¯è¿‡ä¸€æ®µæ—¶é—´æ›´æ–°ä¸€ä¸‹å®˜æ–¹åº“ï¼Œå¹³å¸¸çš„æ—¶å€™ï¼Œå’±ä»¬å¯ä»¥åœ¨<code>install</code>æˆ–<code>update</code>åŠ ä¸€ä¸ªå‚æ•°<code>--no-repo-update</code>è®©å®ƒä¸ç”¨æ›´æ–°ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pod install --verbose --no-repo-update
</span><span class='line'>$ pod update --verbose --no-repo-update</span></code></pre></td></tr></table></div></figure>


<h2>å‚è€ƒ</h2>

<p><a href="https://guides.cocoapods.org/making/private-cocoapods.html">Private Pods</a>   <br/>
<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/">ä½¿ç”¨Cocoapodsåˆ›å»ºç§æœ‰podspec</a>   <br/>
<a href="http://blog.csdn.net/wzzvictory/article/details/18737437?utm_source=tuicool">CocoaPodsè¯¦è§£ä¹‹&mdash;-ä½¿ç”¨ç¯‡</a></p>

<h2>ä¿®æ”¹è®°å½•</h2>

<ul>
<li>2015.10.19 å‘å¸ƒï¼Œä¸­é€”ä¿®æ”¹è¿‡å‡ æ¬¡</li>
<li>2016.4.11 ä¿®æ”¹äº†ç¬¬ä¸‰éƒ¨ä¸­çš„éªŒè¯å¹¶æ¨é€åˆ°æœåŠ¡å™¨å†…å®¹</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS9ä¹‹é€‚é…ATS]]></title>
    <link href="http://www.liuchungui.com/blog/2015/10/11/ios9zhi-gua-pei-ats/"/>
    <updated>2015-10-11T13:15:11+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/10/11/ios9zhi-gua-pei-ats</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘çš„iOS9ç³»ç»Ÿå‡ºæ¥äº†ï¼Œè€Œç½‘ç»œæ–¹é¢çš„ATS(App Transport Security)ç‰¹æ€§å¯ä»¥è¯´æ¯ä¸ªäººéƒ½è¦ç»å†ã€‚è€Œæˆ‘è¿™ç¯‡åšå®¢ï¼Œå°±æ˜¯ç»“åˆæˆ‘æœ€è¿‘å‡ å¤©çš„ç»å†ï¼Œæ¥è°ˆè°ˆä»æœåŠ¡å™¨åˆ°iOSå®¢æˆ·ç«¯å¯¹ATSçš„é€‚é…ã€‚</p>

<h3>ä¸€ã€ç®€å•è°ˆè°ˆATS(App Transport Security)</h3>

<p>ATS(App Transport Security)æ˜¯ä¸ºäº†æé«˜Appä¸æœåŠ¡å™¨ä¹‹é—´å®‰å…¨ä¼ è¾“æ•°æ®ä¸€ä¸ªç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä»iOS9å’ŒOSX10.11å¼€å§‹å‡ºç°ï¼Œå®ƒé»˜è®¤éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>

<ul>
<li>æœåŠ¡å™¨TLSç‰ˆæœ¬è‡³å°‘æ˜¯1.2ç‰ˆæœ¬</li>
<li>è¿æ¥åŠ å¯†åªå…è®¸å‡ ç§å…ˆè¿›çš„åŠ å¯†</li>
<li>è¯ä¹¦å¿…é¡»ä½¿ç”¨SHA256æˆ–è€…æ›´å¥½çš„å“ˆå¸Œç®—æ³•è¿›è¡Œç­¾åï¼Œè¦ä¹ˆæ˜¯2048ä½æˆ–è€…æ›´é•¿çš„RSAå¯†é’¥ï¼Œè¦ä¹ˆå°±æ˜¯256ä½æˆ–æ›´é•¿çš„ECCå¯†é’¥</li>
</ul>


<p>å¦‚æœæƒ³äº†è§£å“ªå‡ ç§å…ˆè¿›çš„åŠ å¯†æ˜¯è¢«å…è®¸çš„ï¼Œè¯¦æƒ…è¯·è§å®˜æ–¹æ–‡æ¡£<a href="https://developer.apple.com/library/mac/technotes/App-Transport-Security-Technote/">App Transport Security Technote</a></p>

<!-- more -->


<h3>äºŒã€æ­å»ºHTTPSæœåŠ¡å™¨</h3>

<p>æ­å»ºHTTPSæœåŠ¡å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆ›å»ºè¯ä¹¦è¯·æ±‚ï¼Œç„¶ååˆ°æƒå¨æœºæ„è®¤è¯ï¼Œéšä¹‹é…ç½®åˆ°æœåŠ¡å™¨ï¼›å¦å¤–ä¸€ç§æ˜¯è‡ªå»ºè¯ä¹¦ï¼Œç„¶åé…ç½®ç»™æœåŠ¡å™¨ã€‚ç¬¬ä¸€ç§æ–¹å¼æ­å»ºçš„HTTPSæœåŠ¡å™¨å½“ç„¶æ˜¯æœ€ä¼˜çš„äº†ï¼Œå»ºç«‹ç½‘ç«™çš„è¯ï¼Œç›´æ¥å°±ä¼šè¢«ä¿¡ä»»ï¼Œè€Œä½œä¸ºç§»åŠ¨ç«¯appçš„æœåŠ¡å™¨æ—¶ï¼Œä¹Ÿä¸éœ€è¦ä¸ºATSåšè¿‡å¤šçš„é€‚é…ã€‚è™½ç„¶è¯´æƒå¨çš„æœºæ„è®¤è¯éƒ½æ˜¯éœ€è¦é’±çš„ï¼Œä½†æ˜¯å¦‚ä»Šä¹Ÿä¸ä¹å­˜åœ¨å…è´¹çš„ç¬¬ä¸‰æ–¹è®¤è¯æœºæ„ï¼›ç¬¬äºŒç§æ–¹å¼æ­å»ºçš„HTTPSæœåŠ¡å™¨ï¼Œå¯¹äºç½‘ç«™æ¥è¯´å®Œå…¨ä¸å¯è¡Œï¼Œç”¨æˆ·æ‰“å¼€æ—¶ç›´æ¥å¼¹å‡ºä¸€ä¸ªè­¦å‘Šæé†’ï¼Œè¯´è¿™æ˜¯ä¸€ä¸ªä¸å—ä¿¡ä»»çš„ç½‘ç«™ï¼Œè®©ç”¨æˆ·æ˜¯å¦ç»§ç»­ï¼Œä½“éªŒå¾ˆå·®ï¼Œè€Œä¸”è®©ç”¨æˆ·æ„Ÿè§‰ç½‘ç«™ä¸å®‰å…¨ã€‚å¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œåœ¨iOS9å‡ºç°ä¹‹å‰ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨iOS9å‡ºæ¥ä¹‹åï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯é€šä¸è¿‡ATSç‰¹æ€§ï¼Œéœ€è¦å°†NSAllowsArbitraryLoadsè®¾ç½®ä¸ºYESæ‰è¡Œã€‚æ‰€ä»¥ï¼Œæˆ‘æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼æ­å»ºHTTPSæœåŠ¡å™¨ã€‚   <br/>
ä¸‹é¢ï¼Œå’±ä»¬æ¥è¯´è¯´è¿™ä¸¤ç§æ–¹å¼éƒ½å¦‚ä½•è¿›è¡Œæ“ä½œã€‚</p>

<h5>ç¬¬ä¸€ç§ã€ä½¿ç”¨CAæœºæ„è®¤è¯çš„è¯ä¹¦æ­å»ºHTTPSæœåŠ¡å™¨</h5>

<p>1ã€åˆ›å»ºè¯ä¹¦è¯·æ±‚ï¼Œå¹¶æäº¤ç»™CAæœºæ„è®¤è¯</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ç”Ÿæˆç§é’¥
</span><span class='line'>openssl genrsa -des3 -out private.key 2048
</span><span class='line'>#ç”ŸæˆæœåŠ¡å™¨çš„ç§é’¥ï¼Œå»é™¤å¯†é’¥å£ä»¤ 
</span><span class='line'>openssl rsa -in private.key -out server.key
</span><span class='line'>#ç”Ÿæˆè¯ä¹¦è¯·æ±‚
</span><span class='line'>openssl req -new -key private.key -out server.csr</span></code></pre></td></tr></table></div></figure>


<p>å°†ç”Ÿæˆserver.csræäº¤ç»™CAæœºæ„ï¼ŒCAæœºæ„å¯¹å®ƒè¿›è¡Œç­¾åä¹‹åï¼Œç„¶åä¼šç”Ÿæˆç­¾ååçš„æ ¹è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦å‘é€ç»™ä½ ï¼Œè¿™ä¸ªæ—¶å€™çš„è¯ä¹¦å°±æ˜¯CAè®¤è¯ä¹‹åçš„è¯ä¹¦ã€‚æˆ‘ä»¬è¿™é‡Œå°†æ ¹è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦åˆ†åˆ«æ”¹åä¸ºca.crtå’Œserve.crtã€‚</p>

<p>2ã€é…ç½®ApacheæœåŠ¡å™¨   <br/>
å°†ca.crtã€server.keyã€server.crtä¸Šä¼ åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œä½¿ç”¨SSHç™»é™†è¿›å…¥è¿™ä¸‰ä¸ªæ–‡ä»¶çš„ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir ssl
</span><span class='line'>cp server.crt /alidata/server/httpd/conf/ssl/server.crt
</span><span class='line'>cp server.key /alidata/server/httpd/conf/ssl/server.key
</span><span class='line'>cp demoCA/cacert.pem /alidata/server/httpd/conf/ssl/ca.crt
</span><span class='line'>cp -r ssl /alidata/server/httpd/conf/</span></code></pre></td></tr></table></div></figure>


<p>ç¼–è¾‘<code>/alidata/server/httpd/conf/extra/httpd-ssl.conf</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°SSLCertificateFileã€SSLCertificateKeyFileã€SSLCACertificatePathã€SSLCACertificateFileè¿›è¡Œä¿®æ”¹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># æŒ‡å®šæœåŠ¡å™¨è¯ä¹¦ä½ç½®
</span><span class='line'>SSLCertificateFile "/alidata/server/httpd/conf/ssl/server.crt"
</span><span class='line'># æŒ‡å®šæœåŠ¡å™¨è¯ä¹¦keyä½ç½®
</span><span class='line'>SSLCertificateKeyFile "/alidata/server/httpd/conf/ssl/server.key"
</span><span class='line'># è¯ä¹¦ç›®å½•
</span><span class='line'>SSLCACertificatePath "/alidata/server/httpd/conf/ssl"
</span><span class='line'># æ ¹è¯ä¹¦ä½ç½®
</span><span class='line'>SSLCACertificateFile "/alidata/server/httpd/conf/ssl/ca.crt"</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹vhosté…ç½®<code>vim /alidata/server/httpd/conf/vhosts/phpwind.conf</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;VirtualHost *:443&gt;
</span><span class='line'>        SSLCertificateFile    /alidata/server/httpd/conf/ssl/server.crt
</span><span class='line'>        SSLCertificateKeyFile /alidata/server/httpd/conf/ssl/server.key
</span><span class='line'>        SSLCACertificatePath /alidata/server/httpd/conf/ssl
</span><span class='line'>        SSLCACertificateFile /alidata/server/httpd/conf/ssl/ca.crt
</span><span class='line'>        ServerName www.casetree.cn
</span><span class='line'>        DocumentRoot /alidata/www
</span><span class='line'>&lt;/VirtualHost&gt;</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œé‡å¯ApacheæœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸã€‚æˆ‘è¿™é‡Œæ˜¯ä¸ªäººä½¿ç”¨ï¼Œç”³è¯·çš„æ˜¯å…è´¹çš„è¯ä¹¦ï¼Œæˆ‘ç”³è¯·è¯ä¹¦çš„ç½‘ç«™æ˜¯<a href="https://buy.wosign.com">æ²ƒé€š</a>ã€‚  <br/>
æ­å»ºçš„æˆæœï¼š<a href="https://www.casetree.cn">https://www.casetree.cn</a></p>

<h5>ç¬¬äºŒç§ã€è‡ªå»ºè¯ä¹¦é…ç½®HTTPSæœåŠ¡å™¨</h5>

<p>è¯·æŸ¥çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡<a href="http://www.liuchungui.com/blog/2015/09/25/zi-jian-zheng-shu-pei-zhi-httpsfu-wu-qi/">è‡ªå»ºè¯ä¹¦é…ç½®HTTPSæœåŠ¡å™¨</a></p>

<h3>ä¸‰ã€ä½¿ç”¨nscurlå¯¹æœåŠ¡å™¨è¿›è¡Œæ£€æµ‹</h3>

<p>æ­å»ºå®ŒHTTPSæœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨nscurlå‘½ä»¤æ¥è¿›è¡Œæ£€æµ‹ï¼ŒæŸ¥çœ‹å»ºç«‹çš„HTTPSæœåŠ¡å™¨æ˜¯å¦èƒ½é€šè¿‡ATSç‰¹æ€§ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nscurl --ats-diagnostics --verbose https://casetree.cn</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœHTTPSæœåŠ¡å™¨èƒ½é€šè¿‡ATSç‰¹æ€§ï¼Œåˆ™ä¸Šé¢æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹éƒ½æ˜¯PASSï¼›å¦‚æœæŸä¸€é¡¹çš„Reusltæ˜¯FAILï¼Œå°±æ‰¾åˆ°ATS Dictionaryæ¥æŸ¥çœ‹ï¼Œå°±èƒ½çŸ¥é“HTTPSæœåŠ¡å™¨ä¸æ»¡è¶³ATSå“ªä¸ªæ¡ä»¶ã€‚
è¿™é‡Œæˆ‘å‰é¢ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è‡ªå»ºè¯ä¹¦çš„æ—¶å€™ï¼Œé€šè¿‡æ­¤å‘½ä»¤è¿›è¡Œæµ‹è¯•æ—¶ï¼Œå‘ç°Resultå…¨æ˜¯FAILï¼Œè€Œä¸”åœ¨iOSçš„ä»£ç æµ‹è¯•ä¸­ä¹Ÿå‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œå°±æ˜¯ç›¸åŒçš„ä»£ç ï¼Œåœ¨iOS8.4è¯·æ±‚æ•°æ®å®Œå…¨æ­£å¸¸ï¼Œä½†æ˜¯åœ¨iOS9ä¸Šï¼Œç›´æ¥æ˜¯è¿æ¥å¤±è´¥ã€‚æœ€ç»ˆå‘ç°ï¼Œå…¶å®å°±æ˜¯å› ä¸ºè‡ªå»ºè¯ä¹¦ä¸å—ä¿¡ä»»ï¼Œæ˜¯é€šä¸è¿‡ATSçš„ï¼Œé™¤éå°†NSAllowsArbitraryLoadsè®¾ç½®ä¸ºYESã€‚</p>

<h3>å››ã€iOSå®¢æˆ·ç«¯</h3>

<p>åœ¨ä¸Šé¢çš„ç¬¬äºŒå¤§æ­¥éª¤å½“ä¸­ï¼ŒHTTPSæœåŠ¡å™¨æ»¡è¶³ATSé»˜è®¤çš„æ¡ä»¶ï¼Œè€Œä¸”SSLè¯ä¹¦æ˜¯é€šè¿‡æƒå¨çš„CAæœºæ„è®¤è¯è¿‡çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨Xcode7å¼€å‘çš„æ—¶å€™ï¼Œå¯¹ç½‘ç»œçš„é€‚é…ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ­£å¸¸ä¸æœåŠ¡å™¨é€šä¿¡ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å¯¹å®‰å…¨æ€§æœ‰æ›´é«˜çš„è¦æ±‚æ—¶æˆ–è€…æˆ‘ä»¬è‡ªå»ºè¯ä¹¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æœ¬åœ°å¯¼å…¥è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ã€‚   <br/>
é‚£ä¹ˆï¼Œå¦‚ä½•æœ¬åœ°å¯¼å…¥è¯ä¹¦è¿›è¡ŒéªŒè¯å‘¢ï¼Ÿ   <br/>
åœ¨è¿™é‡Œå…ˆæä¸€ä¸‹ï¼Œç”±äºiOSå®¢æˆ·ç«¯æ”¯æŒçš„è¯ä¹¦æ˜¯DERæ ¼å¼çš„ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ã€‚åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ï¼Œç›´æ¥å°†æœåŠ¡ç«¯çš„CAæ ¹è¯ä¹¦å¯¼å‡ºæˆDERæ ¼å¼å°±è¡Œã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl  x509  -inform PEM  -outform DER -in ca.crt -out ca.cer</span></code></pre></td></tr></table></div></figure>


<p>å¯¼å…¥å®Œè¯ä¹¦ä¹‹åï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥è¯´è¯´ä½¿ç”¨NSURLSessionå’ŒAFNetworkingæ¥è¿›è¡Œæœ¬åœ°éªŒè¯ã€‚</p>

<h5>é¦–å…ˆï¼Œæ¥è¯´è¯´ä½¿ç”¨NSURLSessionéªŒè¯</h5>

<p>éªŒè¯æ­¥éª¤å¦‚ä¸‹ï¼š   <br/>
1ã€å¯¼å…¥CAæ ¹è¯ä¹¦åˆ°å·¥ç¨‹ä¸­ï¼Œå³æˆ‘ä»¬åˆ›å»ºçš„ca.cer   <br/>
2ã€è·å–trust objectï¼Œé€šè¿‡SecCertificateCreateWithDataæ–¹æ³•è¯»å–å¯¼å…¥çš„è¯ä¹¦çš„æ•°æ®ç”Ÿæˆä¸€ä¸ªè¯ä¹¦å¯¹è±¡ï¼Œç„¶åé€šè¿‡SecTrustSetAnchorCertificates
è®¾ç½®è¿™ä¸ªè¯ä¹¦ä¸ºtrust objectçš„ä¿¡ä»»æ ¹è¯ä¹¦ï¼ˆtrusted anchor)  <br/>
3ã€é€šè¿‡SecTrustEvaluateæ–¹æ³•å»éªŒè¯trust object  <br/>
ä¸‹é¢æ˜¯ä¸»è¦OCå®ç°ä»£ç ï¼ŒDemoå·¥ç¨‹æˆ‘ä¹Ÿæ”¾åœ¨githubä¸Šäº†ï¼Œæœ‰OCå’ŒSwiftä¸¤ç§è¯­è¨€ï¼Œä¸‹è½½Demoè¯·ç‚¹å‡»<a href="https://github.com/liuchungui/HTTPSConnectDemo">HTTPSConnectDemo</a>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">cerPath</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@&quot;ca&quot;</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@&quot;cer&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfFile</span><span class="p">:</span><span class="n">cerPath</span><span class="p">];</span>
</span><span class='line'>    <span class="n">SecCertificateRef</span> <span class="n">certificate</span> <span class="o">=</span> <span class="n">SecCertificateCreateWithData</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFDataRef</span><span class="p">)</span> <span class="n">data</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">trustedCerArr</span> <span class="o">=</span> <span class="l">@[</span><span class="p">(</span><span class="k">__bridge_transfer</span> <span class="kt">id</span><span class="p">)</span><span class="n">certificate</span><span class="l">]</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//å‘é€è¯·æ±‚</span>
</span><span class='line'>    <span class="bp">NSURL</span> <span class="o">*</span><span class="n">testURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;https://casetree.cn/web/test/demo.php&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">NSURLSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSession</span> <span class="nl">sessionWithConfiguration</span><span class="p">:[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">]</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span> <span class="nl">delegateQueue</span><span class="p">:[</span><span class="bp">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]];</span>
</span><span class='line'>    <span class="bp">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">task</span> <span class="o">=</span> <span class="p">[</span><span class="n">session</span> <span class="nl">dataTaskWithRequest</span><span class="p">:[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">testURL</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">task</span> <span class="n">resume</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - NSURLSessionDelegate</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">URLSession:</span><span class="p">(</span><span class="bp">NSURLSession</span> <span class="o">*</span><span class="p">)</span><span class="nv">session</span> <span class="nf">didReceiveChallenge:</span><span class="p">(</span><span class="bp">NSURLAuthenticationChallenge</span> <span class="o">*</span><span class="p">)</span><span class="nv">challenge</span>
</span><span class='line'> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSURLSessionAuthChallengeDisposition</span> <span class="n">disposition</span><span class="p">,</span> <span class="bp">NSURLCredential</span> <span class="o">*</span> <span class="n">__nullable</span> <span class="n">credential</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">OSStatus</span> <span class="n">err</span><span class="p">;</span>
</span><span class='line'>    <span class="n">NSURLSessionAuthChallengeDisposition</span> <span class="n">disposition</span> <span class="o">=</span> <span class="n">NSURLSessionAuthChallengePerformDefaultHandling</span><span class="p">;</span>
</span><span class='line'>    <span class="n">SecTrustResultType</span>  <span class="n">trustResult</span> <span class="o">=</span> <span class="n">kSecTrustResultInvalid</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSURLCredential</span> <span class="o">*</span><span class="n">credential</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//è·å–æœåŠ¡å™¨çš„trust object</span>
</span><span class='line'>    <span class="n">SecTrustRef</span> <span class="n">serverTrust</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">.</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">serverTrust</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//å°†è¯»å–çš„è¯ä¹¦è®¾ç½®ä¸ºserverTrustçš„æ ¹è¯ä¹¦</span>
</span><span class='line'>    <span class="n">err</span> <span class="o">=</span> <span class="n">SecTrustSetAnchorCertificates</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFArrayRef</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">trustedCerArr</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="n">noErr</span><span class="p">){</span>
</span><span class='line'>        <span class="c1">//é€šè¿‡æœ¬åœ°å¯¼å…¥çš„è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼Œå¦‚æœå°†SecTrustSetAnchorCertificatesOnlyè®¾ç½®ä¸ºNOï¼Œåˆ™åªè¦é€šè¿‡æœ¬åœ°æˆ–è€…ç³»ç»Ÿè¯ä¹¦é“¾ä»»ä½•ä¸€æ–¹è®¤è¯å°±è¡Œ</span>
</span><span class='line'>        <span class="n">err</span> <span class="o">=</span> <span class="n">SecTrustEvaluate</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">trustResult</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="n">errSecSuccess</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">trustResult</span> <span class="o">==</span> <span class="n">kSecTrustResultProceed</span> <span class="o">||</span> <span class="n">trustResult</span> <span class="o">==</span> <span class="n">kSecTrustResultUnspecified</span><span class="p">)){</span>
</span><span class='line'>        <span class="c1">//è®¤è¯æˆåŠŸï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå‡­è¯è¿”å›ç»™æœåŠ¡å™¨</span>
</span><span class='line'>        <span class="n">disposition</span> <span class="o">=</span> <span class="n">NSURLSessionAuthChallengeUseCredential</span><span class="p">;</span>
</span><span class='line'>        <span class="n">credential</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLCredential</span> <span class="nl">credentialForTrust</span><span class="p">:</span><span class="n">serverTrust</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="n">disposition</span> <span class="o">=</span> <span class="n">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//å›è°ƒå‡­è¯ï¼Œä¼ é€’ç»™æœåŠ¡å™¨</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">completionHandler</span><span class="p">){</span>
</span><span class='line'>        <span class="n">completionHandler</span><span class="p">(</span><span class="n">disposition</span><span class="p">,</span> <span class="n">credential</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼š   <br/>
1ã€SecTrustSetAnchorCertificatesæ–¹æ³•ä¼šè®¾ç½®ä¸€ä¸ªæ ‡ç¤ºå»å±è”½trust objectå¯¹å…¶å®ƒæ ¹è¯ä¹¦çš„ä¿¡ä»»ï¼›å¦‚æœä½ ä¹Ÿæƒ³ä¿¡ä»»ç³»ç»Ÿé»˜è®¤çš„æ ¹è¯ä¹¦ï¼Œè¯·è°ƒç”¨SecTrustSetAnchorCertificatesOnlyæ–¹æ³•ï¼Œæ¸…ç©ºè¿™ä¸ªæ ‡ç¤ºï¼ˆè®¾ç½®ä¸ºNOï¼‰
2ã€éªŒè¯çš„æ–¹æ³•ä¸ä»…ä»…åªæœ‰è¿™ä¸€ç§ï¼Œæ›´å¤šçš„éªŒè¯æ–¹æ³•ï¼Œè¯·å‚è€ƒ<a href="https://developer.apple.com/library/ios/technotes/tn2232/_index.html#//apple_ref/doc/uid/DTS40012884-CH1-SECCUSTOMIZEAPIS">HTTPS Server Trust Evaluation</a></p>

<h5>ä¸‹é¢ï¼Œæ¥è°ˆè°ˆAFNetworkingæ˜¯å¦‚ä½•éªŒè¯çš„ï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨AFNetworking</h5>

<p>AFNetworkingçš„è¯ä¹¦éªŒè¯å·¥ä½œæ˜¯ç”±AFSecurityPolicyæ¥å®Œæˆçš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ¥äº†è§£ä¸€ä¸‹AFSecurityPolicyã€‚<strong>æ³¨æ„ï¼šæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯AFNetworking2.6.0ï¼Œå®ƒè·Ÿ2.5.0æ˜¯æœ‰åŒºåˆ«çš„ã€‚</strong>  <br/>
è¯´åˆ°AFSecurityPolicyï¼Œæˆ‘ä»¬å¿…é¡»è¦æåˆ°å®ƒä¸‰ä¸ªé‡è¦çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">readonly</span><span class="p">,</span> <span class="k">nonatomic</span><span class="p">,</span> <span class="k">assign</span><span class="p">)</span> <span class="n">AFSSLPinningMode</span> <span class="n">SSLPinningMode</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">assign</span><span class="p">)</span> <span class="kt">BOOL</span> <span class="n">allowInvalidCertificates</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">assign</span><span class="p">)</span> <span class="kt">BOOL</span> <span class="n">validatesDomainName</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>SSLPingModeæ˜¯æœ€é‡è¦çš„å±æ€§ï¼Œå®ƒæ ‡æ˜äº†AFSecurityPolicyæ˜¯ä»¥ä½•ç§æ–¹å¼æ¥éªŒè¯ã€‚å®ƒæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œè¿™ä¸ªæšä¸¾ç±»å‹æœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯AFSSLPinningModeNoneã€AFSSLPinningModePublicKeyã€AFSSLPinningModeCertificateã€‚å…¶ä¸­ï¼ŒAFSSLPinningModeNoneä»£è¡¨äº†AFSecurityPolicyä¸åšæ›´ä¸¥æ ¼çš„éªŒè¯ï¼Œåªè¦æ˜¯ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦å°±å¯ä»¥é€šè¿‡éªŒè¯ï¼Œä¸è¿‡ï¼Œå®ƒå—åˆ°allowInvalidCertificateså’ŒvalidatesDomainNameçš„å½±å“ï¼›AFSSLPinningModePublicKeyæ˜¯é€šè¿‡æ¯”è¾ƒè¯ä¹¦å½“ä¸­å…¬é’¥(PublicKey)éƒ¨åˆ†æ¥è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡SecTrustCopyPublicKeyæ–¹æ³•è·å–æœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸€ä¸ªç›¸åŒï¼Œåˆ™é€šè¿‡éªŒè¯ï¼Œæ­¤æ–¹å¼ä¸»è¦é€‚ç”¨äºè‡ªå»ºè¯ä¹¦æ­å»ºçš„HTTPSæœåŠ¡å™¨å’Œéœ€è¦è¾ƒé«˜å®‰å…¨è¦æ±‚çš„éªŒè¯ï¼›AFSSLPinningModeCertificateåˆ™æ˜¯ç›´æ¥å°†æœ¬åœ°çš„è¯ä¹¦è®¾ç½®ä¸ºä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œç„¶åæ¥è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶ä¸”æ¯”è¾ƒæœ¬åœ°è¯ä¹¦çš„å†…å®¹å’ŒæœåŠ¡å™¨è¯ä¹¦å†…å®¹æ˜¯å¦ç›¸åŒï¼Œæ¥è¿›è¡ŒäºŒæ¬¡åˆ¤æ–­ï¼Œæ­¤æ–¹å¼é€‚ç”¨äºè¾ƒé«˜å®‰å…¨è¦æ±‚çš„éªŒè¯ã€‚   <br/>
allowInvalidCertificateså±æ€§ä»£è¡¨æ˜¯å¦å…è®¸ä¸ä¿¡ä»»çš„è¯ä¹¦é€šè¿‡éªŒè¯ï¼Œé»˜è®¤ä¸ºNO   <br/>
validatesDomainNameå±æ€§ä»£è¡¨æ˜¯å¦éªŒè¯ä¸»æœºåï¼Œé»˜è®¤ä¸ºYES</p>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯´ä¸‹éªŒè¯æµç¨‹ã€‚éªŒè¯æµç¨‹ä¸»è¦æ”¾åœ¨AFSecurityPolicyçš„- (BOOL)evaluateServerTrust:(SecTrustRef)serverTrust forDomain:(NSString *)domainæ–¹æ³•å½“ä¸­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">evaluateServerTrust:</span><span class="p">(</span><span class="n">SecTrustRef</span><span class="p">)</span><span class="nv">serverTrust</span>
</span><span class='line'>                  <span class="nf">forDomain:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">domain</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//å½“ä½¿ç”¨è‡ªå»ºè¯ä¹¦éªŒè¯åŸŸåæ—¶ï¼Œéœ€è¦ä½¿ç”¨AFSSLPinningModePublicKeyæˆ–è€…AFSSLPinningModeCertificate</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">domain</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="p">.</span><span class="n">allowInvalidCertificates</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="p">.</span><span class="n">validatesDomainName</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">SSLPinningMode</span> <span class="o">==</span> <span class="n">AFSSLPinningModeNone</span> <span class="o">||</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">pinnedCertificates</span> <span class="n">count</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;In order to validate a domain name for self signed certificates, you MUST use pinning.&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">policies</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">//éœ€è¦éªŒè¯åŸŸåæ—¶ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªéªŒè¯åŸŸåçš„ç­–ç•¥</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">validatesDomainName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">policies</span> <span class="nl">addObject</span><span class="p">:(</span><span class="k">__bridge_transfer</span> <span class="kt">id</span><span class="p">)</span><span class="n">SecPolicyCreateSSL</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">domain</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">policies</span> <span class="nl">addObject</span><span class="p">:(</span><span class="k">__bridge_transfer</span> <span class="kt">id</span><span class="p">)</span><span class="n">SecPolicyCreateBasicX509</span><span class="p">()];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//è®¾ç½®éªŒè¯çš„ç­–ç•¥ï¼Œå¯ä»¥æ˜¯å¤šä¸ª</span>
</span><span class='line'>    <span class="n">SecTrustSetPolicies</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFArrayRef</span><span class="p">)</span><span class="n">policies</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//SSLPinningModeä¸ºAFSSLPinningModeNoneæ—¶ï¼ŒallowInvalidCertificatesä¸ºYESï¼Œåˆ™ä»£è¡¨æœåŠ¡å™¨ä»»ä½•è¯ä¹¦éƒ½èƒ½éªŒè¯é€šè¿‡ï¼›å¦‚æœå®ƒä¸ºNOï¼Œåˆ™éœ€è¦åˆ¤æ–­æ­¤æœåŠ¡å™¨è¯ä¹¦æ˜¯å¦æ˜¯ç³»ç»Ÿä¿¡ä»»çš„è¯ä¹¦</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">SSLPinningMode</span> <span class="o">==</span> <span class="n">AFSSLPinningModeNone</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">allowInvalidCertificates</span> <span class="o">||</span> <span class="n">AFServerTrustIsValid</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">)){</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">AFServerTrustIsValid</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">self</span><span class="p">.</span><span class="n">allowInvalidCertificates</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//è·å–æœåŠ¡å™¨è¯ä¹¦çš„å†…å®¹</span>
</span><span class='line'>    <span class="bp">NSArray</span> <span class="o">*</span><span class="n">serverCertificates</span> <span class="o">=</span> <span class="n">AFCertificateTrustChainForServerTrust</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">);</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">SSLPinningMode</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFSSLPinningModeNone</span><span class="p">:</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFSSLPinningModeCertificate</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//AFSSLPinningModeCertificateæ˜¯ç›´æ¥å°†æœ¬åœ°çš„è¯ä¹¦è®¾ç½®ä¸ºä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œç„¶åæ¥è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶ä¸”æ¯”è¾ƒæœ¬åœ°è¯ä¹¦çš„å†…å®¹å’ŒæœåŠ¡å™¨è¯ä¹¦å†…å®¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœæœ‰ä¸€ä¸ªç›¸åŒåˆ™è¿”å›YES</span>
</span><span class='line'>
</span><span class='line'>            <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">pinnedCertificates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="n">certificateData</span> <span class="k">in</span> <span class="nb">self</span><span class="p">.</span><span class="n">pinnedCertificates</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="p">[</span><span class="n">pinnedCertificates</span> <span class="nl">addObject</span><span class="p">:(</span><span class="k">__bridge_transfer</span> <span class="kt">id</span><span class="p">)</span><span class="n">SecCertificateCreateWithData</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFDataRef</span><span class="p">)</span><span class="n">certificateData</span><span class="p">)];</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">//è®¾ç½®æœ¬åœ°çš„è¯ä¹¦ä¸ºæ ¹è¯ä¹¦</span>
</span><span class='line'>            <span class="n">SecTrustSetAnchorCertificates</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFArrayRef</span><span class="p">)</span><span class="n">pinnedCertificates</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//é€šè¿‡æœ¬åœ°çš„è¯ä¹¦æ¥åˆ¤æ–­æœåŠ¡å™¨è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼Œä¸å¯ä¿¡ï¼Œåˆ™éªŒè¯ä¸é€šè¿‡</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">AFServerTrustIsValid</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//åˆ¤æ–­æœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦çš„å†…å®¹æ˜¯å¦ç›¸åŒ</span>
</span><span class='line'>            <span class="bp">NSUInteger</span> <span class="n">trustedCertificateCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="n">trustChainCertificate</span> <span class="k">in</span> <span class="n">serverCertificates</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">([</span><span class="nb">self</span><span class="p">.</span><span class="n">pinnedCertificates</span> <span class="nl">containsObject</span><span class="p">:</span><span class="n">trustChainCertificate</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">trustedCertificateCount</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">trustedCertificateCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFSSLPinningModePublicKey</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//AFSSLPinningModePublicKeyæ˜¯é€šè¿‡æ¯”è¾ƒè¯ä¹¦å½“ä¸­å…¬é’¥(PublicKey)éƒ¨åˆ†æ¥è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡SecTrustCopyPublicKeyæ–¹æ³•è·å–æœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸€ä¸ªç›¸åŒï¼Œåˆ™é€šè¿‡éªŒè¯</span>
</span><span class='line'>
</span><span class='line'>            <span class="bp">NSUInteger</span> <span class="n">trustedPublicKeyCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="bp">NSArray</span> <span class="o">*</span><span class="n">publicKeys</span> <span class="o">=</span> <span class="n">AFPublicKeyTrustChainForServerTrust</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//åˆ¤æ–­æœåŠ¡å™¨è¯ä¹¦çš„å…¬é’¥ä¸æœ¬åœ°çš„è¯ä¹¦å…¬é’¥æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™å®¢æˆ·ç«¯è®¤è¯é€šè¿‡</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="kt">id</span> <span class="n">trustChainPublicKey</span> <span class="k">in</span> <span class="n">publicKeys</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">for</span> <span class="p">(</span><span class="kt">id</span> <span class="n">pinnedPublicKey</span> <span class="k">in</span> <span class="nb">self</span><span class="p">.</span><span class="n">pinnedPublicKeys</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="n">AFSecKeyIsEqualToKey</span><span class="p">((</span><span class="k">__bridge</span> <span class="n">SecKeyRef</span><span class="p">)</span><span class="n">trustChainPublicKey</span><span class="p">,</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">SecKeyRef</span><span class="p">)</span><span class="n">pinnedPublicKey</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">trustedPublicKeyCount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">trustedPublicKeyCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¯´äº†éªŒè¯æµç¨‹ï¼Œæˆ‘ä»¬æœ€åæ¥çœ‹çœ‹AFNetworkingæ€ä¹ˆä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code> _httpClient = [[BGAFHTTPClient alloc] initWithBaseURL:[NSURL URLWithString:baseURL]];
 AFSecurityPolicy *policy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];
 //æ˜¯å¦å…è®¸CAä¸ä¿¡ä»»çš„è¯ä¹¦é€šè¿‡
policy.allowInvalidCertificates = YES;
//æ˜¯å¦éªŒè¯ä¸»æœºå
policy.validatesDomainName = YES;
_httpClient.securityPolicy = policy;  
</code></pre>

<p> è¿™é‡Œæˆ‘å°±æ²¡æœ‰å»ºç«‹Demoäº†ï¼Œå¦‚æœè¦çœ‹çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘å†™çš„ä¸€ä¸ªæ¡†æ¶<a href="https://github.com/liuchungui/BGNetwork">BGNetwork</a>ï¼Œé‡Œé¢çš„Demoå¯¹ATSè¿›è¡Œäº†é€‚é…ï¼ŒAFNetworkingçš„ä½¿ç”¨æ”¾åœ¨BGNetworkConnectorç±»é‡Œé¢çš„<code>- (instancetype)initWithBaseURL:(NSString *)baseURL delegate:(id&lt;BGNetworkConnectorDelegate&gt;)delegate</code>åˆå§‹åŒ–æ–¹æ³•ä¸­ã€‚</p>

<h3>äº”ã€é€‚é…ATS</h3>

<p>å‰é¢çš„å†…å®¹è®²è¿°éƒ½æ˜¯æ»¡è¶³ATSç‰¹æ€§çš„æƒ…å†µï¼Œä½†è‹¥æ˜¯æœåŠ¡å™¨æ˜¯è‡ªå»ºè¯ä¹¦æ­å»ºçš„ï¼Œæˆ–è€…TLSç‰ˆæœ¬æ˜¯1.0çš„è¯ï¼ŒæœåŠ¡å™¨åˆä¸èƒ½è½»æ˜“æ”¹åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®¢æˆ·ç«¯å¦‚ä½•é€‚é…å‘¢ï¼Ÿ
ä¸æ€¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å·¥ç¨‹ä¸­çš„Info.plistæ–‡ä»¶å½“ä¸­è¿›è¡Œè®¾ç½®ï¼Œä¸»è¦å‚ç…§ä¸‹å›¾ï¼š
<img src="http://ww3.sinaimg.cn/large/91c6e389jw1ewvshzy5ilj21340m641y.jpg" alt="å›¾ç‰‡" />
é€‚é…è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€»ç»“ï¼š <br/>
1ã€å¦‚æœæ˜¯è‡ªå»ºè¯ä¹¦ï¼Œæ²¡æœ‰ç»è¿‡æƒå¨æœºæ„è®¤è¯çš„è¯ä¹¦ï¼Œé‚£ä¹ˆéœ€è¦å°†NSAllowsArbitraryLoadsè®¾ç½®ä¸ºYESæ‰èƒ½é€šè¿‡ã€‚NSAllowsArbitraryLoadsä¸ºYESï¼Œä»¥å‰çš„HTTPè¯·æ±‚ä¹Ÿèƒ½é€šè¿‡ã€‚       <br/>
2ã€å¦‚æœæ˜¯è®¤è¯è¿‡çš„è¯ä¹¦ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡<code>nscurl --ats-diagnostics --verbose https://casetree.cn</code>è¿™æ ·çš„å‘½ä»¤æ¥æŸ¥çœ‹æœåŠ¡å™¨æ”¯æŒçš„ATS Dictionaryï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„è®¾ç½®ã€‚</p>

<p>é€‚é…çš„éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥å‚ç…§<a href="https://github.com/ChenYilong/iOS9AdaptationTips#1-demo1_ios9%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D_ats%E6%94%B9%E7%94%A8%E6%9B%B4%E5%AE%89%E5%85%A8%E7%9A%84https">Demo1_iOS9ç½‘ç»œé€‚é…_ATSï¼šæ”¹ç”¨æ›´å®‰å…¨çš„HTTPS</a></p>

<h3>æ€»ç»“</h3>

<p>å›é¡¾å‰é¢çš„å†…å®¹ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œä¸»è¦è®²äº†ä¸€ä¸‹å‡ ç‚¹å†…å®¹  <br/>
1. ATSéœ€è¦æ»¡è¶³çš„æ¡ä»¶  <br/>
2. å¦‚ä½•å»ºç«‹è¯ä¹¦ï¼Œæ­å»ºHTTPSæœåŠ¡å™¨    <br/>
3. ä½¿ç”¨nscurlå‘½ä»¤æ¥æ£€æµ‹HTTPSæœåŠ¡å™¨æ˜¯å¦æ»¡è¶³ATSç‰¹æ€§  <br/>
4. å®¢æˆ·ç«¯çš„é€‚é…ï¼Œè®²è¿°äº†NSURLSessionå’ŒAFNetworkingçš„ä½¿ç”¨  <br/>
5. è®²è¿°äº†å¦‚æœå»ºç«‹çš„æœåŠ¡å™¨ä¸æ»¡è¶³ATSçš„æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•é€‚é…</p>

<h3>å‚è€ƒ</h3>

<p><a href="https://developer.apple.com/library/mac/technotes/App-Transport-Security-Technote/">App Transport Security Technote</a>   <br/>
<a href="https://developer.apple.com/library/ios/technotes/tn2232/_index.html#//apple_ref/doc/uid/DTS40012884-CH1-SECCUSTOMIZEAPIS">HTTPS Server Trust Evaluation</a>   <br/>
<a href="http://www.cocoachina.com/ios/20150810/12947.html">æ‰“é€ å®‰å…¨çš„Appï¼iOSå®‰å…¨ç³»åˆ—ä¹‹ HTTPS</a>   <br/>
<a href="http://www.cocoachina.com/ios/20140916/9632.html">AFNetworkingæºç è§£æ&lt;ä¸‰></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è‡ªå»ºè¯ä¹¦é…ç½®HTTPSæœåŠ¡å™¨]]></title>
    <link href="http://www.liuchungui.com/blog/2015/09/25/zi-jian-zheng-shu-pei-zhi-httpsfu-wu-qi/"/>
    <updated>2015-09-25T11:24:02+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/09/25/zi-jian-zheng-shu-pei-zhi-httpsfu-wu-qi</id>
    <content type="html"><![CDATA[<h3>è¯´æ˜</h3>

<p>1ã€å†™è¿™ç¯‡åšå®¢çš„åˆè¡·æ˜¯å› ä¸ºæœ€è¿‘iOS9å‡ºæ¥äº†ï¼Œè‹¹æœå®˜æ–¹é»˜è®¤è¦æ±‚ä½¿ç”¨HTTPSï¼Œæ‰€ä»¥è‡ªå·±æƒ³æ•´ä¸€ä¸ªHTTPSæœåŠ¡å™¨ï¼Œä¹Ÿæƒ³å¥½å¥½äº†è§£ä¸€ä¸‹HTTPSé€šä¿¡ï¼Œä¹ŸçŸ¥é“äº†HTTPSå…¶å®å°±æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†SSL/TLSã€‚å…·ä½“æƒ³äº†è§£SSL/TLSåŸç†çš„è¯·æµè§ˆ<a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">SSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°</a>å’Œ<a href="http://segmentfault.com/a/1190000002554673">SSL/TLSåŸç†è¯¦è§£</a>ã€‚ä¸­é€”çœ‹äº†å¾ˆå¤šåšå®¢ï¼Œä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œæ‰€ä»¥æƒ³è®°å½•ä¸€äº›ä¸œè¥¿ã€‚</p>

<p>2ã€è¿™ç¯‡åšå®¢çš„å†…å®¹ä¸»è¦æ˜¯è®²å‡çº§opensslã€å¦‚ä½•è‡ªå·±åˆ›å»ºè¯ä¹¦ã€é…ç½®è¯ä¹¦åˆ°æœåŠ¡å™¨å’Œè‡ªå»ºCAã€‚å…¶ä¸­å¯¹è¯ä¹¦ä¸å¤ªäº†è§£çš„ï¼Œå¯ä»¥çœ‹<a href="http://kb.cnblogs.com/page/194742/">æ•°å­—è¯ä¹¦åŠCAçš„æ‰«ç›²ä»‹ç»</a>è¿™ç¯‡æ–‡ç« ã€‚æœ¬ç¯‡åšå®¢å…¶ä¸­ç¬¬2æ­¥å’Œç¬¬3æ­¥å·²ç»é‡å¤ï¼Œåªéœ€è¦é€‰æ‹©å…¶ä¸­ä¸€æ­¥æ“ä½œå°±å¯ä»¥æ­å»ºHTTPSæœåŠ¡å™¨ï¼Œå½“ç„¶æ­å»ºéƒ½æ˜¯ä¸å—ä¿¡ä»»çš„ï¼Œå¦‚æœæ˜¯æ¶è®¾ç½‘ç«™è¿˜æ˜¯éœ€è¦åˆ°æƒå¨çš„CAæœºæ„ç”³è¯·è¯ä¹¦ã€‚æœ¬æ¥è¿˜æœ‰ç”ŸæˆiOSå®¢æˆ·ç«¯çš„è¯ä¹¦å’Œä½¿ç”¨è¯ä¹¦è¿æ¥æœåŠ¡å™¨ç›¸å…³çš„å†…å®¹ï¼Œç”±äºç¯‡å¹…çš„åŸå› å°±æŠŠå®ƒæ”¾åœ¨ä¸‹ä¸€ç¯‡å§ã€‚</p>

<p>3ã€æœ¬äººä½¿ç”¨äº†Mac10.10.5å’ŒUbuntu 14.04.1è¿›è¡Œé…ç½®æ­å»ºï¼Œæœ¬ç¯‡åšå®¢ä¸»è¦ä»¥Unbuntu 14.04.1ç³»ç»Ÿä¸ºä¸»ã€‚è€Œæœ¬äººè¿™ä¸ªUbuntu 14.04.1æ˜¯é˜¿é‡Œäº‘ä¸€é”®å®‰è£…çš„ï¼Œè€Œä¸”æ²¡æœ‰æ›´æ”¹é‡Œé¢çš„æœåŠ¡å™¨è®¾ç½®ï¼Œæ‰€ä»¥è¯¸å¤šçš„é…ç½®å¯èƒ½ä¸ä¸€èˆ¬Linuxç³»ç»Ÿä¸å¤ªç›¸åŒï¼ˆä¸æˆ‘ç”µè„‘ä¸Šçš„Linux mintå°±å¾ˆå¤§ä¸åŒï¼‰ã€‚ä¸è¿‡ï¼Œæˆ‘ä¼šåœ¨æœ€åè¯´æ˜ä¸€ä¸‹Macå’ŒLinuxé…ç½®ä¸€äº›ä¸åŒçš„åœ°æ–¹ï¼Œå…¶å®éƒ½æ˜¯ä¸€äº›ç›¸å…³è·¯å¾„çš„ä¸åŒã€‚å½“ç„¶ï¼Œæœ‰å¯èƒ½ä½ çš„Apacheå®‰è£…è·¯å¾„ä¸æˆ‘è¯´çš„å‡ ç§è·¯å¾„éƒ½ä¸åŒï¼Œæ²¡å…³ç³»ï¼Œå¯¹ç…§ç€ä¿®æ”¹ä¹Ÿåº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>

<!-- more -->


<h3>1ã€å®‰è£…å‡çº§openssl</h3>

<h5>é¦–å…ˆï¼ŒæŸ¥çœ‹ä¸‹å½“å‰è®¾å¤‡çš„opensslç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬åœ¨openssl1.0.1gä»¥ä¸Šï¼Œè¯·ç•¥è¿‡</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl version -a
</span><span class='line'>#OpenSSL 1.0.1f 6 Jan 2014</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæ˜¯å¤„äº<code>1.0.1-1.0.1f</code>çš„ç‰ˆæœ¬ï¼Œé‚£å°±èµ¶å¿«å‡çº§åˆ°<code>1.0.1g</code>ç‰ˆæœ¬ä»¥ä¸Šå§ï¼å› ä¸ºè¿™äº›ç‰ˆæœ¬å­˜åœ¨æ¼æ´ï¼Œè¯¦æƒ…è¯·è§<a href="http://drops.wooyun.org/papers/1381">å…³äºOpenSSLâ€œå¿ƒè„å‡ºè¡€â€æ¼æ´çš„åˆ†æ</a></p>

<p>ä»ä¸Šé¢ä¿¡æ¯å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„ç³»ç»Ÿç‰ˆæœ¬æ˜¯1.0.1fï¼Œopenssléœ€è¦å‡çº§ï¼Œé‚£æˆ‘ä»¬å…ˆæ¥ä¸‹è½½æºä»£ç </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://www.openssl.org/source/openssl-1.0.1g.tar.gz     </span></code></pre></td></tr></table></div></figure>


<p>ä¸‹è½½å®Œä¹‹åï¼Œè§£å‹å¹¶è¿›è¡Œå®‰è£…</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar -zxvf openssl-1.0.1g.tar.gz      
</span><span class='line'>cd  openssl-1.0.1g           
</span><span class='line'>./config shared zlib          
</span><span class='line'>make && make install        </span></code></pre></td></tr></table></div></figure>


<p>å®‰è£…çš„è¿‡ç¨‹ä¸­ï¼Œç¢°åˆ°äº†ä¸€ä¸ªé—®é¢˜
make: *** [install_docs] Error 255
è§£å†³è¿™ä¸ªé—®é¢˜è¯·ä½¿ç”¨<code>make install_sw</code>å®‰è£…ï¼Œè¯¦æƒ…è§<a href="https://github.com/openssl/openssl/issues/57">https://github.com/openssl/openssl/issues/57</a></p>

<h5>éšåï¼Œè¿›è¡Œç›¸å…³çš„è®¾ç½®</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ä¿®æ”¹å†å²çš„OpenSSLæ–‡ä»¶è®¾ç½®å¤‡ä»½
</span><span class='line'>mv /usr/bin/openssl /usr/bin/openssl.old
</span><span class='line'>mv /usr/include/openssl /usr/include/openssl.old
</span><span class='line'>
</span><span class='line'>#è®¾ç½®è½¯è¿æ¥ä½¿å…¶ä½¿ç”¨æ–°çš„OpenSSLç‰ˆæœ¬ åˆšåˆšå®‰è£…çš„OpenSSLé»˜è®¤å®‰è£…åœ¨/usr/local/ssl
</span><span class='line'>ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl
</span><span class='line'>ln -s /usr/local/ssl/include/openssl /usr/include/openssl
</span><span class='line'>
</span><span class='line'>#æ›´æ–°åŠ¨æ€é“¾æ¥åº“æ•°æ®
</span><span class='line'>echo "/usr/local/ssl/lib" &gt;&gt; /etc/ld.so.conf
</span><span class='line'>ldconfig -v</span></code></pre></td></tr></table></div></figure>


<p>æœ€åæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>openssl version
</span><span class='line'>OpenSSL 1.0.1g 7 Apr 2014</span></code></pre></td></tr></table></div></figure>


<p>1.0.1gç‰ˆæœ¬å®‰è£…æˆåŠŸ</p>

<h3>2ã€åˆ›å»ºç”¨ç§é’¥ç­¾åçš„è¯ä¹¦ï¼Œé…ç½®åˆ°ApacheæœåŠ¡å™¨</h3>

<h5>é¦–å…ˆï¼Œç”Ÿæˆç§é’¥ï¼Œåˆ›å»ºè¯·æ±‚è¯ä¹¦ï¼Œä½¿ç”¨ç§é’¥å¯¹è¯ä¹¦è¿›è¡Œç­¾å</h5>

<p>ç”Ÿæˆç§é’¥  <br/>
<code>openssl genrsa -des3 -out private.key 2048</code> <br/>
-des3ä»£è¡¨åŠ ä¸Šäº†åŠ å¯†ï¼Œåé¢çš„2048æ˜¯ä»£è¡¨ç”Ÿæˆçš„å¯†é’¥çš„ä½æ•°ï¼Œ1024å·²ç»ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œè¯¦æƒ…è¯·è§<a href="http://get.jobdeer.com/1607.get">äº’è”ç½‘å…¨ç«™HTTPSçš„æ—¶ä»£å·²ç»åˆ°æ¥</a></p>

<p>ç”Ÿæˆè¯ä¹¦è¯·æ±‚   <br/>
<code>openssl req -new -key private.key -out server.csr</code>  <br/>
è¿™ä¸€æ­¥éœ€è¦å¡«å†™ä¸€äº›ä¿¡æ¯ï¼Œå…¶ä¸­<code>Common Name (e.g. server FQDN or YOUR name) []</code>è¿™ä¸ªéœ€è¦å¡«å†™ä½ çš„åŸŸåæˆ–æœåŠ¡å™¨åœ°å€ã€‚</p>

<p>ç”ŸæˆæœåŠ¡å™¨çš„ç§é’¥ï¼Œå»é™¤å¯†é’¥å£ä»¤   <br/>
<code>openssl rsa -in private.key -out server.key</code></p>

<p>ä½¿ç”¨ç§é’¥ä¸ºè¯ä¹¦è¯·æ±‚ç­¾åï¼Œç”Ÿæˆç»™æœåŠ¡å™¨ç­¾ç½²çš„è¯ä¹¦ï¼Œæ ¼å¼æ˜¯x509çš„PEMæ ¼å¼  <br/>
<code>openssl x509 -req -in server.csr -out server.crt -outform pem -signkey server.key -days 3650</code> <br/>
-outform pemæŒ‡å®šè¯ä¹¦ç”Ÿæˆçš„æ ¼å¼ï¼Œé»˜è®¤æ˜¯pemï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥å†™ä½œæˆ<code>sudo openssl x509 -req -in server.csr -out server.crt -signkey server.key -days 3650</code>ã€‚</p>

<p>å°†è¯ä¹¦copyåˆ°Apacheé…ç½®è·¯å¾„ä¸‹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo  mkdir /alidata/server/httpd/conf/ssl
</span><span class='line'>cp server.key /alidata/server/httpd/conf/ssl/server.key
</span><span class='line'>cp server.crt  /alidata/server/httpd/conf/ssl/server.crt</span></code></pre></td></tr></table></div></figure>


<h5>å…¶æ¬¡ï¼Œé…ç½®ApacheæœåŠ¡å™¨</h5>

<p>ç¼–è¾‘/alidata/server/httpd/conf/httpd.confæ–‡ä»¶</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#LoadModule ssl_module modules/mod_ssl.so
</span><span class='line'>#LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
</span><span class='line'>#Include conf/extra/httpd-ssl.conf</span></code></pre></td></tr></table></div></figure>


<p>å°†è¿™ä¸‰è¡Œå‰é¢çš„#å»æ‰</p>

<p>ç¼–è¾‘<code>/alidata/server/httpd/conf/extra/httpd-ssl.conf</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°SSLCertificateFileã€SSLCertificateKeyFileï¼Œä¿®æ”¹å®ƒä»¬ä¸¤å¯¹åº”çš„æ–‡ä»¶</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SSLCertificateFile "/alidata/server/httpd/conf/ssl/server.crt"
</span><span class='line'>SSLCertificateKeyFile "/alidata/server/httpd/conf/ssl/server.key"</span></code></pre></td></tr></table></div></figure>


<p>ç¼–è¾‘<code>/alidata/server/httpd/conf/vhosts/phpwind.conf</code>æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰æ›´æ”¹é˜¿é‡Œäº‘çš„é…ç½®ï¼Œå¦‚æœä½ ä¸æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„<code>httpd/conf/extra/httpd-vhosts.conf</code>æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ªæ–‡ä»¶æˆ‘ä¸»è¦åŠ äº†ä¸‹é¢çš„å†…å®¹ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;VirtualHost *:443&gt;
</span><span class='line'>        SSLCertificateFile    /alidata/server/httpd/conf/ssl/server.crt
</span><span class='line'>        SSLCertificateKeyFile /alidata/server/httpd/conf/ssl/server.key
</span><span class='line'>        ServerName 182.92.5.161
</span><span class='line'>        DocumentRoot /alidata/www
</span><span class='line'>&lt;/VirtualHost&gt;</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œå’±ä»¬é‡å¯ApacheæœåŠ¡å™¨ï¼Œè¾“å…¥é“¾æ¥æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸã€‚</p>

<h3>3ã€è‡ªå»ºCAï¼Œç”¨CAè¯ä¹¦è¿›è¡Œç­¾åï¼Œé…ç½®åˆ°ApacheæœåŠ¡å™¨</h3>

<h5>ç¬¬ä¸€æ­¥ã€ä½¿ç”¨CA.shåˆ›å»ºCAæ ¹è¯ä¹¦</h5>

<p>ä¿®æ”¹opensslçš„é…ç½®æ–‡ä»¶<code>sudo vim /usr/local/ssl/openssl.cnf</code>ï¼Œä¿®æ”¹<code>default_bits=1024</code>ä¸º<code>default_bits=2048</code>ï¼Œä½¿å…¶opensslåŠ å¯†ä½¿ç”¨2048ä½ï¼ŒåŸå› å‰é¢å·²ç»è¯´è¿‡ã€‚</p>

<p>éšååˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶ä¸”å°†ç”ŸæˆCAè¯ä¹¦çš„è„šæœ¬CA.shå¤åˆ¶åˆ°è¿™ä¸ªç›®å½•</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir ca
</span><span class='line'>cd ca
</span><span class='line'>cp /usr/local/ssl/misc/CA.sh CA.sh</span></code></pre></td></tr></table></div></figure>


<p>CA.shè¿™ä¸ªè„šæœ¬å¦‚æœæ‰¾ä¸åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ <code>openssl version -a</code>æŸ¥çœ‹opensslå¯¹åº”çš„ç›®å½•ï¼Œè€ŒCA.shä¸€èˆ¬å°±åœ¨è¿™ä¸ªç›®å½•çš„å­ç›®å½•miscç›®å½•ä¸‹ã€‚</p>

<p>ä¹‹åæ‰§è¡Œ<code>./CA.sh -newca</code>å‘½ä»¤  <br/>
CA.shä¼šä½¿ç”¨<code>/usr/local/ssl/openssl.cnf</code>ä¸­çš„é…ç½®æ¥åˆ›å»ºç§é’¥å’Œè¯ä¹¦ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥ä¸ºå•¥éœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„åŸå› ã€‚</p>

<p>åˆ›å»ºCAè¯ä¹¦è¿‡ç¨‹ä¸­ï¼Œä¸è¾“å…¥ä¿¡æ¯ï¼Œç›´æ¥å›è½¦ï¼Œå¡«å†™åŠ å¯†ç§é’¥çš„å¯†ç å’Œç”ŸæˆCAè¯ä¹¦çš„ç›¸å…³ä¿¡æ¯ã€‚</p>

<p>åˆ›å»ºå®Œä¹‹åä¼šç”ŸæˆdemoCAç›®å½•ã€‚è¿™ä¸ªç›®å½•æœ‰</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cacert.pem  certs  index.txt       index.txt.old  private
</span><span class='line'>careq.pem   crl    index.txt.attr  newcerts       serial</span></code></pre></td></tr></table></div></figure>


<p>å…¶ä¸­cacert.pemæ˜¯CAçš„è¯ä¹¦ï¼Œprivateå­˜æ”¾CAçš„ç§é’¥ï¼Œnewcertså­˜æ”¾CAç­¾åçš„å¤‡ä»½ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„CAå·²ç»å»ºå¥½äº†ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡CAæ¥å¯¹æˆ‘ä»¬çš„è¯ä¹¦è¿›è¡Œç­¾åäº†ã€‚</p>

<h5>ç¬¬äºŒæ­¥ã€ä½¿ç”¨CAæ ¹è¯ä¹¦ä¸ºæœåŠ¡å™¨è¯ä¹¦ç­¾å</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ç”Ÿæˆç§é’¥
</span><span class='line'>sudo  openssl genrsa -des3 -out private.key 2048
</span><span class='line'>#ç”Ÿæˆè¯ä¹¦è¯·æ±‚
</span><span class='line'>sudo openssl req -new -key private.key -out server.csr
</span><span class='line'>#ç”ŸæˆæœåŠ¡å™¨çš„ç§é’¥ï¼Œå»é™¤å¯†é’¥å£ä»¤
</span><span class='line'>sudo openssl rsa -in private.key -out server.key
</span><span class='line'>#ä½¿ç”¨CAè¿›è¡Œç­¾åï¼Œç”Ÿæˆserver.crt
</span><span class='line'>cp server.csr newreq.pem
</span><span class='line'>./CA.sh -sign
</span><span class='line'>mv newcert.pem server.crt
</span><span class='line'>æˆ–è€…ä¸Šé¢ä¸‰æ­¥éƒ½ä¸éœ€è¦ï¼Œç›´æ¥ä½¿ç”¨ä¸‹é¢ä¸€æ­¥
</span><span class='line'>openssl ca -in server.csr -out server.crt</span></code></pre></td></tr></table></div></figure>


<p>æ›´å¤šopenssl ca å‘½ä»¤è¯·è§<a href="http://blog.csdn.net/as3luyuan123/article/details/13346613">OpenSSLå‘½ä»¤&ndash;ca</a></p>

<h5>ç¬¬ä¸‰æ­¥ã€é…ç½®æœåŠ¡å™¨ï¼š</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir ssl
</span><span class='line'>cp server.crt ssl/server.crt
</span><span class='line'>cp server.key ssl/server.key
</span><span class='line'>cp demoCA/cacert.pem ssl/ca.crt
</span><span class='line'>cp -r ssl /alidata/server/httpd/conf/</span></code></pre></td></tr></table></div></figure>


<p>ç¼–è¾‘<code>/alidata/server/httpd/conf/extra/httpd-ssl.conf</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°SSLCertificateFileã€SSLCertificateKeyFileã€SSLCACertificatePathã€SSLCACertificateFileè¿›è¡Œä¿®æ”¹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># æŒ‡å®šæœåŠ¡å™¨è¯ä¹¦ä½ç½®
</span><span class='line'>SSLCertificateFile "/alidata/server/httpd/conf/ssl/server.crt"
</span><span class='line'># æŒ‡å®šæœåŠ¡å™¨è¯ä¹¦keyä½ç½®
</span><span class='line'>SSLCertificateKeyFile "/alidata/server/httpd/conf/ssl/server.key"
</span><span class='line'># è¯ä¹¦ç›®å½•
</span><span class='line'>SSLCACertificatePath "/alidata/server/httpd/conf/ssl"
</span><span class='line'># æ ¹è¯ä¹¦ä½ç½®
</span><span class='line'>SSLCACertificateFile "/alidata/server/httpd/conf/ssl/ca.crt"</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹vhosté…ç½®<code>vim /alidata/server/httpd/conf/vhosts/phpwind.conf</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;VirtualHost *:443&gt;
</span><span class='line'>        SSLCertificateFile    /alidata/server/httpd/conf/ssl/server.crt
</span><span class='line'>        SSLCertificateKeyFile /alidata/server/httpd/conf/ssl/server.key
</span><span class='line'>        SSLCACertificatePath /alidata/server/httpd/conf/ssl
</span><span class='line'>        SSLCACertificateFile /alidata/server/httpd/conf/ssl/ca.crt
</span><span class='line'>        ServerName 182.92.5.161
</span><span class='line'>        DocumentRoot /alidata/www
</span><span class='line'>&lt;/VirtualHost&gt;</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œå’±ä»¬é‡å¯ApacheæœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥é“¾æ¥æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸã€‚å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼Œä¸ç¬¬äºŒæ­¥ä¸åŒä¹‹å¤„åœ¨äºæ­¤æ—¶çš„è¯ä¹¦æœ‰ä¸¤ä¸ªã€‚</p>

<h3>æœ€åï¼Œä¸Macå’Œå¯»å¸¸Linuxç³»ç»Ÿä¸€äº›åŒºåˆ«</h3>

<h5>ä¸€ã€ä¸MACçš„å‡ ç‚¹ä¸åŒ</h5>

<p>1ã€é¦–å…ˆå®‰è£…opensslï¼Œå‚è€ƒæˆ‘çš„<a href="http://www.liuchungui.com/blog/2016/05/10/mac10-dot-11sheng-ji-an-zhuang-openssl/">Mac10.11å‡çº§å®‰è£…openssl</a>  <br/>
2ã€Macä¸Šå¯¹åº”çš„Opensslçš„è·¯å¾„æ˜¯<code>/System/Library/OpenSSL/</code>  <br/>
3ã€Macä¸Šå¯¹åº”çš„Apacheçš„è·¯å¾„æ˜¯<code>/etc/apache2/</code>  <br/>
4ã€Macä¸Šé‡å¯æœåŠ¡å™¨ä½¿ç”¨<code>/usr/sbin/apachectl restart</code>ï¼Œé˜¿é‡Œäº‘æœåŠ¡å™¨ä½¿ç”¨<code>/etc/init.d/httpd restart</code>æˆ–è€…<code>service httpd restart</code>   <br/>
5ã€Macä¸Švhosté…ç½®çš„è·¯å¾„æ˜¯<code>/etc/apache2/extra/httpd-vhosts.conf</code></p>

<h5>äºŒã€ä¸å¯»å¸¸Linuxç³»ç»Ÿçš„ä¸åŒ</h5>

<p>ä¸»è¦å€Ÿé‰´<a href="http://m.blog.csdn.net/blog/whyliu_/41749521">MacOS opensslä¸‹ç”Ÿæˆå»ºç«‹CAå¹¶ç”ŸæˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦æ–¹æ³•</a>è¿™ç¯‡æ–‡ç«    <br/>
1ã€linuxä¸ŠApacheçš„è·¯å¾„æ˜¯<code>/usr/local/apache</code>  <br/>
2ã€linuxä¸Švhosté…ç½®çš„è·¯å¾„æ˜¯<code>/usr/local/apache/conf/extra/httpd_vhosts.conf</code></p>

<h3>æ€»ç»“</h3>

<p>1ã€å¯¹HTTPSçš„ç†è§£  <br/>
å®ƒçš„åŸºæœ¬åŸç†æ˜¯æœåŠ¡å™¨æ‹¥æœ‰ä¸€ä¸ªç§é’¥ï¼Œå®¢æˆ·ç«¯æ‹¥æœ‰å…¬é’¥ï¼Œå½“ç„¶å®ƒä»¬æ˜¯ä½¿ç”¨è¯ä¹¦ç®¡ç†çš„ã€‚æ¯æ¬¡é€šä¿¡å®ƒä»¬é€šè¿‡è¯ä¹¦è¿›è¡Œèº«ä»½è®¤è¯ã€‚èº«ä»½è®¤è¯ä¹‹åå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªâ€œå¯¹è¯å¯†é’¥â€ç»™æœåŠ¡å™¨ã€‚ä¼ è¾“â€œå¯¹è¯å¯†é’¥â€æ—¶ï¼Œå®¢æˆ·ç«¯å…¬é’¥é€šè¿‡ä¸å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†äº†çš„ï¼Œåªæœ‰æœåŠ¡å™¨æ‰èƒ½è§£å¯†ã€‚ç„¶ååŒæ–¹ä½¿ç”¨è¿™ä¸ª"å¯¹è¯å¯†é’¥"å¯¹å†…å®¹è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼ŒåŒæ–¹ä¹‹é—´ä¼ è¾“å†…å®¹ã€‚</p>

<p>2ã€å¯¹opensslã€SSL/TLSçš„ç›¸å…³ç†è§£  <br/>
opensslæ˜¯ä¸€å¥—å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œå¯ä»¥å¯¹ç›¸å…³å†…å®¹è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆè¯ä¹¦å¹¶ä¸”è¿›è¡Œæ•°å­—ç­¾åã€‚å®ƒåˆ›å»ºçš„x509è¯ä¹¦æœ‰PEMå’ŒDERä¸¤ç§ç¼–ç ï¼Œè€Œä¸”å®ƒä»¬è¿˜å¯ä»¥å¯¼å‡ºp12æ–‡ä»¶ã€‚å®ƒä½¿ç”¨çš„åŠ å¯†ç®—æ³•æœ‰å¯¹ç§°åŠ å¯†ï¼Œä¹Ÿæœ‰ä¸å¯¹ç§°åŠ å¯†ã€‚</p>

<p>3ã€HTTPSç›¸å…³ç†è®ºçŸ¥è¯†åšå®¢ï¼Œå€¼å¾—ç»†è¯»  <br/>
<a href="http://segmentfault.com/a/1190000002568019">OpenSSL ä¸ SSL æ•°å­—è¯ä¹¦æ¦‚å¿µè´´</a>  <br/>
<a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">SSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°</a>  <br/>
<a href="http://segmentfault.com/a/1190000002554673">SSL/TLSåŸç†è¯¦è§£</a></p>

<h3>å‚è€ƒï¼š</h3>

<p><a href="http://www.yezhongqi.com/archives/1377.html">httpsä»‹ç»ä¸ç¯å¢ƒæ­å»º</a>  <br/>
<a href="http://myswirl.blog.163.com/blog/static/5131864220071014102353799/">OpenSSLå¸¸ç”¨å‘½ä»¤</a>  <br/>
<a href="http://blog.csdn.net/as3luyuan123/article/details/13344757">OpenSSLå‘½ä»¤&mdash;CA.pl</a>  <br/>
<a href="http://m.blog.csdn.net/blog/whyliu_/41749521">MacOS opensslä¸‹ç”Ÿæˆå»ºç«‹CAå¹¶ç”ŸæˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¯ä¹¦æ–¹æ³•</a>   <br/>
<a href="http://blog.csdn.net/zhu410289616/article/details/46566073">macä¸­apacheå¼€å¯httpsåŠŸèƒ½ï¼Œæœ¬åœ°å‘å¸ƒå®‰è£…app</a>  <br/>
<a href="http://www.cnblogs.com/kyrios/p/tls-and-certificates.html">TLS/HTTPS è¯ä¹¦ç”Ÿæˆä¸éªŒè¯</a>   <br/>
<a href="http://www.cnblogs.com/phpinfo/archive/2013/08/09/3246376.html">OpenSSLå°ç»“</a>      <br/>
<a href="http://www.cnblogs.com/alittlebitcool/archive/2011/09/22/2185418.html">åˆ©ç”¨opensslè¿›è¡ŒRSAåŠ å¯†è§£å¯†</a>  <br/>
<a href="http://blog.sina.com.cn/s/blog_a9303fd90101jmtx.html">DER å’Œ PEM æ ¼å¼</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AutoLayoutä½¿ç”¨ä»£ç å†™çº¦æŸ]]></title>
    <link href="http://www.liuchungui.com/blog/2015/09/20/autolayoutshi-yong-dai-ma-xie-yue-shu/"/>
    <updated>2015-09-20T23:20:56+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/09/20/autolayoutshi-yong-dai-ma-xie-yue-shu</id>
    <content type="html"><![CDATA[<h3>ä¸€ã€çº¦æŸæ˜¯ä»€ä¹ˆï¼Ÿ</h3>

<p>  çº¦æŸæ˜¯è§†å›¾ä¸è§†å›¾ä¹‹é—´ä¸€äº›å±æ€§å…³ç³»ã€‚</p>

<!-- more -->


<p>  æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸‹é¢çš„å†…å®¹ï¼š</p>

<p>  <strong>è§†å›¾å±æ€§</strong>ï¼šè§†å›¾å±æ€§(attribute)æœ‰<code>left</code>, <code>right</code>, <code>top</code>, <code>bottom</code>, <code>leading</code>, <code>trailing</code>, <code>width</code>, <code>height</code>, <code>centerX</code>, <code>centerY</code> å’Œ <code>baseline</code>ã€‚(æ³¨ï¼šiOS8åŠ ä¸Šäº†<code>Margin</code>ï¼Œæ‰€ä»¥å®é™…ä¸Šä»iOS8å¼€å§‹ä¸æ­¢è¿™äº›)</p>

<p>çº¦æŸå±æ€§ï¼šæ¯ä¸€ä¸ªçº¦æŸ(Constraint)æ‹¥æœ‰çš„å±æ€§(Property)æœ‰ï¼š</p>

<ul>
<li> <strong>Constant value</strong>: åç§»é‡</li>
<li> <strong>Relation</strong>: å±æ€§ä¹‹é—´çš„å…³ç³»ï¼Œå’Œå…³ç³»è¡¨è¾¾å¼å¯¹åº”ï¼Œä¾‹å¦‚>(å¤§äº),=(ç­‰äº),>=(å¤§äºç­‰äº)</li>
<li> <strong>Priority level</strong>: ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šä¼šæ»¡è¶³æ­¤çº¦æŸã€‚</li>
</ul>


<p>ä¸€ä¸ªæ™®é€šçº¦æŸè¡¨è¾¾å¼: <code>view1.attribute = view2.attribute + ConstantValue</code></p>

<p>ä¾‹å­ï¼šå½“ä½ å®šä¹‰ä¸€ä¸ªbuttonçš„ä½ç½®æ—¶ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªè¦æ±‚ï¼š"æŒ‰é’®çš„å·¦è¾¹è·ç¦»çˆ¶è§†å›¾çš„å·¦è¾¹20åƒç´ "ã€‚å…¶å®è¿™å¥è¯ç”¨çº¦æŸè¡¨è¾¾å°±æ˜¯<code>button.left = (superView.left + 20)</code>ã€‚</p>

<h3>äºŒã€VFL(Visual Format Language)</h3>

<h5>1ã€è¯­æ³•</h5>

<p>ä¸‹é¢è¿™æ˜¯ä¸€äº›å¸¸ç”¨çš„VFLè¯­æ³•ç¤ºä¾‹ï¼Œå¦‚æœæƒ³è¦çŸ¥é“æ›´è¯¦ç»†çš„è¯­æ³•è§„åˆ™ï¼Œè¯·æŸ¥çœ‹<a href="https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/AutolayoutPG/VisualFormatLanguage.html">Auto Layout Guide</a></p>

<table style="text-align:center;" bgcolor="#FFFFFF"> 
   <tbody>
    <tr> 
     <td>è¯­æ³•ç¤ºä¾‹</td> 
     <td>æ•ˆæœå›¾ç‰‡</td> 
     <td>è§£é‡Š</td> 
    </tr> 
   </tbody>
   <tbody> 
    <tr> 
     <td>[button]-[textField]</td> 
     <td><img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew8up8p9omj205z00odfm.jpg" /></td> 
     <td>æ ‡å‡†ç©ºé—´è·ç¦»ä¸º8åƒç´ </td> 
    </tr> 
    <tr> 
     <td>[button(&gt;=50)]</td> 
     <td><img src="http://ww2.sinaimg.cn/large/91c6e389jw1ew8ur9pn6nj2020015q2q.jpg" /></td> 
     <td>å®½åº¦çº¦æŸ</td> 
    </tr> 
    <tr> 
     <td>|-50-[purpleBox]-50-|</td> 
     <td><img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew8uro1kggj204800wq2r.jpg" /></td> 
     <td>è®¾ç½®ä¸çˆ¶è§†å›¾çš„å…³ç³»ï¼Œ'|'ä»£è¡¨çˆ¶è§†å›¾</td> 
    </tr> 
    <tr> 
     <td>V:[topField]-10-[bottomField]</td> 
     <td><img src="http://ww1.sinaimg.cn/large/91c6e389jw1ew8us3r78nj202o01ia9t.jpg" /></td> 
     <td>å‚ç›´æ–¹å‘çš„å¸ƒå±€ï¼Œ'V'ä»£è¡¨å‚ç›´æ–¹å‘ï¼Œ'H'ä»£è¡¨æ°´å¹³æ–¹å‘</td> 
    </tr> 
    <tr> 
     <td>[maroonView][blueView]</td> 
     <td><img src="http://ww1.sinaimg.cn/large/91c6e389jw1ew8usnshqsj202r00k0b9.jpg" /></td> 
     <td>Flush Views</td> 
    </tr> 
    <tr> 
     <td>[button(100@20)]</td> 
     <td><img src="http://ww1.sinaimg.cn/large/91c6e389jw1ew8usxcz1lj202u014t8i.jpg" /></td> 
     <td>è®¾ç½®ä¼˜å…ˆçº§ï¼Œ@åé¢å°±æ˜¯æ­¤çº¦æŸçš„ä¼˜å…ˆçº§</td> 
    </tr> 
    <tr> 
     <td>[button1(==button2)]</td> 
     <td><img src="http://ww3.sinaimg.cn/large/91c6e389jw1ew8ut6n9abj205e015jr9.jpg" /></td> 
     <td>ç­‰å®½è®¾ç½®</td> 
    </tr> 
    <tr> 
     <td>[flexibleButton(&gt;=70,&lt;=100)]</td> 
     <td><img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew8uteqiv8j202t01m744.jpg" /></td> 
     <td>å¤šä¸ªè°“è¯­æ¥ç¡®å®šå°ºå¯¸</td> 
    </tr> 
   </tbody> 
</table>


<p></p>

<h5>2ã€VFLä½¿ç”¨</h5>

<p>æˆ‘ä»¬ç°åœ¨éœ€è¦åšè¿™ä¹ˆä¸€ä¸ªUIéœ€æ±‚ï¼šé¡µé¢ä¸­æœ‰ä¸¤ä¸ªå…ƒç´ ä¸€å¼ å›¾ç‰‡å’Œä¸€ä¸ªæ–‡æœ¬ã€‚å›¾ç‰‡è·å·¦å³ä¸¤è¾¹å’Œé¡¶éƒ¨10åƒç´ ï¼Œè€Œè·åº•éƒ¨100åƒç´ ï¼›æ–‡æœ¬è·å›¾ç‰‡30åƒç´ ã€‚è¿™ä¸ªç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿè¯·çœ‹ä¸‹é¢ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;dog.jpg&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFit</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ³¨æ„ï¼šä»£ç çº¦æŸéœ€è¦è®¾ç½®è§†å›¾çš„translatesAutoresizingMaskIntoConstraintså±æ€§ä¸ºNO</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">imageView</span> <span class="o">=</span> <span class="n">imageView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="bp">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectZero</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">darkGrayColor</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;This is a lovely dog&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">viewsDictionary</span> <span class="o">=</span> <span class="n">NSDictionaryOfVariableBindings</span><span class="p">(</span><span class="n">imageView</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡çš„æ°´å¹³æ–¹å‘è·çˆ¶è§†å›¾å·¦å³ä¸¤è¾¹éƒ½ä¸º10</span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">constraintArr1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;H:|-10-[imageView]-10-|&quot;</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">viewsDictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraints</span><span class="p">:</span><span class="n">constraintArr1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡å‚ç›´æ–¹å‘è·çˆ¶è§†å›¾é¡¶éƒ¨10ï¼Œåº•éƒ¨100</span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">constraintArr2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;V:|-10-[imageView]-100-|&quot;</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">viewsDictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraints</span><span class="p">:</span><span class="n">constraintArr2</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®labelçš„çº¦æŸ</span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">constraintArr3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;V:[imageView]-30-[label]&quot;</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">viewsDictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraints</span><span class="p">:</span><span class="n">constraintArr3</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚ä¸‹æ˜¯è¿è¡Œçš„æ•ˆæœå›¾ï¼š</p>

<p><img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew8yjnu80jj20yi1pcwj4.jpg" width=310 height=552 /></p>

<p>   åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨VFLå®ç°äº†éœ€æ±‚ã€‚</p>

<p>   å‡å¦‚æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬çš„äº§å“ç»ç†è§‰å¾—è¿™ä¸ªæ•ˆæœä¸å¥½çœ‹ï¼Œéœ€è¦æ”¹ä¸€æ”¹ï¼Œç„¶åUIè®¾è®¡å¸ˆé‡æ–°å‡ºäº†ä¸€å¥—æ•ˆæœå›¾ã€‚ä¸Šé¢çš„é¡µé¢å·²ç»ä¿®æ”¹æˆï¼šå›¾ç‰‡è·å·¦å³ä¸¤è¾¹å’Œé¡¶éƒ¨10åƒç´ ï¼Œè€Œå›¾ç‰‡å®½ä¸é«˜æ¯”ä¾‹ä¸º5:7ï¼›æè¿°æ–‡æœ¬å¤„äºæ°´å¹³å±…ä¸­ä½ç½®ï¼Œå¹¶ä¸”å¤„äºå›¾ç‰‡çš„ä¸‹æ–¹ä¸å±å¹•ä¸Šæ–¹å±…ä¸­ä½ç½®ã€‚</p>

<p>   æ­¤æ—¶ï¼Œæˆ‘ä»¬ç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿ</p>

<p>   æŸ¥çœ‹VFLè¯­æ³•ï¼Œæ˜æ˜¾å›¾ç‰‡å®½ä¸é«˜æ¯”ä¾‹ä¸º5:7è¿™ä¸ªéœ€æ±‚æ²¡æœ‰ç›´æ¥å¯¹åº”çš„è¯­æ³•ï¼Œå®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‹¹æœä¸ºæˆ‘ä»¬å°è£…çš„å¦å¤–ä¸€ä¸ªåˆ›å»ºçº¦æŸçš„æ–¹æ³•<code>constraintWithItem:attribute:relatedBy:toItem:attribute:multiplier:constant:</code>ï¼Œå°±å¯ä»¥è½»æ˜“å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚å¦‚ä¸‹ï¼Œå°±æ˜¯å®ç°ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;dog.jpg&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFit</span><span class="p">;</span>
</span><span class='line'><span class="c1">//æ³¨æ„ï¼šä»£ç çº¦æŸéœ€è¦è®¾ç½®è§†å›¾çš„translatesAutoresizingMaskIntoConstraintså±æ€§ä¸ºNO</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">imageView</span> <span class="o">=</span> <span class="n">imageView</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="bp">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectZero</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">darkGrayColor</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;This is a lovely dog&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">viewsDictionary</span> <span class="o">=</span> <span class="n">NSDictionaryOfVariableBindings</span><span class="p">(</span><span class="n">imageView</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡çš„æ°´å¹³æ–¹å‘è·çˆ¶è§†å›¾å·¦å³ä¸¤è¾¹éƒ½ä¸º10åƒç´ </span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">constraintArr1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;H:|-10-[imageView]-10-|&quot;</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">viewsDictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraints</span><span class="p">:</span><span class="n">constraintArr1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">//è®¾ç½®å›¾ç‰‡å‚ç›´æ–¹å‘è·çˆ¶è§†å›¾é¡¶éƒ¨10åƒç´ ï¼Œåº•éƒ¨100åƒç´ </span>
</span><span class='line'><span class="cm">NSArray *constraintArr2 = [NSLayoutConstraint constraintsWithVisualFormat:@&quot;V:|-10-[imageView]-100-|&quot; options:0 metrics:nil views:viewsDictionary];</span>
</span><span class='line'><span class="cm">[self.view addConstraints:constraintArr2];</span>
</span><span class='line'>
</span><span class='line'><span class="cm">//è®¾ç½®labelçš„çº¦æŸ</span>
</span><span class='line'><span class="cm">NSArray *constraintArr3 = [NSLayoutConstraint constraintsWithVisualFormat:@&quot;V:[imageView]-30-[label]&quot; options:0 metrics:nil views:viewsDictionary];</span>
</span><span class='line'><span class="cm">[self.view addConstraints:constraintArr3];</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡çš„å®½ä¸é«˜çš„æ¯”ä¾‹ä¸º5:7</span>
</span><span class='line'><span class="bp">NSLayoutConstraint</span> <span class="o">*</span><span class="n">constraint1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintWithItem</span><span class="p">:</span><span class="n">imageView</span> <span class="nl">attribute</span><span class="p">:</span><span class="n">NSLayoutAttributeHeight</span> <span class="nl">relatedBy</span><span class="p">:</span><span class="n">NSLayoutRelationEqual</span> <span class="nl">toItem</span><span class="p">:</span><span class="n">imageView</span> <span class="nl">attribute</span><span class="p">:</span><span class="n">NSLayoutAttributeWidth</span> <span class="nl">multiplier</span><span class="p">:</span><span class="mf">1.4</span> <span class="nl">constant</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraint</span><span class="p">:</span><span class="n">constraint1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡è·é¡¶éƒ¨10åƒç´ ï¼Œæè¿°æ–‡å­—å¤„äºå›¾ç‰‡ä¸å±å¹•åº•éƒ¨ä¸­é—´</span>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">constraintArr3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;V:|-10-[imageView]-[label]-|&quot;</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">viewsDictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraints</span><span class="p">:</span><span class="n">constraintArr3</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//æè¿°æ–‡æœ¬æ°´å¹³å±…ä¸­</span>
</span><span class='line'><span class="bp">NSLayoutConstraint</span> <span class="o">*</span><span class="n">constraint2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintWithItem</span><span class="p">:</span><span class="n">label</span> <span class="nl">attribute</span><span class="p">:</span><span class="n">NSLayoutAttributeCenterX</span> <span class="nl">relatedBy</span><span class="p">:</span><span class="n">NSLayoutRelationEqual</span> <span class="nl">toItem</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">attribute</span><span class="p">:</span><span class="n">NSLayoutAttributeCenterX</span> <span class="nl">multiplier</span><span class="p">:</span><span class="mf">1.0</span> <span class="nl">constant</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addConstraint</span><span class="p">:</span><span class="n">constraint2</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew905ecso1j20yi1pc78y.jpg" width=310 height=552 /></p>

<p><code>constraintWithItem:attribute:relatedBy:toItem:attribute:multiplier:constant:</code>æ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†åˆ›å»ºè§†å›¾çº¦æŸå±æ€§ä¹‹é—´çš„å…³ç³»ï¼Œè€Œè¿™ä¸ªæ–¹æ³•çš„ç²¾é«“ä¸»è¦æ˜¯è¿™ä¹ˆä¸€ä¸ªè¡¨è¾¾å¼ï¼š<strong>view1.attribute = view2.attribute * multiplier + constant</strong>ã€‚è¿™é‡Œä¸æˆ‘ä»¬å‰é¢è®²è¿‡çš„è¡¨è¾¾å¼ç±»ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªmultiplierçš„ç³»æ•°ã€‚</p>

<h3>ä¸‰ã€Masnoryå†™çº¦æŸ</h3>

<p><a href="https://github.com/SnapKit/Masonry">Masonry</a>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¸ƒå±€æ¡†æ¶ï¼Œæ‹¥æœ‰è‡ªå·±çš„æè¿°è¯­æ³•ï¼Œé‡‡ç”¨æ›´ä¼˜é›…çš„é“¾å¼è¯­æ³•å°è£…è‡ªåŠ¨å¸ƒå±€ï¼Œç®€æ´æ˜äº† å¹¶å…·æœ‰é«˜å¯è¯»æ€§ã€‚</p>

<p>ä¸Šé¢çš„éœ€æ±‚ï¼Œæˆ‘ä½¿ç”¨Masnoryå®ç°èµ·æ¥ï¼Œä»£ç ç®€æ´äº†å¾ˆå¤šï¼Œè€Œä¸”åŸºæœ¬ä¸Šä¸æ€ä¹ˆéœ€è¦å­¦å°±èƒ½é€šè¿‡Masnoryå®ç°ä¸Šé¢çš„éœ€æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//æ³¨æ„ï¼šä»£ç çº¦æŸéœ€è¦è®¾ç½®è§†å›¾çš„translatesAutoresizingMaskIntoConstraintså±æ€§ä¸ºNO</span>
</span><span class='line'><span class="bp">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;dog.jpg&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">contentMode</span> <span class="o">=</span> <span class="n">UIViewContentModeScaleAspectFit</span><span class="p">;</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UILabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectZero</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">darkGrayColor</span><span class="p">];</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;This is a lovely dog&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">label</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//è®¾ç½®å›¾ç‰‡çš„æ°´å¹³æ–¹å‘è·çˆ¶è§†å›¾å·¦å³ä¸¤è¾¹éƒ½ä¸º10åƒç´ ï¼Œå›¾ç‰‡çš„å®½ä¸é«˜çš„æ¯”ä¾‹ä¸º5:7</span>
</span><span class='line'><span class="p">[</span><span class="n">imageView</span> <span class="nl">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_left</span><span class="p">).</span><span class="n">with</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_right</span><span class="p">).</span><span class="n">with</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_top</span><span class="p">).</span><span class="n">with</span><span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">height</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">imageView</span><span class="p">.</span><span class="n">mas_width</span><span class="p">).</span><span class="n">with</span><span class="p">.</span><span class="n">multipliedBy</span><span class="p">(</span><span class="mf">1.4</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//æ–‡å­—æè¿°æ°´å¹³å±…ä¸­ï¼Œå¹¶ä¸”å¤„äºå›¾ç‰‡ä¸å±å¹•åº•éƒ¨ä¸­é—´</span>
</span><span class='line'><span class="p">[</span><span class="n">label</span> <span class="nl">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">centerX</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_centerX</span><span class="p">);</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">imageView</span><span class="p">.</span><span class="n">mas_bottom</span><span class="p">);</span>
</span><span class='line'>    <span class="n">make</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_bottom</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>  æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p>  <img src="http://ww4.sinaimg.cn/large/91c6e389jw1ew905ecso1j20yi1pc78y.jpg" width=310 height=552 /></p>

<p>  ç¤ºä¾‹ä»£ç å·²ç»æ”¾åˆ°githubä¸Šäº†ï¼Œ<a href="https://github.com/liuchungui/VFLDemo.git">githubä»£ç ç¤ºä¾‹</a></p>

<h3>å››ã€ä½¿ç”¨AutoLayoutæ—¶ï¼Œå¦‚ä½•æ·»åŠ åŠ¨ç”»ï¼Ÿ</h3>

<p> ä½¿ç”¨VFLæ—¶ï¼ŒåŠ¨ç”»æ”¹å˜å°ºå¯¸æˆ–ä½ç½®æ—¶ï¼Œå¾ˆç®€å•åªéœ€è¦å°†å¯¹åº”çš„çº¦æŸä¿å­˜æˆå…¨å±€å˜é‡ï¼Œç„¶åæ”¹å˜çº¦æŸå½“ä¸­çš„å±æ€§å°±è¡Œäº†ã€‚</p>

<p> ä½¿ç”¨AutolayoutåŠ¨ç”»æ”¹å˜å°ºå¯¸ã€ä½ç½®çš„å®˜æ–¹æ¨¡æ¿å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">containerView</span> <span class="n">layoutIfNeeded</span><span class="p">];</span> <span class="c1">// Ensures that all pending layout operations have been completed</span>
</span><span class='line'><span class="p">[</span><span class="bp">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span><span class="mf">1.0</span> <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Make all constraint changes here</span>
</span><span class='line'><span class="p">[</span><span class="n">containerView</span> <span class="n">layoutIfNeeded</span><span class="p">];</span> <span class="c1">// Forces the layout of the subtree animation block and then captures all of the frame changes</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>é‚£å¦‚æœä½¿ç”¨çš„æ˜¯Masnoryæ¡†æ¶ï¼Œæ€ä¹ˆæ·»åŠ åŠ¨ç”»ï¼Ÿ</p>

<p>æˆ‘è¿™é‡Œæœ‰ä¸ªDemoï¼Œè¯·çœ‹ä»£ç ï¼š</p>

<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];

    //åˆ›å»ºdisplayView
    UIView *displayView = [[UIView alloc] init];
    displayView.backgroundColor = [UIColor purpleColor];
    [self.view addSubview:displayView];
    self.displayView = displayView;

    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    [button setTitle:@"ç‚¹å‡»" forState:UIControlStateNormal];
    [button setTitleColor:[UIColor darkGrayColor] forState:UIControlStateHighlighted];
    [button setTitleColor:[UIColor blueColor] forState:UIControlStateNormal];
    [button addTarget:self action:@selector(buttonAction:) forControlEvents:UIControlEventTouchUpInside];
    [self.view addSubview:button];

    //æ·»åŠ çº¦æŸ
    [displayView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.view.mas_top).offset(100);
        make.size.mas_equalTo(CGSizeMake(50, 50));
        make.centerX.equalTo(self.view.mas_centerX);
    }];

    [button mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.equalTo(self.view.mas_centerX);
        make.size.mas_equalTo(CGSizeMake(200, 50));
        make.bottom.mas_equalTo(self.view.mas_bottom).offset(-50);
    }];
    // Do any additional setup after loading the view, typically from a nib.
} 


- (void)buttonAction:(UIButton *)butt    on{
    //åŠ¨    ç”»æ”¹å˜
    [self.view layoutIfNeeded];
    [UIView animateWithDuration:1.0 animations:^{
        [self.displayView mas_updateConstraints:^(MASConstraintMaker *make) {
            make.size.mas_equalTo(CGSizeMake(300, 300));
            }];
        [self.view layoutIfNeeded];
    }];
}
</code></pre>

<p>ç¤ºä¾‹ä»£ç å·²ç»æ”¾åˆ°githubä¸Šäº†ï¼Œ<a href="https://github.com/liuchungui/AnimationForAutoLayoutDemo.git">githubä»£ç ç¤ºä¾‹</a></p>

<h3>äº”ã€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä»£ç å†™çº¦æŸï¼Ÿ</h3>

<p>  ä½¿ç”¨Xibå†™çº¦æŸï¼Œå¯ä»¥å¾ˆç›´è§‚ã€å¿«æ·çš„æ­å»ºç•Œé¢ï¼Œè®©æˆ‘ä»¬çš„å¼€å‘é€Ÿåº¦æå‡å¾ˆå¿«ã€‚ä½†ï¼ŒXibå¼€å‘æœ‰æ—¶å€™ä¸æ˜¯å¾ˆçµæ´»ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¾—è€ƒè™‘ä½¿ç”¨ä»£ç æ¥å®ç°çº¦æŸã€‚</p>

<p>  ä»¥ä¸‹å‡ ç§æƒ…å†µï¼Œæˆ‘è§‰å¾—ä½¿ç”¨ä»£ç å†™çº¦æŸæ¯”è¾ƒé€‚åˆï¼š</p>

<ul>
<li>è¿è¡Œæ—¶æ”¹å˜è§†å›¾å°ºå¯¸ã€ä½ç½®çš„æ—¶å€™ï¼Œåº”è¯¥ä½¿ç”¨ä»£ç å†™çº¦æŸ</li>
<li>å°è£…ä¸€ä¸ªæ§ä»¶æ—¶ï¼Œä½¿å…¶èƒ½å¤Ÿæœ‰è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œåº”è¯¥ä½¿ç”¨ä»£ç å†™çº¦æŸ</li>
<li>æ·»åŠ åŠ¨ç”»çš„æ—¶å€™ï¼Œä½¿ç”¨ä»£ç å†™çº¦æŸã€‚</li>
<li>ä¸€äº›å¤æ‚çš„UIï¼Œä½¿ç”¨IBå¾ˆéš¾å®ç°çš„åœºæ™¯ï¼Œä½¿ç”¨ä»£ç å†™çº¦æŸ</li>
</ul>


<h3>å…­ã€æ€»ç»“</h3>

<p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²äº†ä¸‹é¢ä¸€äº›ä¸œè¥¿</p>

<ul>
<li>çº¦æŸæ˜¯ä»€ä¹ˆ</li>
<li>VFLç›¸å…³è¯­æ³•</li>
<li>VFLçš„ä½¿ç”¨</li>
<li>Masnoryæ¡†æ¶çš„ä½¿ç”¨</li>
<li>ä½¿ç”¨Autolayoutæ—¶ï¼Œæ·»åŠ åŠ¨ç”»</li>
<li>å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨ä»£ç æ¥å†™çº¦æŸ</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Macç”µè„‘ä¸Šæ­å»ºoctopressåšå®¢]]></title>
    <link href="http://www.liuchungui.com/blog/2015/09/11/macdian-nao-shang-da-jian-octopressbo-ke/"/>
    <updated>2015-09-11T22:51:44+08:00</updated>
    <id>http://www.liuchungui.com/blog/2015/09/11/macdian-nao-shang-da-jian-octopressbo-ke</id>
    <content type="html"><![CDATA[<p>æ­å»ºoctopressåšå®¢çš„æ–‡ç« å¾ˆè¯¦ç»†å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œæ–‡ç« æœ«å°¾å°±æœ‰ç›¸å…³çš„å‚è€ƒï¼Œæˆ‘è¿™é‡Œåªç®€å•è®°å½•ä¸‹macç”µè„‘ä¸Šæ­å»ºoctopressåšå®¢çš„æ­¥éª¤ã€‚</p>

<h4>1ã€æ­å»ºç¯å¢ƒ</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'>cd octopress
</span><span class='line'>gem install bundler
</span><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<p>é‡åˆ°çš„é—®é¢˜ï¼š</p>

<ul>
<li><p><code>gem install bundler</code>å¤±è´¥äº†ï¼Œéœ€è¦æ›´æ”¹ä¸€ä¸‹<code>octopress/Gemfile</code>æ–‡ä»¶å½“ä¸­çš„æºï¼Œå°†ç¬¬ä¸€è¡Œ<code>source "https://rubygems.org"</code> æ›´æ”¹æˆ <code>source "http://ruby.taobao.org/"</code>å°±è¡Œäº†ã€‚</p></li>
<li><p>å¦‚æœå®‰è£…çš„æ—¶å€™æŠ¥<code>â€œYou don't have write permissions for the /Library/Ruby/Gems/2.0.0 directoryâ€</code>è¿™æ ·çš„é”™è¯¯ï¼Œè¯·åŠ ä¸Šsudoæƒé™ã€‚</p></li>
</ul>


<p>ä¹‹åï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake install</span></code></pre></td></tr></table></div></figure>


<h4>2ã€å°†åšå®¢éƒ¨ç½²åˆ°githubä¸Š</h4>

<p>åœ¨githubä¸Šåˆ›å»ºä¸€ä¸ª<code>username.github.io</code>çš„ä»“åº“ï¼Œç„¶åè¾“å…¥ä¸‹é¢å‘½ä»¤</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<p>å›è½¦ï¼Œä¹‹åå‡ºç°ä¸‹é¢å†…å®¹</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Enter the read/write url for your repository
</span><span class='line'>(For example, 'git@github.com:your_username/your_username.github.io.git)
</span><span class='line'>           or 'https://github.com/your_username/your_username.github.io')
</span><span class='line'>Repository url:</span></code></pre></td></tr></table></div></figure>


<p>ç²˜è´´<code>username.github.io</code>ä»“åº“å¯¹åº”çš„urlï¼Œä¾‹å¦‚æˆ‘çš„å°±æ˜¯<code>https://github.com/liuchungui/liuchungui.github.io.git</code></p>

<h4>3ã€ç”Ÿæˆå¹¶ç¼–è¾‘åšå®¢</h4>

<p>é¦–å…ˆï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤ç”Ÿæˆæ–°æ–‡ç« ï¼Œå…¶ä¸­titleå°±æ˜¯åšæ–‡åï¼Œä½ ä¹Ÿå¯ä»¥è¾“å…¥<code>rake new_post</code>å›è½¦ï¼Œç„¶ååœ¨å†è¾“å…¥åšæ–‡åã€‚æ–‡ç« åœ¨<code>source/_post/</code>ç›®å½•ä¸‹ï¼Œ<code>æ–‡ä»¶åæ„æˆä¸ºæ—¶é—´å’Œæ ‡é¢˜çš„æ‹¼éŸ³</code>ã€‚å¯ä»¥è¿›å…¥åˆ°<code>octopress/source/_posts</code>ç›®å½•ï¼Œæ‰¾åˆ°å¯¹åº”çš„åšæ–‡è¿›è¡Œä¿®æ”¹ã€‚åšæ–‡é‡‡ç”¨çš„markdownè¯­æ³•ï¼Œæˆ‘æ¨èä¸€æ¬¾ä¸é”™çš„ç¼–è¾‘å·¥å…·<strong>Mou</strong>ï¼Œå®ƒå¯ä»¥å®æ—¶ç¼–è¾‘å®æ—¶æŸ¥çœ‹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_post['title']</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤ç”Ÿæˆå¹¶åœ¨æœ¬åœ°è¿›è¡Œé¢„è§ˆã€‚<code>rake preview</code>å¼€å¯ä¸€ä¸ªwebæœåŠ¡ï¼Œæ­¤æ—¶å°±å¯ä»¥é¢„è§ˆäº†ï¼Œä½¿ç”¨<code>localhost:4000</code>æ‰“å¼€çœ‹æŸ¥çœ‹æ•ˆæœã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate
</span><span class='line'>rake preview</span></code></pre></td></tr></table></div></figure>


<p>ä¹‹åï¼ŒæŸ¥çœ‹æ•ˆæœæ²¡æœ‰é—®é¢˜ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ä¸Šä¼ åˆ°githubã€‚è¿™æ¡å‘½ä»¤ä¼šå°†<code>octopress/public</code>ä¸‹çš„æ–‡ä»¶ä¸Šä¼ åˆ°ä½ çš„ä»“åº“masteråˆ†æ”¯ä¸‹ã€‚</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake deploy</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œå°†æºä»£ç ä¸Šä¼ åˆ°githubä»“åº“çš„sourceåˆ†æ”¯ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span><span class='line'>git commit -m 'add source file'
</span><span class='line'>git push origin source</span></code></pre></td></tr></table></div></figure>


<h4>4ã€åˆ é™¤twitterã€googleç›¸å…³ä¸œè¥¿ï¼š</h4>

<ul>
<li>ä¿®æ”¹æ–‡ä»¶<code>octopress/_config.yml</code>æ–‡ä»¶ï¼Œè®¾ç½®titleã€subtitleã€authorï¼Œæ³¨æ„æœ€å¥½æŠŠé‡Œé¢çš„ twitter ç›¸å…³çš„ä¿¡æ¯å…¨éƒ¨åˆ æ‰ï¼Œå¦åˆ™ç”±äº GFW çš„åŸå› ï¼Œå°†ä¼šé€ æˆé¡µé¢ load å¾ˆæ…¢ã€‚</li>
<li>ä¿®æ”¹å¤´éƒ¨æ¨¡å— <strong>source/_includes/head.html</strong> å°†<code>//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js</code>æ›¿æ¢æˆ<code>http://cdn.staticfile.org/jquery/1.9.1/jquery.min.js</code>ï¼Œå¦åˆ™ä¼šå¾ˆæ…¢ã€‚</li>
<li>ä¿®æ”¹å®šåˆ¶æ–‡ä»¶ <strong>source/_includes/custom/head.html</strong> æŠŠ google çš„è‡ªå®šä¹‰å­—ä½“å»æ‰ï¼ŒåŸå› åŒä¸Šã€‚</li>
</ul>


<h4>5ã€è‡ªå®šä¹‰åšå®¢</h4>

<p>æ–°æ ‡ç­¾æ‰“å¼€ç½‘ç«™ä¸­ç¬¬ä¸‰æ–¹é“¾æ¥é»˜è®¤æ˜¯ä»å½“å‰ç•Œé¢æ‰“å¼€ï¼Œè¿™å¯¼è‡´ç½‘ç«™æµè§ˆè€…è·³è½¬åˆ°ç¬¬ä¸‰æ–¹é“¾æ¥åå¾ˆéš¾å›æ¥ã€‚å°†ä»¥ä¸‹ä»£ç åŠ å…¥ <code>source/_includes/custom/head.html</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ˜¯æ–°å»ºä¸€ä¸ªç•Œé¢æ‰“å¼€ï¼Œä»ç„¶ä¿æŒå½“å‰ç½‘é¡µã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">addBlankTargetForLinks</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a[href^=&quot;http&quot;]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;_blank&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;DOMNodeInserted&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">addBlankTargetForLinks</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>é»˜è®¤æƒ…å†µï¼Œæ‰€æœ‰æ–‡å­—çš„æ’å¤´ä¼šå¯¹é½ï¼Œä½†å¦‚æœæœ‰åˆ—è¡¨é¡¹çš„æƒ…å†µä¸‹ä¹Ÿå¦‚æ­¤ï¼Œåˆ—è¡¨å¤´å°±ä¼šå†²å‡ºæ–‡ç« çš„ä¸»ä½“åŒºå—äº†ã€‚åœ¨ octopress/sass/custom/_layout.scss æ–‡ä»¶ä¸­æ‰¾åˆ°#$indented-lists: true è¡Œï¼Œå»æ‰#æ³¨é‡Šå³å¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$indented</span><span class="o">-</span><span class="nx">lists</span><span class="o">:</span> <span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…¶å®ƒï¼Œç•Œé¢ã€ä¾§è¾¹æ ã€åº•éƒ¨æ ã€æ·»åŠ topå›åˆ°é¡¶éƒ¨ç­‰ï¼Œè¯·å‚è€ƒ<a href="http://foggry.com/blog/2014/04/28/custom-your-octopress-blog/">è‡ªå®šä¹‰ä½ çš„Octopressåšå®¢</a></p>

<p><strong>æ³¨æ„ï¼šå½“è‡ªå®šä¹‰äº†åšå®¢æ—¶ï¼Œä¿®æ”¹äº†å¤´ã€ä¾§è¾¹æ ã€åº•éƒ¨æ ã€æ·»åŠ è¯„è®ºç­‰é…ç½®æ–‡ä»¶åï¼Œä½¿ç”¨rake generateç”Ÿæˆä¸€ä¸‹ã€‚</strong></p>

<h4>6ã€æ–°å¢</h4>

<p>1ã€å‘å¸ƒåšå®¢ï¼ˆ2016.4.5ï¼‰</p>

<p>æ·»åŠ è¿™ä¸ªï¼Œæ˜¯å› ä¸ºæŸä¸€å¤©ä¸å°å¿ƒä½¿ç”¨å‘½ä»¤è¡Œå…¨åˆ äº†ï¼Œåæ¥å‘ç°è‡ªå·±çš„åšå®¢åªæ˜¯<code>rake deploy</code>ï¼Œå´æ²¡æœ‰å°†æºä»£ç çš„æ ·å¼å’Œåšå®¢çš„markdownæ–‡ä»¶æäº¤åˆ°githubï¼Œå½“æ—¶å¿ƒé‡ŒæŒºéš¾å—çš„ï¼Œéš¾é“è¦ä¸€ä¸ªä¸€ä¸ªæ¢å¤ï¼Ÿå› ä¸ºè¿™ä»¶äº‹æƒ…ï¼Œä¸­é—´è¿˜æ–­è¿‡ä¸€æ®µæ—¶é—´ï¼Œå¥½åœ¨åæ¥ä¸€ä¸€åœ¨å¦å¤–ä¸€ä¸ªç›®å½•ä¸‹æ‰¾åˆ°äº†ã€‚ä½†æ˜¯ï¼Œè¿™ç§äº‹æƒ…ä¸å…è®¸å†æ¬¡å‘ç”Ÿï¼Œæ‰€ä»¥ä¸“é—¨å†™äº†ä¸€ä¸ªç®€å•çš„blogPublishè„šæœ¬ã€‚
è„šæœ¬çš„å†…å®¹ç‰¹åˆ«ç®€å•ï¼Œå°±æ˜¯deployæ–‡ç« ï¼Œç„¶åå°†æºä»£ç pushåˆ°githubä¸Šã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span><span class="o">!</span><span class="err">/bin/bash</span>
</span><span class='line'><span class="nx">rake</span> <span class="nx">generate</span>
</span><span class='line'><span class="nx">rake</span> <span class="nx">deploy</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="p">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">m</span> <span class="s1">&#39;update blog&#39;</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">source</span>
</span></code></pre></td></tr></table></div></figure>


<p>2ã€è¡¨æ ¼æ·»åŠ è¾¹æ¡†ï¼ˆ2016.4.5ï¼‰</p>

<p>2016.4.5 ä¸ºè¡¨æ ¼æ·»åŠ è¾¹æ¡†ï¼Œå‚è€ƒ<a href="http://programus.github.io/blog/2012/03/07/add-table-data-css-for-octopress/">ä¸ºOctopressè¿½åŠ æ•°æ®è¡¨æ ¼çš„CSS</a></p>

<h4>å‚è€ƒ</h4>

<p>æ·»åŠ è¯„è®ºå’Œåˆ†äº«ç³»ç»Ÿï¼Œè¯·å‚è€ƒ<a href="http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/">è±¡å†™ç¨‹åºä¸€æ ·å†™åšå®¢ï¼šæ­å»ºåŸºäºgithubçš„åšå®¢</a></p>

<p><a href="http://matrixzk.github.io/blog/20141020/octopress-setup-and-analysis/#section">ä½¿ç”¨ Octopress 2.0 æ­å»ºåŸºäº Github Pages ä¸ªäººåšå®¢çš„è¯¦ç»†è¿‡ç¨‹åŠåŸç†åˆ†æ</a></p>

<p><a href="http://www.jianshu.com/p/0ac2ac1a8e45">octopressåšå®¢æ­å»ºå’Œä¸ªæ€§åŒ–é…ç½®</a></p>

<p><a href="http://biaobiaoqi.github.io/blog/2013/07/10/decorate-octopress/">å®šåˆ¶Octopress</a></p>
]]></content>
  </entry>
  
</feed>
